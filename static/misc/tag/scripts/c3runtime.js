!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).glMatrix={})}(this,(function(e){var t=1e-6,s="undefined"!=typeof Float32Array?Float32Array:Array,i=Math.random,r="zyx";var n=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var a=Object.freeze({__proto__:null,EPSILON:t,get ARRAY_TYPE(){return s},RANDOM:i,ANGLE_ORDER:r,setMatrixArrayType:function(e){s=e},toRadian:function(e){return e*n},equals:function(e,s){return Math.abs(e-s)<=t*Math.max(1,Math.abs(e),Math.abs(s))}});function o(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=s[0],h=s[1],l=s[2],c=s[3];return e[0]=i*o+n*h,e[1]=r*o+a*h,e[2]=i*l+n*c,e[3]=r*l+a*c,e}function h(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e}var l=o,c=h,u=Object.freeze({__proto__:null,create:function(){var e=new s(4);return s!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new s(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,i,r){var n=new s(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},set:function(e,t,s,i,r){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e},transpose:function(e,t){if(e===t){var s=t[1];e[1]=t[2],e[2]=s}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=s*n-r*i;return a?(a=1/a,e[0]=n*a,e[1]=-i*a,e[2]=-r*a,e[3]=s*a,e):null},adjoint:function(e,t){var s=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=s,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:o,rotate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.sin(s),h=Math.cos(s);return e[0]=i*h+n*o,e[1]=r*h+a*o,e[2]=i*-o+n*h,e[3]=r*-o+a*h,e},scale:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=s[0],h=s[1];return e[0]=i*o,e[1]=r*o,e[2]=n*h,e[3]=a*h,e},fromRotation:function(e,t){var s=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=s,e[2]=-s,e[3]=i,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3])},LDU:function(e,t,s,i){return e[2]=i[2]/i[0],s[0]=i[0],s[1]=i[1],s[3]=i[3]-e[2]*s[1],[e,t,s]},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e},subtract:h,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,s){var i=e[0],r=e[1],n=e[2],a=e[3],o=s[0],h=s[1],l=s[2],c=s[3];return Math.abs(i-o)<=t*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-h)<=t*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-l)<=t*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=t*Math.max(1,Math.abs(a),Math.abs(c))},multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e},mul:l,sub:c});function _(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=s[0],c=s[1],u=s[2],_=s[3],d=s[4],p=s[5];return e[0]=i*l+n*c,e[1]=r*l+a*c,e[2]=i*u+n*_,e[3]=r*u+a*_,e[4]=i*d+n*p+o,e[5]=r*d+a*p+h,e}function d(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e}var p=_,f=d,m=Object.freeze({__proto__:null,create:function(){var e=new s(6);return s!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new s(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,i,r,n,a){var o=new s(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=n,o[5]=a,o},set:function(e,t,s,i,r,n,a){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=s*n-i*r;return h?(h=1/h,e[0]=n*h,e[1]=-i*h,e[2]=-r*h,e[3]=s*h,e[4]=(r*o-n*a)*h,e[5]=(i*a-s*o)*h,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:_,rotate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=Math.sin(s),c=Math.cos(s);return e[0]=i*c+n*l,e[1]=r*c+a*l,e[2]=i*-l+n*c,e[3]=r*-l+a*c,e[4]=o,e[5]=h,e},scale:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=s[0],c=s[1];return e[0]=i*l,e[1]=r*l,e[2]=n*c,e[3]=a*c,e[4]=o,e[5]=h,e},translate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=s[0],c=s[1];return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=i*l+n*c+o,e[5]=r*l+a*c+h,e},fromRotation:function(e,t){var s=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=s,e[2]=-s,e[3]=i,e[4]=0,e[5]=0,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e},subtract:d,multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,s){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=s[0],c=s[1],u=s[2],_=s[3],d=s[4],p=s[5];return Math.abs(i-l)<=t*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=t*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=t*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-_)<=t*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-d)<=t*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(h-p)<=t*Math.max(1,Math.abs(h),Math.abs(p))},mul:p,sub:f});function g(){var e=new s(9);return s!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function S(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=t[8],_=s[0],d=s[1],p=s[2],f=s[3],m=s[4],g=s[5],S=s[6],y=s[7],G=s[8];return e[0]=_*i+d*a+p*l,e[1]=_*r+d*o+p*c,e[2]=_*n+d*h+p*u,e[3]=f*i+m*a+g*l,e[4]=f*r+m*o+g*c,e[5]=f*n+m*h+g*u,e[6]=S*i+y*a+G*l,e[7]=S*r+y*o+G*c,e[8]=S*n+y*h+G*u,e}function y(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e[6]=t[6]-s[6],e[7]=t[7]-s[7],e[8]=t[8]-s[8],e}var G=S,I=y,T=Object.freeze({__proto__:null,create:g,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new s(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,i,r,n,a,o,h,l){var c=new s(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=n,c[5]=a,c[6]=o,c[7]=h,c[8]=l,c},set:function(e,t,s,i,r,n,a,o,h,l){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e[6]=o,e[7]=h,e[8]=l,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var s=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=s,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=c*a-o*l,_=-c*n+o*h,d=l*n-a*h,p=s*u+i*_+r*d;return p?(p=1/p,e[0]=u*p,e[1]=(-c*i+r*l)*p,e[2]=(o*i-r*a)*p,e[3]=_*p,e[4]=(c*s-r*h)*p,e[5]=(-o*s+r*n)*p,e[6]=d*p,e[7]=(-l*s+i*h)*p,e[8]=(a*s-i*n)*p,e):null},adjoint:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8];return e[0]=a*c-o*l,e[1]=r*l-i*c,e[2]=i*o-r*a,e[3]=o*h-n*c,e[4]=s*c-r*h,e[5]=r*n-s*o,e[6]=n*l-a*h,e[7]=i*h-s*l,e[8]=s*a-i*n,e},determinant:function(e){var t=e[0],s=e[1],i=e[2],r=e[3],n=e[4],a=e[5],o=e[6],h=e[7],l=e[8];return t*(l*n-a*h)+s*(-l*r+a*o)+i*(h*r-n*o)},multiply:S,translate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=t[8],_=s[0],d=s[1];return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=o,e[5]=h,e[6]=_*i+d*a+l,e[7]=_*r+d*o+c,e[8]=_*n+d*h+u,e},rotate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=t[8],_=Math.sin(s),d=Math.cos(s);return e[0]=d*i+_*a,e[1]=d*r+_*o,e[2]=d*n+_*h,e[3]=d*a-_*i,e[4]=d*o-_*r,e[5]=d*h-_*n,e[6]=l,e[7]=c,e[8]=u,e},scale:function(e,t,s){var i=s[0],r=s[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){var s=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=s,e[2]=0,e[3]=-s,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=s+s,o=i+i,h=r+r,l=s*a,c=i*a,u=i*o,_=r*a,d=r*o,p=r*h,f=n*a,m=n*o,g=n*h;return e[0]=1-u-p,e[3]=c-g,e[6]=_+m,e[1]=c+g,e[4]=1-l-p,e[7]=d-f,e[2]=_-m,e[5]=d+f,e[8]=1-l-u,e},normalFromMat4:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],_=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],S=s*o-i*a,y=s*h-r*a,G=s*l-n*a,I=i*h-r*o,T=i*l-n*o,b=r*l-n*h,C=c*f-u*p,P=c*m-_*p,v=c*g-d*p,x=u*m-_*f,R=u*g-d*f,w=_*g-d*m,A=S*w-y*R+G*x+I*v-T*P+b*C;return A?(A=1/A,e[0]=(o*w-h*R+l*x)*A,e[1]=(h*v-a*w-l*P)*A,e[2]=(a*R-o*v+l*C)*A,e[3]=(r*R-i*w-n*x)*A,e[4]=(s*w-r*v+n*P)*A,e[5]=(i*v-s*R-n*C)*A,e[6]=(f*b-m*T+g*I)*A,e[7]=(m*G-p*b-g*y)*A,e[8]=(p*T-f*G+g*S)*A,e):null},projection:function(e,t,s){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/s,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e[8]=t[8]+s[8],e},subtract:y,multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e[6]=t[6]+s[6]*i,e[7]=t[7]+s[7]*i,e[8]=t[8]+s[8]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,s){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],c=e[7],u=e[8],_=s[0],d=s[1],p=s[2],f=s[3],m=s[4],g=s[5],S=s[6],y=s[7],G=s[8];return Math.abs(i-_)<=t*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(r-d)<=t*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-p)<=t*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-f)<=t*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-m)<=t*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(h-g)<=t*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(l-S)<=t*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-y)<=t*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-G)<=t*Math.max(1,Math.abs(u),Math.abs(G))},mul:G,sub:I});function b(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function C(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=t[8],_=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],S=t[15],y=s[0],G=s[1],I=s[2],T=s[3];return e[0]=y*i+G*o+I*u+T*f,e[1]=y*r+G*h+I*_+T*m,e[2]=y*n+G*l+I*d+T*g,e[3]=y*a+G*c+I*p+T*S,y=s[4],G=s[5],I=s[6],T=s[7],e[4]=y*i+G*o+I*u+T*f,e[5]=y*r+G*h+I*_+T*m,e[6]=y*n+G*l+I*d+T*g,e[7]=y*a+G*c+I*p+T*S,y=s[8],G=s[9],I=s[10],T=s[11],e[8]=y*i+G*o+I*u+T*f,e[9]=y*r+G*h+I*_+T*m,e[10]=y*n+G*l+I*d+T*g,e[11]=y*a+G*c+I*p+T*S,y=s[12],G=s[13],I=s[14],T=s[15],e[12]=y*i+G*o+I*u+T*f,e[13]=y*r+G*h+I*_+T*m,e[14]=y*n+G*l+I*d+T*g,e[15]=y*a+G*c+I*p+T*S,e}function P(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,h=r+r,l=n+n,c=i*o,u=i*h,_=i*l,d=r*h,p=r*l,f=n*l,m=a*o,g=a*h,S=a*l;return e[0]=1-(d+f),e[1]=u+S,e[2]=_-g,e[3]=0,e[4]=u-S,e[5]=1-(c+f),e[6]=p+m,e[7]=0,e[8]=_+g,e[9]=p-m,e[10]=1-(c+d),e[11]=0,e[12]=s[0],e[13]=s[1],e[14]=s[2],e[15]=1,e}function v(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function x(e,t){var s=t[0],i=t[1],r=t[2],n=t[4],a=t[5],o=t[6],h=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(s,i,r),e[1]=Math.hypot(n,a,o),e[2]=Math.hypot(h,l,c),e}function R(e,t){var i=new s(3);x(i,t);var r=1/i[0],n=1/i[1],a=1/i[2],o=t[0]*r,h=t[1]*n,l=t[2]*a,c=t[4]*r,u=t[5]*n,_=t[6]*a,d=t[8]*r,p=t[9]*n,f=t[10]*a,m=o+u+f,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(_-p)/g,e[1]=(d-l)/g,e[2]=(h-c)/g):o>u&&o>f?(g=2*Math.sqrt(1+o-u-f),e[3]=(_-p)/g,e[0]=.25*g,e[1]=(h+c)/g,e[2]=(d+l)/g):u>f?(g=2*Math.sqrt(1+u-o-f),e[3]=(d-l)/g,e[0]=(h+c)/g,e[1]=.25*g,e[2]=(_+p)/g):(g=2*Math.sqrt(1+f-o-u),e[3]=(h-c)/g,e[0]=(d+l)/g,e[1]=(_+p)/g,e[2]=.25*g),e}function w(e,t,s,i,r){var n=1/Math.tan(t/2);if(e[0]=n/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){var a=1/(i-r);e[10]=(r+i)*a,e[14]=2*r*i*a}else e[10]=-1,e[14]=-2*i;return e}var A=w;function M(e,t,s,i,r,n,a){var o=1/(t-s),h=1/(i-r),l=1/(n-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+s)*o,e[13]=(r+i)*h,e[14]=(a+n)*l,e[15]=1,e}var D=M;function E(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e[6]=t[6]-s[6],e[7]=t[7]-s[7],e[8]=t[8]-s[8],e[9]=t[9]-s[9],e[10]=t[10]-s[10],e[11]=t[11]-s[11],e[12]=t[12]-s[12],e[13]=t[13]-s[13],e[14]=t[14]-s[14],e[15]=t[15]-s[15],e}var k=C,F=E,O=Object.freeze({__proto__:null,create:function(){var e=new s(16);return s!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new s(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,i,r,n,a,o,h,l,c,u,_,d,p,f,m){var g=new s(16);return g[0]=e,g[1]=t,g[2]=i,g[3]=r,g[4]=n,g[5]=a,g[6]=o,g[7]=h,g[8]=l,g[9]=c,g[10]=u,g[11]=_,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},set:function(e,t,s,i,r,n,a,o,h,l,c,u,_,d,p,f,m){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e[6]=o,e[7]=h,e[8]=l,e[9]=c,e[10]=u,e[11]=_,e[12]=d,e[13]=p,e[14]=f,e[15]=m,e},identity:b,transpose:function(e,t){if(e===t){var s=t[1],i=t[2],r=t[3],n=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=s,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=r,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],_=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],S=s*o-i*a,y=s*h-r*a,G=s*l-n*a,I=i*h-r*o,T=i*l-n*o,b=r*l-n*h,C=c*f-u*p,P=c*m-_*p,v=c*g-d*p,x=u*m-_*f,R=u*g-d*f,w=_*g-d*m,A=S*w-y*R+G*x+I*v-T*P+b*C;return A?(A=1/A,e[0]=(o*w-h*R+l*x)*A,e[1]=(r*R-i*w-n*x)*A,e[2]=(f*b-m*T+g*I)*A,e[3]=(_*T-u*b-d*I)*A,e[4]=(h*v-a*w-l*P)*A,e[5]=(s*w-r*v+n*P)*A,e[6]=(m*G-p*b-g*y)*A,e[7]=(c*b-_*G+d*y)*A,e[8]=(a*R-o*v+l*C)*A,e[9]=(i*v-s*R-n*C)*A,e[10]=(p*T-f*G+g*S)*A,e[11]=(u*G-c*T-d*S)*A,e[12]=(o*P-a*x-h*C)*A,e[13]=(s*x-i*P+r*C)*A,e[14]=(f*y-p*I-m*S)*A,e[15]=(c*I-u*y+_*S)*A,e):null},adjoint:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],u=t[9],_=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],S=s*o-i*a,y=s*h-r*a,G=s*l-n*a,I=i*h-r*o,T=i*l-n*o,b=r*l-n*h,C=c*f-u*p,P=c*m-_*p,v=c*g-d*p,x=u*m-_*f,R=u*g-d*f,w=_*g-d*m;return e[0]=o*w-h*R+l*x,e[1]=r*R-i*w-n*x,e[2]=f*b-m*T+g*I,e[3]=_*T-u*b-d*I,e[4]=h*v-a*w-l*P,e[5]=s*w-r*v+n*P,e[6]=m*G-p*b-g*y,e[7]=c*b-_*G+d*y,e[8]=a*R-o*v+l*C,e[9]=i*v-s*R-n*C,e[10]=p*T-f*G+g*S,e[11]=u*G-c*T-d*S,e[12]=o*P-a*x-h*C,e[13]=s*x-i*P+r*C,e[14]=f*y-p*I-m*S,e[15]=c*I-u*y+_*S,e},determinant:function(e){var t=e[0],s=e[1],i=e[2],r=e[3],n=e[4],a=e[5],o=e[6],h=e[7],l=e[8],c=e[9],u=e[10],_=e[11],d=e[12],p=e[13],f=e[14],m=t*a-s*n,g=t*o-i*n,S=s*o-i*a,y=l*p-c*d,G=l*f-u*d,I=c*f-u*p;return h*(t*I-s*G+i*y)-r*(n*I-a*G+o*y)+e[15]*(l*S-c*g+u*m)-_*(d*S-p*g+f*m)},multiply:C,translate:function(e,t,s){var i,r,n,a,o,h,l,c,u,_,d,p,f=s[0],m=s[1],g=s[2];return t===e?(e[12]=t[0]*f+t[4]*m+t[8]*g+t[12],e[13]=t[1]*f+t[5]*m+t[9]*g+t[13],e[14]=t[2]*f+t[6]*m+t[10]*g+t[14],e[15]=t[3]*f+t[7]*m+t[11]*g+t[15]):(i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=t[8],_=t[9],d=t[10],p=t[11],e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=o,e[5]=h,e[6]=l,e[7]=c,e[8]=u,e[9]=_,e[10]=d,e[11]=p,e[12]=i*f+o*m+u*g+t[12],e[13]=r*f+h*m+_*g+t[13],e[14]=n*f+l*m+d*g+t[14],e[15]=a*f+c*m+p*g+t[15]),e},scale:function(e,t,s){var i=s[0],r=s[1],n=s[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,s,i,r){var n,a,o,h,l,c,u,_,d,p,f,m,g,S,y,G,I,T,b,C,P,v,x,R,w=r[0],A=r[1],M=r[2],D=Math.hypot(w,A,M);return D<t?null:(w*=D=1/D,A*=D,M*=D,n=Math.sin(i),o=1-(a=Math.cos(i)),h=s[0],l=s[1],c=s[2],u=s[3],_=s[4],d=s[5],p=s[6],f=s[7],m=s[8],g=s[9],S=s[10],y=s[11],G=w*w*o+a,I=A*w*o+M*n,T=M*w*o-A*n,b=w*A*o-M*n,C=A*A*o+a,P=M*A*o+w*n,v=w*M*o+A*n,x=A*M*o-w*n,R=M*M*o+a,e[0]=h*G+_*I+m*T,e[1]=l*G+d*I+g*T,e[2]=c*G+p*I+S*T,e[3]=u*G+f*I+y*T,e[4]=h*b+_*C+m*P,e[5]=l*b+d*C+g*P,e[6]=c*b+p*C+S*P,e[7]=u*b+f*C+y*P,e[8]=h*v+_*x+m*R,e[9]=l*v+d*x+g*R,e[10]=c*v+p*x+S*R,e[11]=u*v+f*x+y*R,s!==e&&(e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15]),e)},rotateX:function(e,t,s){var i=Math.sin(s),r=Math.cos(s),n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],c=t[9],u=t[10],_=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*r+l*i,e[5]=a*r+c*i,e[6]=o*r+u*i,e[7]=h*r+_*i,e[8]=l*r-n*i,e[9]=c*r-a*i,e[10]=u*r-o*i,e[11]=_*r-h*i,e},rotateY:function(e,t,s){var i=Math.sin(s),r=Math.cos(s),n=t[0],a=t[1],o=t[2],h=t[3],l=t[8],c=t[9],u=t[10],_=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*r-l*i,e[1]=a*r-c*i,e[2]=o*r-u*i,e[3]=h*r-_*i,e[8]=n*i+l*r,e[9]=a*i+c*r,e[10]=o*i+u*r,e[11]=h*i+_*r,e},rotateZ:function(e,t,s){var i=Math.sin(s),r=Math.cos(s),n=t[0],a=t[1],o=t[2],h=t[3],l=t[4],c=t[5],u=t[6],_=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*r+l*i,e[1]=a*r+c*i,e[2]=o*r+u*i,e[3]=h*r+_*i,e[4]=l*r-n*i,e[5]=c*r-a*i,e[6]=u*r-o*i,e[7]=_*r-h*i,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,s,i){var r,n,a,o=i[0],h=i[1],l=i[2],c=Math.hypot(o,h,l);return c<t?null:(o*=c=1/c,h*=c,l*=c,r=Math.sin(s),a=1-(n=Math.cos(s)),e[0]=o*o*a+n,e[1]=h*o*a+l*r,e[2]=l*o*a-h*r,e[3]=0,e[4]=o*h*a-l*r,e[5]=h*h*a+n,e[6]=l*h*a+o*r,e[7]=0,e[8]=o*l*a+h*r,e[9]=h*l*a-o*r,e[10]=l*l*a+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var s=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=s,e[7]=0,e[8]=0,e[9]=-s,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var s=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-s,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=s,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var s=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=s,e[2]=0,e[3]=0,e[4]=-s,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:P,fromQuat2:function(e,t){var i=new s(3),r=-t[0],n=-t[1],a=-t[2],o=t[3],h=t[4],l=t[5],c=t[6],u=t[7],_=r*r+n*n+a*a+o*o;return _>0?(i[0]=2*(h*o+u*r+l*a-c*n)/_,i[1]=2*(l*o+u*n+c*r-h*a)/_,i[2]=2*(c*o+u*a+h*n-l*r)/_):(i[0]=2*(h*o+u*r+l*a-c*n),i[1]=2*(l*o+u*n+c*r-h*a),i[2]=2*(c*o+u*a+h*n-l*r)),P(e,t,i),e},getTranslation:v,getScaling:x,getRotation:R,decompose:function(e,t,s,i){t[0]=i[12],t[1]=i[13],t[2]=i[14];var r=i[0],n=i[1],a=i[2],o=i[4],h=i[5],l=i[6],c=i[8],u=i[9],_=i[10];s[0]=Math.hypot(r,n,a),s[1]=Math.hypot(o,h,l),s[2]=Math.hypot(c,u,_);var d=1/s[0],p=1/s[1],f=1/s[2],m=r*d,g=n*p,S=a*f,y=o*d,G=h*p,I=l*f,T=c*d,b=u*p,C=_*f,P=m+G+C,v=0;return P>0?(v=2*Math.sqrt(P+1),e[3]=.25*v,e[0]=(I-b)/v,e[1]=(T-S)/v,e[2]=(g-y)/v):m>G&&m>C?(v=2*Math.sqrt(1+m-G-C),e[3]=(I-b)/v,e[0]=.25*v,e[1]=(g+y)/v,e[2]=(T+S)/v):G>C?(v=2*Math.sqrt(1+G-m-C),e[3]=(T-S)/v,e[0]=(g+y)/v,e[1]=.25*v,e[2]=(I+b)/v):(v=2*Math.sqrt(1+C-m-G),e[3]=(g-y)/v,e[0]=(T+S)/v,e[1]=(I+b)/v,e[2]=.25*v),e},fromRotationTranslationScale:function(e,t,s,i){var r=t[0],n=t[1],a=t[2],o=t[3],h=r+r,l=n+n,c=a+a,u=r*h,_=r*l,d=r*c,p=n*l,f=n*c,m=a*c,g=o*h,S=o*l,y=o*c,G=i[0],I=i[1],T=i[2];return e[0]=(1-(p+m))*G,e[1]=(_+y)*G,e[2]=(d-S)*G,e[3]=0,e[4]=(_-y)*I,e[5]=(1-(u+m))*I,e[6]=(f+g)*I,e[7]=0,e[8]=(d+S)*T,e[9]=(f-g)*T,e[10]=(1-(u+p))*T,e[11]=0,e[12]=s[0],e[13]=s[1],e[14]=s[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,s,i,r){var n=t[0],a=t[1],o=t[2],h=t[3],l=n+n,c=a+a,u=o+o,_=n*l,d=n*c,p=n*u,f=a*c,m=a*u,g=o*u,S=h*l,y=h*c,G=h*u,I=i[0],T=i[1],b=i[2],C=r[0],P=r[1],v=r[2],x=(1-(f+g))*I,R=(d+G)*I,w=(p-y)*I,A=(d-G)*T,M=(1-(_+g))*T,D=(m+S)*T,E=(p+y)*b,k=(m-S)*b,F=(1-(_+f))*b;return e[0]=x,e[1]=R,e[2]=w,e[3]=0,e[4]=A,e[5]=M,e[6]=D,e[7]=0,e[8]=E,e[9]=k,e[10]=F,e[11]=0,e[12]=s[0]+C-(x*C+A*P+E*v),e[13]=s[1]+P-(R*C+M*P+k*v),e[14]=s[2]+v-(w*C+D*P+F*v),e[15]=1,e},fromQuat:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=s+s,o=i+i,h=r+r,l=s*a,c=i*a,u=i*o,_=r*a,d=r*o,p=r*h,f=n*a,m=n*o,g=n*h;return e[0]=1-u-p,e[1]=c+g,e[2]=_-m,e[3]=0,e[4]=c-g,e[5]=1-l-p,e[6]=d+f,e[7]=0,e[8]=_+m,e[9]=d-f,e[10]=1-l-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,s,i,r,n,a){var o=1/(s-t),h=1/(r-i),l=1/(n-a);return e[0]=2*n*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*h,e[6]=0,e[7]=0,e[8]=(s+t)*o,e[9]=(r+i)*h,e[10]=(a+n)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*n*2*l,e[15]=0,e},perspectiveNO:w,perspective:A,perspectiveZO:function(e,t,s,i,r){var n=1/Math.tan(t/2);if(e[0]=n/s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){var a=1/(i-r);e[10]=r*a,e[14]=r*i*a}else e[10]=-1,e[14]=-i;return e},perspectiveFromFieldOfView:function(e,t,s,i){var r=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),h=2/(a+o),l=2/(r+n);return e[0]=h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-o)*h*.5,e[9]=(r-n)*l*.5,e[10]=i/(s-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*s/(s-i),e[15]=0,e},orthoNO:M,ortho:D,orthoZO:function(e,t,s,i,r,n,a){var o=1/(t-s),h=1/(i-r),l=1/(n-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+s)*o,e[13]=(r+i)*h,e[14]=n*l,e[15]=1,e},lookAt:function(e,s,i,r){var n,a,o,h,l,c,u,_,d,p,f=s[0],m=s[1],g=s[2],S=r[0],y=r[1],G=r[2],I=i[0],T=i[1],C=i[2];return Math.abs(f-I)<t&&Math.abs(m-T)<t&&Math.abs(g-C)<t?b(e):(u=f-I,_=m-T,d=g-C,n=y*(d*=p=1/Math.hypot(u,_,d))-G*(_*=p),a=G*(u*=p)-S*d,o=S*_-y*u,(p=Math.hypot(n,a,o))?(n*=p=1/p,a*=p,o*=p):(n=0,a=0,o=0),h=_*o-d*a,l=d*n-u*o,c=u*a-_*n,(p=Math.hypot(h,l,c))?(h*=p=1/p,l*=p,c*=p):(h=0,l=0,c=0),e[0]=n,e[1]=h,e[2]=u,e[3]=0,e[4]=a,e[5]=l,e[6]=_,e[7]=0,e[8]=o,e[9]=c,e[10]=d,e[11]=0,e[12]=-(n*f+a*m+o*g),e[13]=-(h*f+l*m+c*g),e[14]=-(u*f+_*m+d*g),e[15]=1,e)},targetTo:function(e,t,s,i){var r=t[0],n=t[1],a=t[2],o=i[0],h=i[1],l=i[2],c=r-s[0],u=n-s[1],_=a-s[2],d=c*c+u*u+_*_;d>0&&(c*=d=1/Math.sqrt(d),u*=d,_*=d);var p=h*_-l*u,f=l*c-o*_,m=o*u-h*c;return(d=p*p+f*f+m*m)>0&&(p*=d=1/Math.sqrt(d),f*=d,m*=d),e[0]=p,e[1]=f,e[2]=m,e[3]=0,e[4]=u*m-_*f,e[5]=_*p-c*m,e[6]=c*f-u*p,e[7]=0,e[8]=c,e[9]=u,e[10]=_,e[11]=0,e[12]=r,e[13]=n,e[14]=a,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e[8]=t[8]+s[8],e[9]=t[9]+s[9],e[10]=t[10]+s[10],e[11]=t[11]+s[11],e[12]=t[12]+s[12],e[13]=t[13]+s[13],e[14]=t[14]+s[14],e[15]=t[15]+s[15],e},subtract:E,multiplyScalar:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12]*s,e[13]=t[13]*s,e[14]=t[14]*s,e[15]=t[15]*s,e},multiplyScalarAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e[6]=t[6]+s[6]*i,e[7]=t[7]+s[7]*i,e[8]=t[8]+s[8]*i,e[9]=t[9]+s[9]*i,e[10]=t[10]+s[10]*i,e[11]=t[11]+s[11]*i,e[12]=t[12]+s[12]*i,e[13]=t[13]+s[13]*i,e[14]=t[14]+s[14]*i,e[15]=t[15]+s[15]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:function(e,s){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],c=e[7],u=e[8],_=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],S=e[15],y=s[0],G=s[1],I=s[2],T=s[3],b=s[4],C=s[5],P=s[6],v=s[7],x=s[8],R=s[9],w=s[10],A=s[11],M=s[12],D=s[13],E=s[14],k=s[15];return Math.abs(i-y)<=t*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-G)<=t*Math.max(1,Math.abs(r),Math.abs(G))&&Math.abs(n-I)<=t*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(a-T)<=t*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(o-b)<=t*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(h-C)<=t*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(l-P)<=t*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(c-v)<=t*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-x)<=t*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(_-R)<=t*Math.max(1,Math.abs(_),Math.abs(R))&&Math.abs(d-w)<=t*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(p-A)<=t*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(f-M)<=t*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(m-D)<=t*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(g-E)<=t*Math.max(1,Math.abs(g),Math.abs(E))&&Math.abs(S-k)<=t*Math.max(1,Math.abs(S),Math.abs(k))},mul:k,sub:F});function B(){var e=new s(3);return s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function L(e){var t=e[0],s=e[1],i=e[2];return Math.hypot(t,s,i)}function N(e,t,i){var r=new s(3);return r[0]=e,r[1]=t,r[2]=i,r}function W(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e}function V(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e[2]=t[2]*s[2],e}function U(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e[2]=t[2]/s[2],e}function j(e,t){var s=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.hypot(s,i,r)}function H(e,t){var s=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return s*s+i*i+r*r}function X(e){var t=e[0],s=e[1],i=e[2];return t*t+s*s+i*i}function Y(e,t){var s=t[0],i=t[1],r=t[2],n=s*s+i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function z(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function q(e,t,s){var i=t[0],r=t[1],n=t[2],a=s[0],o=s[1],h=s[2];return e[0]=r*h-n*o,e[1]=n*a-i*h,e[2]=i*o-r*a,e}var J,K=W,Z=V,Q=U,$=j,ee=H,te=L,se=X,ie=(J=B(),function(e,t,s,i,r,n){var a,o;for(t||(t=3),s||(s=0),o=i?Math.min(i*t+s,e.length):e.length,a=s;a<o;a+=t)J[0]=e[a],J[1]=e[a+1],J[2]=e[a+2],r(J,J,n),e[a]=J[0],e[a+1]=J[1],e[a+2]=J[2];return e}),re=Object.freeze({__proto__:null,create:B,clone:function(e){var t=new s(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:L,fromValues:N,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,s,i){return e[0]=t,e[1]=s,e[2]=i,e},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e},subtract:W,multiply:V,divide:U,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e[2]=Math.min(t[2],s[2]),e},max:function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e[2]=Math.max(t[2],s[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e},scaleAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e},distance:j,squaredDistance:H,squaredLength:X,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:Y,dot:z,cross:q,lerp:function(e,t,s,i){var r=t[0],n=t[1],a=t[2];return e[0]=r+i*(s[0]-r),e[1]=n+i*(s[1]-n),e[2]=a+i*(s[2]-a),e},slerp:function(e,t,s,i){var r=Math.acos(Math.min(Math.max(z(t,s),-1),1)),n=Math.sin(r),a=Math.sin((1-i)*r)/n,o=Math.sin(i*r)/n;return e[0]=a*t[0]+o*s[0],e[1]=a*t[1]+o*s[1],e[2]=a*t[2]+o*s[2],e},hermite:function(e,t,s,i,r,n){var a=n*n,o=a*(2*n-3)+1,h=a*(n-2)+n,l=a*(n-1),c=a*(3-2*n);return e[0]=t[0]*o+s[0]*h+i[0]*l+r[0]*c,e[1]=t[1]*o+s[1]*h+i[1]*l+r[1]*c,e[2]=t[2]*o+s[2]*h+i[2]*l+r[2]*c,e},bezier:function(e,t,s,i,r,n){var a=1-n,o=a*a,h=n*n,l=o*a,c=3*n*o,u=3*h*a,_=h*n;return e[0]=t[0]*l+s[0]*c+i[0]*u+r[0]*_,e[1]=t[1]*l+s[1]*c+i[1]*u+r[1]*_,e[2]=t[2]*l+s[2]*c+i[2]*u+r[2]*_,e},random:function(e,t){t=t||1;var s=2*i()*Math.PI,r=2*i()-1,n=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(s)*n,e[1]=Math.sin(s)*n,e[2]=r*t,e},transformMat4:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=s[3]*i+s[7]*r+s[11]*n+s[15];return a=a||1,e[0]=(s[0]*i+s[4]*r+s[8]*n+s[12])/a,e[1]=(s[1]*i+s[5]*r+s[9]*n+s[13])/a,e[2]=(s[2]*i+s[6]*r+s[10]*n+s[14])/a,e},transformMat3:function(e,t,s){var i=t[0],r=t[1],n=t[2];return e[0]=i*s[0]+r*s[3]+n*s[6],e[1]=i*s[1]+r*s[4]+n*s[7],e[2]=i*s[2]+r*s[5]+n*s[8],e},transformQuat:function(e,t,s){var i=s[0],r=s[1],n=s[2],a=s[3],o=t[0],h=t[1],l=t[2],c=r*l-n*h,u=n*o-i*l,_=i*h-r*o,d=r*_-n*u,p=n*c-i*_,f=i*u-r*c,m=2*a;return c*=m,u*=m,_*=m,d*=2,p*=2,f*=2,e[0]=o+c+d,e[1]=h+u+p,e[2]=l+_+f,e},rotateX:function(e,t,s,i){var r=[],n=[];return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[0],n[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),n[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2],e},rotateY:function(e,t,s,i){var r=[],n=[];return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),n[1]=r[1],n[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2],e},rotateZ:function(e,t,s,i){var r=[],n=[];return r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),n[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),n[2]=r[2],e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2],e},angle:function(e,t){var s=e[0],i=e[1],r=e[2],n=t[0],a=t[1],o=t[2],h=Math.sqrt((s*s+i*i+r*r)*(n*n+a*a+o*o)),l=h&&z(e,t)/h;return Math.acos(Math.min(Math.max(l,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,s){var i=e[0],r=e[1],n=e[2],a=s[0],o=s[1],h=s[2];return Math.abs(i-a)<=t*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=t*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-h)<=t*Math.max(1,Math.abs(n),Math.abs(h))},sub:K,mul:Z,div:Q,dist:$,sqrDist:ee,len:te,sqrLen:se,forEach:ie});function ne(){var e=new s(4);return s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ae(e){var t=new s(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function oe(e,t,i,r){var n=new s(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function he(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function le(e,t,s,i,r){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e}function ce(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e}function ue(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e}function _e(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e[2]=t[2]*s[2],e[3]=t[3]*s[3],e}function de(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e[2]=t[2]/s[2],e[3]=t[3]/s[3],e}function pe(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e}function fe(e,t){var s=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],n=t[3]-e[3];return Math.hypot(s,i,r,n)}function me(e,t){var s=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],n=t[3]-e[3];return s*s+i*i+r*r+n*n}function ge(e){var t=e[0],s=e[1],i=e[2],r=e[3];return Math.hypot(t,s,i,r)}function Se(e){var t=e[0],s=e[1],i=e[2],r=e[3];return t*t+s*s+i*i+r*r}function ye(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=s*s+i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=s*a,e[1]=i*a,e[2]=r*a,e[3]=n*a,e}function Ge(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ie(e,t,s,i){var r=t[0],n=t[1],a=t[2],o=t[3];return e[0]=r+i*(s[0]-r),e[1]=n+i*(s[1]-n),e[2]=a+i*(s[2]-a),e[3]=o+i*(s[3]-o),e}function Te(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var be=ue,Ce=_e,Pe=de,ve=fe,xe=me,Re=ge,we=Se,Ae=function(){var e=ne();return function(t,s,i,r,n,a){var o,h;for(s||(s=4),i||(i=0),h=r?Math.min(r*s+i,t.length):t.length,o=i;o<h;o+=s)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],n(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}(),Me=Object.freeze({__proto__:null,create:ne,clone:ae,fromValues:oe,copy:he,set:le,add:ce,subtract:ue,multiply:_e,divide:de,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e[2]=Math.min(t[2],s[2]),e[3]=Math.min(t[3],s[3]),e},max:function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e[2]=Math.max(t[2],s[2]),e[3]=Math.max(t[3],s[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:pe,scaleAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e},distance:fe,squaredDistance:me,length:ge,squaredLength:Se,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:ye,dot:Ge,cross:function(e,t,s,i){var r=s[0]*i[1]-s[1]*i[0],n=s[0]*i[2]-s[2]*i[0],a=s[0]*i[3]-s[3]*i[0],o=s[1]*i[2]-s[2]*i[1],h=s[1]*i[3]-s[3]*i[1],l=s[2]*i[3]-s[3]*i[2],c=t[0],u=t[1],_=t[2],d=t[3];return e[0]=u*l-_*h+d*o,e[1]=-c*l+_*a-d*n,e[2]=c*h-u*a+d*r,e[3]=-c*o+u*n-_*r,e},lerp:Ie,random:function(e,t){var s,r,n,a,o,h;t=t||1;do{o=(s=2*i()-1)*s+(r=2*i()-1)*r}while(o>=1);do{h=(n=2*i()-1)*n+(a=2*i()-1)*a}while(h>=1);var l=Math.sqrt((1-o)/h);return e[0]=t*s,e[1]=t*r,e[2]=t*n*l,e[3]=t*a*l,e},transformMat4:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3];return e[0]=s[0]*i+s[4]*r+s[8]*n+s[12]*a,e[1]=s[1]*i+s[5]*r+s[9]*n+s[13]*a,e[2]=s[2]*i+s[6]*r+s[10]*n+s[14]*a,e[3]=s[3]*i+s[7]*r+s[11]*n+s[15]*a,e},transformQuat:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=s[0],o=s[1],h=s[2],l=s[3],c=l*i+o*n-h*r,u=l*r+h*i-a*n,_=l*n+a*r-o*i,d=-a*i-o*r-h*n;return e[0]=c*l+d*-a+u*-h-_*-o,e[1]=u*l+d*-o+_*-a-c*-h,e[2]=_*l+d*-h+c*-o-u*-a,e[3]=t[3],e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:Te,equals:function(e,s){var i=e[0],r=e[1],n=e[2],a=e[3],o=s[0],h=s[1],l=s[2],c=s[3];return Math.abs(i-o)<=t*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-h)<=t*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-l)<=t*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=t*Math.max(1,Math.abs(a),Math.abs(c))},sub:be,mul:Ce,div:Pe,dist:ve,sqrDist:xe,len:Re,sqrLen:we,forEach:Ae});function De(){var e=new s(4);return s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ee(e,t,s){s*=.5;var i=Math.sin(s);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(s),e}function ke(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=s[0],h=s[1],l=s[2],c=s[3];return e[0]=i*c+a*o+r*l-n*h,e[1]=r*c+a*h+n*o-i*l,e[2]=n*c+a*l+i*h-r*o,e[3]=a*c-i*o-r*h-n*l,e}function Fe(e,t,s){s*=.5;var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.sin(s),h=Math.cos(s);return e[0]=i*h+a*o,e[1]=r*h+n*o,e[2]=n*h-r*o,e[3]=a*h-i*o,e}function Oe(e,t,s){s*=.5;var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.sin(s),h=Math.cos(s);return e[0]=i*h-n*o,e[1]=r*h+a*o,e[2]=n*h+i*o,e[3]=a*h-r*o,e}function Be(e,t,s){s*=.5;var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.sin(s),h=Math.cos(s);return e[0]=i*h+r*o,e[1]=r*h-i*o,e[2]=n*h+a*o,e[3]=a*h-n*o,e}function Le(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=Math.sqrt(s*s+i*i+r*r),o=Math.exp(n),h=a>0?o*Math.sin(a)/a:0;return e[0]=s*h,e[1]=i*h,e[2]=r*h,e[3]=o*Math.cos(a),e}function Ne(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=Math.sqrt(s*s+i*i+r*r),o=a>0?Math.atan2(a,n)/a:0;return e[0]=s*o,e[1]=i*o,e[2]=r*o,e[3]=.5*Math.log(s*s+i*i+r*r+n*n),e}function We(e,s,i,r){var n,a,o,h,l,c=s[0],u=s[1],_=s[2],d=s[3],p=i[0],f=i[1],m=i[2],g=i[3];return(a=c*p+u*f+_*m+d*g)<0&&(a=-a,p=-p,f=-f,m=-m,g=-g),1-a>t?(n=Math.acos(a),o=Math.sin(n),h=Math.sin((1-r)*n)/o,l=Math.sin(r*n)/o):(h=1-r,l=r),e[0]=h*c+l*p,e[1]=h*u+l*f,e[2]=h*_+l*m,e[3]=h*d+l*g,e}function Ve(e,t){var s,i=t[0]+t[4]+t[8];if(i>0)s=Math.sqrt(i+1),e[3]=.5*s,s=.5/s,e[0]=(t[5]-t[7])*s,e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var n=(r+1)%3,a=(r+2)%3;s=Math.sqrt(t[3*r+r]-t[3*n+n]-t[3*a+a]+1),e[r]=.5*s,s=.5/s,e[3]=(t[3*n+a]-t[3*a+n])*s,e[n]=(t[3*n+r]+t[3*r+n])*s,e[a]=(t[3*a+r]+t[3*r+a])*s}return e}var Ue=ae,je=oe,He=he,Xe=le,Ye=ce,ze=ke,qe=pe,Je=Ge,Ke=Ie,Ze=ge,Qe=Ze,$e=Se,et=$e,tt=ye,st=Te;var it,rt,nt,at,ot,ht,lt=(it=B(),rt=N(1,0,0),nt=N(0,1,0),function(e,t,s){var i=z(t,s);return i<-.999999?(q(it,rt,t),te(it)<1e-6&&q(it,nt,t),Y(it,it),Ee(e,it,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(q(it,t,s),e[0]=it[0],e[1]=it[1],e[2]=it[2],e[3]=1+i,tt(e,e))}),ct=(at=De(),ot=De(),function(e,t,s,i,r,n){return We(at,t,r,n),We(ot,s,i,n),We(e,at,ot,2*n*(1-n)),e}),ut=(ht=g(),function(e,t,s,i){return ht[0]=s[0],ht[3]=s[1],ht[6]=s[2],ht[1]=i[0],ht[4]=i[1],ht[7]=i[2],ht[2]=-t[0],ht[5]=-t[1],ht[8]=-t[2],tt(e,Ve(e,ht))}),_t=Object.freeze({__proto__:null,create:De,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:Ee,getAxisAngle:function(e,s){var i=2*Math.acos(s[3]),r=Math.sin(i/2);return r>t?(e[0]=s[0]/r,e[1]=s[1]/r,e[2]=s[2]/r):(e[0]=1,e[1]=0,e[2]=0),i},getAngle:function(e,t){var s=Je(e,t);return Math.acos(2*s*s-1)},multiply:ke,rotateX:Fe,rotateY:Oe,rotateZ:Be,calculateW:function(e,t){var s=t[0],i=t[1],r=t[2];return e[0]=s,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-s*s-i*i-r*r)),e},exp:Le,ln:Ne,pow:function(e,t,s){return Ne(e,t),qe(e,e,s),Le(e,e),e},slerp:We,random:function(e){var t=i(),s=i(),r=i(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*s),e[1]=n*Math.cos(2*Math.PI*s),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e},invert:function(e,t){var s=t[0],i=t[1],r=t[2],n=t[3],a=s*s+i*i+r*r+n*n,o=a?1/a:0;return e[0]=-s*o,e[1]=-i*o,e[2]=-r*o,e[3]=n*o,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat3:Ve,fromEuler:function(e,t,s,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r,a=Math.PI/360;t*=a,i*=a,s*=a;var o=Math.sin(t),h=Math.cos(t),l=Math.sin(s),c=Math.cos(s),u=Math.sin(i),_=Math.cos(i);switch(n){case"xyz":e[0]=o*c*_+h*l*u,e[1]=h*l*_-o*c*u,e[2]=h*c*u+o*l*_,e[3]=h*c*_-o*l*u;break;case"xzy":e[0]=o*c*_-h*l*u,e[1]=h*l*_-o*c*u,e[2]=h*c*u+o*l*_,e[3]=h*c*_+o*l*u;break;case"yxz":e[0]=o*c*_+h*l*u,e[1]=h*l*_-o*c*u,e[2]=h*c*u-o*l*_,e[3]=h*c*_+o*l*u;break;case"yzx":e[0]=o*c*_+h*l*u,e[1]=h*l*_+o*c*u,e[2]=h*c*u-o*l*_,e[3]=h*c*_-o*l*u;break;case"zxy":e[0]=o*c*_-h*l*u,e[1]=h*l*_+o*c*u,e[2]=h*c*u+o*l*_,e[3]=h*c*_-o*l*u;break;case"zyx":e[0]=o*c*_-h*l*u,e[1]=h*l*_+o*c*u,e[2]=h*c*u-o*l*_,e[3]=h*c*_+o*l*u;break;default:throw new Error("Unknown angle order "+n)}return e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},clone:Ue,fromValues:je,copy:He,set:Xe,add:Ye,mul:ze,scale:qe,dot:Je,lerp:Ke,length:Ze,len:Qe,squaredLength:$e,sqrLen:et,normalize:tt,exactEquals:st,equals:function(e,t){return Math.abs(Ge(e,t))>=.999999},rotationTo:lt,sqlerp:ct,setAxes:ut});function dt(e,t,s){var i=.5*s[0],r=.5*s[1],n=.5*s[2],a=t[0],o=t[1],h=t[2],l=t[3];return e[0]=a,e[1]=o,e[2]=h,e[3]=l,e[4]=i*l+r*h-n*o,e[5]=r*l+n*a-i*h,e[6]=n*l+i*o-r*a,e[7]=-i*a-r*o-n*h,e}function pt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}var ft=He;var mt=He;function gt(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=s[4],h=s[5],l=s[6],c=s[7],u=t[4],_=t[5],d=t[6],p=t[7],f=s[0],m=s[1],g=s[2],S=s[3];return e[0]=i*S+a*f+r*g-n*m,e[1]=r*S+a*m+n*f-i*g,e[2]=n*S+a*g+i*m-r*f,e[3]=a*S-i*f-r*m-n*g,e[4]=i*c+a*o+r*l-n*h+u*S+p*f+_*g-d*m,e[5]=r*c+a*h+n*o-i*l+_*S+p*m+d*f-u*g,e[6]=n*c+a*l+i*h-r*o+d*S+p*g+u*m-_*f,e[7]=a*c-i*o-r*h-n*l+p*S-u*f-_*m-d*g,e}var St=gt;var yt=Je;var Gt=Ze,It=Gt,Tt=$e,bt=Tt;var Ct=Object.freeze({__proto__:null,create:function(){var e=new s(8);return s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone:function(e){var t=new s(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues:function(e,t,i,r,n,a,o,h){var l=new s(8);return l[0]=e,l[1]=t,l[2]=i,l[3]=r,l[4]=n,l[5]=a,l[6]=o,l[7]=h,l},fromRotationTranslationValues:function(e,t,i,r,n,a,o){var h=new s(8);h[0]=e,h[1]=t,h[2]=i,h[3]=r;var l=.5*n,c=.5*a,u=.5*o;return h[4]=l*r+c*i-u*t,h[5]=c*r+u*e-l*i,h[6]=u*r+l*t-c*e,h[7]=-l*e-c*t-u*i,h},fromRotationTranslation:dt,fromTranslation:function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat4:function(e,t){var i=De();R(i,t);var r=new s(3);return v(r,t),dt(e,i,r),e},copy:pt,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set:function(e,t,s,i,r,n,a,o,h){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=a,e[6]=o,e[7]=h,e},getReal:ft,getDual:function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setReal:mt,setDual:function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation:function(e,t){var s=t[4],i=t[5],r=t[6],n=t[7],a=-t[0],o=-t[1],h=-t[2],l=t[3];return e[0]=2*(s*l+n*a+i*h-r*o),e[1]=2*(i*l+n*o+r*a-s*h),e[2]=2*(r*l+n*h+s*o-i*a),e},translate:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=.5*s[0],h=.5*s[1],l=.5*s[2],c=t[4],u=t[5],_=t[6],d=t[7];return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=a*o+r*l-n*h+c,e[5]=a*h+n*o-i*l+u,e[6]=a*l+i*h-r*o+_,e[7]=-i*o-r*h-n*l+d,e},rotateX:function(e,t,s){var i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=o*a+c*i+h*n-l*r,_=h*a+c*r+l*i-o*n,d=l*a+c*n+o*r-h*i,p=c*a-o*i-h*r-l*n;return Fe(e,t,s),i=e[0],r=e[1],n=e[2],a=e[3],e[4]=u*a+p*i+_*n-d*r,e[5]=_*a+p*r+d*i-u*n,e[6]=d*a+p*n+u*r-_*i,e[7]=p*a-u*i-_*r-d*n,e},rotateY:function(e,t,s){var i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=o*a+c*i+h*n-l*r,_=h*a+c*r+l*i-o*n,d=l*a+c*n+o*r-h*i,p=c*a-o*i-h*r-l*n;return Oe(e,t,s),i=e[0],r=e[1],n=e[2],a=e[3],e[4]=u*a+p*i+_*n-d*r,e[5]=_*a+p*r+d*i-u*n,e[6]=d*a+p*n+u*r-_*i,e[7]=p*a-u*i-_*r-d*n,e},rotateZ:function(e,t,s){var i=-t[0],r=-t[1],n=-t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],u=o*a+c*i+h*n-l*r,_=h*a+c*r+l*i-o*n,d=l*a+c*n+o*r-h*i,p=c*a-o*i-h*r-l*n;return Be(e,t,s),i=e[0],r=e[1],n=e[2],a=e[3],e[4]=u*a+p*i+_*n-d*r,e[5]=_*a+p*r+d*i-u*n,e[6]=d*a+p*n+u*r-_*i,e[7]=p*a-u*i-_*r-d*n,e},rotateByQuatAppend:function(e,t,s){var i=s[0],r=s[1],n=s[2],a=s[3],o=t[0],h=t[1],l=t[2],c=t[3];return e[0]=o*a+c*i+h*n-l*r,e[1]=h*a+c*r+l*i-o*n,e[2]=l*a+c*n+o*r-h*i,e[3]=c*a-o*i-h*r-l*n,o=t[4],h=t[5],l=t[6],c=t[7],e[4]=o*a+c*i+h*n-l*r,e[5]=h*a+c*r+l*i-o*n,e[6]=l*a+c*n+o*r-h*i,e[7]=c*a-o*i-h*r-l*n,e},rotateByQuatPrepend:function(e,t,s){var i=t[0],r=t[1],n=t[2],a=t[3],o=s[0],h=s[1],l=s[2],c=s[3];return e[0]=i*c+a*o+r*l-n*h,e[1]=r*c+a*h+n*o-i*l,e[2]=n*c+a*l+i*h-r*o,e[3]=a*c-i*o-r*h-n*l,o=s[4],h=s[5],l=s[6],c=s[7],e[4]=i*c+a*o+r*l-n*h,e[5]=r*c+a*h+n*o-i*l,e[6]=n*c+a*l+i*h-r*o,e[7]=a*c-i*o-r*h-n*l,e},rotateAroundAxis:function(e,s,i,r){if(Math.abs(r)<t)return pt(e,s);var n=Math.hypot(i[0],i[1],i[2]);r*=.5;var a=Math.sin(r),o=a*i[0]/n,h=a*i[1]/n,l=a*i[2]/n,c=Math.cos(r),u=s[0],_=s[1],d=s[2],p=s[3];e[0]=u*c+p*o+_*l-d*h,e[1]=_*c+p*h+d*o-u*l,e[2]=d*c+p*l+u*h-_*o,e[3]=p*c-u*o-_*h-d*l;var f=s[4],m=s[5],g=s[6],S=s[7];return e[4]=f*c+S*o+m*l-g*h,e[5]=m*c+S*h+g*o-f*l,e[6]=g*c+S*l+f*h-m*o,e[7]=S*c-f*o-m*h-g*l,e},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e[6]=t[6]+s[6],e[7]=t[7]+s[7],e},multiply:gt,mul:St,scale:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e},dot:yt,lerp:function(e,t,s,i){var r=1-i;return yt(t,s)<0&&(i=-i),e[0]=t[0]*r+s[0]*i,e[1]=t[1]*r+s[1]*i,e[2]=t[2]*r+s[2]*i,e[3]=t[3]*r+s[3]*i,e[4]=t[4]*r+s[4]*i,e[5]=t[5]*r+s[5]*i,e[6]=t[6]*r+s[6]*i,e[7]=t[7]*r+s[7]*i,e},invert:function(e,t){var s=Tt(t);return e[0]=-t[0]/s,e[1]=-t[1]/s,e[2]=-t[2]/s,e[3]=t[3]/s,e[4]=-t[4]/s,e[5]=-t[5]/s,e[6]=-t[6]/s,e[7]=t[7]/s,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},length:Gt,len:It,squaredLength:Tt,sqrLen:bt,normalize:function(e,t){var s=Tt(t);if(s>0){s=Math.sqrt(s);var i=t[0]/s,r=t[1]/s,n=t[2]/s,a=t[3]/s,o=t[4],h=t[5],l=t[6],c=t[7],u=i*o+r*h+n*l+a*c;e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=(o-i*u)/s,e[5]=(h-r*u)/s,e[6]=(l-n*u)/s,e[7]=(c-a*u)/s}return e},str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals:function(e,s){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],c=e[7],u=s[0],_=s[1],d=s[2],p=s[3],f=s[4],m=s[5],g=s[6],S=s[7];return Math.abs(i-u)<=t*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-_)<=t*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(n-d)<=t*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=t*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-f)<=t*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(h-m)<=t*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(l-g)<=t*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-S)<=t*Math.max(1,Math.abs(c),Math.abs(S))}});function Pt(){var e=new s(2);return s!=Float32Array&&(e[0]=0,e[1]=0),e}function vt(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e}function xt(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e}function Rt(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e}function wt(e,t){var s=t[0]-e[0],i=t[1]-e[1];return Math.hypot(s,i)}function At(e,t){var s=t[0]-e[0],i=t[1]-e[1];return s*s+i*i}function Mt(e){var t=e[0],s=e[1];return Math.hypot(t,s)}function Dt(e){var t=e[0],s=e[1];return t*t+s*s}var Et=Mt,kt=vt,Ft=xt,Ot=Rt,Bt=wt,Lt=At,Nt=Dt,Wt=function(){var e=Pt();return function(t,s,i,r,n,a){var o,h;for(s||(s=2),i||(i=0),h=r?Math.min(r*s+i,t.length):t.length,o=i;o<h;o+=s)e[0]=t[o],e[1]=t[o+1],n(e,e,a),t[o]=e[0],t[o+1]=e[1];return t}}(),Vt=Object.freeze({__proto__:null,create:Pt,clone:function(e){var t=new s(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var i=new s(2);return i[0]=e,i[1]=t,i},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,s){return e[0]=t,e[1]=s,e},add:function(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e},subtract:vt,multiply:xt,divide:Rt,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e},max:function(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e},scaleAndAdd:function(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e},distance:wt,squaredDistance:At,length:Mt,squaredLength:Dt,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var s=t[0],i=t[1],r=s*s+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,s){var i=t[0]*s[1]-t[1]*s[0];return e[0]=e[1]=0,e[2]=i,e},lerp:function(e,t,s,i){var r=t[0],n=t[1];return e[0]=r+i*(s[0]-r),e[1]=n+i*(s[1]-n),e},random:function(e,t){t=t||1;var s=2*i()*Math.PI;return e[0]=Math.cos(s)*t,e[1]=Math.sin(s)*t,e},transformMat2:function(e,t,s){var i=t[0],r=t[1];return e[0]=s[0]*i+s[2]*r,e[1]=s[1]*i+s[3]*r,e},transformMat2d:function(e,t,s){var i=t[0],r=t[1];return e[0]=s[0]*i+s[2]*r+s[4],e[1]=s[1]*i+s[3]*r+s[5],e},transformMat3:function(e,t,s){var i=t[0],r=t[1];return e[0]=s[0]*i+s[3]*r+s[6],e[1]=s[1]*i+s[4]*r+s[7],e},transformMat4:function(e,t,s){var i=t[0],r=t[1];return e[0]=s[0]*i+s[4]*r+s[12],e[1]=s[1]*i+s[5]*r+s[13],e},rotate:function(e,t,s,i){var r=t[0]-s[0],n=t[1]-s[1],a=Math.sin(i),o=Math.cos(i);return e[0]=r*o-n*a+s[0],e[1]=r*a+n*o+s[1],e},angle:function(e,t){var s=e[0],i=e[1],r=t[0],n=t[1],a=Math.sqrt((s*s+i*i)*(r*r+n*n)),o=a&&(s*r+i*n)/a;return Math.acos(Math.min(Math.max(o,-1),1))},zero:function(e){return e[0]=0,e[1]=0,e},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,s){var i=e[0],r=e[1],n=s[0],a=s[1];return Math.abs(i-n)<=t*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-a)<=t*Math.max(1,Math.abs(r),Math.abs(a))},len:Et,sub:kt,mul:Ft,div:Ot,dist:Bt,sqrDist:Lt,sqrLen:Nt,forEach:Wt});e.glMatrix=a,e.mat2=u,e.mat2d=m,e.mat3=T,e.mat4=O,e.quat=_t,e.quat2=Ct,e.vec2=Vt,e.vec3=re,e.vec4=Me,Object.defineProperty(e,"__esModule",{value:!0})}));{function GraphemeSplitter(){function e(e,t){void 0===t&&(t=0);var s=e.charCodeAt(t);if(55296<=s&&56319>=s&&t<e.length-1){var i=s;return 56320<=(e=e.charCodeAt(t+1))&&57343>=e?1024*(i-55296)+(e-56320)+65536:i}return 56320<=s&&57343>=s&&1<=t?(i=e.charCodeAt(t-1),e=s,55296<=i&&56319>=i?1024*(i-55296)+(e-56320)+65536:e):s}function t(e,t,s){var i=[e].concat(t).concat([s]),r=i[i.length-2],n=i.lastIndexOf(14);return 1<n&&i.slice(1,n).every((function(e){return 3==e}))&&-1==[3,13,17].indexOf(e)?2:0<(e=i.lastIndexOf(4))&&i.slice(1,e).every((function(e){return 4==e}))&&-1==[12,4].indexOf(r)?1==i.filter((function(e){return 4==e})).length%2?3:4:0==r&&1==s?0:2==r||0==r||1==r?14==s&&t.every((function(e){return 3==e}))?2:1:2==s||0==s||1==s?1:(6!=r||6!=s&&7!=s&&9!=s&&10!=s)&&(9!=r&&7!=r||7!=s&&8!=s)&&(10!=r&&8!=r||8!=s)?3==s||15==s||5==s||12==r?0:(e=-1!=i.indexOf(3)?i.lastIndexOf(3)-1:i.length-2,-1!=[13,17].indexOf(i[e])&&i.slice(e+1,-1).every((function(e){return 3==e}))&&14==s||15==r&&-1!=[16,17].indexOf(s)?0:-1!=t.indexOf(4)?2:4==r&&4==s?0:1):0}function s(e){return 1536<=e&&1541>=e||1757==e||1807==e||2274==e||3406==e||69821==e||70082<=e&&70083>=e||72250==e||72326<=e&&72329>=e||73030==e?12:13==e?0:10==e?1:0<=e&&9>=e||11<=e&&12>=e||14<=e&&31>=e||127<=e&&159>=e||173==e||1564==e||6158==e||8203==e||8206<=e&&8207>=e||8232==e||8233==e||8234<=e&&8238>=e||8288<=e&&8292>=e||8293==e||8294<=e&&8303>=e||55296<=e&&57343>=e||65279==e||65520<=e&&65528>=e||65529<=e&&65531>=e||113824<=e&&113827>=e||119155<=e&&119162>=e||917504==e||917505==e||917506<=e&&917535>=e||917632<=e&&917759>=e||918e3<=e&&921599>=e?2:768<=e&&879>=e||1155<=e&&1159>=e||1160<=e&&1161>=e||1425<=e&&1469>=e||1471==e||1473<=e&&1474>=e||1476<=e&&1477>=e||1479==e||1552<=e&&1562>=e||1611<=e&&1631>=e||1648==e||1750<=e&&1756>=e||1759<=e&&1764>=e||1767<=e&&1768>=e||1770<=e&&1773>=e||1809==e||1840<=e&&1866>=e||1958<=e&&1968>=e||2027<=e&&2035>=e||2070<=e&&2073>=e||2075<=e&&2083>=e||2085<=e&&2087>=e||2089<=e&&2093>=e||2137<=e&&2139>=e||2260<=e&&2273>=e||2275<=e&&2306>=e||2362==e||2364==e||2369<=e&&2376>=e||2381==e||2385<=e&&2391>=e||2402<=e&&2403>=e||2433==e||2492==e||2494==e||2497<=e&&2500>=e||2509==e||2519==e||2530<=e&&2531>=e||2561<=e&&2562>=e||2620==e||2625<=e&&2626>=e||2631<=e&&2632>=e||2635<=e&&2637>=e||2641==e||2672<=e&&2673>=e||2677==e||2689<=e&&2690>=e||2748==e||2753<=e&&2757>=e||2759<=e&&2760>=e||2765==e||2786<=e&&2787>=e||2810<=e&&2815>=e||2817==e||2876==e||2878==e||2879==e||2881<=e&&2884>=e||2893==e||2902==e||2903==e||2914<=e&&2915>=e||2946==e||3006==e||3008==e||3021==e||3031==e||3072==e||3134<=e&&3136>=e||3142<=e&&3144>=e||3146<=e&&3149>=e||3157<=e&&3158>=e||3170<=e&&3171>=e||3201==e||3260==e||3263==e||3266==e||3270==e||3276<=e&&3277>=e||3285<=e&&3286>=e||3298<=e&&3299>=e||3328<=e&&3329>=e||3387<=e&&3388>=e||3390==e||3393<=e&&3396>=e||3405==e||3415==e||3426<=e&&3427>=e||3530==e||3535==e||3538<=e&&3540>=e||3542==e||3551==e||3633==e||3636<=e&&3642>=e||3655<=e&&3662>=e||3761==e||3764<=e&&3769>=e||3771<=e&&3772>=e||3784<=e&&3789>=e||3864<=e&&3865>=e||3893==e||3895==e||3897==e||3953<=e&&3966>=e||3968<=e&&3972>=e||3974<=e&&3975>=e||3981<=e&&3991>=e||3993<=e&&4028>=e||4038==e||4141<=e&&4144>=e||4146<=e&&4151>=e||4153<=e&&4154>=e||4157<=e&&4158>=e||4184<=e&&4185>=e||4190<=e&&4192>=e||4209<=e&&4212>=e||4226==e||4229<=e&&4230>=e||4237==e||4253==e||4957<=e&&4959>=e||5906<=e&&5908>=e||5938<=e&&5940>=e||5970<=e&&5971>=e||6002<=e&&6003>=e||6068<=e&&6069>=e||6071<=e&&6077>=e||6086==e||6089<=e&&6099>=e||6109==e||6155<=e&&6157>=e||6277<=e&&6278>=e||6313==e||6432<=e&&6434>=e||6439<=e&&6440>=e||6450==e||6457<=e&&6459>=e||6679<=e&&6680>=e||6683==e||6742==e||6744<=e&&6750>=e||6752==e||6754==e||6757<=e&&6764>=e||6771<=e&&6780>=e||6783==e||6832<=e&&6845>=e||6846==e||6912<=e&&6915>=e||6964==e||6966<=e&&6970>=e||6972==e||6978==e||7019<=e&&7027>=e||7040<=e&&7041>=e||7074<=e&&7077>=e||7080<=e&&7081>=e||7083<=e&&7085>=e||7142==e||7144<=e&&7145>=e||7149==e||7151<=e&&7153>=e||7212<=e&&7219>=e||7222<=e&&7223>=e||7376<=e&&7378>=e||7380<=e&&7392>=e||7394<=e&&7400>=e||7405==e||7412==e||7416<=e&&7417>=e||7616<=e&&7673>=e||7675<=e&&7679>=e||8204==e||8400<=e&&8412>=e||8413<=e&&8416>=e||8417==e||8418<=e&&8420>=e||8421<=e&&8432>=e||11503<=e&&11505>=e||11647==e||11744<=e&&11775>=e||12330<=e&&12333>=e||12334<=e&&12335>=e||12441<=e&&12442>=e||42607==e||42608<=e&&42610>=e||42612<=e&&42621>=e||42654<=e&&42655>=e||42736<=e&&42737>=e||43010==e||43014==e||43019==e||43045<=e&&43046>=e||43204<=e&&43205>=e||43232<=e&&43249>=e||43302<=e&&43309>=e||43335<=e&&43345>=e||43392<=e&&43394>=e||43443==e||43446<=e&&43449>=e||43452==e||43493==e||43561<=e&&43566>=e||43569<=e&&43570>=e||43573<=e&&43574>=e||43587==e||43596==e||43644==e||43696==e||43698<=e&&43700>=e||43703<=e&&43704>=e||43710<=e&&43711>=e||43713==e||43756<=e&&43757>=e||43766==e||44005==e||44008==e||44013==e||64286==e||65024<=e&&65039>=e||65056<=e&&65071>=e||65438<=e&&65439>=e||66045==e||66272==e||66422<=e&&66426>=e||68097<=e&&68099>=e||68101<=e&&68102>=e||68108<=e&&68111>=e||68152<=e&&68154>=e||68159==e||68325<=e&&68326>=e||69633==e||69688<=e&&69702>=e||69759<=e&&69761>=e||69811<=e&&69814>=e||69817<=e&&69818>=e||69888<=e&&69890>=e||69927<=e&&69931>=e||69933<=e&&69940>=e||70003==e||70016<=e&&70017>=e||70070<=e&&70078>=e||70090<=e&&70092>=e||70191<=e&&70193>=e||70196==e||70198<=e&&70199>=e||70206==e||70367==e||70371<=e&&70378>=e||70400<=e&&70401>=e||70460==e||70462==e||70464==e||70487==e||70502<=e&&70508>=e||70512<=e&&70516>=e||70712<=e&&70719>=e||70722<=e&&70724>=e||70726==e||70832==e||70835<=e&&70840>=e||70842==e||70845==e||70847<=e&&70848>=e||70850<=e&&70851>=e||71087==e||71090<=e&&71093>=e||71100<=e&&71101>=e||71103<=e&&71104>=e||71132<=e&&71133>=e||71219<=e&&71226>=e||71229==e||71231<=e&&71232>=e||71339==e||71341==e||71344<=e&&71349>=e||71351==e||71453<=e&&71455>=e||71458<=e&&71461>=e||71463<=e&&71467>=e||72193<=e&&72198>=e||72201<=e&&72202>=e||72243<=e&&72248>=e||72251<=e&&72254>=e||72263==e||72273<=e&&72278>=e||72281<=e&&72283>=e||72330<=e&&72342>=e||72344<=e&&72345>=e||72752<=e&&72758>=e||72760<=e&&72765>=e||72767==e||72850<=e&&72871>=e||72874<=e&&72880>=e||72882<=e&&72883>=e||72885<=e&&72886>=e||73009<=e&&73014>=e||73018==e||73020<=e&&73021>=e||73023<=e&&73029>=e||73031==e||92912<=e&&92916>=e||92976<=e&&92982>=e||94095<=e&&94098>=e||113821<=e&&113822>=e||119141==e||119143<=e&&119145>=e||119150<=e&&119154>=e||119163<=e&&119170>=e||119173<=e&&119179>=e||119210<=e&&119213>=e||119362<=e&&119364>=e||121344<=e&&121398>=e||121403<=e&&121452>=e||121461==e||121476==e||121499<=e&&121503>=e||121505<=e&&121519>=e||122880<=e&&122886>=e||122888<=e&&122904>=e||122907<=e&&122913>=e||122915<=e&&122916>=e||122918<=e&&122922>=e||125136<=e&&125142>=e||125252<=e&&125258>=e||917536<=e&&917631>=e||917760<=e&&917999>=e?3:127462<=e&&127487>=e?4:2307==e||2363==e||2366<=e&&2368>=e||2377<=e&&2380>=e||2382<=e&&2383>=e||2434<=e&&2435>=e||2495<=e&&2496>=e||2503<=e&&2504>=e||2507<=e&&2508>=e||2563==e||2622<=e&&2624>=e||2691==e||2750<=e&&2752>=e||2761==e||2763<=e&&2764>=e||2818<=e&&2819>=e||2880==e||2887<=e&&2888>=e||2891<=e&&2892>=e||3007==e||3009<=e&&3010>=e||3014<=e&&3016>=e||3018<=e&&3020>=e||3073<=e&&3075>=e||3137<=e&&3140>=e||3202<=e&&3203>=e||3262==e||3264<=e&&3265>=e||3267<=e&&3268>=e||3271<=e&&3272>=e||3274<=e&&3275>=e||3330<=e&&3331>=e||3391<=e&&3392>=e||3398<=e&&3400>=e||3402<=e&&3404>=e||3458<=e&&3459>=e||3536<=e&&3537>=e||3544<=e&&3550>=e||3570<=e&&3571>=e||3635==e||3763==e||3902<=e&&3903>=e||3967==e||4145==e||4155<=e&&4156>=e||4182<=e&&4183>=e||4228==e||6070==e||6078<=e&&6085>=e||6087<=e&&6088>=e||6435<=e&&6438>=e||6441<=e&&6443>=e||6448<=e&&6449>=e||6451<=e&&6456>=e||6681<=e&&6682>=e||6741==e||6743==e||6765<=e&&6770>=e||6916==e||6965==e||6971==e||6973<=e&&6977>=e||6979<=e&&6980>=e||7042==e||7073==e||7078<=e&&7079>=e||7082==e||7143==e||7146<=e&&7148>=e||7150==e||7154<=e&&7155>=e||7204<=e&&7211>=e||7220<=e&&7221>=e||7393==e||7410<=e&&7411>=e||7415==e||43043<=e&&43044>=e||43047==e||43136<=e&&43137>=e||43188<=e&&43203>=e||43346<=e&&43347>=e||43395==e||43444<=e&&43445>=e||43450<=e&&43451>=e||43453<=e&&43456>=e||43567<=e&&43568>=e||43571<=e&&43572>=e||43597==e||43755==e||43758<=e&&43759>=e||43765==e||44003<=e&&44004>=e||44006<=e&&44007>=e||44009<=e&&44010>=e||44012==e||69632==e||69634==e||69762==e||69808<=e&&69810>=e||69815<=e&&69816>=e||69932==e||70018==e||70067<=e&&70069>=e||70079<=e&&70080>=e||70188<=e&&70190>=e||70194<=e&&70195>=e||70197==e||70368<=e&&70370>=e||70402<=e&&70403>=e||70463==e||70465<=e&&70468>=e||70471<=e&&70472>=e||70475<=e&&70477>=e||70498<=e&&70499>=e||70709<=e&&70711>=e||70720<=e&&70721>=e||70725==e||70833<=e&&70834>=e||70841==e||70843<=e&&70844>=e||70846==e||70849==e||71088<=e&&71089>=e||71096<=e&&71099>=e||71102==e||71216<=e&&71218>=e||71227<=e&&71228>=e||71230==e||71340==e||71342<=e&&71343>=e||71350==e||71456<=e&&71457>=e||71462==e||72199<=e&&72200>=e||72249==e||72279<=e&&72280>=e||72343==e||72751==e||72766==e||72873==e||72881==e||72884==e||94033<=e&&94078>=e||119142==e||119149==e?5:4352<=e&&4447>=e||43360<=e&&43388>=e?6:4448<=e&&4519>=e||55216<=e&&55238>=e?7:4520<=e&&4607>=e||55243<=e&&55291>=e?8:44032==e||44060==e||44088==e||44116==e||44144==e||44172==e||44200==e||44228==e||44256==e||44284==e||44312==e||44340==e||44368==e||44396==e||44424==e||44452==e||44480==e||44508==e||44536==e||44564==e||44592==e||44620==e||44648==e||44676==e||44704==e||44732==e||44760==e||44788==e||44816==e||44844==e||44872==e||44900==e||44928==e||44956==e||44984==e||45012==e||45040==e||45068==e||45096==e||45124==e||45152==e||45180==e||45208==e||45236==e||45264==e||45292==e||45320==e||45348==e||45376==e||45404==e||45432==e||45460==e||45488==e||45516==e||45544==e||45572==e||45600==e||45628==e||45656==e||45684==e||45712==e||45740==e||45768==e||45796==e||45824==e||45852==e||45880==e||45908==e||45936==e||45964==e||45992==e||46020==e||46048==e||46076==e||46104==e||46132==e||46160==e||46188==e||46216==e||46244==e||46272==e||46300==e||46328==e||46356==e||46384==e||46412==e||46440==e||46468==e||46496==e||46524==e||46552==e||46580==e||46608==e||46636==e||46664==e||46692==e||46720==e||46748==e||46776==e||46804==e||46832==e||46860==e||46888==e||46916==e||46944==e||46972==e||47e3==e||47028==e||47056==e||47084==e||47112==e||47140==e||47168==e||47196==e||47224==e||47252==e||47280==e||47308==e||47336==e||47364==e||47392==e||47420==e||47448==e||47476==e||47504==e||47532==e||47560==e||47588==e||47616==e||47644==e||47672==e||47700==e||47728==e||47756==e||47784==e||47812==e||47840==e||47868==e||47896==e||47924==e||47952==e||47980==e||48008==e||48036==e||48064==e||48092==e||48120==e||48148==e||48176==e||48204==e||48232==e||48260==e||48288==e||48316==e||48344==e||48372==e||48400==e||48428==e||48456==e||48484==e||48512==e||48540==e||48568==e||48596==e||48624==e||48652==e||48680==e||48708==e||48736==e||48764==e||48792==e||48820==e||48848==e||48876==e||48904==e||48932==e||48960==e||48988==e||49016==e||49044==e||49072==e||49100==e||49128==e||49156==e||49184==e||49212==e||49240==e||49268==e||49296==e||49324==e||49352==e||49380==e||49408==e||49436==e||49464==e||49492==e||49520==e||49548==e||49576==e||49604==e||49632==e||49660==e||49688==e||49716==e||49744==e||49772==e||49800==e||49828==e||49856==e||49884==e||49912==e||49940==e||49968==e||49996==e||50024==e||50052==e||50080==e||50108==e||50136==e||50164==e||50192==e||50220==e||50248==e||50276==e||50304==e||50332==e||50360==e||50388==e||50416==e||50444==e||50472==e||50500==e||50528==e||50556==e||50584==e||50612==e||50640==e||50668==e||50696==e||50724==e||50752==e||50780==e||50808==e||50836==e||50864==e||50892==e||50920==e||50948==e||50976==e||51004==e||51032==e||51060==e||51088==e||51116==e||51144==e||51172==e||51200==e||51228==e||51256==e||51284==e||51312==e||51340==e||51368==e||51396==e||51424==e||51452==e||51480==e||51508==e||51536==e||51564==e||51592==e||51620==e||51648==e||51676==e||51704==e||51732==e||51760==e||51788==e||51816==e||51844==e||51872==e||51900==e||51928==e||51956==e||51984==e||52012==e||52040==e||52068==e||52096==e||52124==e||52152==e||52180==e||52208==e||52236==e||52264==e||52292==e||52320==e||52348==e||52376==e||52404==e||52432==e||52460==e||52488==e||52516==e||52544==e||52572==e||52600==e||52628==e||52656==e||52684==e||52712==e||52740==e||52768==e||52796==e||52824==e||52852==e||52880==e||52908==e||52936==e||52964==e||52992==e||53020==e||53048==e||53076==e||53104==e||53132==e||53160==e||53188==e||53216==e||53244==e||53272==e||53300==e||53328==e||53356==e||53384==e||53412==e||53440==e||53468==e||53496==e||53524==e||53552==e||53580==e||53608==e||53636==e||53664==e||53692==e||53720==e||53748==e||53776==e||53804==e||53832==e||53860==e||53888==e||53916==e||53944==e||53972==e||54e3==e||54028==e||54056==e||54084==e||54112==e||54140==e||54168==e||54196==e||54224==e||54252==e||54280==e||54308==e||54336==e||54364==e||54392==e||54420==e||54448==e||54476==e||54504==e||54532==e||54560==e||54588==e||54616==e||54644==e||54672==e||54700==e||54728==e||54756==e||54784==e||54812==e||54840==e||54868==e||54896==e||54924==e||54952==e||54980==e||55008==e||55036==e||55064==e||55092==e||55120==e||55148==e||55176==e?9:44033<=e&&44059>=e||44061<=e&&44087>=e||44089<=e&&44115>=e||44117<=e&&44143>=e||44145<=e&&44171>=e||44173<=e&&44199>=e||44201<=e&&44227>=e||44229<=e&&44255>=e||44257<=e&&44283>=e||44285<=e&&44311>=e||44313<=e&&44339>=e||44341<=e&&44367>=e||44369<=e&&44395>=e||44397<=e&&44423>=e||44425<=e&&44451>=e||44453<=e&&44479>=e||44481<=e&&44507>=e||44509<=e&&44535>=e||44537<=e&&44563>=e||44565<=e&&44591>=e||44593<=e&&44619>=e||44621<=e&&44647>=e||44649<=e&&44675>=e||44677<=e&&44703>=e||44705<=e&&44731>=e||44733<=e&&44759>=e||44761<=e&&44787>=e||44789<=e&&44815>=e||44817<=e&&44843>=e||44845<=e&&44871>=e||44873<=e&&44899>=e||44901<=e&&44927>=e||44929<=e&&44955>=e||44957<=e&&44983>=e||44985<=e&&45011>=e||45013<=e&&45039>=e||45041<=e&&45067>=e||45069<=e&&45095>=e||45097<=e&&45123>=e||45125<=e&&45151>=e||45153<=e&&45179>=e||45181<=e&&45207>=e||45209<=e&&45235>=e||45237<=e&&45263>=e||45265<=e&&45291>=e||45293<=e&&45319>=e||45321<=e&&45347>=e||45349<=e&&45375>=e||45377<=e&&45403>=e||45405<=e&&45431>=e||45433<=e&&45459>=e||45461<=e&&45487>=e||45489<=e&&45515>=e||45517<=e&&45543>=e||45545<=e&&45571>=e||45573<=e&&45599>=e||45601<=e&&45627>=e||45629<=e&&45655>=e||45657<=e&&45683>=e||45685<=e&&45711>=e||45713<=e&&45739>=e||45741<=e&&45767>=e||45769<=e&&45795>=e||45797<=e&&45823>=e||45825<=e&&45851>=e||45853<=e&&45879>=e||45881<=e&&45907>=e||45909<=e&&45935>=e||45937<=e&&45963>=e||45965<=e&&45991>=e||45993<=e&&46019>=e||46021<=e&&46047>=e||46049<=e&&46075>=e||46077<=e&&46103>=e||46105<=e&&46131>=e||46133<=e&&46159>=e||46161<=e&&46187>=e||46189<=e&&46215>=e||46217<=e&&46243>=e||46245<=e&&46271>=e||46273<=e&&46299>=e||46301<=e&&46327>=e||46329<=e&&46355>=e||46357<=e&&46383>=e||46385<=e&&46411>=e||46413<=e&&46439>=e||46441<=e&&46467>=e||46469<=e&&46495>=e||46497<=e&&46523>=e||46525<=e&&46551>=e||46553<=e&&46579>=e||46581<=e&&46607>=e||46609<=e&&46635>=e||46637<=e&&46663>=e||46665<=e&&46691>=e||46693<=e&&46719>=e||46721<=e&&46747>=e||46749<=e&&46775>=e||46777<=e&&46803>=e||46805<=e&&46831>=e||46833<=e&&46859>=e||46861<=e&&46887>=e||46889<=e&&46915>=e||46917<=e&&46943>=e||46945<=e&&46971>=e||46973<=e&&46999>=e||47001<=e&&47027>=e||47029<=e&&47055>=e||47057<=e&&47083>=e||47085<=e&&47111>=e||47113<=e&&47139>=e||47141<=e&&47167>=e||47169<=e&&47195>=e||47197<=e&&47223>=e||47225<=e&&47251>=e||47253<=e&&47279>=e||47281<=e&&47307>=e||47309<=e&&47335>=e||47337<=e&&47363>=e||47365<=e&&47391>=e||47393<=e&&47419>=e||47421<=e&&47447>=e||47449<=e&&47475>=e||47477<=e&&47503>=e||47505<=e&&47531>=e||47533<=e&&47559>=e||47561<=e&&47587>=e||47589<=e&&47615>=e||47617<=e&&47643>=e||47645<=e&&47671>=e||47673<=e&&47699>=e||47701<=e&&47727>=e||47729<=e&&47755>=e||47757<=e&&47783>=e||47785<=e&&47811>=e||47813<=e&&47839>=e||47841<=e&&47867>=e||47869<=e&&47895>=e||47897<=e&&47923>=e||47925<=e&&47951>=e||47953<=e&&47979>=e||47981<=e&&48007>=e||48009<=e&&48035>=e||48037<=e&&48063>=e||48065<=e&&48091>=e||48093<=e&&48119>=e||48121<=e&&48147>=e||48149<=e&&48175>=e||48177<=e&&48203>=e||48205<=e&&48231>=e||48233<=e&&48259>=e||48261<=e&&48287>=e||48289<=e&&48315>=e||48317<=e&&48343>=e||48345<=e&&48371>=e||48373<=e&&48399>=e||48401<=e&&48427>=e||48429<=e&&48455>=e||48457<=e&&48483>=e||48485<=e&&48511>=e||48513<=e&&48539>=e||48541<=e&&48567>=e||48569<=e&&48595>=e||48597<=e&&48623>=e||48625<=e&&48651>=e||48653<=e&&48679>=e||48681<=e&&48707>=e||48709<=e&&48735>=e||48737<=e&&48763>=e||48765<=e&&48791>=e||48793<=e&&48819>=e||48821<=e&&48847>=e||48849<=e&&48875>=e||48877<=e&&48903>=e||48905<=e&&48931>=e||48933<=e&&48959>=e||48961<=e&&48987>=e||48989<=e&&49015>=e||49017<=e&&49043>=e||49045<=e&&49071>=e||49073<=e&&49099>=e||49101<=e&&49127>=e||49129<=e&&49155>=e||49157<=e&&49183>=e||49185<=e&&49211>=e||49213<=e&&49239>=e||49241<=e&&49267>=e||49269<=e&&49295>=e||49297<=e&&49323>=e||49325<=e&&49351>=e||49353<=e&&49379>=e||49381<=e&&49407>=e||49409<=e&&49435>=e||49437<=e&&49463>=e||49465<=e&&49491>=e||49493<=e&&49519>=e||49521<=e&&49547>=e||49549<=e&&49575>=e||49577<=e&&49603>=e||49605<=e&&49631>=e||49633<=e&&49659>=e||49661<=e&&49687>=e||49689<=e&&49715>=e||49717<=e&&49743>=e||49745<=e&&49771>=e||49773<=e&&49799>=e||49801<=e&&49827>=e||49829<=e&&49855>=e||49857<=e&&49883>=e||49885<=e&&49911>=e||49913<=e&&49939>=e||49941<=e&&49967>=e||49969<=e&&49995>=e||49997<=e&&50023>=e||50025<=e&&50051>=e||50053<=e&&50079>=e||50081<=e&&50107>=e||50109<=e&&50135>=e||50137<=e&&50163>=e||50165<=e&&50191>=e||50193<=e&&50219>=e||50221<=e&&50247>=e||50249<=e&&50275>=e||50277<=e&&50303>=e||50305<=e&&50331>=e||50333<=e&&50359>=e||50361<=e&&50387>=e||50389<=e&&50415>=e||50417<=e&&50443>=e||50445<=e&&50471>=e||50473<=e&&50499>=e||50501<=e&&50527>=e||50529<=e&&50555>=e||50557<=e&&50583>=e||50585<=e&&50611>=e||50613<=e&&50639>=e||50641<=e&&50667>=e||50669<=e&&50695>=e||50697<=e&&50723>=e||50725<=e&&50751>=e||50753<=e&&50779>=e||50781<=e&&50807>=e||50809<=e&&50835>=e||50837<=e&&50863>=e||50865<=e&&50891>=e||50893<=e&&50919>=e||50921<=e&&50947>=e||50949<=e&&50975>=e||50977<=e&&51003>=e||51005<=e&&51031>=e||51033<=e&&51059>=e||51061<=e&&51087>=e||51089<=e&&51115>=e||51117<=e&&51143>=e||51145<=e&&51171>=e||51173<=e&&51199>=e||51201<=e&&51227>=e||51229<=e&&51255>=e||51257<=e&&51283>=e||51285<=e&&51311>=e||51313<=e&&51339>=e||51341<=e&&51367>=e||51369<=e&&51395>=e||51397<=e&&51423>=e||51425<=e&&51451>=e||51453<=e&&51479>=e||51481<=e&&51507>=e||51509<=e&&51535>=e||51537<=e&&51563>=e||51565<=e&&51591>=e||51593<=e&&51619>=e||51621<=e&&51647>=e||51649<=e&&51675>=e||51677<=e&&51703>=e||51705<=e&&51731>=e||51733<=e&&51759>=e||51761<=e&&51787>=e||51789<=e&&51815>=e||51817<=e&&51843>=e||51845<=e&&51871>=e||51873<=e&&51899>=e||51901<=e&&51927>=e||51929<=e&&51955>=e||51957<=e&&51983>=e||51985<=e&&52011>=e||52013<=e&&52039>=e||52041<=e&&52067>=e||52069<=e&&52095>=e||52097<=e&&52123>=e||52125<=e&&52151>=e||52153<=e&&52179>=e||52181<=e&&52207>=e||52209<=e&&52235>=e||52237<=e&&52263>=e||52265<=e&&52291>=e||52293<=e&&52319>=e||52321<=e&&52347>=e||52349<=e&&52375>=e||52377<=e&&52403>=e||52405<=e&&52431>=e||52433<=e&&52459>=e||52461<=e&&52487>=e||52489<=e&&52515>=e||52517<=e&&52543>=e||52545<=e&&52571>=e||52573<=e&&52599>=e||52601<=e&&52627>=e||52629<=e&&52655>=e||52657<=e&&52683>=e||52685<=e&&52711>=e||52713<=e&&52739>=e||52741<=e&&52767>=e||52769<=e&&52795>=e||52797<=e&&52823>=e||52825<=e&&52851>=e||52853<=e&&52879>=e||52881<=e&&52907>=e||52909<=e&&52935>=e||52937<=e&&52963>=e||52965<=e&&52991>=e||52993<=e&&53019>=e||53021<=e&&53047>=e||53049<=e&&53075>=e||53077<=e&&53103>=e||53105<=e&&53131>=e||53133<=e&&53159>=e||53161<=e&&53187>=e||53189<=e&&53215>=e||53217<=e&&53243>=e||53245<=e&&53271>=e||53273<=e&&53299>=e||53301<=e&&53327>=e||53329<=e&&53355>=e||53357<=e&&53383>=e||53385<=e&&53411>=e||53413<=e&&53439>=e||53441<=e&&53467>=e||53469<=e&&53495>=e||53497<=e&&53523>=e||53525<=e&&53551>=e||53553<=e&&53579>=e||53581<=e&&53607>=e||53609<=e&&53635>=e||53637<=e&&53663>=e||53665<=e&&53691>=e||53693<=e&&53719>=e||53721<=e&&53747>=e||53749<=e&&53775>=e||53777<=e&&53803>=e||53805<=e&&53831>=e||53833<=e&&53859>=e||53861<=e&&53887>=e||53889<=e&&53915>=e||53917<=e&&53943>=e||53945<=e&&53971>=e||53973<=e&&53999>=e||54001<=e&&54027>=e||54029<=e&&54055>=e||54057<=e&&54083>=e||54085<=e&&54111>=e||54113<=e&&54139>=e||54141<=e&&54167>=e||54169<=e&&54195>=e||54197<=e&&54223>=e||54225<=e&&54251>=e||54253<=e&&54279>=e||54281<=e&&54307>=e||54309<=e&&54335>=e||54337<=e&&54363>=e||54365<=e&&54391>=e||54393<=e&&54419>=e||54421<=e&&54447>=e||54449<=e&&54475>=e||54477<=e&&54503>=e||54505<=e&&54531>=e||54533<=e&&54559>=e||54561<=e&&54587>=e||54589<=e&&54615>=e||54617<=e&&54643>=e||54645<=e&&54671>=e||54673<=e&&54699>=e||54701<=e&&54727>=e||54729<=e&&54755>=e||54757<=e&&54783>=e||54785<=e&&54811>=e||54813<=e&&54839>=e||54841<=e&&54867>=e||54869<=e&&54895>=e||54897<=e&&54923>=e||54925<=e&&54951>=e||54953<=e&&54979>=e||54981<=e&&55007>=e||55009<=e&&55035>=e||55037<=e&&55063>=e||55065<=e&&55091>=e||55093<=e&&55119>=e||55121<=e&&55147>=e||55149<=e&&55175>=e||55177<=e&&55203>=e?10:9757==e||9977==e||9994<=e&&9997>=e||127877==e||127938<=e&&127940>=e||127943==e||127946<=e&&127948>=e||128066<=e&&128067>=e||128070<=e&&128080>=e||128110==e||128112<=e&&128120>=e||128124==e||128129<=e&&128131>=e||128133<=e&&128135>=e||128170==e||128372<=e&&128373>=e||128378==e||128400==e||128405<=e&&128406>=e||128581<=e&&128583>=e||128587<=e&&128591>=e||128675==e||128692<=e&&128694>=e||128704==e||128716==e||129304<=e&&129308>=e||129310<=e&&129311>=e||129318==e||129328<=e&&129337>=e||129341<=e&&129342>=e||129489<=e&&129501>=e?13:127995<=e&&127999>=e?14:8205==e?15:9792==e||9794==e||9877<=e&&9878>=e||9992==e||10084==e||127752==e||127806==e||127859==e||127891==e||127908==e||127912==e||127979==e||127981==e||128139==e||128187<=e&&128188>=e||128295==e||128300==e||128488==e||128640==e||128658==e?16:128102<=e&&128105>=e?17:11}return this.nextBreak=function(i,r){if(void 0===r&&(r=0),0>r)return 0;if(r>=i.length-1)return i.length;var n=s(e(i,r)),a=[];for(r+=1;r<i.length;r++){var o=i,h=r-1;if(!(55296<=o.charCodeAt(h)&&56319>=o.charCodeAt(h)&&56320<=o.charCodeAt(h+1)&&57343>=o.charCodeAt(h+1))){if(t(n,a,o=s(e(i,r))))return r;a.push(o)}}return i.length},this.splitGraphemes=function(e){for(var t,s=[],i=0;(t=this.nextBreak(e,i))<e.length;)s.push(e.slice(i,t)),i=t;return i<e.length&&s.push(e.slice(i)),s},this.iterateGraphemes=function(e){var t=0,s={next:function(){var s;if((s=this.nextBreak(e,t))<e.length){var i=e.slice(t,s);return t=s,{value:i,done:!1}}return t<e.length?(i=e.slice(t),t=e.length,{value:i,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!=typeof Symbol&&Symbol.iterator&&(s[Symbol.iterator]=function(){return s}),s},this.countGraphemes=function(e){for(var t,s=0,i=0;(t=this.nextBreak(e,i))<e.length;)i=t,s++;return i<e.length&&s++,s},this}self.GraphemeSplitter=GraphemeSplitter}{function lineInt(e,t,s){s=s||0;var i,r,n,a,o,h,l,c=[0,0];return i=e[1][1]-e[0][1],r=e[0][0]-e[1][0],n=i*e[0][0]+r*e[0][1],a=t[1][1]-t[0][1],o=t[0][0]-t[1][0],h=a*t[0][0]+o*t[0][1],scalar_eq(l=i*o-a*r,0,s)||(c[0]=(o*n-r*h)/l,c[1]=(i*h-a*n)/l),c}function lineSegmentsIntersect(e,t,s,i){var r=t[0]-e[0],n=t[1]-e[1],a=i[0]-s[0],o=i[1]-s[1];if(a*n-o*r==0)return!1;var h=(r*(s[1]-e[1])+n*(e[0]-s[0]))/(a*n-o*r),l=(a*(e[1]-s[1])+o*(s[0]-e[0]))/(o*r-a*n);return h>=0&&h<=1&&l>=0&&l<=1}function triangleArea(e,t,s){return(t[0]-e[0])*(s[1]-e[1])-(s[0]-e[0])*(t[1]-e[1])}function isLeft(e,t,s){return triangleArea(e,t,s)>0}function isLeftOn(e,t,s){return triangleArea(e,t,s)>=0}function isRight(e,t,s){return triangleArea(e,t,s)<0}function isRightOn(e,t,s){return triangleArea(e,t,s)<=0}var tmpPoint1=[],tmpPoint2=[];function collinear(e,t,s,i){if(i){var r=tmpPoint1,n=tmpPoint2;r[0]=t[0]-e[0],r[1]=t[1]-e[1],n[0]=s[0]-t[0],n[1]=s[1]-t[1];var a=r[0]*n[0]+r[1]*n[1],o=Math.sqrt(r[0]*r[0]+r[1]*r[1]),h=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return Math.acos(a/(o*h))<i}return 0===triangleArea(e,t,s)}function sqdist(e,t){var s=t[0]-e[0],i=t[1]-e[1];return s*s+i*i}function polygonAt(e,t){var s=e.length;return e[t<0?t%s+s:t%s]}function polygonClear(e){e.length=0}function polygonAppend(e,t,s,i){for(var r=s;r<i;r++)e.push(t[r])}function polygonMakeCCW(e){for(var t=0,s=e,i=1;i<e.length;++i)(s[i][1]<s[t][1]||s[i][1]===s[t][1]&&s[i][0]>s[t][0])&&(t=i);return!isLeft(polygonAt(e,t-1),polygonAt(e,t),polygonAt(e,t+1))&&(polygonReverse(e),!0)}function polygonReverse(e){for(var t=[],s=e.length,i=0;i!==s;i++)t.push(e.pop());for(i=0;i!==s;i++)e[i]=t[i]}function polygonIsReflex(e,t){return isRight(polygonAt(e,t-1),polygonAt(e,t),polygonAt(e,t+1))}var tmpLine1=[],tmpLine2=[];function polygonCanSee(e,t,s){var i,r,n=tmpLine1,a=tmpLine2;if(isLeftOn(polygonAt(e,t+1),polygonAt(e,t),polygonAt(e,s))&&isRightOn(polygonAt(e,t-1),polygonAt(e,t),polygonAt(e,s)))return!1;r=sqdist(polygonAt(e,t),polygonAt(e,s));for(var o=0;o!==e.length;++o)if((o+1)%e.length!==t&&o!==t&&isLeftOn(polygonAt(e,t),polygonAt(e,s),polygonAt(e,o+1))&&isRightOn(polygonAt(e,t),polygonAt(e,s),polygonAt(e,o))&&(n[0]=polygonAt(e,t),n[1]=polygonAt(e,s),a[0]=polygonAt(e,o),a[1]=polygonAt(e,o+1),i=lineInt(n,a),sqdist(polygonAt(e,t),i)<r))return!1;return!0}function polygonCanSee2(e,t,s){for(var i=0;i!==e.length;++i)if(i!==t&&i!==s&&(i+1)%e.length!==t&&(i+1)%e.length!==s&&lineSegmentsIntersect(polygonAt(e,t),polygonAt(e,s),polygonAt(e,i),polygonAt(e,i+1)))return!1;return!0}function polygonCopy(e,t,s,i){var r=i||[];if(polygonClear(r),t<s)for(var n=t;n<=s;n++)r.push(e[n]);else{for(n=0;n<=s;n++)r.push(e[n]);for(n=t;n<e.length;n++)r.push(e[n])}return r}function polygonGetCutEdges(e){for(var t=[],s=[],i=[],r=[],n=Number.MAX_VALUE,a=0;a<e.length;++a)if(polygonIsReflex(e,a))for(var o=0;o<e.length;++o)if(polygonCanSee(e,a,o)){s=polygonGetCutEdges(polygonCopy(e,a,o,r)),i=polygonGetCutEdges(polygonCopy(e,o,a,r));for(var h=0;h<i.length;h++)s.push(i[h]);s.length<n&&(t=s,n=s.length,t.push([polygonAt(e,a),polygonAt(e,o)]))}return t}function polygonDecomp(e){var t=polygonGetCutEdges(e);return t.length>0?polygonSlice(e,t):[e]}function polygonSlice(e,t){if(0===t.length)return[e];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2===t[0].length&&t[0][0]instanceof Array){for(var s=[e],i=0;i<t.length;i++)for(var r=t[i],n=0;n<s.length;n++){var a=polygonSlice(s[n],r);if(a){s.splice(n,1),s.push(a[0],a[1]);break}}return s}r=t,i=e.indexOf(r[0]),n=e.indexOf(r[1]);return-1!==i&&-1!==n&&[polygonCopy(e,i,n),polygonCopy(e,n,i)]}function polygonIsSimple(e){var t,s=e;for(t=0;t<s.length-1;t++)for(var i=0;i<t-1;i++)if(lineSegmentsIntersect(s[t],s[t+1],s[i],s[i+1]))return!1;for(t=1;t<s.length-2;t++)if(lineSegmentsIntersect(s[0],s[s.length-1],s[t],s[t+1]))return!1;return!0}function getIntersectionPoint(e,t,s,i,r){r=r||0;var n=t[1]-e[1],a=e[0]-t[0],o=n*e[0]+a*e[1],h=i[1]-s[1],l=s[0]-i[0],c=h*s[0]+l*s[1],u=n*l-h*a;return scalar_eq(u,0,r)?[0,0]:[(l*o-a*c)/u,(n*c-h*o)/u]}function polygonQuickDecomp(e,t,s,i,r,n,a){n=n||100,a=a||0,r=r||25,t=void 0!==t?t:[],s=s||[],i=i||[];var o=[0,0],h=[0,0],l=[0,0],c=0,u=0,_=0,d=0,p=0,f=0,m=0,g=[],S=[],y=e,G=e;if(G.length<3)return t;if(++a>n)return t;for(var I=0;I<e.length;++I)if(polygonIsReflex(y,I)){s.push(y[I]),c=u=Number.MAX_VALUE;for(var T=0;T<e.length;++T)isLeft(polygonAt(y,I-1),polygonAt(y,I),polygonAt(y,T))&&isRightOn(polygonAt(y,I-1),polygonAt(y,I),polygonAt(y,T-1))&&(l=getIntersectionPoint(polygonAt(y,I-1),polygonAt(y,I),polygonAt(y,T),polygonAt(y,T-1)),isRight(polygonAt(y,I+1),polygonAt(y,I),l)&&(_=sqdist(y[I],l))<u&&(u=_,h=l,f=T)),isLeft(polygonAt(y,I+1),polygonAt(y,I),polygonAt(y,T+1))&&isRightOn(polygonAt(y,I+1),polygonAt(y,I),polygonAt(y,T))&&(l=getIntersectionPoint(polygonAt(y,I+1),polygonAt(y,I),polygonAt(y,T),polygonAt(y,T+1)),isLeft(polygonAt(y,I-1),polygonAt(y,I),l)&&(_=sqdist(y[I],l))<c&&(c=_,o=l,p=T));if(f===(p+1)%e.length)l[0]=(h[0]+o[0])/2,l[1]=(h[1]+o[1])/2,i.push(l),I<p?(polygonAppend(g,y,I,p+1),g.push(l),S.push(l),0!==f&&polygonAppend(S,y,f,y.length),polygonAppend(S,y,0,I+1)):(0!==I&&polygonAppend(g,y,I,y.length),polygonAppend(g,y,0,p+1),g.push(l),S.push(l),polygonAppend(S,y,f,I+1));else{if(f>p&&(p+=e.length),d=Number.MAX_VALUE,p<f)return t;for(T=f;T<=p;++T)isLeftOn(polygonAt(y,I-1),polygonAt(y,I),polygonAt(y,T))&&isRightOn(polygonAt(y,I+1),polygonAt(y,I),polygonAt(y,T))&&(_=sqdist(polygonAt(y,I),polygonAt(y,T)))<d&&polygonCanSee2(y,I,T)&&(d=_,m=T%e.length);I<m?(polygonAppend(g,y,I,m+1),0!==m&&polygonAppend(S,y,m,G.length),polygonAppend(S,y,0,I+1)):(0!==I&&polygonAppend(g,y,I,G.length),polygonAppend(g,y,0,m+1),polygonAppend(S,y,m,I+1))}return g.length<S.length?(polygonQuickDecomp(g,t,s,i,r,n,a),polygonQuickDecomp(S,t,s,i,r,n,a)):(polygonQuickDecomp(S,t,s,i,r,n,a),polygonQuickDecomp(g,t,s,i,r,n,a)),t}return t.push(e),t}function polygonRemoveCollinearPoints(e,t){for(var s=0,i=e.length-1;e.length>3&&i>=0;--i)collinear(polygonAt(e,i-1),polygonAt(e,i),polygonAt(e,i+1),t)&&(e.splice(i%e.length,1),s++);return s}function polygonRemoveDuplicatePoints(e,t){for(var s=e.length-1;s>=1;--s)for(var i=e[s],r=s-1;r>=0;--r)if(points_eq(i,e[r],t)){e.splice(s,1);continue}}function scalar_eq(e,t,s){return s=s||0,Math.abs(e-t)<=s}function points_eq(e,t,s){return scalar_eq(e[0],t[0],s)&&scalar_eq(e[1],t[1],s)}self.polyDecomp={decomp:polygonDecomp,quickDecomp:polygonQuickDecomp,isSimple:polygonIsSimple,removeCollinearPoints:polygonRemoveCollinearPoints,removeDuplicatePoints:polygonRemoveDuplicatePoints,makeCCW:polygonMakeCCW}}{let e=!1,t=!1,s="dev";const i=self.C3=class{constructor(){throw TypeError("static class can't be instantiated")}static SetReady(){e=!0}static IsReady(){return e}static SetAppStarted(){t=!0}static HasAppStarted(){return t}static SetBuildMode(e){s=e}static GetBuildMode(){return s}static IsReleaseBuild(){return"final"===s}};i.isDebug=!1,i.isDebugDefend=!1,i.hardwareConcurrency=navigator.hardwareConcurrency||2,self.C3X={}}{const e=self.C3;e.QueryParser=class{constructor(e){this._queryString=e,this._parameters=new Map,this._Parse()}_Parse(){let e=this._queryString;(e.startsWith("?")||e.startsWith("#"))&&(e=e.substr(1));const t=e.split("&");for(const e of t)this._ParseParameter(e)}_ParseParameter(e){if(!e)return;if(!e.includes("="))return void this._parameters.set(e,null);const t=e.indexOf("="),s=decodeURIComponent(e.substring(0,t)),i=decodeURIComponent(e.substring(t+1));this._parameters.set(s,i)}LogAll(){for(const e of this._parameters);}Has(e){return this._parameters.has(e)}Get(e){const t=this._parameters.get(e);return void 0===t?null:t}ClearHash(){history.replaceState("",document.title,location.pathname+location.search)}Reparse(e){this._queryString=e,this._parameters.clear(),this._Parse()}},e.QueryString=new e.QueryParser(location.search),e.LocationHashString=new e.QueryParser(location.hash),e.QueryString.Has("perf")&&(e.isPerformanceProfiling=!0),"dev"!==e.QueryString.Get("mode")&&e.SetBuildMode("final")}{const e=self.C3,t="(unknown)";e.Platform={OS:t,OSVersion:t,Browser:t,BrowserVersion:t,BrowserVersionNumber:NaN,BrowserEngine:t,Context:"browser",IsDesktop:!0,IsMobile:!1,IsAppleOS:!1,IsIpadOS:!1,GetDetailedInfo:async()=>{}};const s=new Map([[5,"2000"],[5.1,"XP"],[5.2,"XP"],[6,"Vista"],[6.1,"7"],[6.2,"8"],[6.3,"8.1"],[10,"10"]]);function GetWindowsNTVersionName(e){const t=parseFloat(e),i=s.get(t);return i||(t>=13?"11":"NT "+e)}const i=navigator.userAgent,r=navigator.userAgentData;if(r&&r.brands.length>0){e.Platform.OS=r.platform,e.Platform.IsMobile=r.mobile,e.Platform.IsDesktop=!e.Platform.IsMobile;const s=new Map([["Google Chrome","Chrome"],["Microsoft Edge","Edge"],["Opera","Opera"],["Opera GX","Opera GX"],["Mozilla Firefox","Firefox"],["Apple Safari","Safari"],["NW.js","NW.js"]]),i=new Map([["Chromium","Chromium"],["Gecko","Gecko"],["WebKit","WebKit"]]);function ReadBrandList(r){let n="",a="",o="",h="";for(const e of r){const t=s.get(e.brand);!n&&t&&(n=t,a=e.version);const r=i.get(e.brand);!o&&r&&(o=r,h=e.version)}n||"Chromium"!==o||(e.Platform.Browser="Chromium",e.Platform.BrowserVersion=h),e.Platform.Browser=n||t,e.Platform.BrowserVersion=a||t,e.Platform.BrowserEngine=o||t}ReadBrandList(r.brands);let n=!1;e.Platform.GetDetailedInfo=async()=>{if(!n)try{const t=await navigator.userAgentData.getHighEntropyValues(["platformVersion","fullVersionList"]);ReadBrandList(t.fullVersionList),"Windows"===e.Platform.OS?e.Platform.OSVersion=GetWindowsNTVersionName(t.platformVersion):e.Platform.OSVersion=t.platformVersion,n=!0}catch(e){}}}else{function RunTest(e,t){const s=Array.isArray(e)?e:[e];for(const e of s){const s=e.exec(i);if(s){t(s);break}}}RunTest(/windows\s+nt\s+([\d\.]+)/i,(t=>{e.Platform.OS="Windows";const s=t[1];e.Platform.OSVersion=GetWindowsNTVersionName(s)})),RunTest(/mac\s+os\s+x\s+([\d\._]+)/i,(t=>{e.Platform.OS="macOS",e.Platform.OSVersion=t[1].replace(/_/g,".")})),RunTest(/CrOS/,(()=>{e.Platform.OS="Chrome OS"})),RunTest(/linux|openbsd|freebsd|netbsd/i,(()=>{e.Platform.OS="Linux"})),RunTest(/android/i,(()=>{e.Platform.OS="Android"})),RunTest(/android\s+([\d\.]+)/i,(t=>{e.Platform.OS="Android",e.Platform.OSVersion=t[1]})),e.Platform.OS===t&&(RunTest(/(iphone|ipod|ipad)/i,(t=>{e.Platform.OS="iOS"})),RunTest([/iphone\s+os\s+([\d\._]+)/i,/ipad[^)]*os\s+([\d\._]+)/i],(t=>{e.Platform.OS="iOS",e.Platform.OSVersion=t[1].replace(/_/g,".")})));const s=/chrome\//i.test(i),r=/chromium\//i.test(i),n=/edg\//i.test(i),a=/OPR\//.test(i),o=/nwjs/i.test(i),h=/safari\//i.test(i),l=/webkit/i.test(i);n||a||RunTest(/chrome\/([\d\.]+)/i,(t=>{e.Platform.Browser="Chrome",e.Platform.BrowserVersion=t[1],e.Platform.BrowserEngine="Chromium"})),RunTest(/edg\/([\d\.]+)/i,(t=>{e.Platform.Browser="Edge",e.Platform.BrowserVersion=t[1],e.Platform.BrowserEngine="Chromium"})),RunTest(/OPR\/([\d\.]+)/,(t=>{e.Platform.Browser="Opera",e.Platform.BrowserVersion=t[1],e.Platform.BrowserEngine="Chromium"})),RunTest(/chromium\/([\d\.]+)/i,(t=>{e.Platform.Browser="Chromium",e.Platform.BrowserVersion=t[1],e.Platform.BrowserEngine="Chromium"})),RunTest(/nwjs\/[0-9.]+/i,(t=>{e.Platform.Browser="NW.js",e.Platform.BrowserVersion=t[1],e.Platform.BrowserEngine="Chromium",e.Platform.Context="nwjs"})),RunTest(/firefox\/([\d\.]+)/i,(t=>{e.Platform.Browser="Firefox",e.Platform.BrowserVersion=t[1],e.Platform.BrowserEngine="Gecko"})),!h||s||r||n||a||o||(e.Platform.Browser="Safari",e.Platform.BrowserEngine="WebKit",RunTest(/version\/([\d\.]+)/i,(t=>{e.Platform.BrowserVersion=t[1]})),RunTest(/crios\/([\d\.]+)/i,(t=>{e.Platform.Browser="Chrome for iOS",e.Platform.BrowserVersion=t[1]})),RunTest(/fxios\/([\d\.]+)/i,(t=>{e.Platform.Browser="Firefox for iOS",e.Platform.BrowserVersion=t[1]})),RunTest(/edgios\/([\d\.]+)/i,(t=>{e.Platform.Browser="Edge for iOS",e.Platform.BrowserVersion=t[1]}))),e.Platform.BrowserEngine===t&&l&&(e.Platform.BrowserEngine="WebKit"),"Android"===e.Platform.OS&&"Safari"===e.Platform.Browser&&(e.Platform.Browser="Stock");const c=new Set(["Windows","macOS","Linux","Chrome OS"]),u=c.has(e.Platform.OS)||"nwjs"===e.Platform.Context;e.Platform.IsDesktop=u,e.Platform.IsMobile=!u}"Chrome"===e.Platform.Browser&&"browser"===e.Platform.Context&&/wv\)/.test(i)&&(e.Platform.Context="webview"),"nwjs"!==e.Platform.Context&&"undefined"!=typeof window&&(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||navigator.standalone)&&(e.Platform.Context="webapp"),e.Platform.BrowserVersionNumber=parseFloat(e.Platform.BrowserVersion);const n="macOS"===e.Platform.OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2;n&&(e.Platform.OS="iOS",e.Platform.OSVersion=e.Platform.BrowserVersion,e.Platform.IsDesktop=!1,e.Platform.IsMobile=!0,e.Platform.IsIpadOS=!0),e.Platform.IsAppleOS="macOS"===e.Platform.OS||"iOS"===e.Platform.OS}{const e=2,t="keyvaluepairs",s=new Map,i="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAll,r="undefined"!=typeof IDBObjectStore&&"function"==typeof IDBObjectStore.prototype.getAllKeys;function asyncifyRequest(e){return new Promise(((t,s)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>s(e.error)}))}function asyncifyTransaction(e){return new Promise(((t,s)=>{e.oncomplete=()=>t(),e.onerror=()=>s(e.error),e.onabort=()=>s(e.error)}))}function openReadOnlyTransaction(e,t){return openTransaction(e,t)}function openWriteTransaction(e,t){return openTransaction(e,t,!0)}async function openTransaction(e,i,r=!1,n=!0){const a=await lazyOpenDatabase(e);try{return i(a.transaction([t],r?"readwrite":"readonly"))}catch(t){if(n&&"InvalidStateError"===t.name)return s.delete(e),openTransaction(e,i,r,!1);throw t}}function lazyOpenDatabase(e){RequireString(e);let t=s.get(e);return t instanceof Promise||(t=openDatabase(e),s.set(e,t),t.catch((t=>s.delete(e)))),t}async function openDatabase(s){RequireString(s);const i=indexedDB.open(s,e);return i.addEventListener("upgradeneeded",(e=>{try{e.target.result.createObjectStore(t)}catch(e){}})),asyncifyRequest(i)}function RequireString(e){if("string"!=typeof e)throw new TypeError("expected string")}function getEntriesFromCursor(e,s){const i=e.objectStore(t).openCursor();return new Promise((e=>{const t=[];i.onsuccess=i=>{const r=i.target.result;if(r){switch(s){case"entries":t.push([r.key,r.value]);break;case"keys":t.push(r.key);break;case"values":t.push(r.value);break}r.continue()}else e(t)}}))}class n{constructor(e){RequireString(e),this.name=e}async ready(){await lazyOpenDatabase(this.name)}set(e,s){return RequireString(e),openWriteTransaction(this.name,(async i=>{const r=asyncifyRequest(i.objectStore(t).put(s,e)),n=asyncifyTransaction(i);await Promise.all([n,r])}))}get(e){return RequireString(e),openReadOnlyTransaction(this.name,(async s=>{const i=asyncifyRequest(s.objectStore(t).get(e)),r=asyncifyTransaction(s),[n,a]=await Promise.all([r,i]);return a}))}delete(e){return RequireString(e),openWriteTransaction(this.name,(async s=>{const i=asyncifyRequest(s.objectStore(t).delete(e)),r=asyncifyTransaction(s);await Promise.all([r,i])}))}clear(){return openWriteTransaction(this.name,(async e=>{const s=asyncifyRequest(e.objectStore(t).clear()),i=asyncifyTransaction(e);await Promise.all([i,s])}))}keys(){return openReadOnlyTransaction(this.name,(async e=>{let s;if(r){s=asyncifyRequest(e.objectStore(t).getAllKeys())}else s=getEntriesFromCursor(e,"keys");const i=asyncifyTransaction(e),[n,a]=await Promise.all([i,s]);return a}))}values(){return openReadOnlyTransaction(this.name,(async e=>{let s;if(i){s=asyncifyRequest(e.objectStore(t).getAll())}else s=getEntriesFromCursor(e,"values");const r=asyncifyTransaction(e),[n,a]=await Promise.all([r,s]);return a}))}entries(){return openReadOnlyTransaction(this.name,(async e=>{const t=getEntriesFromCursor(e,"entries"),s=asyncifyTransaction(e),[i,r]=await Promise.all([s,t]);return r}))}}self.KVStorageContainer=n}{const e=self.KVStorageContainer,t=[/no available storage method found/i,/an attempt was made to break through the security policy of the user agent/i,/the user denied permission to access the database/i,/a mutation operation was attempted on a database that did not allow mutations/i,/idbfactory\.open\(\) called in an invalid security context/i],s=new WeakMap;let i=!1;function NOT_IMPLEMENTED(e){throw new Error(`"${e}" is not implemented`)}function DISALLOW_CALLBACK(e){if("function"==typeof e)throw new Error("localforage callback API is not implemented; please use the promise API instead")}function StructuredClone(e){return"object"==typeof e?new Promise((t=>{const{port1:s,port2:i}=new MessageChannel;i.onmessage=e=>t(e.data),s.postMessage(e)})):Promise.resolve(e)}"undefined"==typeof indexedDB&&(i=!0);class r{constructor(e){this._inst=e,s.set(this,new Map)}_MaybeSwitchToMemoryFallback(e){if(!i)for(const s of t)if(e&&s.test(e.message)){i=!0;break}}async _getItemFallback(e){const t=s.get(this).get(e),i=await StructuredClone(t);return void 0===i?null:i}async _setItemFallback(e,t){t=await StructuredClone(t),s.get(this).set(e,t)}_removeItemFallback(e){s.get(this).delete(e)}_clearFallback(){s.get(this).clear()}_keysFallback(){return Array.from(s.get(this).keys())}IsUsingFallback(){return i}async getItem(e,t){if(DISALLOW_CALLBACK(t),i)return await this._getItemFallback(e);let s;try{s=await this._inst.get(e)}catch(t){return this._MaybeSwitchToMemoryFallback(t),i?await this._getItemFallback(e):null}return void 0===s?null:s}async setItem(e,t,s){if(DISALLOW_CALLBACK(s),void 0===t&&(t=null),i)await this._setItemFallback(e,t);else try{await this._inst.set(e,t)}catch(s){if(this._MaybeSwitchToMemoryFallback(s),!i)throw s;await this._setItemFallback(e,t)}}async removeItem(e,t){if(DISALLOW_CALLBACK(t),i)this._removeItemFallback(e);else try{await this._inst.delete(e)}catch(t){this._MaybeSwitchToMemoryFallback(t),i&&this._removeItemFallback(e)}}async clear(e){if(DISALLOW_CALLBACK(e),i)this._clearFallback();else try{await this._inst.clear()}catch(e){this._MaybeSwitchToMemoryFallback(e),i&&this._clearFallback()}}async keys(e){if(DISALLOW_CALLBACK(e),i)return this._keysFallback();let t=[];try{t=await this._inst.keys()}catch(e){if(this._MaybeSwitchToMemoryFallback(e),i)return this._keysFallback()}return t}ready(e){return DISALLOW_CALLBACK(e),i?Promise.resolve(!0):this._inst.ready()}createInstance(t){if("object"!=typeof t)throw new TypeError("invalid options object");const s=t.name;if("string"!=typeof s)throw new TypeError("invalid store name");const i=new e(s);return new r(i)}length(e){NOT_IMPLEMENTED("localforage.length()")}key(e,t){NOT_IMPLEMENTED("localforage.key()")}iterate(e,t){NOT_IMPLEMENTED("localforage.iterate()")}setDriver(e){NOT_IMPLEMENTED("localforage.setDriver()")}config(e){NOT_IMPLEMENTED("localforage.config()")}defineDriver(e){NOT_IMPLEMENTED("localforage.defineDriver()")}driver(){NOT_IMPLEMENTED("localforage.driver()")}supports(e){NOT_IMPLEMENTED("localforage.supports()")}dropInstance(){NOT_IMPLEMENTED("localforage.dropInstance()")}disableMemoryMode(){i=!1}}self.localforage=new r(new e("localforage"))}{const e=self.C3;if(e.Supports={},e.Supports.WebAnimations=(()=>{try{if("Safari"===e.Platform.Browser)return!1;if("undefined"==typeof document)return!1;const t=document.createElement("div");if(void 0===t.animate)return!1;return void 0!==t.animate([{opacity:"0"},{opacity:"1"}],1e3).reverse}catch(e){return!1}})(),e.Supports.DialogElement="undefined"!=typeof HTMLDialogElement,e.Supports.RequestIdleCallback=!!self.requestIdleCallback,e.Supports.ImageBitmap=!!self.createImageBitmap,e.Supports.ImageBitmapOptions=!1,e.Supports.ImageBitmapOptionsResize=!1,e.Supports.ImageBitmap){try{self.createImageBitmap(new ImageData(32,32),{premultiplyAlpha:"none"}).then((()=>{e.Supports.ImageBitmapOptions=!0})).catch((()=>{e.Supports.ImageBitmapOptions=!1}))}catch(t){e.Supports.ImageBitmapOptions=!1}try{self.createImageBitmap(new ImageData(32,32),{resizeWidth:10,resizeHeight:10}).then((t=>{e.Supports.ImageBitmapOptionsResize=10===t.width&&10===t.height})).catch((()=>{e.Supports.ImageBitmapOptionsResize=!1}))}catch(t){e.Supports.ImageBitmapOptionsResize=!1}}if(e.Supports.ClipboardReadText=!(!navigator.clipboard||!navigator.clipboard.readText||"Firefox"===e.Platform.Browser),e.Supports.PermissionsQuery=!(!navigator.permissions||!navigator.permissions.query),e.Supports.ClipboardPermissionsQuery=!1,e.Supports.PermissionsQuery){const t={name:"clipboard-read"};navigator.permissions.query(t).then((()=>{e.Supports.ClipboardPermissionsQuery=!0})).catch((()=>{e.Supports.ClipboardPermissionsQuery=!1}))}e.Supports.AsyncClipboardApi=!!(navigator.permissions&&navigator.clipboard&&self.ClipboardItem),e.Supports.Proxies="undefined"!=typeof Proxy,e.Supports.DownloadAttribute=(()=>{if("undefined"==typeof document)return!1;return void 0!==document.createElement("a").download})(),e.Supports.Fetch="function"==typeof fetch,e.Supports.PersistentStorage=!!(self.isSecureContext&&"Opera"!==e.Platform.Browser&&navigator.storage&&navigator.storage.persist),e.Supports.StorageQuotaEstimate=!!(self.isSecureContext&&navigator.storage&&navigator.storage.estimate),e.Supports.Fullscreen=(()=>{if("undefined"==typeof document)return!1;if("iOS"===e.Platform.OS)return!1;const t=document.documentElement;return!!(t.requestFullscreen||t.msRequestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen)})(),e.Supports.ImageDecoder=void 0!==self.ImageDecoder,e.Supports.WebCodecs=!!self.VideoEncoder,e.Supports.NativeFileSystemAPI=!!self.showOpenFilePicker,e.Supports.QueryLocalFonts=!!self.queryLocalFonts,e.Supports.UserActivation=!!navigator.userActivation,e.Supports.CanvasToBlobWebP=!1,(async()=>{let t;"undefined"==typeof document?t=new OffscreenCanvas(32,32):(t=document.createElement("canvas"),t.width=32,t.height=32);const s=t.getContext("2d");s.fillStyle="blue",s.fillRect(0,0,32,32);let i=null;try{t.toBlob?i=await new Promise((e=>t.toBlob(e,"image/webp",1))):t.convertToBlob&&(i=await t.convertToBlob({type:"image/webp",quality:1})),e.Supports.CanvasToBlobWebP=i&&"image/webp"===i.type}catch(t){e.Supports.CanvasToBlobWebP=!1}})()}{const e=self.C3;if(!String.prototype.trimStart){const e=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/;String.prototype.trimStart=function(){return this.replace(e,"")}}if(!String.prototype.trimEnd){const e=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/;String.prototype.trimEnd=function(){return this.replace(e,"")}}if(String.prototype.replaceAll||(String.prototype.replaceAll=function(t,s){return this.replace(new RegExp(e.EscapeRegex(t),"g"),s)}),Array.prototype.values||(Array.prototype.values=function*(){for(const e of this)yield e}),!Array.prototype.flat){function arrayFlat(e,t){return e.reduce(((e,s)=>t>0&&Array.isArray(s)?(Array.prototype.push.apply(e,arrayFlat(s,t-1)),e):(e.push(s),e)),[])}Array.prototype.flat=function(e=1){return arrayFlat(this,e)}}Array.prototype.at||(Array.prototype.at=function(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}),String.prototype.at||(String.prototype.at=function(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}),RegExp.escape||(RegExp.escape=function(e){return String(e).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}),navigator.storage&&!navigator.storage.estimate&&navigator.webkitTemporaryStorage&&navigator.webkitTemporaryStorage.queryUsageAndQuota&&(navigator.storage.estimate=function(){return new Promise(((e,t)=>navigator.webkitTemporaryStorage.queryUsageAndQuota(((t,s)=>e({usage:t,quota:s})),t)))}),void 0===self.isSecureContext&&(self.isSecureContext="https:"===location.protocol),void 0===self.globalThis&&(self.globalThis=self)}{const e=self.C3;function assertFail(t){e.GetCallStack()}self.assert=function(e,t){e||assertFail(t)}}{const e=self.C3,t=self.C3X;e.IsNumber=function(e){return"number"==typeof e},e.IsFiniteNumber=function(t){return e.IsNumber(t)&&isFinite(t)},e.RequireNumber=function(t){if(!e.IsNumber(t))throw new TypeError("expected number")},e.RequireOptionalNumber=function(t){e.IsNullOrUndefined(t)},e.RequireNumberInRange=function(t,s,i){if(!e.IsNumber(t)||isNaN(t)||s>t||i<t)throw new RangeError("number outside of range")},e.RequireAllNumber=function(...e){for(let t of e);},e.RequireFiniteNumber=function(t){if(!e.IsFiniteNumber(t))throw new TypeError("expected finite number")},e.RequireOptionalFiniteNumber=function(t){e.IsNullOrUndefined(t)},e.RequireAllFiniteNumber=function(...e){for(let t of e);},e.IsString=function(e){return"string"==typeof e},e.RequireString=function(t){if(!e.IsString(t))throw new TypeError("expected string")},e.RequireOptionalString=function(t){e.IsNullOrUndefined(t)},e.RequireAllString=function(...e){for(let t of e);},e.IsSimpleObject=function(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return t?t.constructor===Object:null===t},e.RequireSimpleObject=function(t){if(!e.IsSimpleObject(t))throw new TypeError("expected simple object")},e.RequireOptionalSimpleObject=function(t){if(!e.IsNullOrUndefined(t)&&!e.IsSimpleObject(t))throw new TypeError("expected simple object")},e.IsObject=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},e.RequireObject=function(t){if(!e.IsObject(t))throw new TypeError("expected object")},e.RequireOptionalObject=function(t){e.IsNullOrUndefined(t)},e.RequireAllObject=function(...e){for(let t of e);},e.IsFileLike=function(t){return e.WeakIsInstanceOf(t,Blob)&&"string"==typeof t.name},e.RequireFileLike=function(t){if(!e.IsFileLike(t))throw new TypeError("expected file")},e.RequireOptionalFileLike=function(t){e.IsNullOrUndefined(t)},e.IsArray=function(e){return Array.isArray(e)},e.RequireArray=function(t){if(!e.IsArray(t))throw new TypeError("expected array")},e.RequireOptionalArray=function(t){e.IsNullOrUndefined(t)},e.RequireAllArray=function(...e){for(let t of e);},e.Is2DArray=function(t){return!!e.IsArray(t)&&(!t.length||!!e.IsArray(t[0]))},e.Require2DArray=function(t){if(!e.Is2DArray(t))throw new TypeError("expected 2d array");for(let s of t)if(!e.IsArray(s))throw new TypeError("expected 2d array")},e.RequireOptional2DArray=function(t){e.IsNullOrUndefined(t)},e.IsFunction=function(e){return"function"==typeof e},e.RequireFunction=function(t,s){if(!e.IsFunction(t))throw new TypeError("expected function");if(!e.IsNullOrUndefined(s)&&t!==s)throw new TypeError("expected same function reference")},e.RequireOptionalFunction=function(t){e.IsNullOrUndefined(t)},e.RequireAllFunction=function(...e){for(let t of e);},e.RequireAnyFunction=function(t,...s){if(!e.IsFunction(t))throw new TypeError("expected function");if(!s.length)throw new Error("missing comparison functions");for(let i of s)if(!e.IsNullOrUndefined(i)&&t===i)return;throw new TypeError("expected same function reference")},e.RequireOptionalAllFunction=function(...t){if(!e.IsNullOrUndefined(t))for(let e of t);},e.IsInstanceOf=function(e,t){return e instanceof t},e.IsInstanceOfAny=function(t,...s){for(let i of s)if(e.IsInstanceOf(t,i))return!0;return!1},e.RequireInstanceOf=function(t,s){if(!e.IsInstanceOf(t,s))throw new TypeError("unexpected type")},e.RequireOptionalInstanceOf=function(t,s){e.IsNullOrUndefined(t)},e.RequireAllInstanceOf=function(e,...t){for(let e of t);},e.RequireAnyInstanceOf=function(t,...s){if(!e.IsInstanceOfAny(t,...s))throw new TypeError("unexpected type")},e.RequireAnyOptionalInstanceOf=function(t,...s){if(!e.IsNullOrUndefined(t)&&!e.IsInstanceOfAny(t,...s))throw new TypeError("unexpected type")},e.IsArrayOf=function(t,s){for(let i of t)if(!e.IsInstanceOf(i,s))return!1;return!0},e.IsArrayOfFiniteNumbers=function(t){for(let s of t)if(!e.IsFiniteNumber(s))return!1;return!0},e.RequireArrayOf=function(e,t){for(let t of e);},e.RequireOptionalArrayOf=function(t,s){if(!e.IsNullOrUndefined(t))for(let e of t);},e.RequireArrayOfAny=function(e,...t){for(let t of e);},e.RequireOptionalArrayOfAny=function(t,...s){if(!e.IsNullOrUndefined(t))for(let e of t);},e.IsDOMNode=function(t,s){return!(e.IsNullOrUndefined(t)||!e.IsString(t.nodeName))&&(!s||e.equalsNoCase(t.nodeName,s))},e.RequireDOMNode=function(t,s){if(e.IsNullOrUndefined(t)||!e.IsString(t.nodeName))throw new TypeError("expected DOM node");if(s&&!e.equalsNoCase(t.nodeName,s))throw new TypeError(`expected DOM '${s}' node`)},e.RequireOptionalDOMNode=function(t,s){e.IsNullOrUndefined(t)},e.IsHTMLElement=function(t,s){return!(e.IsNullOrUndefined(t)||!e.IsString(t.tagName))&&(!s||e.equalsNoCase(t.tagName,s))},e.RequireHTMLElement=function(t,s){if(e.IsNullOrUndefined(t)||!e.IsString(t.tagName))throw new TypeError("expected HTML element");if(s&&!e.equalsNoCase(t.tagName,s))throw new TypeError(`expected HTML '${s}' element`)},e.RequireOptionalHTMLElement=function(t,s){e.IsNullOrUndefined(t)},e.IsDrawable=function(t){return e.IsHTMLElement(t,"img")||e.IsHTMLElement(t,"canvas")||e.IsHTMLElement(t,"video")||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap},e.RequireDrawable=function(t){if(!e.IsDrawable(t))throw new TypeError("expected drawable")},e.RequireOptionalDrawable=function(t){e.IsNullOrUndefined(t)},e.IsDrawableOrImageData=function(t){return t instanceof ImageData||e.IsDrawable(t)},e.RequireDrawableOrImageData=function(t){if(!e.IsDrawableOrImageData(t))throw new TypeError("expected drawable or image data")},e.RequireOptionalDrawableOrImageData=function(t){if(!e.IsNullOrUndefined(t)&&!e.IsDrawableOrImageData(t))throw new TypeError("expected drawable or image data")},e.IsStringLike=function(t){return"string"==typeof t||e.HtmlString&&t instanceof e.HtmlString||t instanceof e.BBString},e.RequireStringLike=function(t){if(!e.IsStringLike(t))throw new TypeError("expected string-like")},e.RequireOptionalStringLike=function(t){e.IsNullOrUndefined(t)},e.RequireAllStringLike=function(...e){for(let t of e);},e.RequireOverride=function(){throw new Error("must be overridden")},e.NotYetImplemented=function(){throw new Error("not yet implemented")},e.IsDefined=function(e,...t){let s=e;if(void 0===s)return!1;for(let e of t){if(void 0===s[e])return!1;s=s[e]}return!0},e.IsNullOrUndefined=function(e){return null==e},e.AreArrayElementsOfSameType=function(e){let t=e[0].constructor;for(let s of e)if(s.constructor!==t)return!1;return t},e.AreArrayElementsOfType=function(e,t){for(let s of e)if(!(s instanceof t))return!1;return!0};const s=Object.getPrototypeOf(Uint8Array);e.IsTypedArray=function(t){return e.IsInstanceOf(t,s)},e.RequireTypedArray=function(e){},e.WeakRequireTypedArray=function(t){e.WeakRequireInstanceOf(t,s)},e.WeakRequireAnyInstanceOf=function(t,...s){if(!e.WeakIsAnyInstanceOf(t,...s))throw new TypeError("unexpected type")},e.WeakIsAnyInstanceOf=function(t,...s){for(const i of s)if(e.WeakIsInstanceOf(t,i))return!0;return!1},e.WeakRequireInstanceOf=function(t,s){if(!e.WeakIsInstanceOf(t,s))throw new TypeError("unexpected type")},e.WeakIsInstanceOf=function(e,t){for(;e=Object.getPrototypeOf(e);)if(e.constructor.name===t.name)return!0;return!1},t.RequireNumber=e.RequireNumber,t.RequireOptionalNumber=e.RequireOptionalNumber,t.RequireFiniteNumber=e.RequireFiniteNumber,t.RequireOptionalFiniteNumber=e.RequireOptionalFiniteNumber,t.RequireString=e.RequireString,t.RequireOptionalString=e.RequireOptionalString,t.RequireObject=e.RequireObject,t.RequireOptionalObject=e.RequireOptionalObject,t.RequireArray=e.RequireArray,t.RequireOptionalArray=e.RequireOptionalArray,t.RequireFunction=e.RequireFunction,t.RequireOptionalFunction=e.RequireOptionalFunction,t.RequireInstanceOf=e.RequireInstanceOf,t.RequireOptionalInstanceOf=e.RequireOptionalInstanceOf,t.IsNullOrUndefined=e.IsNullOrUndefined}{const e=self.C3,t=new Map;let s;function isValidTypeChange(t,s){let i=e.getType(t),r=e.getType(s);return"null"===i||"null"===r||"undefined"!==i&&"undefined"!==r&&i===r}e.ColorLog=function(e,t){},e.RafLog=function(e,...s){t.has(e)||t.set(e,-1),-1===t.get(e)&&t.set(e,requestAnimationFrame((()=>{t.set(e,-1)})))},e.StartMeasure=function(e){performance.mark(e),s||(s=new Map),s.has(e)||s.set(e,{current:0,total:0,average:0,calls:1,toString:function(){return`current => ${this.current.toPrecision(3)} :: average => ${this.average.toPrecision(3)} :: calls => ${this.calls}`}})},e.EndMeasure=function(e){performance.measure("measure",e);const t=performance.getEntriesByName("measure")[0],i=s.get(e);i.current=t.duration,i.total+=i.current,i.average=i.total/i.calls,i.calls++,performance.clearMarks(),performance.clearMeasures()},e.GetCallStack=function(){return(new Error).stack},e.Debugger=function(){},e.cast=function(e,t){return e&&e instanceof t?e:null},e.getName=function(t){return void 0===t?"undefined":null===t?"null":"boolean"==typeof t?"<boolean>":e.IsNumber(t)?"<number>":e.IsString(t)?"<string>":e.IsArray(t)?"<array>":"symbol"==typeof t?"<"+t.toString()+">":e.IsFunction(t)?t.name&&"Function"!==t.name?t.name:"<anonymous function>":"object"==typeof t?t.constructor&&t.constructor.name&&"Object"!==t.constructor.name?t.constructor.name:"<anonymous object>":"<unknown>"},e.getType=function(e){return null===e?"null":Array.isArray(e)?"array":typeof e},e.range=function*(e,t){if(!isFinite(Math.abs(e-t)))throw new Error("Invalid parameters");if(e>t)for(let s=e-1;s>=t;s--)yield s;else for(let s=e;s<t;s++)yield s};let i=new Map,r=new Map,n=new WeakMap,a=new WeakMap;e.DefendHandler={};const o=new Set(["then","splice"]);function logDefendedObjectWarning(e){}e.DefendHandler.get=function(t,s){return s in t||"symbol"==typeof s||o.has(s)||logDefendedObjectWarning(`Accessed missing property '${s}' from defended object '${e.getName(t)}', returning undefined`),a.has(t)&&"symbol"!=typeof s&&!o.has(s)&&logDefendedObjectWarning(`Accessed property '${s}' on a released object '${e.getName(t)}'\nObject was originally released at: ${a.get(t)})\nCall stack at access: `),t[s]},e.DefendHandler.set=function(t,s,r){return s in t||i.has(t)||logDefendedObjectWarning(`Set non-existent property '${s}' to '${r}' on defended object '${e.getName(t)}'`),isValidTypeChange(t[s],r)||i.has(t)||logDefendedObjectWarning(`Set '${e.getType(t[s])}' property '${s}' to type '${e.getType(r)}' on defended object '${e.getName(t)}'`),a.has(t)&&logDefendedObjectWarning(`Set property '${s}' on a released object '${e.getName(t)}'\nObject was originally released at: ${a.get(t)})\nCall stack at access: `),t[s]=r,!0},e.DefendHandler.deleteProperty=function(t,s){throw new ReferenceError(`Cannot delete property '${s}' from defended object '${e.getName(t)}'`)},e.DefendHandler.defineProperty=function(t,s,i){throw new ReferenceError(`Cannot define property '${s}' on defended object '${e.getName(t)}'`)},e.DefendHandler.enumerate=function(t){throw new ReferenceError(`Cannot enumerate defended object '${e.getName(t)}'`)};let h=-1;function CheckDefendedObjectsUsedCorrectly(){if(h=-1,i.size>0||r.size>0){[...new Set([...i.keys()].map((t=>e.getName(t))))].join(",");i.clear(),r.clear()}}e.DefendedBase=class{constructor(){if(!e.isDebugDefend||!e.Supports.Proxies)return;let t=new.target,s=Object.create(t.prototype),a=new Proxy(s,e.DefendHandler);return i.set(s,a),r.set(a,s),n.set(a,s),-1===h&&(h=requestAnimationFrame(CheckDefendedObjectsUsedCorrectly)),a}},e.debugDefend=function(t){if(e.isDebugDefend&&e.Supports.Proxies&&t instanceof e.DefendedBase){if(!r.has(t))return t;let e=r.get(t);return r.delete(t),i.delete(e),t}return e.isDebug?Object.seal(t):t},e.New=function(t,...s){let n;try{n=new t(...s)}catch(e){throw r.clear(),i.clear(),e}return e.isDebugDefend&&VerifyObjectPropertiesConsistent(t,n),e.debugDefend(n)},e.Release=function(t){let s=n.get(t);s&&a.set(s,e.GetCallStack())},e.WasReleased=function(e){let t=n.get(e);return!!t&&!!a.get(t)};let l=new Map;function getObjectPropertySet(e){let t=new Set;for(let s in e)t.add(s);return t}function VerifyObjectPropertiesConsistent(t,s){let i=getObjectPropertySet(s),r=l.get(t);if(r){let t=[];for(let e of r.values())i.has(e)?i.delete(e):t.push(e);e.appendArray(t,[...i]),t.length}else l.set(t,i)}e.PerfMark=class{constructor(e){this._name="",e&&this.start(e)}start(t){e.isPerformanceProfiling&&(this._name=t,performance.mark(this._name+"-Start"))}end(){e.isPerformanceProfiling&&(performance.mark(this._name+"-End"),performance.measure(this._name,this._name+"-Start",this._name+"-End"))}next(t){e.isPerformanceProfiling&&(this.end(),this._name=t,performance.mark(this._name+"-Start"))}}}{const e=self.C3,t=2*Math.PI,s=Math.PI/180,i=180/Math.PI;e.wrap=function(e,t,s){e=Math.floor(e),t=Math.floor(t);const i=(s=Math.floor(s))-t;if(0===i)return s;if(e<t){const r=s-(t-e)%i;return r===s?0:r}return t+(e-t)%i},e.mapToRange=function(e,t,s,i,r){return(e-t)*(r-i)/(s-t)+i},e.normalize=function(e,t,s){return(e-t)/(s-t)},e.clamp=function(e,t,s){return e<t?t:e>s?s:e},e.clampAngle=function(e){return(e%=t)<0&&(e+=t),e},e.toRadians=function(e){return e*s},e.toDegrees=function(e){return e*i},e.distanceTo=function(e,t,s,i){return Math.hypot(s-e,i-t)},e.distanceSquared=function(e,t,s,i){const r=s-e,n=i-t;return r*r+n*n},e.angleTo=function(e,t,s,i){return Math.atan2(i-t,s-e)},e.angleDiff=function(e,t){if(e===t)return 0;let s=Math.sin(e),i=Math.cos(e),r=s*Math.sin(t)+i*Math.cos(t);return r>=1?0:r<=-1?Math.PI:Math.acos(r)},e.angleRotate=function(t,s,i){let r=Math.sin(t),n=Math.cos(t),a=Math.sin(s),o=Math.cos(s);return Math.acos(r*a+n*o)>i?n*a-r*o>0?e.clampAngle(t+i):e.clampAngle(t-i):e.clampAngle(s)},e.angleClockwise=function(e,t){let s=Math.sin(e);return Math.cos(e)*Math.sin(t)-s*Math.cos(t)<=0},e.angleLerp=function(s,i,r,n=0){let a=e.angleDiff(s,i);const o=t*n;return e.angleClockwise(i,s)?e.clampAngle(s+(a+o)*r):e.clampAngle(s-(a+o)*r)},e.angleLerpClockwise=function(s,i,r,n=0){const a=e.angleDiff(s,i),o=t*n;return e.angleClockwise(i,s)?e.clampAngle(s+(a+o)*r):e.clampAngle((t-a+o)*r)},e.angleLerpAntiClockwise=function(s,i,r,n=0){const a=e.angleDiff(s,i),o=t*n;return e.angleClockwise(i,s)?e.clampAngle((-t+a-o)*r):e.clampAngle(s-(a+o)*r)},e.lerp=function(e,t,s){return e+s*(t-e)},e.unlerp=function(e,t,s){return e===t?0:(s-e)/(t-e)},e.relerp=function(t,s,i,r,n){return e.lerp(r,n,e.unlerp(t,s,i))},e.qarp=function(t,s,i,r){return e.lerp(e.lerp(t,s,r),e.lerp(s,i,r),r)},e.cubic=function(t,s,i,r,n){return e.lerp(e.qarp(t,s,i,n),e.qarp(s,i,r,n),n)},e.cosp=function(e,t,s){return(e+t+(e-t)*Math.cos(s*Math.PI))/2},e.isPOT=function(e){return e>0&&0==(e-1&e)},e.nextHighestPowerOfTwo=function(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1},e.roundToNearestFraction=function(e,t){return Math.round(e*t)/t},e.floorToNearestFraction=function(e,t){return Math.floor(e*t)/t},e.round6dp=function(e){return Math.round(1e6*e)/1e6},e.toFixed=function(e,t){let s=e.toFixed(t),i=s.length-1;for(;i>=0&&"0"===s.charAt(i);--i);return i>=0&&"."===s.charAt(i)&&--i,i<0?s:s.substr(0,i+1)},e.PackRGB=function(t,s,i){return e.clamp(t,0,255)|e.clamp(s,0,255)<<8|e.clamp(i,0,255)<<16};const r=1024,n=1023,a=16384,o=8191,h=-8192;function isNegativeZero(e){return 0===e&&1/e<0}e.PackRGBAEx=function(t,s,i,l){return t=e.clamp(Math.floor(1024*t),h,o),s=e.clamp(Math.floor(1024*s),h,o),i=e.clamp(Math.floor(1024*i),h,o),l=e.clamp(Math.floor(l*n),0,n),t<0&&(t+=a),s<0&&(s+=a),i<0&&(i+=a),-(t*a*a*r+s*a*r+i*r+l)},e.PackRGBEx=function(t,s,i){return e.PackRGBAEx(t,s,i,1)},e.GetRValue=function(e){if(e>=0)return(255&e)/255;{let t=Math.floor(-e/(a*a*r));return t>o&&(t-=a),t/1024}},e.GetGValue=function(e){if(e>=0)return((65280&e)>>8)/255;{let t=Math.floor(-e%(a*a*r)/(a*r));return t>o&&(t-=a),t/1024}},e.GetBValue=function(e){if(e>=0)return((16711680&e)>>16)/255;{let t=Math.floor(-e%(a*r)/r);return t>o&&(t-=a),t/1024}},e.GetAValue=function(e){if(isNegativeZero(e))return 0;if(e>=0)return 1;return Math.floor(-e%r)/n},e.greatestCommonDivisor=function(e,t){for(e=Math.floor(e),t=Math.floor(t);0!==t;){let s=t;t=e%t,e=s}return e};const l=[[3,2],[4,3],[5,4],[5,3],[6,5],[14,9],[16,9],[16,10],[21,9]];e.getAspectRatio=function(t,s){if((t=Math.floor(t))===(s=Math.floor(s)))return[1,1];for(let e of l){let i=t/e[0]*e[1];if(Math.abs(s-i)<1)return e.slice(0);if(i=t/e[1]*e[0],Math.abs(s-i)<1)return[e[1],e[0]]}let i=e.greatestCommonDivisor(t,s);return[t/i,s/i]},e.segmentsIntersect=function(e,t,s,i,r,n,a,o){const h=Math.min(e,s),l=Math.max(e,s),c=Math.min(r,a),u=Math.max(r,a);if(l<c||h>u)return!1;const _=Math.min(t,i),d=Math.max(t,i),p=Math.min(n,o),f=Math.max(n,o);if(d<p||_>f)return!1;const m=r-e+a-s,g=n-t+o-i,S=s-e,y=i-t,G=a-r,I=o-n,T=Math.abs(y*G-I*S),b=G*g-I*m;if(Math.abs(b)>T)return!1;const C=S*g-y*m;return Math.abs(C)<=T},e.segmentsIntersectPreCalc=function(e,t,s,i,r,n,a,o,h,l,c,u){const _=Math.min(h,c),d=Math.max(h,c);if(n<_||r>d)return!1;const p=Math.min(l,u),f=Math.max(l,u);if(o<p||a>f)return!1;const m=h-e+c-s,g=l-t+u-i,S=s-e,y=i-t,G=c-h,I=u-l,T=Math.abs(y*G-I*S),b=G*g-I*m;if(Math.abs(b)>T)return!1;const C=S*g-y*m;return Math.abs(C)<=T},e.segmentIntersectsQuad=function(t,s,i,r,n){const a=Math.min(t,i),o=Math.max(t,i),h=Math.min(s,r),l=Math.max(s,r),c=n.getTlx(),u=n.getTly(),_=n.getTrx(),d=n.getTry(),p=n.getBrx(),f=n.getBry(),m=n.getBlx(),g=n.getBly();return e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,c,u,_,d)||e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,_,d,p,f)||e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,p,f,m,g)||e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,m,g,c,u)},e.segmentIntersectsAnyN=function(t,s,i,r,n){const a=Math.min(t,i),o=Math.max(t,i),h=Math.min(s,r),l=Math.max(s,r);let c=0;for(let u=n.length-4;c<=u;c+=2)if(e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,n[c],n[c+1],n[c+2],n[c+3]))return!0;return e.segmentsIntersectPreCalc(t,s,i,r,a,o,h,l,n[c],n[c+1],n[0],n[1])};const c=2,u=1e-6;e.rayIntersect=function(e,t,s,i,r,n,a,o){const h=s-e,l=o-n,_=h*l-(i-t)*(a-r);if(0===_)return c;const d=((t-i)*(a-e)+h*(o-t))/_;return 0<d&&d<1+u?(l*(a-e)+(r-a)*(o-t))/_:c},e.rayIntersectExtended=function(t,s,i,r,n,a,o,h,l){const c=(o-n)*l,u=(h-a)*l;return e.rayIntersect(t,s,i,r,n-c,a-u,o+c,h+u)},e.isPointInTriangleInclusive=function(e,t,s,i,r,n,a,o){const h=r-s,l=n-i,c=a-s,u=o-i,_=e-s,d=t-i,p=h*h+l*l,f=h*c+l*u,m=h*_+l*d,g=c*c+u*u,S=c*_+u*d,y=1/(p*g-f*f),G=(g*m-f*S)*y,I=(p*S-f*m)*y;return G>=0&&I>=0&&G+I<=1},e.triangleCartesianToBarycentric=function(e,t,s,i,r,n,a,o){const h=r-s,l=n-i,c=a-s,u=o-i,_=e-s,d=t-i,p=h*h+l*l,f=h*c+l*u,m=c*c+u*u,g=_*h+d*l,S=_*c+d*u,y=p*m-f*f,G=(m*g-f*S)/y,I=(p*S-f*g)/y;return[1-G-I,G,I]},e.triangleBarycentricToCartesian=function(e,t,s,i,r,n,a,o,h){return[e*i+t*n+s*o,e*r+t*a+s*h]}}{const e=self.C3;let t=null,s="";if("undefined"!=typeof document){t=document;const e=document.querySelector("base");s=e&&e.hasAttribute("href")?e.getAttribute("href"):"",s&&(s.startsWith("/")&&(s=s.substr(1)),s.endsWith("/")||(s+="/"))}e.GetBaseHref=function(){return s},e.GetBaseURL=function(){if(!t)return"";const i=t.location;return e.GetPathFromURL(i.origin+i.pathname)+s},e.GetPathFromURL=function(e){if(!e.length)return e;if(e.endsWith("/")||e.endsWith("\\"))return e;const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return-1===t?"":e.substr(0,t+1)},e.GetFilenameFromURL=function(e){if(!e.length)return e;if(e.endsWith("/")||e.endsWith("\\"))return"";const t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return-1===t?e:e.substr(t+1)},e.GetFileExtension=function(e){let t=e.lastIndexOf(".");return t<1?"":e.substr(t)},e.SetFileExtension=function(e,t){const s=e.lastIndexOf(".");return-1===s?e+"."+t:e.substr(0,s+1)+t},e.GetFileNamePart=function(e){let t=e.lastIndexOf(".");return t<1?e:e.substr(0,t)},e.NormalizeFileSeparator=function(e){return e.replace(/\\/g,"/")},e.IsFileExtension=function(t,s){return s===(t?e.GetFileExtension(t).slice(1):"")},e.FileNameEquals=function(t,s){let i,r;return e.IsFileLike(t)&&(i=e.GetFileNamePart(t.name)),e.IsString(t)&&(i=e.GetFileNamePart(t)),e.IsFileLike(s)&&(r=e.GetFileNamePart(s.name)),e.IsString(s)&&(r=e.GetFileNamePart(s)),i===r},e.ParseFilePath=function(t){t=e.NormalizeFileSeparator(t);let s=/^\w:\//.exec(t);s?(s=s[0],"/"!==(t=t.slice(3))[0]&&(t="/"+t)):s="",(t=t.replace(/\/{2,}/g,"/")).length>1&&"/"===t.slice(-1)&&(t=t.slice(0,-1));const i=t.lastIndexOf("/")+1;let r,n="",a=t,o="";i>0&&(n=t.slice(0,i),a=t.slice(i)),r=a;const h=a.lastIndexOf(".");h>0&&(o=a.slice(h),r=a.slice(0,-o.length));return{dir:n,base:a,name:r,root:s,ext:o,full:s+n+a}},e.Wait=function(e,t){return new Promise(((s,i)=>{self.setTimeout(s,e,t)}))},e.swallowException=function(t){try{t()}catch(t){e.isDebug}},e.noop=function(){},e.equalsNoCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize().toLowerCase()===t.normalize().toLowerCase())},e.equalsCase=function(e,t){return"string"==typeof e&&"string"==typeof t&&(e===t||e.normalize()===t.normalize())},e.typedArraySet16=function(e,t,s){e[s++]=t[0],e[s++]=t[1],e[s++]=t[2],e[s++]=t[3],e[s++]=t[4],e[s++]=t[5],e[s++]=t[6],e[s++]=t[7],e[s++]=t[8],e[s++]=t[9],e[s++]=t[10],e[s++]=t[11],e[s++]=t[12],e[s++]=t[13],e[s++]=t[14],e[s]=t[15]},e.truncateArray=function(e,t){e.length=t},e.clearArray=function(t){t&&0!==t.length&&e.truncateArray(t,0)},e.clear2DArray=function(t){if(t){for(let s=0;s<t.length;s++){let i=t[s];e.truncateArray(i,0)}e.truncateArray(t,0)}},e.extendArray=function(e,t,s){t|=0;const i=e.length;if(!(t<=i))for(let r=i;r<t;++r)e.push(s)},e.resizeArray=function(t,s,i){s|=0;const r=t.length;s<r?e.truncateArray(t,s):s>r&&e.extendArray(t,s,i)},e.shallowAssignArray=function(t,s){e.clearArray(t),e.appendArray(t,s)},e.appendArray=function(e,t){if(t.length<1e4)e.push(...t);else for(let s=0,i=t.length;s<i;++s)e.push(t[s])},e.arrayRemove=function(t,s){if((s=Math.floor(s))<0||s>=t.length)return;let i=t.length-1;for(let e=s;e<i;++e)t[e]=t[e+1];e.truncateArray(t,i)},e.arrayFindRemove=function(e,t){let s=e.indexOf(t);s>=0&&e.splice(s,1)},e.arraysEqual=function(e,t){let s=e.length;if(t.length!==s)return!1;for(let i=0;i<s;++i)if(e[i]!==t[i])return!1;return!0},e.arrayFilterOut=function(t,s){let i=[],r=0;for(let e=0,n=t.length;e<n;++e){let n=t[e];s(n)?i.push(n):(t[r]=n,++r)}return e.truncateArray(t,r),i},e.arrayRemoveAllInSet=function(t,s){const i=t.length;let r=0;for(let e=0,i=t.length;e<i;++e){let i=t[e];s.has(i)||(t[r++]=i)}return e.truncateArray(t,r),i-r},e.isArrayIndexInBounds=function(e,t){return e===Math.floor(e)&&(e>=0&&e<t.length)},e.validateArrayIndex=function(t,s){if(!e.isArrayIndexInBounds(t,s))throw new RangeError("array index out of bounds")},e.cloneArray=function(e){return e.slice()},e.deepCloneArray=function(t,s){let i=[];for(let r of t)if(e.IsObject(r)){let e=s(r);if(!e)throw new Error("missing clone");if(e.constructor!==r.constructor)throw new Error("object is not a clone");i.push(e)}else e.IsArray(r)?i.push(e.deepCloneArray(r,s)):i.push(r);return i},e.clone2DArray=function(e){let t=[];for(let s of e)t.push(s.slice());return t},e.mergeSets=function(e,t){return new Set([...e,...t])},e.mergeSetsInPlace=function(e,t){for(const s of t)e.add(s);return e},e.first=function(e){for(let t of e)return t;return null},e.xor=function(e,t){return!e!=!t},e.compare=function(e,t,s){switch(t){case 0:return e===s;case 1:return e!==s;case 2:return e<s;case 3:return e<=s;case 4:return e>s;case 5:return e>=s;default:return!1}},e.hasAnyOwnProperty=function(e){for(let t in e)if(e.hasOwnProperty(t))return!0;return!1},e.PromiseAllWithProgress=function(e,t){return e.length?new Promise(((s,i)=>{const r=[];let n=0,a=!1;for(let o=0,h=e.length;o<h;++o)r.push(void 0),e[o].then((i=>{a||(r[o]=i,++n,n===e.length?s(r):t(n,e.length))})).catch((e=>{a=!0,i(e)}))})):Promise.resolve([])};let i=[];e.AddLibraryMemoryCallback=function(e){i.push(e)},e.GetEstimatedLibraryMemoryUsage=function(){let e=0;for(let t of i){e+=t()}return Math.floor(e)};let r=1;const n=new Map,a=new MessageChannel;a.port2.onmessage=function(e){const t=e.data,s=n.get(t);n.delete(t),s&&s(performance.now())},e.RequestUnlimitedAnimationFrame=function(e){const t=r++;return n.set(t,e),a.port1.postMessage(t),t},e.CancelUnlimitedAnimationFrame=function(e){n.delete(e)},e.PostTask=e.RequestUnlimitedAnimationFrame,e.WaitForNextTask=function(){return new Promise((t=>e.PostTask(t)))};const o=new Set;e.RequestPostAnimationFrame=function(t){const s=self.requestAnimationFrame((async i=>{await e.WaitForNextTask(),o.has(s)&&(o.delete(s),t(i))}));return o.add(s),s},e.CancelPostAnimationFrame=function(e){o.has(e)&&(self.cancelAnimationFrame(e),o.delete(e))}}{const e=self.C3;e.IsAbsoluteURL=function(e){return/^(?:[a-z\-]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)},e.IsRelativeURL=function(t){return!e.IsAbsoluteURL(t)},e.ThrowIfNotOk=function(e){if(!e.ok)throw new Error(`fetch '${e.url}' response returned ${e.status} ${e.statusText}`)},e.FetchOk=function(t,s){return fetch(t,s).then((t=>(e.ThrowIfNotOk(t),t)))},e.FetchText=function(t){return e.FetchOk(t).then((e=>e.text()))},e.FetchJson=function(t){return e.FetchOk(t).then((e=>e.json()))},e.FetchBlob=function(t){return e.FetchOk(t).then((e=>e.blob()))},e.FetchArrayBuffer=function(t){return e.FetchOk(t).then((e=>e.arrayBuffer()))},e.FetchImage=function(e){return new Promise(((t,s)=>{const i=new Image;i.onload=()=>t(i),i.onerror=e=>s(e),i.src=e}))},e.BlobToArrayBuffer=function(e){return"function"==typeof e.arrayBuffer?e.arrayBuffer():new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>s(i.error),i.readAsArrayBuffer(e)}))},e.BlobToString=function(e){return"function"==typeof e.text?e.text():new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>s(i.error),i.readAsText(e)}))},e.BlobToJson=function(t){return e.BlobToString(t).then((e=>JSON.parse(e)))},e.BlobToImage=async function(t,s){let i=URL.createObjectURL(t);try{const t=await e.FetchImage(i);return URL.revokeObjectURL(i),i="",s&&"function"==typeof t.decode&&await t.decode(),t}finally{i&&URL.revokeObjectURL(i)}},e.CreateCanvas=function(e,t){if("undefined"!=typeof document&&"function"==typeof document.createElement){const s=document.createElement("canvas");return s.width=e,s.height=t,s}return new OffscreenCanvas(e,t)},e.CanvasToBlob=function(t,s,i){if("number"!=typeof i&&(i=1),s=s||"image/png",i=e.clamp(i,0,1),t.toBlob)return new Promise((e=>t.toBlob(e,s,i)));if(t.convertToBlob)return t.convertToBlob({type:s,quality:i});throw new Error("could not convert canvas to blob")},e.DrawableToBlob=function(t,s,i){const r=e.CreateCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),e.CanvasToBlob(r,s,i)},e.ImageDataToBlob=function(t,s,i){if(e.Supports.ImageBitmapOptions)return createImageBitmap(t,{premultiplyAlpha:"none"}).then((t=>e.DrawableToBlob(t,s,i)));if(e.Supports.ImageBitmap)return createImageBitmap(t).then((t=>e.DrawableToBlob(t,s,i)));{const r=e.CreateCanvas(t.width,t.height);return r.getContext("2d").putImageData(t,0,0),e.CanvasToBlob(r,s,i)}},e.CopySet=function(e,t){e.clear();for(const s of t)e.add(s)},e.MapToObject=function(e){const t=Object.create(null);for(const[s,i]of e.entries())t[s]=i;return t},e.ObjectToMap=function(e,t){t.clear();for(const[s,i]of Object.entries(e))t.set(s,i)},e.ToSuperJSON=function e(t){if("object"==typeof t&&null!==t){if(t instanceof Set)return{_c3type_:"set",data:[...t].map((t=>e(t)))};if(t instanceof Map)return{_c3type_:"map",data:[...t].map((t=>[t[0],e(t[1])]))};{const s=Object.create(null);for(const[i,r]of Object.entries(t))s[i]=e(r);return s}}return t},e.FromSuperJSON=function e(t){if("object"==typeof t&null!==t){if("set"===t._c3type_)return new Set(t.data.map((t=>e(t))));if("map"===t._c3type_)return new Map(t.data.map((t=>[t[0],e(t[1])])));{const s=Object.create(null);for(const[i,r]of Object.entries(t))s[i]=e(r);return s}}return t},e.CSSToCamelCase=function(e){if(e.startsWith("--"))return e;let t="",s=!1;for(const i of e)"-"===i?s=!0:s?(t+=i.toUpperCase(),s=!1):t+=i;return t},e.IsIterator=function(e){return"object"==typeof e&&"function"==typeof e.next},e.MakeFilledArray=function(e,t){const s=[];if("function"==typeof t)for(let i=0;i<e;++i)s.push(t());else for(let i=0;i<e;++i)s.push(t);return s}}{const e=self.C3,t=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?/i,s=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?,([0-9.])/i;function padTwoDigits(e){return 0===e.length?"00":1===e.length?"0"+e:e}function hueToRGB(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}e.Color=class{constructor(t,s,i,r){this._r=NaN,this._g=NaN,this._b=NaN,this._a=NaN,this._r=0,this._g=0,this._b=0,this._a=0,t instanceof e.Color?this.set(t):this.setRgba(t||0,s||0,i||0,r||0)}setRgb(e,t,s){return this._r=+e,this._g=+t,this._b=+s,this.clamp(),this}setRgba(e,t,s,i){return this._r=+e,this._g=+t,this._b=+s,this._a=+i,this.clamp(),this}set(e){return this._r=e._r,this._g=e._g,this._b=e._b,this._a=e._a,this}copy(e){return this.set(e)}add(e){this._r+=e._r,this._g+=e._g,this._b+=e._b,this._a+=e._a,this.clamp()}addRgb(e,t,s,i=0){this._r+=+e,this._g+=+t,this._b+=+s,this._a+=+i,this.clamp()}diff(e){this.setR(Math.max(this._r,e._r)-Math.min(this._r,e._r)),this.setG(Math.max(this._g,e._g)-Math.min(this._g,e._g)),this.setB(Math.max(this._b,e._b)-Math.min(this._b,e._b)),this.setA(Math.max(this._a,e._a)-Math.min(this._a,e._a)),this.clamp()}copyRgb(e){this._r=e._r,this._g=e._g,this._b=e._b}setR(t){this._r=e.clamp(+t,0,1)}getR(){return this._r}setG(t){this._g=e.clamp(+t,0,1)}getG(){return this._g}setB(t){this._b=e.clamp(+t,0,1)}getB(){return this._b}setA(t){this._a=e.clamp(+t,0,1)}getA(){return this._a}clone(){return e.New(e.Color,this._r,this._g,this._b,this._a)}toArray(){return[this._r,this._g,this._b,this._a]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t++]=this._b,e[t]=this._a}writeRGBToTypedArray(e,t){e[t++]=this._r,e[t++]=this._g,e[t]=this._b}equals(e){return this._r===e._r&&this._g===e._g&&this._b===e._b&&this._a===e._a}equalsIgnoringAlpha(e){return this._r===e._r&&this._g===e._g&&this._b===e._b}equalsRgb(e,t,s){return this._r===e&&this._g===t&&this._b===s}equalsRgba(e,t,s,i){return this._r===e&&this._g===t&&this._b===s&&this._a===i}equalsF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)&&e[t+3]===Math.fround(this._a)}equalsRGBF32Array(e,t){return e[t]===Math.fround(this._r)&&e[t+1]===Math.fround(this._g)&&e[t+2]===Math.fround(this._b)}multiply(e){this._r*=e._r,this._g*=e._g,this._b*=e._b,this._a*=e._a}multiplyAlpha(e){this._r*=e,this._g*=e,this._b*=e,this._a*=e}premultiply(){return this._r*=this._a,this._g*=this._a,this._b*=this._a,this}unpremultiply(){return this._r/=this._a,this._g/=this._a,this._b/=this._a,this}clamp(){return this._r=e.clamp(this._r,0,1),this._g=e.clamp(this._g,0,1),this._b=e.clamp(this._b,0,1),this._a=e.clamp(this._a,0,1),this}setFromRgbValue(t){this._r=e.GetRValue(t),this._g=e.GetGValue(t),this._b=e.GetBValue(t),this._a=e.GetAValue(t)}getCssRgb(t,s,i){return`rgb(${100*(e.IsFiniteNumber(t)?t:this.getR())}%, ${100*(e.IsFiniteNumber(s)?s:this.getG())}%, ${100*(e.IsFiniteNumber(i)?i:this.getB())}%)`}getCssRgba(t,s,i,r){return`rgba(${100*(e.IsFiniteNumber(t)?t:this.getR())}%, ${100*(e.IsFiniteNumber(s)?s:this.getG())}%, ${100*(e.IsFiniteNumber(i)?i:this.getB())}%, ${e.IsFiniteNumber(r)?r:this.getA()})`}toHexString(){const e=Math.round(255*this.getR()),t=Math.round(255*this.getG()),s=Math.round(255*this.getB());return"#"+padTwoDigits(e.toString(16))+padTwoDigits(t.toString(16))+padTwoDigits(s.toString(16))}parseHexString(e){if("string"!=typeof e)return!1;let t,s,i;if("#"===(e=e.trim()).charAt(0)&&(e=e.substr(1)),3===e.length)t=parseInt(e[0],16)/15,s=parseInt(e[1],16)/15,i=parseInt(e[2],16)/15;else{if(6!==e.length)return!1;t=parseInt(e.substr(0,2),16)/255,s=parseInt(e.substr(2,2),16)/255,i=parseInt(e.substr(4,2),16)/255}return isFinite(t)&&this.setR(t),isFinite(s)&&this.setG(s),isFinite(i)&&this.setB(i),this.setA(1),!0}toCommaSeparatedRgb(){return`${Math.round(255*this.getR())}, ${Math.round(255*this.getG())}, ${Math.round(255*this.getB())}`}toRgbArray(){return[Math.round(255*this.getR()),Math.round(255*this.getG()),Math.round(255*this.getB())]}parseCommaSeparatedRgb(e){if("string"!=typeof e)return!1;const t=(e=e.replace(/^rgb\(|\)|%/,"")).split(",");if(t.length<3)return!1;const s=parseInt(t[0].trim(),10)/255,i=parseInt(t[1].trim(),10)/255,r=parseInt(t[2].trim(),10)/255;return isFinite(s)&&this.setR(s),isFinite(i)&&this.setG(i),isFinite(r)&&this.setB(r),this.setA(1),!0}parseCommaSeparatedPercentageRgb(e){if("string"!=typeof e)return!1;const t=(e=e.replace(/^rgb\(|\)|%/,"")).split(",");if(t.length<3)return!1;const s=parseInt(t[0].trim(),10)/100,i=parseInt(t[1].trim(),10)/100,r=parseInt(t[2].trim(),10)/100;return isFinite(s)&&this.setR(s),isFinite(i)&&this.setG(i),isFinite(r)&&this.setB(r),this.setA(1),!0}parseCommaSeparatedRgba(e){if("string"!=typeof e)return!1;const t=(e=e.replace(/^rgba\(|\)|%/,"")).split(",");if(t.length<4)return!1;const s=parseInt(t[0].trim(),10)/255,i=parseInt(t[1].trim(),10)/255,r=parseInt(t[2].trim(),10)/255,n=parseFloat(t[3].trim());return isFinite(s)&&this.setR(s),isFinite(i)&&this.setG(i),isFinite(r)&&this.setB(r),isFinite(n)&&this.setA(n),!0}parseCommaSeparatedPercentageRgba(e){if("string"!=typeof e)return!1;const t=(e=e.replace(/^rgba\(|\)|%/,"")).split(",");if(t.length<4)return!1;const s=parseInt(t[0].trim(),10)/100,i=parseInt(t[1].trim(),10)/100,r=parseInt(t[2].trim(),10)/100,n=parseFloat(t[3].trim());return isFinite(s)&&this.setR(s),isFinite(i)&&this.setG(i),isFinite(r)&&this.setB(r),isFinite(n)&&this.setA(n),!0}parseString(e){if("string"!=typeof e)return!1;if((e=e.replace(/\s+/,"")).includes(",")){if(e.startsWith("rgb("))return e.includes("%")?this.parseCommaSeparatedPercentageRgb(e):this.parseCommaSeparatedRgb(e);if(e.startsWith("rgba("))return e.includes("%")?this.parseCommaSeparatedPercentageRgba(e):this.parseCommaSeparatedRgba(e);if(e.startsWith("hsl(")||e.startsWith("hsla("))return this.parseHSLString(e);{const t=e.split(",");return e.includes("%")?3===t.length?this.parseCommaSeparatedPercentageRgb(e):4===t.length&&this.parseCommaSeparatedPercentageRgba(e):3===t.length?this.parseCommaSeparatedRgb(e):4===t.length&&this.parseCommaSeparatedRgba(e)}}return this.parseHexString(e)}toJSON(){return[this._r,this._g,this._b,this._a]}setFromHSLA(t,s,i,r){let n,a,o;if(t%=360,s=e.clamp(s,0,100),i=e.clamp(i,0,100),r=e.clamp(r,0,1),t/=360,i/=100,0===(s/=100))n=a=o=i;else{const e=i<.5?i*(1+s):i+s-i*s,r=2*i-e;n=hueToRGB(r,e,t+1/3),a=hueToRGB(r,e,t),o=hueToRGB(r,e,t-1/3)}return this.setR(n),this.setG(a),this.setB(o),this.setA(r),this}parseHSLString(e){const i=e.replace(/ |hsl|hsla|\(|\)|;/gi,""),r=t.exec(i),n=s.exec(i);return r&&4===r.length?(this.setFromHSLA(+r[1],+r[2],+r[3],1),!0):!(!n||5!==n.length)&&(this.setFromHSLA(+r[1],+r[2],+r[3],+r[4]),!0)}toHSLAString(){const t=this._r,s=this._g,i=this._b,r=this._a;return`hsla(${e.Color.GetHue(t,s,i)}, ${e.Color.GetSaturation(t,s,i)}%, ${e.Color.GetLuminosity(t,s,i)}%, ${r})`}toHSLAArray(){const t=this._r,s=this._g,i=this._b;return[e.Color.GetHue(t,s,i),e.Color.GetSaturation(t,s,i),e.Color.GetLuminosity(t,s,i),this._a]}setFromJSON(e){Array.isArray(e)&&(e.length<3||(this._r=e[0],this._g=e[1],this._b=e[2],e.length>=4?this._a=e[3]:this._a=1))}set r(e){this.setR(e)}get r(){return this.getR()}set g(e){this.setG(e)}get g(){return this.getG()}set b(e){this.setB(e)}get b(){return this.getB()}set a(e){this.setA(e)}get a(){return this.getA()}setAtIndex(e,t){switch(e){case 0:this.setR(t);break;case 1:this.setG(t);break;case 2:this.setB(t);break;case 3:this.setA(t);break;default:throw new RangeError("invalid color index")}}getAtIndex(e){switch(e){case 0:return this.getR();case 1:return this.getG();case 2:return this.getB();case 3:return this.getA();default:throw new RangeError("invalid color index")}}static Equals(t,s){let i,r;if(Array.isArray(t))i=new e.Color,i.setFromJSON(t);else{if(!(t instanceof e.Color))throw new Error("unexpected type");i=t}if(Array.isArray(s))r=new e.Color,r.setFromJSON(s);else{if(!(s instanceof e.Color))throw new Error("unexpected type");r=s}return i.equals(r)}static DiffChannel(t,s){return e.clamp(Math.max(t,s)-Math.min(t,s),0,1)}static Diff(t,s){const i=new e.Color;return i.setR(Math.max(t._r,s._r)-Math.min(t._r,s._r)),i.setG(Math.max(t._g,s._g)-Math.min(t._g,s._g)),i.setB(Math.max(t._b,s._b)-Math.min(t._b,s._b)),i.setA(Math.max(t._a,s._a)-Math.min(t._a,s._a)),i}static DiffNoAlpha(t,s){const i=new e.Color(0,0,0,1);return i.setR(Math.max(t._r,s._r)-Math.min(t._r,s._r)),i.setG(Math.max(t._g,s._g)-Math.min(t._g,s._g)),i.setB(Math.max(t._b,s._b)-Math.min(t._b,s._b)),i}static GetHue(e,t,s){const i=Math.max(e,t,s),r=Math.min(e,t,s);if(i===r)return 0;let n=0;switch(i){case e:n=(t-s)/(i-r)+(t<s?6:0);break;case t:n=(s-e)/(i-r)+2;break;case s:n=(e-t)/(i-r)+4;break}return Math.round(n/6*360)}static GetSaturation(e,t,s){const i=Math.max(e,t,s),r=Math.min(e,t,s);if(i===r)return 0;const n=i-r,a=(i+r)/2>.5?n/(2-i-r):n/(i+r);return Math.round(100*a)}static GetLuminosity(e,t,s){const i=Math.max(e,t,s),r=(i+Math.min(e,t,s))/2;return i?Math.round(100*r):0}},e.Color.White=Object.freeze(e.New(e.Color,1,1,1,1)),e.Color.Black=Object.freeze(e.New(e.Color,0,0,0,1)),e.Color.TransparentBlack=Object.freeze(e.New(e.Color,0,0,0,0))}{const e=self.C3;e.Vector2=class{constructor(t,s){this._x=0,this._y=0,t instanceof e.Vector2?this.copy(t):this.set(t||0,s||0)}set(e,t){this._x=+e,this._y=+t}copy(e){this._x=e._x,this._y=e._y}equals(e){return this._x===e._x&&this._y===e._y}equalsValues(e,t){return this._x===e&&this._y===t}equalsF32Array(e,t){return e[t]===Math.fround(this._x)&&e[t+1]===Math.fround(this._y)}setX(e){this._x=+e}getX(){return this._x}setY(e){this._y=+e}getY(){return this._y}toArray(){return[this._x,this._y]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._x,e[t]=this._y}offset(e,t){this._x+=+e,this._y+=+t}scale(e,t){this._x*=e,this._y*=t}divide(e,t){this._x/=e,this._y/=t}round(){this._x=Math.round(this._x),this._y=Math.round(this._y)}floor(){this._x=Math.floor(this._x),this._y=Math.floor(this._y)}ceil(){this._x=Math.ceil(this._x),this._y=Math.ceil(this._y)}angle(){return e.angleTo(0,0,this._x,this._y)}lengthSquared(){return this._x*this._x+this._y*this._y}length(){return Math.hypot(this._x,this._y)}rotatePrecalc(e,t){const s=this._x*t-this._y*e;this._y=this._y*t+this._x*e,this._x=s}rotate(e){0!==e&&this.rotatePrecalc(Math.sin(e),Math.cos(e))}rotateAbout(e,t,s){0===e||t===this._x&&s===this._y||(this._x-=t,this._y-=s,this.rotatePrecalc(Math.sin(e),Math.cos(e)),this._x+=+t,this._y+=+s)}move(e,t){0!==t&&(this._x+=Math.cos(e)*t,this._y+=Math.sin(e)*t)}normalize(){const e=this.length();0!==e&&1!==e&&(this._x/=e,this._y/=e)}clamp(t,s){this._x=e.clamp(this._x,t,s),this._y=e.clamp(this._y,t,s)}}}{const e=self.C3;e.Rect=class{constructor(t,s,i,r){this._left=NaN,this._top=NaN,this._right=NaN,this._bottom=NaN,this._left=0,this._top=0,this._right=0,this._bottom=0,t instanceof e.Rect?this.copy(t):this.set(t||0,s||0,i||0,r||0)}set(e,t,s,i){this._left=+e,this._top=+t,this._right=+s,this._bottom=+i}setWH(e,t,s,i){e=+e,t=+t,this._left=e,this._top=t,this._right=e+ +s,this._bottom=t+ +i}copy(e){this._left=+e._left,this._top=+e._top,this._right=+e._right,this._bottom=+e._bottom}clone(){return new e.Rect(this._left,this._top,this._right,this._bottom)}static Merge(t,s){const i=new e.Rect;return i.setLeft(Math.min(t._left,s._left)),i.setTop(Math.min(t._top,s._top)),i.setRight(Math.max(t._right,s._right)),i.setBottom(Math.max(t._bottom,s._bottom)),i}static FromObject(t){return new e.Rect(t.left,t.top,t.right,t.bottom)}equals(e){return this._left===e._left&&this._top===e._top&&this._right===e._right&&this._bottom===e._bottom}equalsWH(e,t,s,i){return this._left===e&&this._top===t&&this.width()===s&&this.height()===i}equalsF32Array(e,t){return e[t]===Math.fround(this._left)&&e[t+1]===Math.fround(this._top)&&e[t+2]===Math.fround(this._right)&&e[t+3]===Math.fround(this._bottom)}setLeft(e){this._left=+e}getLeft(){return this._left}setTop(e){this._top=+e}getTop(){return this._top}setRight(e){this._right=+e}getRight(){return this._right}setBottom(e){this._bottom=+e}getBottom(){return this._bottom}toArray(){return[this._left,this._top,this._right,this._bottom]}toTypedArray(){return new Float64Array(this.toArray())}toDOMRect(){return new DOMRect(this._left,this._top,this.width(),this.height())}writeToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t]=this._bottom}writeAsQuadToTypedArray(e,t){e[t++]=this._left,e[t++]=this._top,e[t++]=this._right,e[t++]=this._top,e[t++]=this._right,e[t++]=this._bottom,e[t++]=this._left,e[t]=this._bottom}writeAsQuadToTypedArray3D(e,t,s){e[t++]=this._left,e[t++]=this._top,e[t++]=s,e[t++]=this._right,e[t++]=this._top,e[t++]=s,e[t++]=this._right,e[t++]=this._bottom,e[t++]=s,e[t++]=this._left,e[t++]=this._bottom,e[t]=s}width(){return this._right-this._left}height(){return this._bottom-this._top}midX(){return(this._left+this._right)/2}midY(){return(this._top+this._bottom)/2}offset(e,t){e=+e,t=+t,this._left+=e,this._top+=t,this._right+=e,this._bottom+=t}offsetLeft(e){this._left+=+e}offsetTop(e){this._top+=+e}offsetRight(e){this._right+=+e}offsetBottom(e){this._bottom+=+e}toSquare(e){if("x"!==e)throw new Error("invalid axis, only 'x' supported");this._top<this._bottom?this._left<this._right?this._bottom=this._top+this.width():this._bottom=this._top-this.width():this._left<this._right?this._bottom=this._top-this.width():this._bottom=this._top+this.width()}inflate(e,t){e=+e,t=+t,this._left-=e,this._top-=t,this._right+=e,this._bottom+=t}deflate(e,t){e=+e,t=+t,this._left+=e,this._top+=t,this._right-=e,this._bottom-=t}multiply(e,t){this._left*=e,this._top*=t,this._right*=e,this._bottom*=t}divide(e,t){this._left/=e,this._top/=t,this._right/=e,this._bottom/=t}mirrorAround(e){this._left=+e-this._left,this._right=+e-this._right}flipAround(e){this._top=+e-this._top,this._bottom=+e-this._bottom}rotate90DegreesAround(e,t){const s=this.width(),i=this.height(),r=this.getLeft()+s*e,n=this.getTop()+i*t;this.setWH(r-i*t,n-s*e,i,s)}swapLeftRight(){const e=this._left;this._left=this._right,this._right=e}swapTopBottom(){const e=this._top;this._top=this._bottom,this._bottom=e}shuntY(e){const t=this._top;this._top=+e-this._bottom,this._bottom=+e-t}round(){this._left=Math.round(this._left),this._top=Math.round(this._top),this._right=Math.round(this._right),this._bottom=Math.round(this._bottom)}roundInner(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}roundOuter(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}floor(){this._left=Math.floor(this._left),this._top=Math.floor(this._top),this._right=Math.floor(this._right),this._bottom=Math.floor(this._bottom)}ceil(){this._left=Math.ceil(this._left),this._top=Math.ceil(this._top),this._right=Math.ceil(this._right),this._bottom=Math.ceil(this._bottom)}clamp(e,t,s,i){this._left<e&&(this._left=+e),this._top<t&&(this._top=+t),this._right>s&&(this._right=+s),this._bottom>i&&(this._bottom=+i)}clampFlipped(e,t,s,i){this._left<e&&(this._left=+e),this._top>t&&(this._top=+t),this._right>s&&(this._right=+s),this._bottom<i&&(this._bottom=+i)}normalize(){this._left>this._right&&this.swapLeftRight(),this._top>this._bottom&&this.swapTopBottom()}intersectsRect(e){return!(e._right<this._left||e._bottom<this._top||e._left>this._right||e._top>this._bottom)}intersectsRectOffset(e,t,s){return!(e._right+t<this._left||e._bottom+s<this._top||e._left+t>this._right||e._top+s>this._bottom)}containsPoint(e,t){return e>=this._left&&e<=this._right&&t>=this._top&&t<=this._bottom}containsRect(e){return e._left>=this._left&&e._top>=this._top&&e._right<=this._right&&e._bottom<=this._bottom}expandToContain(e){e._left<this._left&&(this._left=+e._left),e._top<this._top&&(this._top=+e._top),e._right>this._right&&(this._right=+e._right),e._bottom>this._bottom&&(this._bottom=+e._bottom)}lerpInto(t){this._left=e.lerp(t._left,t._right,this._left),this._top=e.lerp(t._top,t._bottom,this._top),this._right=e.lerp(t._left,t._right,this._right),this._bottom=e.lerp(t._top,t._bottom,this._bottom)}}}{const e=self.C3;e.Quad=class{constructor(t,s,i,r,n,a,o,h){this._tlx=NaN,this._tly=NaN,this._trx=NaN,this._try=NaN,this._brx=NaN,this._bry=NaN,this._blx=NaN,this._bly=NaN,this._tlx=0,this._tly=0,this._trx=0,this._try=0,this._brx=0,this._bry=0,this._blx=0,this._bly=0,t instanceof e.Quad?this.copy(t):this.set(t||0,s||0,i||0,r||0,n||0,a||0,o||0,h||0)}set(e,t,s,i,r,n,a,o){this._tlx=+e,this._tly=+t,this._trx=+s,this._try=+i,this._brx=+r,this._bry=+n,this._blx=+a,this._bly=+o}setRect(e,t,s,i){this.set(e,t,s,t,s,i,e,i)}copy(e){this._tlx=e._tlx,this._tly=e._tly,this._trx=e._trx,this._try=e._try,this._brx=e._brx,this._bry=e._bry,this._blx=e._blx,this._bly=e._bly}equals(e){return this._tlx===e._tlx&&this._tly===e._tly&&this._trx===e._trx&&this._try===e._try&&this._brx===e._brx&&this._bry===e._bry&&this._blx===e._blx&&this._bly===e._bly}setTlx(e){this._tlx=+e}getTlx(){return this._tlx}setTly(e){this._tly=+e}getTly(){return this._tly}setTrx(e){this._trx=+e}getTrx(){return this._trx}setTry(e){this._try=+e}getTry(){return this._try}setBrx(e){this._brx=+e}getBrx(){return this._brx}setBry(e){this._bry=+e}getBry(){return this._bry}setBlx(e){this._blx=+e}getBlx(){return this._blx}setBly(e){this._bly=+e}getBly(){return this._bly}toDOMQuad(){return new DOMQuad(new DOMPoint(this._tlx,this._tly),new DOMPoint(this._trx,this._try),new DOMPoint(this._brx,this._bry),new DOMPoint(this._blx,this._bly))}toArray(){return[this._tlx,this._tly,this._trx,this._try,this._brx,this._bry,this._blx,this._bly]}toTypedArray(){return new Float64Array(this.toArray())}writeToTypedArray(e,t){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=this._trx,e[t++]=this._try,e[t++]=this._brx,e[t++]=this._bry,e[t++]=this._blx,e[t]=this._bly}writeToTypedArray3D(e,t,s){e[t++]=this._tlx,e[t++]=this._tly,e[t++]=s,e[t++]=this._trx,e[t++]=this._try,e[t++]=s,e[t++]=this._brx,e[t++]=this._bry,e[t++]=s,e[t++]=this._blx,e[t++]=this._bly,e[t]=s}offset(e,t){e=+e,t=+t,this._tlx+=e,this._tly+=t,this._trx+=e,this._try+=t,this._brx+=e,this._bry+=t,this._blx+=e,this._bly+=t}round(){this._tlx=Math.round(this._tlx),this._tly=Math.round(this._tly),this._trx=Math.round(this._trx),this._try=Math.round(this._try),this._brx=Math.round(this._brx),this._bry=Math.round(this._bry),this._blx=Math.round(this._blx),this._bly=Math.round(this._bly)}floor(){this._tlx=Math.floor(this._tlx),this._tly=Math.floor(this._tly),this._trx=Math.floor(this._trx),this._try=Math.floor(this._try),this._brx=Math.floor(this._brx),this._bry=Math.floor(this._bry),this._blx=Math.floor(this._blx),this._bly=Math.floor(this._bly)}ceil(){this._tlx=Math.ceil(this._tlx),this._tly=Math.ceil(this._tly),this._trx=Math.ceil(this._trx),this._try=Math.ceil(this._try),this._brx=Math.ceil(this._brx),this._bry=Math.ceil(this._bry),this._blx=Math.ceil(this._blx),this._bly=Math.ceil(this._bly)}setFromRect(e){this._tlx=e._left,this._tly=e._top,this._trx=e._right,this._try=e._top,this._brx=e._right,this._bry=e._bottom,this._blx=e._left,this._bly=e._bottom}setFromRotatedRect(e,t){0===t?this.setFromRect(e):this.setFromRotatedRectPrecalc(e,Math.sin(t),Math.cos(t))}setFromRotatedRectPrecalc(e,t,s){const i=e._left*t,r=e._top*t,n=e._right*t,a=e._bottom*t,o=e._left*s,h=e._top*s,l=e._right*s,c=e._bottom*s;this._tlx=o-r,this._tly=h+i,this._trx=l-r,this._try=h+n,this._brx=l-a,this._bry=c+n,this._blx=o-a,this._bly=c+i}getBoundingBox(e){e.set(Math.min(this._tlx,this._trx,this._brx,this._blx),Math.min(this._tly,this._try,this._bry,this._bly),Math.max(this._tlx,this._trx,this._brx,this._blx),Math.max(this._tly,this._try,this._bry,this._bly))}containsPoint(e,t){let s=this._trx-this._tlx,i=this._try-this._tly;const r=this._brx-this._tlx,n=this._bry-this._tly,a=e-this._tlx,o=t-this._tly;let h=s*s+i*i,l=s*r+i*n,c=s*a+i*o;const u=r*r+n*n,_=r*a+n*o;let d=1/(h*u-l*l),p=(u*c-l*_)*d,f=(h*_-l*c)*d;return p>=0&&f>0&&p+f<1||(s=this._blx-this._tlx,i=this._bly-this._tly,h=s*s+i*i,l=s*r+i*n,c=s*a+i*o,d=1/(h*u-l*l),p=(u*c-l*_)*d,f=(h*_-l*c)*d,p>=0&&f>0&&p+f<1)}midX(){return(this._tlx+this._trx+this._brx+this._blx)/4}midY(){return(this._tly+this._try+this._bry+this._bly)/4}intersectsSegment(t,s,i,r){return!(!this.containsPoint(t,s)&&!this.containsPoint(i,r))||e.segmentIntersectsQuad(t,s,i,r,this)}intersectsQuad(t){let s=t.midX(),i=t.midY();if(this.containsPoint(s,i))return!0;if(s=this.midX(),i=this.midY(),t.containsPoint(s,i))return!0;const r=this._tlx,n=this._tly,a=this._trx,o=this._try,h=this._brx,l=this._bry,c=this._blx,u=this._bly;return e.segmentIntersectsQuad(r,n,a,o,t)||e.segmentIntersectsQuad(a,o,h,l,t)||e.segmentIntersectsQuad(h,l,c,u,t)||e.segmentIntersectsQuad(c,u,r,n,t)}rotatePointsAnticlockwise(){const e=this._tlx,t=this._tly;this._tlx=this._trx,this._tly=this._try,this._trx=this._brx,this._try=this._bry,this._brx=this._blx,this._bry=this._bly,this._blx=e,this._bly=t}mirror(){this._swap(0,2),this._swap(1,3),this._swap(6,4),this._swap(7,5)}flip(){this._swap(0,6),this._swap(1,7),this._swap(2,4),this._swap(3,5)}diag(){this._swap(2,6),this._swap(3,7)}_swap(e,t){const s=this._getAtIndex(e);this._setAtIndex(e,this._getAtIndex(t)),this._setAtIndex(t,s)}_getAtIndex(e){switch(e){case 0:return this._tlx;case 1:return this._tly;case 2:return this._trx;case 3:return this._try;case 4:return this._brx;case 5:return this._bry;case 6:return this._blx;case 7:return this._bly;default:throw new RangeError("invalid quad point index")}}_setAtIndex(e,t){switch(t=+t,e){case 0:this._tlx=t;break;case 1:this._tly=t;break;case 2:this._trx=t;break;case 3:this._try=t;break;case 4:this._brx=t;break;case 5:this._bry=t;break;case 6:this._blx=t;break;case 7:this._bly=t;break;default:throw new RangeError("invalid quad point index")}}}}{const e=self.C3,t=self.assert,s=[0,0,1,0,1,1,0,1],i=e.New(e.Quad);e.CollisionPoly=class extends e.DefendedBase{constructor(t,i=!0){super(),t||(t=s),this._ptsArr=Float64Array.from(t),this._bbox=new e.Rect,this._isBboxChanged=!0,this._enabled=i}Release(){}pointsArr(){return this._ptsArr}pointCount(){return this._ptsArr.length/2}setPoints(e){this._ptsArr.length===e.length?this._ptsArr.set(e):this._ptsArr=Float64Array.from(e),this._isBboxChanged=!0}setDefaultPoints(){this.setPoints(s)}copy(e){this.setPoints(e._ptsArr)}setBboxChanged(){this._isBboxChanged=!0}_updateBbox(){if(!this._isBboxChanged)return;const e=this._ptsArr;let t=e[0],s=e[1],i=t,r=s;for(let n=0,a=e.length;n<a;n+=2){const a=e[n],o=e[n+1];a<t&&(t=a),a>i&&(i=a),o<s&&(s=o),o>r&&(r=o)}this._bbox.set(t,s,i,r),this._isBboxChanged=!1}setFromRect(e,t,s){let i=this._ptsArr;8!==i.length&&(i=new Float64Array(8),this._ptsArr=i),i[0]=e.getLeft()-t,i[1]=e.getTop()-s,i[2]=e.getRight()-t,i[3]=e.getTop()-s,i[4]=e.getRight()-t,i[5]=e.getBottom()-s,i[6]=e.getLeft()-t,i[7]=e.getBottom()-s,this._bbox.copy(e),0===t&&0===s||this._bbox.offset(-t,-s),this._isBboxChanged=!1}setFromQuad(e,t,s){i.copy(e),i.offset(t,s),this.setPoints(i.toArray()),this._isBboxChanged=!0}transform(e,t,s){let i=0,r=1;0!==s&&(i=Math.sin(s),r=Math.cos(s)),this.transformPrecalc(e,t,i,r)}transformPrecalc(e,t,s,i){const r=this._ptsArr;for(let n=0,a=r.length;n<a;n+=2){const a=n+1,o=r[n]*e,h=r[a]*t;r[n]=o*i-h*s,r[a]=h*i+o*s}this._isBboxChanged=!0}offset(e,t){const s=this._ptsArr;for(let i=0,r=s.length;i<r;i+=2)s[i]+=e,s[i+1]+=t}containsPoint(t,s){const i=this._ptsArr;if(t===i[0]&&s===i[1])return!0;this._updateBbox();const r=this._bbox,n=r.getLeft()-110,a=r.getTop()-101,o=r.getRight()+131,h=r.getBottom()+120;let l=0,c=0,u=0,_=0,d=0,p=0,f=0,m=0;n<t?(l=n,u=t):(l=t,u=n),a<s?(c=a,_=s):(c=s,_=a),o<t?(d=o,f=t):(d=t,f=o),h<s?(p=h,m=s):(p=s,m=h);let g=0,S=0;for(let r=0,y=i.length;r<y;r+=2){const G=(r+2)%y,I=i[r],T=i[r+1],b=i[G],C=i[G+1];e.segmentsIntersectPreCalc(n,a,t,s,l,u,c,_,I,T,b,C)&&++g,e.segmentsIntersectPreCalc(o,h,t,s,d,f,p,m,I,T,b,C)&&++S}return g%2==1||S%2==1}intersectsPoly(t,s,i){const r=t._ptsArr,n=this._ptsArr;if(this.containsPoint(r[0]+s,r[1]+i))return!0;if(t.containsPoint(n[0]-s,n[1]-i))return!0;for(let t=0,a=n.length;t<a;t+=2){const o=(t+2)%a,h=n[t],l=n[t+1],c=n[o],u=n[o+1];let _=0,d=0,p=0,f=0;h<c?(_=h,p=c):(_=c,p=h),l<u?(d=l,f=u):(d=u,f=l);for(let t=0,n=r.length;t<n;t+=2){const a=(t+2)%n,o=r[t]+s,m=r[t+1]+i,g=r[a]+s,S=r[a+1]+i;if(e.segmentsIntersectPreCalc(h,l,c,u,_,p,d,f,o,m,g,S))return!0}}return!1}intersectsSegment(t,s,i,r,n,a){if(this.containsPoint(i-t,r-s))return!0;if(this.containsPoint(n-t,a-s))return!0;let o=0,h=0,l=0,c=0;i<n?(o=i,l=n):(o=n,l=i),r<a?(h=r,c=a):(h=a,c=r);const u=this._ptsArr;for(let _=0,d=u.length;_<d;_+=2){const p=(_+2)%d,f=u[_]+t,m=u[_+1]+s,g=u[p]+t,S=u[p+1]+s;if(e.segmentsIntersectPreCalc(i,r,n,a,o,l,h,c,f,m,g,S))return!0}return!1}mirror(e){const t=this._ptsArr;for(let s=0,i=t.length;s<i;s+=2)t[s]=2*e-t[s];this._isBboxChanged=!0}flip(e){const t=this._ptsArr;for(let s=0,i=t.length;s<i;s+=2){const i=s+1;t[i]=2*e-t[i]}this._isBboxChanged=!0}diag(){const e=this._ptsArr;for(let t=0,s=e.length;t<s;t+=2){const s=t+1,i=e[t];e[t]=e[s],e[s]=i}this._isBboxChanged=!0}GetMidX(){const e=this._ptsArr;let t=0;for(let s=0,i=e.length;s<i;s+=2)t+=e[s];return t/this.pointCount()}GetMidY(){const e=this._ptsArr;let t=0;for(let s=0,i=e.length;s<i;s+=2)t+=e[s+1];return t/this.pointCount()}GetPointsArray(){return this._ptsArr}GetPointCount(){return this.pointCount()}IsEnabled(){return this._enabled}}}{const e=self.C3;e.PairMap=class extends e.DefendedBase{constructor(e){if(super(),this._firstMap=new Map,e)for(const[t,s,i]of e)this.Set(t,s,i)}Release(){this.Clear(),this._firstMap=null}Clear(){const e=this._firstMap;for(const t of e.values())t.clear();e.clear()}Set(e,t,s){const i=this._firstMap;let r=i.get(e);r||(r=new Map,i.set(e,r)),r.set(t,s)}Get(e,t){const s=this._firstMap.get(e);return s?s.get(t):s}Has(e,t){const s=this._firstMap.get(e);return!!s&&s.has(t)}Delete(e,t){const s=this._firstMap,i=s.get(e);if(!i)return!1;const r=i.delete(t);return r&&0===i.size&&s.delete(e),r}DeleteEither(e){const t=this._firstMap,s=t.get(e);s&&(s.clear(),t.delete(e));for(const[s,i]of t.entries())i.delete(e)&&0===i.size&&t.delete(s)}GetSize(){let e=0;for(const t of this._firstMap.values())e+=t.size;return e}*values(){for(const e of this._firstMap.values())yield*e.values()}*keyPairs(){for(const[e,t]of this._firstMap.entries())for(const s of t.keys())yield[e,s]}*entries(){for(const[e,t]of this._firstMap.entries())for(const[s,i]of t.entries())yield[e,s,i]}}}{const e=self.C3;e.ArraySet=class extends e.DefendedBase{constructor(){super(),this._set=new Set,this._arr=[],this._needToRebuildArray=!1}Release(){this.Clear()}Clear(){this._set.clear(),e.clearArray(this._arr),this._needToRebuildArray=!1}Add(e){this._set.has(e)||(this._set.add(e),this._needToRebuildArray||this._arr.push(e))}Has(e){return this._set.has(e)}Delete(e){this._set.delete(e)&&(this._needToRebuildArray=!0)}GetSize(){return this._set.size}IsEmpty(){return 0===this._set.size}GetArray(){return this._needToRebuildArray&&(this._RebuildArray(),this._needToRebuildArray=!1),this._arr}_RebuildArray(){const t=this._arr;e.clearArray(t);for(const e of this._set)t.push(e)}}}{const e=self.C3,t=new Map,s=new Map,i=new Map,r=new Map,n=new Map,a=new Map,o=new Map;o.set("linear","noease"),o.set("default","noease");const h=["default","noease","easeinquad","easeoutquad","easeinoutquad","easeincubic","easeoutcubic","easeinoutcubic","easeinquart","easeoutquart","easeinoutquart","easeinquint","easeoutquint","easeinoutquint","easeinsine","easeoutsine","easeinoutsine","easeinexpo","easeoutexpo","easeinoutexpo","easeincirc","easeoutcirc","easeinoutcirc","easeinelastic","easeoutelastic","easeinoutelastic","easeinback","easeoutback","easeinoutback","easeinbounce","easeoutbounce","easeinoutbounce"],l=["default","noease","quad","cubic","quart","quint","sine","expo","circ","elastic","back","bounce"],c=new Map([["linear","noease"],["in-sine","easeinsine"],["out-sine","easeoutsine"],["in-out-sine","easeinoutsine"],["in-elastic","easeinelastic"],["out-elastic","easeoutelastic"],["in-out-elastic","easeinoutelastic"],["in-back","easeinback"],["out-back","easeoutback"],["in-out-back","easeinoutback"],["in-bounce","easeinbounce"],["out-bounce","easeoutbounce"],["in-out-bounce","easeinoutbounce"],["in-cubic","easeincubic"],["out-cubic","easeoutcubic"],["in-out-cubic","easeinoutcubic"],["in-quadratic","easeinquad"],["out-quadratic","easeoutquad"],["in-out-quadratic","easeinoutquad"],["in-quartic","easeinquart"],["out-quartic","easeoutquart"],["in-out-quartic","easeinoutquart"],["in-quintic","easeinquint"],["out-quintic","easeoutquint"],["in-out-quintic","easeinoutquint"],["in-circular","easeincirc"],["out-circular","easeoutcirc"],["in-out-circular","easeinoutcirc"],["in-exponential","easeinexpo"],["out-exponential","easeoutexpo"],["in-out-exponential","easeinoutexpo"]]);self.Ease=class d{constructor(){}static InheritEase(){return"default"}static DefaultEase(){return"noease"}static ToInternal(e){return c.get(e)}static GetEditorEaseNames(e,...t){let n;this._CreateEaseMap(),e?(i.has(e)||i.set(e,new Map),n=i.get(e)):n=r;const a=[...n.keys()];return a.sort(),[...s.keys()].concat(a).filter((e=>!t.includes(e)))}static GetRuntimeEaseNames(){this._CreateEaseMap();const e=[...r.keys()];return e.sort(),[...s.keys()].concat(e)}static GetCustomRuntimeEaseNames(){this._CreateEaseMap();const e=[...r.keys()];return e.sort(),e}static IsPredefinedTranslatedName(e){for(const t of h){if(self.lang(`ui.bars.timeline.eases.${t}`)===e)return!0}for(const t of l){if(self.lang(`ui.bars.timeline.short-eases.${t}`)===e)return!0}}static IsNamePredefined(e){return this._CreateEaseMap(),[...s.keys()].includes(e)}static _GetEase(e){const s=o.get(e);return s?t.get(s):d.IsNamePredefined(e)?t.get(e):n.has(e)?n.get(e):void 0}static GetBuiltInTransition(e){return this._CreateEaseMap(),a.get(e)}static GetEditorEase(e,t){this._CreateEaseMap();const s=d._GetEase(e);if(s)return s;if(!t)throw new Error("missing ease function");return i.get(t).get(e)}static GetRuntimeEase(e){this._CreateEaseMap();const t=d._GetEase(e);return t||r.get(e)}static GetEaseFromIndex(e){this._CreateEaseMap();return this.GetRuntimeEaseNames()[e]}static GetIndexForEase(e,t){this._CreateEaseMap();return this.GetEditorEaseNames(t).indexOf(e)}static GetIndexForEaseAtRuntime(e){return this.GetIndexForEase(e)}static _CreateEaseMap(){0===t.size&&(this._AddPredifinedEase("default",(()=>{})),this._AddPredifinedEase("noease",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}],!0),this._AddPredifinedEase("easeinsine",[{x:0,y:0,sax:.485,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.038,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutsine",[{x:0,y:0,sax:.038,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.485,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutsine",[{x:0,y:0,sax:.336,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.336,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinelastic",[{x:0,y:0,sax:.018,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.116,y:.002,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.266,y:-.005,sax:.024,say:0,eax:-.021,eay:0,se:!0,ee:!0},{x:.416,y:.016,sax:.024,say:0,eax:-.026,eay:0,se:!0,ee:!0},{x:.566,y:-.045,sax:.061,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.716,y:.132,sax:.072,say:-.004,eax:-.045,eay:0,se:!0,ee:!0},{x:.866,y:-.373,sax:.06,say:0,eax:-.049,eay:-.002,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.038,eay:-.263,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutelastic",[{x:0,y:0,sax:.038,say:.263,eax:0,eay:0,se:!0,ee:!1},{x:.136,y:1.373,sax:.049,say:.002,eax:-.06,eay:0,se:!0,ee:!0},{x:.286,y:.868,sax:.045,say:0,eax:-.072,eay:.004,se:!0,ee:!0},{x:.436,y:1.045,sax:.025,say:0,eax:-.061,eay:0,se:!0,ee:!0},{x:.586,y:.984,sax:.026,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.736,y:1.005,sax:.021,say:0,eax:-.024,eay:0,se:!0,ee:!0},{x:.886,y:.998,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.018,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutelastic",[{x:0,y:0,sax:.025,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.067,y:.001,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.18,y:-.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.292,y:.025,sax:.053,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.405,y:-.118,sax:.069,say:0,eax:-.027,eay:0,se:!0,ee:!0},{x:.597,y:1.118,sax:.027,say:0,eax:-.069,eay:0,se:!0,ee:!0},{x:.71,y:.975,sax:.025,say:0,eax:-.053,eay:0,se:!0,ee:!0},{x:.822,y:1.005,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.935,y:.999,sax:.025,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.025,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinback",[{x:0,y:0,sax:.35,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.34,eay:-1.579,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutback",[{x:0,y:0,sax:.34,say:1.579,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.35,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutback",[{x:0,y:0,sax:.035,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.242,y:-.1,sax:.258,say:0,eax:-.025,eay:0,se:!0,ee:!0},{x:.76,y:1.1,sax:.025,say:0,eax:-.26,eay:0,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.035,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinbounce",[{x:0,y:0,sax:.033,say:.025,eax:0,eay:0,se:!0,ee:!1},{x:.092,y:0,sax:.026,say:.078,eax:-.033,eay:.025,se:!0,ee:!0},{x:.274,y:0,sax:.097,say:.319,eax:-.026,eay:.078,se:!0,ee:!0},{x:.637,y:0,sax:.105,say:.625,eax:-.097,eay:.319,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:-.004,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutbounce",[{x:0,y:0,sax:.125,say:.004,eax:0,eay:0,se:!0,ee:!1},{x:.365,y:1,sax:.097,say:-.319,eax:-.105,eay:-.625,se:!0,ee:!0},{x:.728,y:1,sax:.026,say:-.078,eax:-.097,eay:-.319,se:!0,ee:!0},{x:.91,y:1,sax:.033,say:-.025,eax:-.026,eay:-.078,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.033,eay:-.025,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutbounce",[{x:0,y:0,sax:.01,say:.006,eax:0,eay:0,se:!0,ee:!1},{x:.046,y:0,sax:.021,say:.038,eax:-.01,eay:.006,se:!0,ee:!0},{x:.137,y:0,sax:.059,say:.158,eax:-.021,eay:.038,se:!0,ee:!0},{x:.319,y:0,sax:.117,say:.744,eax:-.059,eay:.158,se:!0,ee:!0},{x:.683,y:1,sax:.059,say:-.158,eax:-.117,eay:-.744,se:!0,ee:!0},{x:.865,y:1,sax:.021,say:-.038,eax:-.059,eay:-.158,se:!0,ee:!0},{x:.956,y:1,sax:.01,say:-.006,eax:-.021,eay:-.038,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.01,eay:-.006,se:!1,ee:!0}]),this._AddPredifinedEase("easeincubic",[{x:0,y:0,sax:.75,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.138,eay:-.321,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcubic",[{x:0,y:0,sax:.138,say:.321,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.75,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcubic",[{x:0,y:0,sax:.285,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.081,say:.272,eax:-.081,eay:-.272,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.285,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquad",[{x:0,y:0,sax:.4,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.178,eay:-.392,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquad",[{x:0,y:0,sax:.178,say:.392,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.4,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquad",[{x:0,y:0,sax:.25,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.03,say:.065,eax:-.03,eay:-.065,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquart",[{x:0,y:0,sax:.264,say:.079,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.329,eay:-1.287,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquart",[{x:0,y:0,sax:.329,say:1.287,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.264,eay:-.079,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquart",[{x:0,y:0,sax:.765,say:.03,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.765,eay:-.03,se:!1,ee:!0}]),this._AddPredifinedEase("easeinquint",[{x:0,y:0,sax:.6,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.2,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutquint",[{x:0,y:0,sax:.2,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.6,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutquint",[{eax:0,eay:0,ee:!1,sax:.84,say:0,se:!0,x:0,y:0},{eax:-.84,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPredifinedEase("easeincirc",[{x:0,y:0,sax:.25,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.024,eay:-.808,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutcirc",[{x:0,y:0,sax:.024,say:.808,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.25,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutcirc",[{x:0,y:0,sax:.125,say:0,eax:0,eay:0,se:!0,ee:!1},{x:.5,y:.5,sax:.02,say:.428,eax:-.02,eay:-.428,se:!0,ee:!0},{x:1,y:1,sax:0,say:0,eax:-.125,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinexpo",[{x:0,y:0,sax:.66,say:0,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.14,eay:-1,se:!1,ee:!0}]),this._AddPredifinedEase("easeoutexpo",[{x:0,y:0,sax:.14,say:1,eax:0,eay:0,se:!0,ee:!1},{x:1,y:1,sax:0,say:0,eax:-.66,eay:0,se:!1,ee:!0}]),this._AddPredifinedEase("easeinoutexpo",[{eax:0,eay:0,ee:!1,sax:.345,say:0,se:!0,x:0,y:0},{eax:-.06,eay:-.5,ee:!0,sax:.06,say:.5,se:!0,x:.5,y:.5},{eax:-.335,eay:0,ee:!0,sax:0,say:0,se:!1,x:1,y:1}]),this._AddPrivateCustomEase("cubicbezier",this.EaseCubicBezier),this._AddPrivateCustomEase("spline",this.EaseSpline))}static _AddPredifinedEase(t,s,i=!1){if("function"==typeof s)d._AddEase(t,s,"predefined");else{if(!e.IsArray(s))throw new Error("unexpected arguments");if(self.BuiltInTransition){const r=e.New(self.BuiltInTransition,t,i);r.SetFromJson(s),d._AddEase(t,((e,t,s,i)=>r.Interpolate(e,t,s,i)),"predefined"),a.set(t,r)}else{const r=e.New(e.Transition,[t,s.map((e=>[e.x,e.y,e.sax,e.say,e.eax,e.eay,e.se,e.ee]))],!1);r.MakeLinear(i),d._AddEase(t,((e,t,s,i)=>r.Interpolate(e,t,s,i)),"predefined")}}}static _AddPrivateCustomEase(e,t){d._AddEase(e,t,"private")}static AddCustomEase(e,t,s){this._CreateEaseMap(),d._AddEase(e,t,"custom",s)}static RemoveCustomEase(e,t){if(this.IsNamePredefined(e))return;if([...n.keys()].includes(e))return;const s=i.get(t);s&&s.delete(e)}static _AddEase(e,a,o,h){switch(o){case"predefined":t.set(e,a),s.set(e,a);break;case"custom":if(h){i.has(h)||i.set(h,new Map);i.get(h).set(e,a)}else r.set(e,a);break;case"private":t.set(e,a),n.set(e,a);break;default:throw new Error("unexpected ease mode")}}static NoEase(e,t,s,i){return s*e/i+t}static EaseInQuad(e,t,s,i){return s*(e/=i)*e+t}static EaseOutQuad(e,t,s,i){return-s*(e/=i)*(e-2)+t}static EaseInOutQuad(e,t,s,i){return(e/=i/2)<1?s/2*e*e+t:-s/2*(--e*(e-2)-1)+t}static EaseInCubic(e,t,s,i){return s*(e/=i)*e*e+t}static EaseOutCubic(e,t,s,i){return s*((e=e/i-1)*e*e+1)+t}static EaseInOutCubic(e,t,s,i){return(e/=i/2)<1?s/2*e*e*e+t:s/2*((e-=2)*e*e+2)+t}static EaseInQuart(e,t,s,i){return s*(e/=i)*e*e*e+t}static EaseOutQuart(e,t,s,i){return-s*((e=e/i-1)*e*e*e-1)+t}static EaseInOutQuart(e,t,s,i){return(e/=i/2)<1?s/2*e*e*e*e+t:-s/2*((e-=2)*e*e*e-2)+t}static EaseInQuint(e,t,s,i){return s*(e/=i)*e*e*e*e+t}static EaseOutQuint(e,t,s,i){return s*((e=e/i-1)*e*e*e*e+1)+t}static EaseInOutQuint(e,t,s,i){return(e/=i/2)<1?s/2*e*e*e*e*e+t:s/2*((e-=2)*e*e*e*e+2)+t}static EaseInSine(e,t,s,i){return-s*Math.cos(e/i*(Math.PI/2))+s+t}static EaseOutSine(e,t,s,i){return s*Math.sin(e/i*(Math.PI/2))+t}static EaseInOutSine(e,t,s,i){return-s/2*(Math.cos(Math.PI*e/i)-1)+t}static EaseInExpo(e,t,s,i){return 0===e?t:s*Math.pow(2,10*(e/i-1))+t}static EaseOutExpo(e,t,s,i){return e===i?t+s:s*(1-Math.pow(2,-10*e/i))+t}static EaseInOutExpo(e,t,s,i){return 0===e?t:e===i?t+s:(e/=i/2)<1?s/2*Math.pow(2,10*(e-1))+t:s/2*(2-Math.pow(2,-10*--e))+t}static EaseInCirc(e,t,s,i){return-s*(Math.sqrt(1-(e/=i)*e)-1)+t}static EaseOutCirc(e,t,s,i){return s*Math.sqrt(1-(e=e/i-1)*e)+t}static EaseInOutCirc(e,t,s,i){return(e/=i/2)<1?-s/2*(Math.sqrt(1-e*e)-1)+t:s/2*(Math.sqrt(1-(e-=2)*e)+1)+t}static EaseInElastic(e,t,s,i){let r=1.70158,n=0,a=s;return 0===e?t:1==(e/=i)?t+s:(n||(n=.3*i),a<Math.abs(s)?(a=s,r=n/4):r=n/(2*Math.PI)*Math.asin(s/a),-a*Math.pow(2,10*(e-=1))*Math.sin((e*i-r)*(2*Math.PI)/n)+t)}static EaseOutElastic(e,t,s,i){let r=1.70158,n=0,a=s;return 0===e?t:1==(e/=i)?t+s:(n||(n=.3*i),a<Math.abs(s)?(a=s,r=n/4):r=n/(2*Math.PI)*Math.asin(s/a),a*Math.pow(2,-10*e)*Math.sin((e*i-r)*(2*Math.PI)/n)+s+t)}static EaseInOutElastic(e,t,s,i){let r=1.70158,n=0,a=s;return 0===e?t:2==(e/=i/2)?t+s:(n||(n=i*(.3*1.5)),a<Math.abs(s)?(a=s,r=n/4):r=n/(2*Math.PI)*Math.asin(s/a),e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*i-r)*(2*Math.PI)/n)*-.5+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*i-r)*(2*Math.PI)/n)*.5+s+t)}static EaseInBack(e,t,s,i,r){return void 0===r&&(r=1.70158),s*(e/=i)*e*((r+1)*e-r)+t}static EaseOutBack(e,t,s,i,r){return void 0===r&&(r=1.70158),s*((e=e/i-1)*e*((r+1)*e+r)+1)+t}static EaseInOutBack(e,t,s,i,r){return void 0===r&&(r=1.70158),(e/=i/2)<1?s/2*(e*e*((1+(r*=1.525))*e-r))+t:s/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t}static EaseInBounce(e,t,s,i){return s-d.EaseOutBounce(i-e,0,s,i)+t}static EaseOutBounce(e,t,s,i){return(e/=i)<1/2.75?s*(7.5625*e*e)+t:e<2/2.75?s*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?s*(7.5625*(e-=2.25/2.75)*e+.9375)+t:s*(7.5625*(e-=2.625/2.75)*e+.984375)+t}static EaseInOutBounce(e,t,s,i){return e<i/2?.5*d.EaseInBounce(2*e,0,s,i)+t:.5*d.EaseOutBounce(2*e-i,0,s,i)+.5*s+t}static EaseCubicBezier(e,t,s,i,r){return t+3*e*(s-t)+3*e**2*(t+i-2*s)+e**3*(r-t+3*s-3*i)}static EaseSpline(e,t,s,i,r,n,a,o,h,l){if(i===r&&n===a)return e;const c=T(e,t,i,n,o,l),u=g(s,r,a,h),_=S(s,r,a,h),d=y(s,r,a,h);return G(c,u,_,d)}static GetBezierSamples(e,t,s,i){const r=[],n=g(e,t,s,i),a=S(e,t,s,i),o=y(e,t,s,i);for(let e=0;e<u;++e){const t=G(e*_,n,a,o);r.push(t)}return r}};const u=11,_=1/(u-1),d=4,p=.01,f=1e-7,m=10,g=(e,t,s,i)=>i-3*s+3*t-e,S=(e,t,s,i)=>3*s-6*t+3*e,y=(e,t,s,i)=>3*(t-e),G=(e,t,s,i)=>((t*e+s)*e+i)*e,I=(e,t,s,i)=>3*t*e*e+2*s*e+i,T=(e,t,s,i,r,n)=>{if(1==e)return 1;let a=0,o=1,h=n[o],l=u-1;n[u-1];for(;o!=l&&h<=e;)o++,h=n[o],a+=_;o--,h=n[o];let c=a+(e-h)/(n[o+1]-h)*_;const T=g(t,s,i,r),b=S(t,s,i,r),C=y(t,s,i,r),P=I(c,T,b,C);if(0===P)return c;if(P>=p){for(let t=0;t<d;++t){c-=(G(c,T,b,C)-e)/I(c,T,b,C)}return c}{let t,s,i=a,r=a+_,n=0;do{c=i+(r-i)/2;let a=G(c,T,b,C)-e;a>0?r=c:i=c,t=Math.abs(a)>f,s=++n<m}while(t&&s);return c}}}{const e=self.C3;function RequireStringOrNumber(t){e.IsString(t)}e.ProbabilityTable=class{constructor(){this._items=[],this._totalWeight=0}Release(){this.Clear(),this._items=null}Clear(){e.clear2DArray(this._items),this._totalWeight=0}GetTotalWeight(){return this._totalWeight}Sample(e=Math.random()*this.GetTotalWeight()){let t=0;for(const[s,i]of this._items)if(t+=s,e<t)return i;return 0}AddItem(e,t){RequireStringOrNumber(t),this._totalWeight+=e,this._items.push([e,t])}RemoveItem(e,t){RequireStringOrNumber(t);const s=0===e;for(let i=0;i<this._items.length;i++){const r=this._items[i],n=s||r[0]===e,a=r[1]===t;if(n&&a){this._items.splice(i,1),this._totalWeight-=r[0];break}}}asJSON(){return JSON.stringify(this._items)}static fromJSON(t){const s=new e.ProbabilityTable,i=JSON.parse(t);for(const e of i){const t=e[0],i=e[1];s.AddItem(t,i)}return s}}}{const e=self.C3;let t=0;e.ScreenReaderText=class{constructor(e,s){this._runtime=e,this._text=s,this._id=t++,this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"create",id:this._id,text:this._text})}Release(){this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"release",id:this._id}),this._runtime=null,this._text="",this._id=-1}SetText(e){this._text!==e&&(this._text=e,this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{type:"update",id:this._id,text:this._text}))}}}{const e=self.C3;e.Event=class{constructor(e,t){this.type=e,this.cancelable=!!t,this.defaultPrevented=!1,this.propagationStopped=!1,this.isAsync=!1}preventDefault(){if(!this.cancelable)throw new Error(`event '${this.type}' is not cancelable`);this.defaultPrevented=!0}stopPropagation(){if(!this.cancelable)throw new Error(`event '${this.type}' cannot be stopped`);if(this.isAsync)throw new Error(`cannot stop async event '${this.type}' propagation`);this.propagationStopped=!0}}}{const e=self.C3,t=self.assert;e.Event.Handler=class extends e.DefendedBase{constructor(e){super(),this._type=e,this._captureListeners=[],this._captureListenersSet=new Set,this._listeners=[],this._listenersSet=new Set,this._fireDepth=0,this._queueModifyListeners=[]}Release(){this._fireDepth>0||(e.clearArray(this._captureListeners),this._captureListenersSet.clear(),e.clearArray(this._listeners),this._listenersSet.clear(),e.clearArray(this._queueModifyListeners),e.Release(this))}_AddListener(e,t){if(this._IsFiring())this._queueModifyListeners.push({op:"add",func:e,capture:t});else if(t){if(this._captureListenersSet.has(e))return;this._captureListeners.push(e),this._captureListenersSet.add(e)}else{if(this._listenersSet.has(e))return;this._listeners.push(e),this._listenersSet.add(e)}}_RemoveListener(t,s){this._IsFiring()?this._queueModifyListeners.push({op:"remove",func:t,capture:s}):s?this._captureListenersSet.has(t)&&(this._captureListenersSet.delete(t),e.arrayFindRemove(this._captureListeners,t)):this._listenersSet.has(t)&&(this._listenersSet.delete(t),e.arrayFindRemove(this._listeners,t))}_IsEmpty(){return!this._captureListeners.length&&!this._listeners.length}_IsFiring(){return this._fireDepth>0}_ProcessQueuedListeners(){const t=new Set,s=new Set;for(const e of this._queueModifyListeners)if("add"===e.op)this._AddListener(e.func,e.capture),e.capture?s.delete(e.func):t.delete(e.func);else{if("remove"!==e.op)throw new Error("invalid op");e.capture?(this._captureListenersSet.delete(e.func),s.add(e.func)):(this._listenersSet.delete(e.func),t.add(e.func))}e.arrayRemoveAllInSet(this._listeners,t),e.arrayRemoveAllInSet(this._captureListeners,s),e.clearArray(this._queueModifyListeners)}_FireCancellable(e){this._IncreaseFireDepth();let t=!1;for(let s=0,i=this._captureListeners.length;s<i;++s)if(this._captureListeners[s](e),e.propagationStopped){t=!0;break}if(!t)for(let t=0,s=this._listeners.length;t<s&&(this._listeners[t](e),!e.propagationStopped);++t);return this._DecreaseFireDepth(),!e.defaultPrevented}_FireNonCancellable(e){this._IncreaseFireDepth();for(let t=0,s=this._captureListeners.length;t<s;++t)this._captureListeners[t](e);for(let t=0,s=this._listeners.length;t<s;++t)this._listeners[t](e);return this._DecreaseFireDepth(),!0}_IncreaseFireDepth(){this._fireDepth++}_DecreaseFireDepth(){this._fireDepth--,0===this._fireDepth&&this._queueModifyListeners.length>0&&this._ProcessQueuedListeners()}SetDelayRemoveEventsEnabled(e){e?this._IncreaseFireDepth():this._DecreaseFireDepth()}_FireAsync(t){let s=[];for(let i=0,r=this._captureListeners.length;i<r;++i){let r=this._captureListeners[i];s.push(e.Asyncify((()=>r(t))))}for(let i=0,r=this._listeners.length;i<r;++i){let r=this._listeners[i];s.push(e.Asyncify((()=>r(t))))}return Promise.all(s).then((()=>!t.defaultPrevented))}_FireAndWait_AsyncOptional(e){const t=[];this._IncreaseFireDepth();for(let s=0,i=this._captureListeners.length;s<i;++s){const i=this._captureListeners[s](e);i instanceof Promise&&t.push(i)}for(let s=0,i=this._listeners.length;s<i;++s){const i=this._listeners[s](e);i instanceof Promise&&t.push(i)}return this._DecreaseFireDepth(),t.length?Promise.all(t).then((()=>!e.defaultPrevented)):!e.defaultPrevented}async _FireAndWaitAsync(e){return await this._FireAndWait_AsyncOptional(e)}async _FireAndWaitAsyncSequential(e){this._IncreaseFireDepth();for(let t=0,s=this._captureListeners.length;t<s;++t){const s=this._captureListeners[t](e);s instanceof Promise&&await s}for(let t=0,s=this._listeners.length;t<s;++t){const s=this._listeners[t](e);s instanceof Promise&&await s}return this._DecreaseFireDepth(),!e.defaultPrevented}*_FireAsGenerator(t){this._IncreaseFireDepth();for(let s=0,i=this._captureListeners.length;s<i;++s){const i=this._captureListeners[s](t);e.IsIterator(i)&&(yield*i)}for(let s=0,i=this._listeners.length;s<i;++s){const i=this._listeners[s](t);e.IsIterator(i)&&(yield*i)}this._DecreaseFireDepth()}}}{const e=self.C3;e.Event.Dispatcher=class extends e.DefendedBase{constructor(){super(),this._eventHandlers=new Map,this._dispatcherWasReleased=!1}Release(){if(this._dispatcherWasReleased)throw new Error("already released");this.ClearEvents(),this._dispatcherWasReleased=!0,e.Release(this)}WasReleased(){return this._dispatcherWasReleased}ClearEvents(){for(let e of this._eventHandlers.values())e.Release();this._eventHandlers.clear()}_GetHandlerByType(t,s){let i=this._eventHandlers.get(t);return i||(s?(i=e.New(e.Event.Handler,t),this._eventHandlers.set(t,i),i):null)}HasAnyHandlerFor(e){return this._eventHandlers.has(e)}addEventListener(e,t,s){this._GetHandlerByType(e,!0)._AddListener(t,!!s)}removeEventListener(e,t,s){let i=this._GetHandlerByType(e,!1);i&&(i._RemoveListener(t,!!s),i._IsEmpty()&&this._eventHandlers.delete(e))}dispatchEvent(e){const t=this._GetHandlerByType(e.type,!1);return!t||(e.cancelable?t._FireCancellable(e):t._FireNonCancellable(e))}dispatchEventAsync(e){const t=this._GetHandlerByType(e.type,!1);return t?(e.isAsync=!0,t._FireAsync(e)):Promise.resolve(!0)}async dispatchEventAndClearAsync(e){const t=this._GetHandlerByType(e.type,!1);if(!t)return!0;this._eventHandlers.delete(e.type),e.isAsync=!0;const s=await t._FireAsync(e);return t.Release(),s}async dispatchEventAndWaitAsync(e){const t=this._GetHandlerByType(e.type,!1);return!t||await t._FireAndWaitAsync(e)}dispatchEventAndWait_AsyncOptional(e){const t=this._GetHandlerByType(e.type,!1);return!t||t._FireAndWait_AsyncOptional(e)}async dispatchEventAndWaitAsyncSequential(e){const t=this._GetHandlerByType(e.type,!1);return!t||await t._FireAndWaitAsyncSequential(e)}dispatchGeneratorEvent(e){const t=this._GetHandlerByType(e.type,!1);if(!t)return null;if(e.cancelable)throw new Error("not supported");return t._FireAsGenerator(e)}SetDelayRemoveEventsEnabled(e){for(const t of this._eventHandlers.values())t.SetDelayRemoveEventsEnabled(e)}}}{const e=self.C3,t=12,s=16,i=35,r="undefined"!=typeof requestIdleCallback;let n=[],a=-1,o=0;function SetNewCallback(e){a=r&&0===o?requestIdleCallback(DoAsyncifiedWork,{timeout:i}):setTimeout(DoAsyncifiedWork,o>0?1:e)}function DoAsyncifiedWork(e){if(a=-1,!n.length)return;let i=performance.now(),h=i,l=0,c=0;do{DoNextAsyncifiedJob(n.shift()),h=performance.now(),++l,c=(h-i)/l*1.1}while(n.length&&(r&&0===o&&void 0!==e?c<e.timeRemaining():h-i+c<t));if(-1===a&&n.length){let e=h-i;SetNewCallback(Math.max(s-e,4))}}function DoNextAsyncifiedJob(e){let t;try{t=e.func()}catch(t){return void e.reject(t)}e.resolve(t)}let h=e.QueryString.Has("disable-asyncify");e.Asyncify=function(t){let i=null;return e.isDebug&&(i=e.GetCallStack()),new Promise(((e,r)=>{n.push({func:t,resolve:e,reject:r,stack:i}),h?DoNextAsyncifiedJob(n.pop()):-1===a&&SetNewCallback(s)}))},e.Asyncify.SetHighThroughputMode=function(e){if(e)++o;else if(--o,o<0)throw new Error("already turned off high throughput mode")}}{const e=self.C3,t=1e3,s=100;let i=-1;function ClearTimeCache(){i=-1}e.FastGetDateNow=function(){return-1===i&&(i=Date.now(),self.setTimeout(ClearTimeCache,16)),i};let r=-1,n=-1,a=new Set;function CheckActiveIdleTimeouts(){r=-1,n=-1;let e=Date.now();for(let t of a)if(t._CheckTimeout(e)){let e=t._GetDeadline();(-1===n||e<n)&&(n=e)}else a.delete(t);if(-1!==n){let i=Math.max(n-e+s,t);r=self.setTimeout(CheckActiveIdleTimeouts,i)}}e.IdleTimeout=class{constructor(e,t){this._callback=e,this._timeout=1e3*t,this._deadline=0,this._isActive=!1}Reset(){let i=e.FastGetDateNow();this._deadline=i+this._timeout,this._isActive||(a.add(this),this._isActive=!0),-1===r?(n=this._deadline,r=self.setTimeout(CheckActiveIdleTimeouts,this._timeout+s)):this._deadline<n&&n>i+t&&(self.clearTimeout(r),n=this._deadline,r=self.setTimeout(CheckActiveIdleTimeouts,this._timeout+s))}_CheckTimeout(e){return!(e>=this._deadline)||(this._callback()?(this._deadline=e+this._timeout,!0):(this._isActive=!1,!1))}_GetDeadline(){return this._deadline}Cancel(){this._isActive&&(a.delete(this),this._isActive=!1,0===a.size&&-1!==r&&(self.clearTimeout(r),r=-1,n=-1))}Release(){this.Cancel(),this._callback=null}}}{const e=self.C3;e.Disposable=class t{constructor(e){this._disposed=!1,this._disposeAction=e}Dispose(){this._disposed||(this._disposed=!0,this._disposeAction&&(this._disposeAction(),this._disposeAction=null))}IsDisposed(){return this._disposed}Release(){this.Dispose()}static Release(e){return new t((()=>e.Release()))}static From(t,s,i,r,n){if(null==r)r=!1;else if("boolean"!=typeof r&&"object"!=typeof r)throw new TypeError("invalid event listener options");if(n&&(i=i.bind(n)),s.includes(" ")){s=s.split(" ");const n=new e.CompositeDisposable;for(let a of s)t.addEventListener(a,i,r),n.Add(e.New(e.Disposable,(()=>t.removeEventListener(a,i,r))));return n}return t.addEventListener(s,i,r),e.New(e.Disposable,(()=>t.removeEventListener(s,i,r)))}},e.StubDisposable=class extends e.Disposable{SetAction(e){this._disposeAction=e}},e.CompositeDisposable=class extends e.Disposable{constructor(...e){super(),this._disposables=new Set;for(let t of e)this.Add(t)}Add(...e){if(this._disposed)throw new Error("already disposed");for(let t of e)this._disposables.add(t)}Remove(e){if(this._disposed)throw new Error("already disposed");this._disposables.delete(e)}RemoveAll(){if(this._disposed)throw new Error("already disposed");if(this._disposables){for(let e of this._disposables)e.Dispose();this._disposables.clear()}}IsDisposed(){return this._disposed}Dispose(){if(this._disposed)throw new Error("already disposed");this._disposed=!0;for(let e of this._disposables)e.Dispose();this._disposables.clear(),this._disposables=null}Release(){this.Dispose()}}}{const e=self.C3;e.KahanSum=class extends e.DefendedBase{constructor(){super(),this._c=0,this._y=0,this._t=0,this._sum=0}Add(e){e=+e,this._y=e-this._c,this._t=this._sum+this._y,this._c=this._t-this._sum-this._y,this._sum=this._t}Subtract(e){this._sum-=+e}Get(){return this._sum}Reset(){this._c=0,this._y=0,this._t=0,this._sum=0}Set(e){this._c=0,this._y=0,this._t=0,this._sum=+e}Copy(e){this._c=e._c,this._y=e._y,this._t=e._t,this._sum=e._sum}Release(){}}}{const e=self.C3,t={},s=!0,i=!1;t.RBnode=function(e){this.tree=e,this.right=this.tree.sentinel,this.left=this.tree.sentinel,this.parent=null,this.color=!1,this.key=null},t.RedBlackSet=function(e){this.size=0,this.sentinel=new t.RBnode(this),this.sentinel.color=i,this.root=this.sentinel,this.root.parent=this.sentinel,this.compare=e||this.default_compare},t.RedBlackSet.prototype.default_compare=function(e,t){return e<t?-1:t<e?1:0},t.RedBlackSet.prototype.clone=function(){var e=new t.RedBlackSet(this.compare);return e.insertAll(this),e},t.RedBlackSet.prototype.clear=function(){this.size=0,this.sentinel=new t.RBnode(this),this.sentinel.color=i,this.root=this.sentinel,this.root.parent=this.sentinel},t.RedBlackSet.prototype.leftRotate=function(e){var t=e.right;e.right=t.left,t.left!=this.sentinel&&(t.left.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t},t.RedBlackSet.prototype.rightRotate=function(e){var t=e.left;e.left=t.right,t.right!=this.sentinel&&(t.right.parent=e),t.parent=e.parent,e.parent==this.sentinel?this.root=t:e==e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t},t.RedBlackSet.prototype.insert=function(e){if(this.contains(e)){this.get_(e).key=e}else{var i=new t.RBnode(this);i.key=e;for(var r=this.sentinel,n=this.root;n!=this.sentinel;)r=n,n=this.compare(i.key,n.key)<0?n.left:n.right;i.parent=r,r==this.sentinel?this.root=i:this.compare(i.key,r.key)<0?r.left=i:r.right=i,i.left=this.sentinel,i.right=this.sentinel,i.color=s,this.insertFixup(i),this.size++}},t.RedBlackSet.prototype.insertFixup=function(e){for(;e!=this.sentinel&&e!=this.root&&e.parent.color==s;)if(e.parent==e.parent.parent.left){(t=e.parent.parent.right).color==s?(e.parent.color=i,t.color=i,e.parent.parent.color=s,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.leftRotate(e)),e.parent.color=i,e.parent.parent.color=s,e.parent.parent!=this.sentinel&&this.rightRotate(e.parent.parent))}else{var t;(t=e.parent.parent.left).color==s?(e.parent.color=i,t.color=i,e.parent.parent.color=s,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rightRotate(e)),e.parent.color=i,e.parent.parent.color=s,e.parent.parent!=this.sentinel&&this.leftRotate(e.parent.parent))}this.root.color=i},t.RedBlackSet.prototype.delete_=function(e){var t,s;(s=(t=e.left==this.sentinel||e.right==this.sentinel?e:this.successor_(e)).left!=this.sentinel?t.left:t.right).parent=t.parent,t.parent==this.sentinel?this.root=s:t==t.parent.left?t.parent.left=s:t.parent.right=s,t!=e&&(e.key=t.key),t.color==i&&this.deleteFixup(s),this.size--},t.RedBlackSet.prototype.deleteFixup=function(e){for(;e!=this.root&&e.color==i;)if(e==e.parent.left){(t=e.parent.right).color==s&&(t.color=i,e.parent.color=s,this.leftRotate(e.parent),t=e.parent.right),t.left.color==i&&t.right.color==i?(t.color=s,e=e.parent):(t.right.color==i&&(t.left.color=i,t.color=s,this.rightRotate(t),t=e.parent.right),t.color=e.parent.color,e.parent.color=i,t.right.color=i,this.leftRotate(e.parent),e=this.root)}else{var t;(t=e.parent.left).color==s&&(t.color=i,e.parent.color=s,this.rightRotate(e.parent),t=e.parent.left),t.right.color==i&&t.left.color==i?(t.color=s,e=e.parent):(t.left.color==i&&(t.right.color=i,t.color=s,this.leftRotate(t),t=e.parent.left),t.color=e.parent.color,e.parent.color=i,t.left.color=i,this.rightRotate(e.parent),e=this.root)}e.color=i},t.RedBlackSet.prototype.remove=function(e){var t=this.get_(e);if(t!=this.sentinel){var s=t.key;return this.delete_(t),s}return null},t.RedBlackSet.prototype.removeSwapped=function(e,t){this.remove(t)},t.RedBlackSet.prototype.min=function(e){for(;e.left!=this.sentinel;)e=e.left;return e},t.RedBlackSet.prototype.max=function(e){for(;e.right!=this.sentinel;)e=e.right;return e},t.RedBlackSet.prototype.successor_=function(e){if(e.right!=this.sentinel)return this.min(e.right);for(var t=e.parent;t!=this.sentinel&&e==t.right;)e=t,t=t.parent;return t},t.RedBlackSet.prototype.predeccessor_=function(e){if(e.left!=this.sentinel)return this.max(e.left);for(var t=e.parent;t!=this.sentinel&&e==t.left;)e=t,t=t.parent;return t},t.RedBlackSet.prototype.successor=function(e){if(this.size>0){var t=this.get_(e);if(t==this.sentinel)return null;if(t.right!=this.sentinel)return this.min(t.right).key;for(var s=t.parent;s!=this.sentinel&&t==s.right;)t=s,s=s.parent;return s!=this.sentinel?s.key:null}return null},t.RedBlackSet.prototype.predecessor=function(e){if(this.size>0){var t=this.get_(e);if(t==this.sentinel)return null;if(t.left!=this.sentinel)return this.max(t.left).key;for(var s=t.parent;s!=this.sentinel&&t==s.left;)t=s,s=s.parent;return s!=this.sentinel?s.key:null}return null},t.RedBlackSet.prototype.getMin=function(){return this.min(this.root).key},t.RedBlackSet.prototype.getMax=function(){return this.max(this.root).key},t.RedBlackSet.prototype.get_=function(e){for(var t=this.root;t!=this.sentinel&&0!=this.compare(t.key,e);)t=this.compare(e,t.key)<0?t.left:t.right;return t},t.RedBlackSet.prototype.contains=function(e){return null!=this.get_(e).key},t.RedBlackSet.prototype.getValues=function(){var e=[];return this.forEach((function(t){e.push(t)})),e},t.RedBlackSet.prototype.insertAll=function(e){if("array"==t.typeOf(e))for(var s=0;s<e.length;s++)this.insert(e[s]);else if("function"==t.typeOf(e.forEach))e.forEach(this.insert,this);else if("function"==t.typeOf(e.getValues)){var i=e.getValues();for(s=0;s<i.length;s++)this.insert(i[s])}else if("object"==t.typeOf(e))for(var r in e)this.insert(e[r])},t.RedBlackSet.prototype.removeAll=function(e){if("array"==t.typeOf(e))for(var s=0;s<e.length;s++)this.remove(e[s]);else if("function"==t.typeOf(e.forEach))e.forEach(this.removeSwapped,this);else if("function"==t.typeOf(e.getValues)){var i=e.getValues();for(s=0;s<i.length;s++)this.remove(i[s])}else if("object"==t.typeOf(e))for(var r in e)this.remove(e[r])},t.RedBlackSet.prototype.containsAll=function(e){if("array"==t.typeOf(e)){for(var s=0;s<e.length;s++)if(!this.contains(e[s]))return!1;return!0}if("function"==t.typeOf(e.forEach))return e.every(this.contains,this);if("function"==t.typeOf(e.getValues)){var i=e.getValues();for(s=0;s<i.length;s++)if(!this.contains(i[s]))return!1;return!0}if("object"==t.typeOf(e)){for(var r in e)if(!this.contains(e[r]))return!1;return!0}},t.RedBlackSet.prototype.range=function(e,t){var s=[];return this.traverseFromTo((function(e){s.push(e)}),e,t),s},t.RedBlackSet.prototype.traverse=function(e,t){if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel;){if(e.call(t,s.key,this))return;s=this.successor_(s)}},t.RedBlackSet.prototype.traverseFrom=function(e,t,s){if(!this.isEmpty())for(var i=this.get_(t);i!=this.sentinel;){if(e.call(s,i.key,this))return;i=this.successor_(i)}},t.RedBlackSet.prototype.traverseTo=function(e,t,s){if(!this.isEmpty())for(var i=this.min(this.root),r=this.get_(t);i!=r;){if(e.call(s,i.key,this))return;i=this.successor_(i)}},t.RedBlackSet.prototype.traverseFromTo=function(e,t,s,i){if(!this.isEmpty())for(var r=this.get_(t),n=this.get_(s);r!=n;){if(e.call(i,r.key,this))return;r=this.successor_(r)}},t.RedBlackSet.prototype.traverseBackwards=function(e,t){if(!this.isEmpty())for(var s=this.max(this.root);s!=this.sentinel;){if(e.call(t,s.key,this))return;s=this.predeccessor_(s)}},t.RedBlackSet.prototype.forEach=function(e,t){if(!this.isEmpty())for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))e.call(t,s.key,s.key,this)},t.RedBlackSet.prototype.some=function(e,t){if(this.isEmpty())return!1;for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))if(e.call(t,s.key,s.key,this))return!0;return!1},t.RedBlackSet.prototype.every=function(e,t){if(this.isEmpty())return!1;for(var s=this.min(this.root);s!=this.sentinel;s=this.successor_(s))if(!e.call(t,s.key,s.key,this))return!1;return!0},t.RedBlackSet.prototype.map=function(e,t){var s=[];if(this.isEmpty())return s;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))s.push(e.call(t,i.key,i.key,this));return s},t.RedBlackSet.prototype.filter=function(e,t){var s=[];if(this.isEmpty())return s;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))e.call(t,i.key,i.key,this)&&s.push(i.key);return s},t.RedBlackSet.prototype.getCount=function(){return this.size},t.RedBlackSet.prototype.isEmpty=function(){return 0==this.size},t.RedBlackSet.prototype.isSubsetOf=function(e){var s=t.getCount(e);if(this.getCount()>s)return!1;var i=0;if(this.isEmpty())return!0;for(var r=this.min(this.root);r!=this.sentinel;r=this.successor_(r))t.contains.call(e,e,r.key)&&i++;return i==this.getCount()},t.RedBlackSet.prototype.intersection=function(e){var s=new t.RedBlackSet(this.compare);if(this.isEmpty())return s;for(var i=this.min(this.root);i!=this.sentinel;i=this.successor_(i))e.contains.call(e,i.key,i.key,this)&&s.insert(i.key);return s},e.RedBlackSet=class extends e.DefendedBase{constructor(e){super(),this._rbSet=new t.RedBlackSet(e),this._enableQueue=!1,this._queueInsert=new Set,this._queueRemove=new Set}Add(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.delete(e):this._queueInsert.add(e):this._rbSet.insert(e)}Remove(e){this._enableQueue?this._rbSet.contains(e)?this._queueRemove.add(e):this._queueInsert.delete(e):this._rbSet.remove(e)}Has(e){return this._enableQueue?!!this._queueInsert.has(e)||!this._queueRemove.has(e)&&this._rbSet.contains(e):this._rbSet.contains(e)}Clear(){this._rbSet.clear(),this._queueInsert.clear(),this._queueRemove.clear()}toArray(){if(this._enableQueue)throw new Error("cannot be used in queueing mode");return this._rbSet.getValues()}GetSize(){return this._rbSet.getCount()+this._queueInsert.size-this._queueRemove.size}IsEmpty(){return 0===this.GetSize()}Front(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");const e=this._rbSet;return e.min(e.root).key}Shift(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");const e=this.Front();return this.Remove(e),e}SetQueueingEnabled(e){if(e=!!e,this._enableQueue!==e&&(this._enableQueue=e,!e)){for(const e of this._queueRemove)this._rbSet.remove(e);this._queueRemove.clear();for(const e of this._queueInsert)this._rbSet.insert(e);this._queueInsert.clear()}}ForEach(e){this._rbSet.forEach(e)}*values(){if(this.IsEmpty())return;const e=this._rbSet;for(let t=e.min(e.root);t!=e.sentinel;t=e.successor_(t))yield t.key}[Symbol.iterator](){return this.values()}}}{const e=self.C3;e.PromiseThrottle=class{constructor(t=e.hardwareConcurrency){this._maxParallel=t,this._queue=[],this._activeCount=0}Add(e){return new Promise(((t,s)=>{this._queue.push({func:e,resolve:t,reject:s}),this._MaybeStartNext()}))}_FindInQueue(e){for(let t=0,s=this._queue.length;t<s;++t)if(this._queue[t].func===e)return t;return-1}RemoveAndResolve(e,t){const s=this._FindInQueue(e);if(-1===s)throw new Error("cannot find promise to resolve");this._queue[s].resolve(t),this._queue.splice(s,1)}RemoveAndReject(e,t){const s=this._FindInQueue(e);if(-1===s)throw new Error("cannot find promise to reject");this._queue[s].reject(t),this._queue.splice(s,1)}async _MaybeStartNext(){if(!this._queue.length)return;if(this._activeCount>=this._maxParallel)return;this._activeCount++;const e=this._queue.shift();try{const t=await e.func();e.resolve(t)}catch(t){e.reject(t)}this._activeCount--,this._MaybeStartNext()}static async Batch(e,t){const s=[];let i=!1;const r=async e=>{let r;for(;r=t.pop();){if(i)return;try{s.push(await r())}catch(e){throw i=!0,e}}},n=[];for(;e--;)n.push(r());return await Promise.all(n),s}}}{const e=self.C3;e.RateLimiter=class{constructor(e,t,s){this._callback=e,this._interval=t,this._intervalOnBattery=s||2*t,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=()=>this._OnTimer(),this._ignoreReset=!1,this._canRunImmediate=!1,this._callbackArguments=null}SetCanRunImmediate(e){this._canRunImmediate=!!e}_GetInterval(){return void 0!==e.Battery&&e.Battery.IsOnBatteryPower()?this._intervalOnBattery:this._interval}Call(...t){if(-1!==this._timerId)return;this._callbackArguments=t;let s=e.FastGetDateNow(),i=s-this._lastCallTime,r=this._GetInterval();i>=r&&this._canRunImmediate?(this._lastCallTime=s,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(r-i,4))}_RunCallback(){this._ignoreReset=!0;const e=this._callbackArguments;this._callbackArguments=null,e?this._callback(...e):this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._callbackArguments=null,this._lastCallTime=e.FastGetDateNow())}_OnTimer(){this._timerId=-1,this._lastCallTime=e.FastGetDateNow(),this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._callback=null,this._callbackArguments=null,this._timerCallFunc=null}}}{const e=self.C3;e.SVGRasterManager=class{constructor(){this._images=new Map,this._allowNpotSurfaces=!1,this._getBaseSizeCallback=null,this._rasterAtSizeCallback=null,this._releaseResultCallback=null,this._redrawCallback=null}SetNpotSurfaceAllowed(e){this._allowNpotSurfaces=!!e}IsNpotSurfaceAllowed(){return this._allowNpotSurfaces}SetGetBaseSizeCallback(e){this._getBaseSizeCallback=e}GetBaseSize(e){if(!this._getBaseSizeCallback)throw new Error("no get base size callback set");return this._getBaseSizeCallback(e)}SetRasterAtSizeCallback(e){this._rasterAtSizeCallback=e}RasterAtSize(e,t,s,i,r,n){if(!this._rasterAtSizeCallback)throw new Error("no raster at size callback set");return this._rasterAtSizeCallback(e,t,s,i,r,n)}SetReleaseResultCallback(e){this._releaseResultCallback=e}ReleaseResult(e){if(!this._releaseResultCallback)throw new Error("no release result callback set");this._releaseResultCallback(e)}SetRedrawCallback(e){this._redrawCallback=e}Redraw(){if(!this._redrawCallback)throw new Error("no redraw callback set");this._redrawCallback()}AddImage(t){let s=this._images.get(t);return s||(s=e.New(e.SVGRasterImage,this,t),this._images.set(t,s)),s.IncReference(),s}_RemoveImage(e){this._images.delete(e.GetDataSource())}OnTexturesChanged(){for(const e of this._images.values())e.ReleaseRasterizedResult(),e.ForceRasterAgain()}}}{const e=self.C3,t=4096;e.SVGRasterImage=class{constructor(e,t){this._manager=e,this._dataSource=t,this._refCount=0,this._baseWidth=0,this._baseHeight=0,this._getBaseSizePromise=this._manager.GetBaseSize(t).then((e=>{this._manager&&(this._baseWidth=e[0],this._baseHeight=e[1],this._manager.Redraw())})).catch((e=>{this._hadError=!0,this._manager&&this._manager.Redraw()})),this._rasterSurfaceWidth=0,this._rasterSurfaceHeight=0,this._rasterImageWidth=0,this._rasterImageHeight=0,this._isRasterizing=!1,this._rasterizedResult=null,this._forceRaster=!1,this._hadError=!1}Release(){if(this._refCount<=0)throw new Error("already released");this._refCount--,0===this._refCount&&this._Release()}ReleaseRasterizedResult(){this._rasterizedResult&&(this._manager.ReleaseResult(this._rasterizedResult),this._rasterizedResult=null)}_Release(){this.ReleaseRasterizedResult(),this._manager._RemoveImage(this),this._manager=null}GetDataSource(){return this._dataSource}IncReference(){this._refCount++}HasReferences(){return this._refCount>0}GetRasterizedResult(){return this._rasterizedResult}ForceRasterAgain(){this._forceRaster=!0}async StartRasterForSize(s,i,r){if(0===i||0===r||this._hadError)return;if(this._isRasterizing)return;let n=e.nextHighestPowerOfTwo(Math.ceil(i)),a=e.nextHighestPowerOfTwo(Math.ceil(r));const o=Math.max(n,a);if(o>t){const e=t/o;i*=e,r*=e,n=Math.min(Math.ceil(n*e),t),a=Math.min(Math.ceil(a*e),t)}if(i<n&&r<a){const e=i/r;n/a>e?(i=a*e,r=a):(i=n,r=n/e)}if(this._manager.IsNpotSurfaceAllowed()&&(n=Math.ceil(i),a=Math.ceil(r)),n<=this._rasterSurfaceWidth&&a<=this._rasterSurfaceHeight&&!this._forceRaster)return;this._isRasterizing=!0,this._rasterSurfaceWidth=n,this._rasterSurfaceHeight=a;const h=await this._manager.RasterAtSize(this._dataSource,s,this._rasterSurfaceWidth,this._rasterSurfaceHeight,i,r);this._manager&&(this.ReleaseRasterizedResult(),this._rasterizedResult=h,this._rasterImageWidth=i,this._rasterImageHeight=r,this._isRasterizing=!1,this._forceRaster=!1,this._manager.Redraw())}WhenBaseSizeReady(){return this._getBaseSizePromise}GetBaseWidth(){return this._baseWidth}GetBaseHeight(){return this._baseHeight}GetRasterWidth(){return this._rasterImageWidth}GetRasterHeight(){return this._rasterImageHeight}HadError(){return this._hadError}}}{const e=self.C3;e.UTF8_BOM="\ufeff";const t=new Set([..."0123456789"]);e.IsNumericChar=function(e){return t.has(e)};const s=new Set([..." \t\n\r\u2028\u2029"]);e.IsWhitespaceChar=function(e){return s.has(e)},e.FilterWhitespace=function(t){return[...t].filter((t=>!e.IsWhitespaceChar(t))).join("")},e.IsStringAllWhitespace=function(t){for(const s of t)if(!e.IsWhitespaceChar(s))return!1;return!0},e.IsCharArrayAllWhitespace=function(t){for(const s of t)if(!e.IsWhitespaceChar(s))return!1;return!0},e.IsUnprintableChar=function(e){return 1===e.length&&e.charCodeAt(0)<32},e.FilterUnprintableChars=function(t){return[...t].filter((t=>!e.IsUnprintableChar(t))).join("")};const i=new Set([..."0123456789.+-e"]);e.IsStringNumber=function(e){if(!(e=e.trim()).length)return!1;let s=e.charAt(0);if("-"!==s&&!t.has(s))return!1;for(let t of e)if(!i.has(t))return!1;return!0},e.RemoveTrailingDigits=function(t){let s=t.length;for(;s>0;){let i=t.charAt(s-1);if(!e.IsNumericChar(i))break;--s}return t.substr(0,s)},e.IncrementNumberAtEndOf=function(t){let s=e.RemoveTrailingDigits(t),i=t.substr(s.length);return i=i?(parseInt(i,10)+1).toString():"2",s+i};const r=new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#39;"]]);function lookupHtmlEntity(e){return r.get(e)}const n=/[&<>"']/g;e.EscapeHTML=function(e){return e.replace(n,lookupHtmlEntity)},e.EscapeJS=function(t){let s=e.ReplaceAll(t,"\\","\\\\");return s=e.ReplaceAll(s,'"','\\"'),s=e.ReplaceAll(s,"\t","\\t"),s=e.ReplaceAll(s,"\r",""),e.ReplaceAll(s,"\n","\\n")},e.EscapeXML=function(t){let s=e.ReplaceAll(t,"&","&amp;");return s=e.ReplaceAll(s,"<","&lt;"),s=e.ReplaceAll(s,">","&gt;"),e.ReplaceAll(s,'"',"&quot;")};const a=/[-[\]{}()*+?.,\\^$|#\s]/g;e.EscapeRegex=function(e){return e.replace(a,"\\$&")},e.CountCharsInString=function(e,t){let s=0;for(const i of e)i===t&&++s;return s},e.FindAll=function(e,t,s=!1){if(!t)return[];s||(e=e.toLowerCase(),t=t.toLowerCase());const i=t.length;let r=0,n=0,a=[];for(;(n=e.indexOf(t,r))>-1;)a.push(n),r=n+i;return a},e.ReplaceAll=function(e,t,s){return e.replaceAll(t,(()=>s))},e.ReplaceAllCaseInsensitive=function(t,s,i){return t.replace(new RegExp(e.EscapeRegex(s),"gi"),(()=>i))},e.SetElementContent=function(t,s){"string"==typeof s?t.textContent=s:s.isPlainText()?t.textContent=s.toString():(t.innerHTML=s.toHTML(),s instanceof e.BBString&&s.attachLinkHandlers(t))},e.StringLikeEquals=function(t,s){return t instanceof e.HtmlString||t instanceof e.BBString?t.equals(s):s instanceof e.HtmlString||s instanceof e.BBString?s.equals(t):t===s},e.StringSubstitute=function(e,...t){let s=e;for(let i=0,r=t.length;i<r;++i){const r=`{${i}}`;if(!e.includes(r))throw new Error(`missing placeholder '${r}' in string substitution`);s=s.replace(r,t[i].toString())}return s},e.StringSubstituteAllowMissing=function(e,...t){let s=e,i=-1,r=-1;for(let n=0,a=t.length;n<a;++n){const a=`{${n}}`;e.includes(a)?(r=n,s=s.replace(a,t[n].toString())):-1===i&&(i=n)}if(i>=0&&r>=0&&i<r)throw new Error(`missing placeholder '${i}' in string substitution`);return s},e.StringSubstituteMap=function(e,t){let s=e;for(let[e,i]of Object.entries(t))s=s.replaceAll(e,i.toString());return s},e.SortAZ=function(e,t){return e>t?1:e<t?-1:0},e.SortAZCaseInsensitive=function(e,t){let s=e.toLowerCase(),i=t.toLowerCase();return s>i?1:s<i?-1:0};let o=null,h=null;self.Intl&&self.Intl.Segmenter?o=new self.Intl.Segmenter:h=new self.GraphemeSplitter,e.SplitGraphemes=function(e){if(o){const t=[];for(const s of o.segment(e))t.push(s.segment);return t}return h.splitGraphemes(e)},e.IterateGraphemes=function*(e){if(o)for(const t of o.segment(e))yield t.segment;else yield*h.iterateGraphemes(e)},e.CountGraphemes=function(e){if(o){let t=0;for(const s of o.segment(e))++t;return t}return h.countGraphemes(e)};const l=1024,c=1024*l,u=1024*c,_=1024*u;e.FormatDataSize=function(e,t){let s="common."+(t?"dataRates":"dataSizes")+".";const i=self.langSub;if(e<l)return i(s+"bytes",e);if(e<c){let t=e/l;return t=t<10?Math.round(10*t)/10:Math.round(t),i(s+"kilobytes",t)}if(e<u){let t=e/c;return t=t<10?Math.round(10*t)/10:Math.round(t),i(s+"megabytes",t)}if(e<_){let t=e/u;return t=t<10?Math.round(10*t)/10:Math.round(t),i(s+"gigabytes",t)}{let t=e/_;return t=t<10?Math.round(10*t)/10:Math.round(t),i(s+"terabytes",t)}};const d={approximate:!1,days:!0,hours:!0,minutes:!0,seconds:!0};e.FormatTime=function(t,s){s=Object.assign({},d,s),e.Lang.PushContext("common.time");const i=[],r=self.lang,n=self.langPluralSub;if(s.days){const e=Math.floor(t/86400);e>0&&(t-=24*e*3600,i.push(n(".days",null,e)))}if(s.hours){const e=Math.floor(t/3600);(e>0||i.length)&&(t-=3600*e,i.push(n(".hours",null,e)))}if(s.minutes){const e=Math.floor(t/60);(e>0||i.length||!s.seconds)&&(t-=60*e,i.push(n(".minutes",null,e)))}if(s.seconds){const e=Math.floor(t%60);i.push(n(".seconds",null,e))}const a=(s.approximate?r(".approx-prefix"):"")+i.join(r(".separator"));return e.Lang.PopContext(),a},e.ZeroPad=function(e,t){let s=e<0?"-":"",i=(e=Math.abs(e)).toString(),r=t-i.length;for(let e=0;e<r;++e)s+="0";return s+i},e.StringToTitleCase=function(e){return e.toLowerCase().replace(/\b\w/g,(e=>e.toUpperCase()))},e.CompareVersionStrings=function(t,s){let i=t.split(".").map((e=>e.trim())),r=s.split(".").map((e=>e.trim()));e.resizeArray(i,4,"0"),e.resizeArray(r,4,"0"),i=i.map((e=>parseInt(e,10))),r=r.map((e=>parseInt(e,10)));for(let e=0;e<4;++e){const t=i[e]-r[e];if(0!==t)return t<0?-1:1}return 0},e.CreateGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=Math.floor(16*Math.random());return("x"===e?t:3&t|8).toString(16)}))},e.StringHammingDistance=function(e,t){if(e.length!==t.length)throw new Error("strings must be same length");let s=0;for(let i=0,r=e.length;i<r;++i)e.charAt(i)!==t.charAt(i)&&++s;return s},e.StringLevenshteinDistance=function(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;let s,i,r,n,a,o;for(e.length>t.length&&(s=e,e=t,t=s),o=Array(e.length+1),i=0;i<=e.length;i++)o[i]=i;for(i=1;i<=t.length;i++){for(n=i,r=1;r<=e.length;r++)a=t[i-1]===e[r-1]?o[r-1]:Math.min(o[r-1]+1,Math.min(n+1,o[r]+1)),o[r-1]=n,n=a;o[e.length]=n}return o[e.length]}}{const e=self.C3,t=self.assert,s=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["sub","sub"],["sup","sup"],["small","small"],["mark","mark"],["code","code"],["a1","a"],["a2","a"],["a3","a"],["a4","a"],["a5","a"],["a6","a"],["a7","a"],["a8","a"],["a9","a"],["tip1","abbr"],["tip2","abbr"],["tip3","abbr"],["tip4","abbr"],["tip5","abbr"],["tip6","abbr"],["tip7","abbr"],["tip8","abbr"],["tip9","abbr"],["bad",["span","bbCodeBad"]],["good",["span","bbCodeGood"]],["info",["span","bbCodeInfo"]],["h1",["span","bbCodeH1"]],["h2",["span","bbCodeH2"]],["h3",["span","bbCodeH3"]],["h4",["span","bbCodeH4"]],["item",["span","bbCodeItem"]]]),i=/\[(\/?)([a-zA-Z0-9]+)\]/g,r=/\[(\/?)([^\[\n]*?)\]/g;let n=null,a=null,o=0;function bbToHtmlReplacerFunc(t,i,r){const h=s.get(r);if(!h)return"class"===r?i?"</span>":`<span class="bbclass${o++}">`:t;if("string"==typeof h){if("a"===h&&0===n.length||"abbr"===h&&0===a.length)return t;if("a"!==h||i){if("abbr"!==h||i)return"<"+i+h+">";{const t=parseInt(r.substring(3),10)-1;if(t<0||t>=a.length)throw new Error("invalid bbcode tip substitution");const s=a[t];let i="";if("string"==typeof s?i=s:"function"==typeof s&&(i=s()),"string"!=typeof i)throw new TypeError("invalid bbcode tip");return`<abbr title="${e.ReplaceAll(i,'"',"&quot;")}">`}}{const e=parseInt(r.substring(1),10)-1;if(e<0||e>=n.length)throw new Error("invalid bbcode link substitution");const t=n[e];if("string"==typeof t)return`<a href="${n[e]}">`;if("function"==typeof t)return`<a class="bblink${e}">`;throw new TypeError("invalid bbcode link action")}}if(Array.isArray(h)){let e=h[0],t=h[1];return i?"</"+e+">":`<${e} class="${t}">`}}const h=/\n/g;e.BBString=class{constructor(t,s){if(this._bbstr=s&&s.noEscape?t:e.EscapeHTML(t),this._htmlstr="",this._convertLineBreaks=!1,this._linkActions=[],this._tipList=[],s){if(this._convertLineBreaks=!!s.convertLineBreaks,s.links){if(s.links.length>9)throw new Error("too many links");this._linkActions=s.links}if(s.tips){if(s.tips.length>9)throw new Error("too many tips");this._tipList=s.tips}}this._hasAnyBBtags=this._bbstr.includes("["),this._needsLineBreakConversion=this._convertLineBreaks&&this._bbstr.includes("\n"),this._isPlain=!this._hasAnyBBtags&&!this._needsLineBreakConversion&&!this._bbstr.includes("&"),this._hasParsedFragments=!1,this._fragments=[]}toString(){return this._bbstr}valueOf(){return this._bbstr}isPlainText(){return this._isPlain}toPlainText(){return this._hasAnyBBtags?this._bbstr.replace(i,""):this._bbstr}toHTML(){if(this._isPlain)return this._bbstr;if(!this._htmlstr&&this._bbstr){let e=this._bbstr;this._hasAnyBBtags&&(o=0,n=this._linkActions,a=this._tipList,e=e.replace(i,bbToHtmlReplacerFunc),n=null,a=null),this._needsLineBreakConversion&&(e=e.replace(h,"<br>")),this._htmlstr=e}return this._htmlstr}attachLinkHandlers(e){if(this._linkActions.length)for(let t=0,s=this._linkActions.length;t<s;++t){const s=this._linkActions[t];if("function"!=typeof s)continue;const i=e.querySelector(".bblink"+t);if(!i)throw new Error("unable to attach BBString link handler");i.onclick=s}}equals(t){return t instanceof e.HtmlString?this.toHTML()===t.toHTML():t instanceof e.BBString?this._bbstr===t._bbstr:this._bbstr===t}toFragmentList(){if(this._hasParsedFragments)return this._fragments;const e=this._bbstr,t=[];r.lastIndex=0;let s=0,i=null;for(;null!==(i=r.exec(e));){const r=i.index;if(r>0&&"\\"===e.charAt(r-1))continue;const n=i[0],a=i[1],o=i[2],h=e.substring(s,r);if(s=r+n.length,h&&this._fragments.push({text:h,styles:t.slice(0)}),o)if(a){const e=o.toLowerCase();for(let s=t.length-1;s>=0;--s)if(t[s].tag===e){t.splice(s,1);break}}else{let e=o,s=null;const i=o.indexOf("=");-1!==i?(e=o.substring(0,i).toLowerCase(),s=o.substring(i+1)):e=e.toLowerCase(),t.push({tag:e,param:s})}}s<e.length&&this._fragments.push({text:e.substring(s),styles:t.slice(0)});for(const e of this._fragments)e.text=this._ProcessBBCodeEscapeSequences(e.text);return this._hasParsedFragments=!0,this._fragments}_ProcessBBCodeEscapeSequences(t){return t=e.ReplaceAll(t,"\\[","["),e.ReplaceAll(t,"\\\\","\\")}static StripTags(t){return e.New(e.BBString,t,{noEscape:!0}).toPlainText()}static StripAnyTags(e){return e.replace(r,"")}}}{const e=self.C3;function IsWordBreakWhiteSpace(t){return""!==t&&""!==t&&e.IsWhitespaceChar(t)}function WordBreakTrimEnd(e){for(;e.length>0&&IsWordBreakWhiteSpace(e.at(-1));)e.pop()}function IsNewline(e){return"\n"===e||"\r\n"===e}e.WordWrap=class{constructor(){this._lines=[]}GetLines(){return this._lines}GetLineCount(){return this._lines.length}_MeasureLine(e,t){let s=0,i=0,r=0,n=0,a=0;for(const o of e){if(-1===o.width){const e=t(o.chArr,o.styles);o.width=e.width,o.height=e.height,o.fontBoundingBoxAscent=e.fontBoundingBoxAscent||0,o.fontBoundingBoxDescent=e.fontBoundingBoxDescent||0,o.topToAlphabeticDistance=e.topToAlphabeticDistance||0}s+=o.width,i=Math.max(i,o.height),r=Math.max(r,o.fontBoundingBoxAscent),n=Math.max(n,o.fontBoundingBoxDescent),a=Math.max(a,o.topToAlphabeticDistance)}return{width:s,height:i,fontBoundingBoxAscent:r,fontBoundingBoxDescent:n,topToAlphabeticDistance:a}}_AddLine(e,t,s,i,r,n){this._lines.push({fragments:e,width:t,height:s,fontBoundingBoxAscent:i,fontBoundingBoxDescent:r,topToAlphabeticDistance:n})}WordWrap(t,s,i,r,n){if("string"==typeof t&&(t=[{text:t,styles:[]}]),e.clearArray(this._lines),!t.length||1===t.length&&!t[0].text.length||i<2)return;if(1===(t=t.map((t=>({chArr:e.SplitGraphemes(t.text),styles:t.styles})))).length){const e=t[0],r=e.chArr,a=e.styles;if(r.length<=100&&!r.includes("\n")){let{width:e,height:t,fontBoundingBoxAscent:o,fontBoundingBoxDescent:h,topToAlphabeticDistance:l}=s(r,a);if(e+=n,o=o||0,h=h||0,l=l||0,e<=i)return void this._AddLine([{chArr:r,styles:a,width:e,height:t,fontBoundingBoxAscent:o,fontBoundingBoxDescent:h,topToAlphabeticDistance:l}],e,t,o,h,l)}}let a;if("word"===r)a=this._TokeniseWords(t);else{a=[];for(const s of t)e.appendArray(a,s.chArr.map((e=>[{chArr:[e],styles:s.styles}])))}this._WrapText(a,s,i,n)}_TokeniseWords(e){const t=[];let s=[],i=!1;for(const r of e){const e=r.chArr,n=r.styles;for(const r of e)if(IsNewline(r))s.length>0&&t.push(s),t.push([{chArr:["\n"],styles:n}]),s=[];else if(0===s.length)s.push({chArr:[r],styles:n}),i=IsWordBreakWhiteSpace(r);else{const e=IsWordBreakWhiteSpace(r);if(e===i){const e=s.at(-1);e.styles===n?e.chArr.push(r):s.push({chArr:[r],styles:n})}else t.push(s),s=[],s.push({chArr:[r],styles:n}),i=e}}return s.length>0&&t.push(s),t}_CopyLine(e){return e.map((e=>({chArr:e.chArr.slice(0),styles:e.styles,width:e.width,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent,topToAlphabeticDistance:e.topToAlphabeticDistance})))}_AddWordToLine(t,s){const i=t.length?t.at(-1):null;let r=0;i&&s[0].styles===i.styles&&(e.appendArray(i.chArr,s[0].chArr),i.width=-1,i.height=-1,i.fontBoundingBoxAscent=-1,i.fontBoundingBoxDescent=-1,i.topToAlphabeticDistance=-1,r=1);for(let e=s.length;r<e;++r){const e=s[r];t.push({chArr:e.chArr.slice(0),styles:e.styles,width:-1,height:-1,fontBoundingBoxAscent:-1,fontBoundingBoxDescent:-1,topToAlphabeticDistance:-1})}}_WrapText(t,s,i,r){let n=[],a=0,o=0,h=0,l=0,c=0;for(const r of t){if(1===r.length&&1===r[0].chArr.length&&IsNewline(r[0].chArr[0])){if(0===o){const e=s([" "],r[0].styles);o=e.height,h=e.fontBoundingBoxAscent||0,l=e.fontBoundingBoxDescent||0,c=e.topToAlphabeticDistance||0}this._AddLine(n,a,o,h,l,c),n=[],a=0,o=0,h=0,l=0,c=0;continue}const t=this._CopyLine(n);this._AddWordToLine(t,r);const u=this._MeasureLine(t,s),_=u.width;if(_>=i)if(n.length>0&&this._AddLine(n,a,o,h,l,c),n=[],e.IsCharArrayAllWhitespace(r[0].chArr))a=0,o=0,h=0,l=0,c=0;else{this._AddWordToLine(n,r);const e=this._MeasureLine(n,s);a=e.width,o=e.height,h=e.fontBoundingBoxAscent,l=e.fontBoundingBoxDescent,c=e.topToAlphabeticDistance}else n=t,a=_,o=u.height,h=u.fontBoundingBoxAscent,l=u.fontBoundingBoxDescent,c=u.topToAlphabeticDistance}n.length>0&&this._AddLine(n,a,o,h,l,c),this._TrimLinesTrailingWhitespace(s,r)}_TrimLinesTrailingWhitespace(e,t){for(const s of this._lines){const i=s.fragments;if(!i.length)continue;let r=i.at(-1);const n=r.chArr,a=n.slice(0);if(WordBreakTrimEnd(a),0===a.length)s.width-=r.width,i.pop();else if(a.length<n.length){const t=e(a,r.styles).width,i=r.width-t;r.width=t,r.chArr=a,s.width-=i}0!==t&&i.length>0&&(r=i.at(-1),r.width+=t,s.width+=t)}}Clear(){e.clearArray(this._lines)}GetMaxLineWidth(){return this._lines.reduce(((e,t)=>Math.max(e,t.width)),0)}GetTotalLineHeight(){return this._lines.reduce(((e,t)=>e+t.height),0)}}}{const e=self.C3,t=self.glMatrix,s=t.vec3,i=t.vec4,r=t.mat4,n=s.create(),a=s.create(),o=s.create(),h=i.create(),l=r.create(),c=s.create(),u=s.create(),_=s.create(),d=s.create(),p=s.create(),f=s.create(),m=s.create(),g=s.create(),S=i.fromValues(0,0,1,1);function PlaneFromPoints(e,t,i,r){const h=o;s.subtract(n,i,t),s.subtract(a,e,t),s.cross(h,n,a),s.normalize(h,h),r.set(h[0],h[1],h[2],s.dot(e,h))}function IsInFrontOfPlane(e,t,s,i,r,n,a){const o=a.x,h=a.y,l=a.z,c=a.w,u=a.xF,_=a.yF,d=a.zF,p=1-u,f=1-_,m=1-d;if(o*e*u+o*i*p+h*t*_+h*r*f+l*s*d+l*n*m>=c)return!0;return o*i*u+o*e*p+h*r*_+h*t*f+l*n*d+l*s*m>c}function IsPointInFrontOfPlane(e,t,s,i){return i.x*e+i.y*t+i.z*s>=i.w}e.Gfx={Project(e,t,s,i,r,n,a){const o=i[0]*e+i[4]*t+i[8]*s+i[12],h=i[1]*e+i[5]*t+i[9]*s+i[13],l=i[2]*e+i[6]*t+i[10]*s+i[14],c=i[3]*e+i[7]*t+i[11]*s+i[15];let u=r[0]*o+r[4]*h+r[8]*l+r[12]*c,_=r[1]*o+r[5]*h+r[9]*l+r[13]*c,d=r[2]*o+r[6]*h+r[10]*l+r[14]*c,p=r[3]*o+r[7]*h+r[11]*l+r[15]*c;return 0!==p&&(p=1/p,u*=p,_*=p,d*=p,a[0]=(.5*u+.5)*n[2]+n[0],a[1]=(.5*_+.5)*n[3]+n[1],a[2]=.5*(1+d),!0)},Unproject(e,t,s,n,a,o,c){const u=l,_=h;return r.multiply(u,a,n),null!==r.invert(u,u)&&(_[0]=(e-o[0])/o[2]*2-1,_[1]=(t-o[1])/o[3]*2-1,_[2]=2*s-1,_[3]=1,i.transformMat4(_,_,u),0!==_[3]&&(_[3]=1/_[3],c[0]=_[0]*_[3],c[1]=_[1]*_[3],c[2]=_[2]*_[3],!0))},UnprojectScreenToWorldZ(t,i,r,h,l,c,u){const _=n,d=a;if(!e.Gfx.Unproject(t,i,0,h,l,c,_))return!1;if(!e.Gfx.Unproject(t,i,1,h,l,c,d))return!1;const p=a;s.subtract(p,d,_);const f=o;s.set(f,0,0,1);const m=-r,g=s.dot(f,p);let S=0;if(0===g){if(0!==s.dot(f,_)+m)return!1}else if(S=-(s.dot(_,f)+m)/g,S<0)return!1;return s.scaleAndAdd(u,_,p,S),!0}};class y{constructor(){this.x=NaN,this.y=NaN,this.z=NaN,this.w=NaN,this.xF=NaN,this.yF=NaN,this.zF=NaN}set(e,t,s,i){this.x=e,this.y=t,this.z=s,this.w=i,this.xF=e>0?1:0,this.yF=t>0?1:0,this.zF=s>0?1:0}}e.Gfx.ViewFrustum=class{constructor(){this._leftP=new y,this._topP=new y,this._rightP=new y,this._bottomP=new y,this._nearP=new y,this._farP=new y}CalculatePlanes(t,s){const i=S;e.Gfx.Unproject(0,1,0,t,s,i,c),e.Gfx.Unproject(1,1,0,t,s,i,u),e.Gfx.Unproject(0,0,0,t,s,i,_),e.Gfx.Unproject(1,0,0,t,s,i,d),e.Gfx.Unproject(0,1,1,t,s,i,p),e.Gfx.Unproject(1,1,1,t,s,i,f),e.Gfx.Unproject(0,0,1,t,s,i,m),e.Gfx.Unproject(1,0,1,t,s,i,g),PlaneFromPoints(_,c,p,this._leftP),PlaneFromPoints(c,u,f,this._topP),PlaneFromPoints(u,d,g,this._rightP),PlaneFromPoints(d,_,m,this._bottomP),PlaneFromPoints(m,p,f,this._farP),PlaneFromPoints(d,u,c,this._nearP)}ContainsAABB(e,t,s,i,r,n){return IsInFrontOfPlane(e,t,s,i,r,n,this._leftP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._topP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._rightP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._bottomP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._nearP)&&IsInFrontOfPlane(e,t,s,i,r,n,this._farP)}IsBehindNearPlane(e,t,s){return!IsPointInFrontOfPlane(e,t,s,this._nearP)}}}{const e=self.C3,t=self.glMatrix,s=t.vec3,i=t.vec4,r=t.mat4,n=r.create(),a=s.fromValues(0,0,0),o=s.fromValues(0,0,0),h=s.fromValues(0,0,0),l=s.fromValues(0,1,0),c=i.fromValues(0,0,0,0),u=new e.Quad,_=new e.Rect,d=new e.Quad(0,0,1,0,1,1,0,1),p={nearZ:1,farZ:1e4};e.Gfx.RendererBase=class{constructor(t){t=Object.assign({},p,t),this._width=0,this._height=0,this._fovY=e.toRadians(45),this._tan_fovY_2=Math.tan(this._fovY/2),this._matP=r.create(),this._matMV=r.create(),this._zAxisScale=!1,this._nearZ=t.nearZ,this._farZ=t.farZ,this._allShaderPrograms=[],this._shaderProgramsByName=new Map,this._spTextureFill=null,this._spPoints=null,this._spTilemapFill=null,this._spTileRandomization=null,this._spColorFill=null,this._spLinearGradientFill=null,this._spPenumbraFill=null,this._spHardEllipseFill=null,this._spHardEllipseOutline=null,this._spSmoothEllipseFill=null,this._spSmoothEllipseOutline=null,this._spSmoothLineFill=null,this._stateGroups=new Map,this._currentStateGroup=null,this._blendModeTable=[],this._namedBlendModeMap=new Map,this._baseZ=0,this._currentZ=0,this._lineWidth=1,this._lineWidthStack=[this._lineWidth],this._lineCap=1,this._lineCapStack=[this._lineCap],this._lineOffset=.5,this._lineOffsetStack=[this._lineOffset],this._frameNumber=0,this._enableMipmaps=!0,this._hasMajorPerformanceCaveat=!1}FillIndexBufferData(e){let t=0,s=e.length,i=0;for(;t<s;)e[t++]=i,e[t++]=i+1,e[t++]=i+2,e[t++]=i,e[t++]=i+2,e[t++]=i+3,i+=4}_ClearState(){this._baseZ=0,this._currentZ=0,this._spTextureFill=null,this._spPoints=null,this._spTilemapFill=null,this._spTileRandomization=null,this._spColorFill=null,this._spLinearGradientFill=null,this._spPenumbraFill=null,this._spHardEllipseFill=null,this._spHardEllipseOutline=null,this._spSmoothEllipseFill=null,this._spSmoothEllipseOutline=null,this._spSmoothLineFill=null,this._ClearAllShaderPrograms()}InitState(){this._ClearState(),this._currentStateGroup=null}OnDeviceOrContextLost(){for(const e of this._allShaderPrograms)e.Release();this._ClearState()}GetWidth(){return this._width}GetHeight(){return this._height}GetDefaultCameraZ(e){return this.IsZAxisScaleNormalized()?100:e/(2*this._GetTanFovYDiv2())}GetZAxisScaleFactor(e){if(this.IsZAxisScaleNormalized()){return e/(2*this._GetTanFovYDiv2())/this.GetDefaultCameraZ(e)}return 1}SetNearZ(e){this._nearZ=e}GetNearZ(){return this._nearZ}SetFarZ(e){this._farZ=e}GetFarZ(){return this._farZ}SetFovY(e){this._fovY=e,this._tan_fovY_2=Math.tan(this._fovY/2)}GetFovY(){return this._fovY}_GetTanFovYDiv2(){return this._tan_fovY_2}SetZAxisScaleNormalized(){this._zAxisScale=!1}SetZAxisScaleRegular(){this._zAxisScale=!0}IsZAxisScaleNormalized(){return!this._zAxisScale}IsZAxisScaleRegular(){return this._zAxisScale}CalculatePerspectiveMatrix(e,t,s=.5,i=.5){const n=this.GetNearZ(),a=this.GetFarZ(),o=this.GetFovY();if(.5===s&&.5===i)this.IsWebGPU()?r.perspectiveZO(e,o,t,n,a):r.perspective(e,o,t,n,a);else{const o=2*(s=1-s)-2,h=2*s,l=2*i-2,c=2*i,u=this._GetTanFovYDiv2()*n,_=u*t;r.frustum(e,o*_,h*_,l*u,c*u,n,a)}}CalculateOrthographicMatrix(e,t,s,i=1){const n=self.devicePixelRatio,a=2*this.GetDefaultCameraZ(s)*n*this._GetTanFovYDiv2()/s,o=t*a/(2*n*i),h=s*a/(2*n*i),l=-o,c=o,u=-h,_=h;this.IsWebGPU()?r.orthoZO(e,l,c,u,_,this.GetNearZ(),this.GetFarZ()):r.ortho(e,l,c,u,_,this.GetNearZ(),this.GetFarZ())}CalculateLookAtModelView(e,t,i,n,c,u=1){let _=1;this.IsZAxisScaleNormalized()&&(_=200*this._GetTanFovYDiv2()/c);const d=h;s.set(d,_,-_,1);const p=a,f=o;s.multiply(p,t,d),s.multiply(f,i,d),r.lookAt(e,p,f,n||l),d[2]=u,r.scale(e,e,d)}CalculateLookAtModelView2(e,t,i,r,h,c,u,_){return s.set(a,e,t,i),s.set(o,r,h,c),this.CalculateLookAtModelView(n,a,o,l,u,_),n}_AddShaderProgram(e){this._allShaderPrograms.push(e),this._shaderProgramsByName.set(e.GetName(),e)}_RemoveShaderProgram(e){const t=this._allShaderPrograms.indexOf(e);-1!==t&&this._allShaderPrograms.splice(t,1),this._shaderProgramsByName.delete(e.GetName())}_ClearAllShaderPrograms(){e.clearArray(this._allShaderPrograms),this._shaderProgramsByName.clear()}GetShaderProgramByName(e){return this._shaderProgramsByName.get(e)||null}GetTextureFillShaderProgram(){return this._spTextureFill}SetTextureFillMode(){this.SetProgram(this._spTextureFill)}GetPointsRenderingProgram(){return this._spPoints}SetPointsRenderingProgram(){this.SetProgram(this._spPoints)}SetTilemapFillMode(){this.SetProgram(this._spTilemapFill)}SetTileRandomizationMode(){this.SetProgram(this._spTileRandomization)}SetColorFillMode(){this.SetProgram(this._spColorFill)}SetLinearGradientFillMode(){this.SetProgram(this._spLinearGradientFill)}SetPenumbraFillMode(){this.SetProgram(this._spPenumbraFill)}SetHardEllipseFillMode(){this.SetProgram(this._spHardEllipseFill)}SetHardEllipseOutlineMode(){this.SetProgram(this._spHardEllipseOutline)}SetSmoothEllipseFillMode(){this.SetProgram(this._spSmoothEllipseFill)}SetSmoothEllipseOutlineMode(){this.SetProgram(this._spSmoothEllipseOutline)}SetSmoothLineFillMode(){this.SetProgram(this._spSmoothLineFill)}_SetCurrentStateGroup(e){this._currentStateGroup=e}GetCurrentStateGroup(){return this._currentStateGroup}AcquireStateGroup(t,s,i,r){const n=e.Gfx.StateGroup.MakeKey(t,s,i,r);let a=this._stateGroups.get(n);return a||(a=e.New(e.Gfx.StateGroup,this,t,s,i,r),this._stateGroups.set(n,a)),a.AddRef(),a}ReleaseStateGroup(e){e.DecRef(),0===e._GetRefCount()&&(this._currentStateGroup===e&&(this._currentStateGroup=null),this._stateGroups.delete(e.GetKey()),e.Release())}_InitBlendModeData(t){e.clearArray(this._blendModeTable),this._namedBlendModeMap.clear();let s=0;for(const e of t){const t=e[0],i=e[1],r=e[2];this._blendModeTable.push([i,r]),this._namedBlendModeMap.set(t,{number:s,srcBlend:i,destBlend:r}),s++}}_GetBlendByIndex(e){return this._blendModeTable[e]}GetSrcBlendByIndex(e){return this._GetBlendByIndex(e)[0]}GetDestBlendByIndex(e){return this._GetBlendByIndex(e)[1]}GetNamedBlend(e){const t=this._namedBlendModeMap.get(e);if(void 0===t)throw new Error("invalid blend name");return t}NamedBlendToNumber(e){const t=this._namedBlendModeMap.get(e);if(void 0===t)throw new Error("invalid blend name");return t.number}SetBaseZ(e){this._baseZ=e}GetBaseZ(){return this._baseZ}SetCurrentZ(e){this._currentZ=e,this._currentStateGroup=null}GetCurrentZ(){return this._currentZ}Line(t,s,i,r){const n=e.angleTo(t,s,i,r),a=Math.sin(n),o=Math.cos(n),h=.5*this._lineWidth,l=a*h,c=o*h,u=this._lineCap;2===u?this.LinePreCalc_LineCap2(t,s,0,i,r,0,l,c):1===u?this.LinePreCalc_LineCap1(t,s,0,i,r,0,l,c):this.LinePreCalc_LineCap0(t,s,0,i,r,0,l,c)}Line3D(t,s,i,r,n,a){const o=e.angleTo(t,s,r,n),h=Math.sin(o),l=Math.cos(o),c=.5*this._lineWidth,u=h*c,_=l*c,d=this._lineCap;2===d?this.LinePreCalc_LineCap2(t,s,i,r,n,a,u,_):1===d?this.LinePreCalc_LineCap1(t,s,i,r,n,a,u,_):this.LinePreCalc_LineCap0(t,s,i,r,n,a,u,_)}LinePreCalc_LineCap2(e,t,s,i,r,n,a,o){const h=this._lineOffset,l=e+h-o,c=t+h-a,u=i+h+o,_=r+h+a,p=2*o,f=2*a,m=l+a,g=c-o,S=l-a+p,y=c+o+f,G=u+a,I=_-o,T=u-a-p,b=_+o-f;this.Quad3D2(m,g,s,G,I,n,T,b,n,S,y,s,d)}LinePreCalc_LineCap1(e,t,s,i,r,n,a,o){const h=this._lineOffset,l=e+h-o,c=t+h-a,u=i+h+o,_=r+h+a,p=l+a,f=c-o,m=l-a,g=c+o,S=u+a,y=_-o,G=u-a,I=_+o;this.Quad3D2(p,f,s,S,y,n,G,I,n,m,g,s,d)}LinePreCalc_LineCap0(e,t,s,i,r,n,a,o){const h=this._lineOffset,l=e+h,c=t+h,u=i+h,_=r+h,p=l+a,f=c-o,m=l-a,g=c+o,S=u+a,y=_-o,G=u-a,I=_+o;this.Quad3D2(p,f,s,S,y,n,G,I,n,m,g,s,d)}TexturedLine(t,s,i,r,n,a){const o=e.angleTo(t,s,i,r),h=Math.sin(o),l=Math.cos(o),c=.5*this._lineWidth,u=h*c,_=l*c,d=this._lineCap;2===d?this.TexturedLinePreCalc_LineCap2(t,s,i,r,u,_,n,a):1===d?this.TexturedLinePreCalc_LineCap1(t,s,i,r,u,_,n,a):this.TexturedLinePreCalc_LineCap0(t,s,i,r,u,_,n,a)}TexturedLinePreCalc_LineCap2(e,t,s,i,r,n,a,o){const h=this._lineOffset,l=e+h-n,c=t+h-r,d=s+h+n,p=i+h+r,f=2*n,m=2*r,g=l+r,S=c-n,y=l-r+f,G=c+n+m,I=d+r,T=p-n,b=d-r-f,C=p+n-m;u.set(g,S,I,T,b,C,y,G),_.set(a,0,o,0),this.Quad3(u,_)}TexturedLinePreCalc_LineCap1(e,t,s,i,r,n,a,o){const h=this._lineOffset,l=e+h-n,c=t+h-r,d=s+h+n,p=i+h+r,f=l+r,m=c-n,g=l-r,S=c+n,y=d+r,G=p-n,I=d-r,T=p+n;u.set(f,m,y,G,I,T,g,S),_.set(a,0,o,0),this.Quad3(u,_)}TexturedLinePreCalc_LineCap0(e,t,s,i,r,n,a,o){const h=this._lineOffset,l=e+h,c=t+h,d=s+h,p=i+h,f=l+r,m=c-n,g=l-r,S=c+n,y=d+r,G=p-n,I=d-r,T=p+n;u.set(f,m,y,G,I,T,g,S),_.set(a,0,o,0),this.Quad3(u,_)}LineRect(e,t,s,i){const r=.5*this._lineWidth,n=this._lineCap;2===n?this._LineRectPreCalc_LineCap2(e,t,s,i,r):1===n?this._LineRectPreCalc_LineCap1(e,t,s,i,r):this._LineRectPreCalc_LineCap0(e,t,s,i,r)}_LineRectPreCalc_LineCap2(e,t,s,i,r){this.LinePreCalc_LineCap2(e,t,0,s,t,0,0,r),this.LinePreCalc_LineCap2(s,t,0,s,i,0,r,0),this.LinePreCalc_LineCap2(s,i,0,e,i,0,0,-r),this.LinePreCalc_LineCap2(e,i,0,e,t,0,-r,0)}_LineRectPreCalc_LineCap1(e,t,s,i,r){this.LinePreCalc_LineCap1(e,t,0,s,t,0,0,r),this.LinePreCalc_LineCap1(s,t,0,s,i,0,r,0),this.LinePreCalc_LineCap1(s,i,0,e,i,0,0,-r),this.LinePreCalc_LineCap1(e,i,0,e,t,0,-r,0)}_LineRectPreCalc_LineCap0(e,t,s,i,r){this.LinePreCalc_LineCap0(e,t,0,s,t,0,0,r),this.LinePreCalc_LineCap0(s,t,0,s,i,0,r,0),this.LinePreCalc_LineCap0(s,i,0,e,i,0,0,-r),this.LinePreCalc_LineCap0(e,i,0,e,t,0,-r,0)}LineRect2(e){this.LineRect(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}LineQuad(t){const s=e.angleTo(t.getTlx(),t.getTly(),t.getTrx(),t.getTry()),i=Math.sin(s),r=Math.cos(s),n=.5*this._lineWidth,a=i*n,o=r*n,h=this._lineCap;2===h?this._LineQuadPreCalc_LineCap2(t,a,o):1===h?this._LineQuadPreCalc_LineCap1(t,a,o):this._LineQuadPreCalc_LineCap0(t,a,o)}_LineQuadPreCalc_LineCap2(e,t,s){this.LinePreCalc_LineCap2(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap2(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap2(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap2(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}_LineQuadPreCalc_LineCap1(e,t,s){this.LinePreCalc_LineCap1(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap1(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap1(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap1(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}_LineQuadPreCalc_LineCap0(e,t,s){this.LinePreCalc_LineCap0(e.getTlx(),e.getTly(),0,e.getTrx(),e.getTry(),0,t,s),this.LinePreCalc_LineCap0(e.getTrx(),e.getTry(),0,e.getBrx(),e.getBry(),0,s,-t),this.LinePreCalc_LineCap0(e.getBrx(),e.getBry(),0,e.getBlx(),e.getBly(),0,-t,-s),this.LinePreCalc_LineCap0(e.getBlx(),e.getBly(),0,e.getTlx(),e.getTly(),0,-s,t)}SetLineWidth(e){this._lineWidth=e,this._lineWidthStack[this._lineWidthStack.length-1]=e}GetLineWidth(){return this._lineWidth}PushLineWidth(e){if(this._lineWidthStack.length>=100)throw new Error("pushed too many line widths - check push/pop pairs");this._lineWidthStack.push(e),this._lineWidth=e}PopLineWidth(){if(this._lineWidthStack.length<=1)throw new Error("cannot pop last line width - check push/pop pairs");this._lineWidthStack.pop(),this._lineWidth=this._lineWidthStack.at(-1)}SetLineCapButt(){this._lineCap=0,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapSquare(){this._lineCap=1,this._lineCapStack[this._lineCapStack.length-1]=0}SetLineCapZag(){this._lineCap=2,this._lineCapStack[this._lineCapStack.length-1]=0}PushLineCap(e){if("butt"===e)this.PushLineCapButt();else if("square"===e)this.PushLineCapSquare();else{if("zag"!==e)throw new Error("invalid line cap");this.PushLineCapZag()}}PushLineCapButt(){if(this._lineCapStack.length>=100)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(0),this._lineCap=0}PushLineCapSquare(){if(this._lineCapStack.length>=100)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(1),this._lineCap=1}PushLineCapZag(){if(this._lineCapStack.length>=100)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(2),this._lineCap=2}PopLineCap(){if(this._lineCapStack.length<=1)throw new Error("cannot pop last line cap - check push/pop pairs");this._lineCapStack.pop(),this._lineCap=this._lineCapStack.at(-1)}SetLineOffset(e){this._lineOffset=e,this._lineOffsetStack[this._lineOffsetStack.length-1]=e}GetLineOffset(){return this._lineOffset}PushLineOffset(e){if(this._lineOffsetStack.length>=100)throw new Error("pushed too many line offsets - check push/pop pairs");this._lineOffsetStack.push(e),this._lineOffset=e}PopLineOffset(){if(this._lineOffsetStack.length<=1)throw new Error("cannot pop last line offset - check push/pop pairs");this._lineOffsetStack.pop(),this._lineOffset=this._lineOffsetStack.at(-1)}ConvexPoly(e){const t=e.length/2;if(t<3)throw new Error("need at least 3 points");const s=t-2,i=s-1,r=e[0],n=e[1];for(let t=0;t<s;t+=2){const s=2*t,a=e[s+2],o=e[s+3],h=e[s+4],l=e[s+5];if(t===i)this.Quad2(r,n,a,o,h,l,h,l);else{const t=e[s+6],i=e[s+7];this.Quad2(r,n,a,o,h,l,t,i)}}}GetNumVertexComponents(){return 3}Finish(){this.EndBatch(!0),this._frameNumber++}GetFrameNumber(){return this._frameNumber}IncrementFrameNumber(){this._frameNumber++}SetMipmapsEnabled(e){this._enableMipmaps=!!e}AreMipmapsEnabled(){return this._enableMipmaps}SetHasMajorPerformanceCaveat(e){this._hasMajorPerformanceCaveat=!!e}HasMajorPerformanceCaveat(){return this._hasMajorPerformanceCaveat}IsWebGL(){return!1}IsWebGPU(){return!1}}}{const e=self.C3;e.Gfx.ShaderProgramBase=class{constructor(e,t,s){this._name=t,this._renderer=e,this._extendBoxHorizontal=s.extendBoxHorizontal||0,this._extendBoxVertical=s.extendBoxVertical||0,this._crossSampling=!!s.crossSampling,this._mustPreDraw=!!s.mustPreDraw,this._preservesOpaqueness=!!s.preservesOpaqueness,this._animated=!!s.animated,this._blendsBackground=!!s.blendsBackground,this._usesDepth=!!s.usesDepth,this._usesAnySrcRectOrPixelSize=!1,this._needsPostDrawOrExtendBox=this._crossSampling||this._blendsBackground||0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}Release(){this._renderer=null}GetRenderer(){return this._renderer}GetName(){return this._name}ExtendsBox(){return 0!==this._extendBoxHorizontal||0!==this._extendBoxVertical}GetBoxExtendHorizontal(){return this._extendBoxHorizontal}GetBoxExtendVertical(){return this._extendBoxVertical}UsesCrossSampling(){return this._crossSampling}MustPreDraw(){return this._mustPreDraw}PreservesOpaqueness(){return this._preservesOpaqueness}IsAnimated(){return this._animated}BlendsBackground(){return this._blendsBackground}UsesDepth(){return this._usesDepth}UsesAnySrcRectOrPixelSize(){return this._usesAnySrcRectOrPixelSize}NeedsPostDrawOrExtendsBox(){return this._needsPostDrawOrExtendBox}UsesIsSrcTexRotated(){return!1}}}{const e=self.C3;e.Gfx.StateGroup=class{constructor(t,s,i,r,n){this._renderer=t,this._refCount=0,this._shaderProgram=null,this._shaderProgramName="",this._blendMode=i,this._color=e.New(e.Color),this._color.set(r),this._zElevation=n,"string"==typeof s?this._shaderProgramName=s:(this._shaderProgram=s,this._shaderProgramName=this._shaderProgram.GetName())}Release(){if(this._refCount>0)throw new Error("releasing state group still in use");this._renderer=null,this._shaderProgram=null,this._shaderProgramName=""}Apply(){const e=this._renderer;e.SetProgram(this._shaderProgram),e.SetBlendMode(this._blendMode),e.SetColor(this._color),e.SetCurrentZ(this._zElevation),e._SetCurrentStateGroup(this)}GetKey(){return e.Gfx.StateGroup.MakeKey(this._shaderProgramName,this._blendMode,this._color,this._zElevation)}AddRef(){++this._refCount}DecRef(){--this._refCount}_GetRefCount(){return this._refCount}OnContextLost(){this._shaderProgram=null}OnContextRestored(e){if(this._shaderProgram=e.GetShaderProgramByName(this._shaderProgramName),!this._shaderProgram)throw new Error("failed to restore shader program")}static MakeKey(e,t,s,i){return("string"==typeof e?e:e.GetName())+","+t+","+s.getR()+","+s.getG()+","+s.getB()+","+s.getA()+","+i}}}{const e=self.C3,t=e.New(e.Quad);function interpolateQuad(e,t,s){const i=s.getTlx(),r=s.getTly(),n=s.getTrx()-i,a=s.getTry()-r;return[i+n*e+(s.getBlx()-i)*t,r+a*e+(s.getBly()-r)*t]}e.Gfx.MeshPoint=class{constructor(e,t,s){this._mesh=e,this._col=t,this._row=s,this._x=NaN,this._y=NaN,this._zElevation=NaN,this._u=NaN,this._v=NaN,this._x=0,this._y=0,this._zElevation=0,this._u=0,this._v=0}_Init(e,t,s,i){this._x=e,this._y=t,this._u=s,this._v=i}GetX(){return this._x}SetX(e){this._x!==e&&(this._x=e,this._mesh._SetPointsChanged())}GetY(){return this._y}SetY(e){this._y!==e&&(this._y=e,this._mesh._SetPointsChanged())}GetZElevation(){return this._zElevation}SetZElevation(e){this._zElevation!==e&&(this._zElevation=Math.max(e,0),this._mesh._SetPointsChanged())}GetU(){return this._u}SetU(e){this._u=e}GetV(){return this._v}SetV(e){this._v=e}_Interpolate_TexRect(t,s,i){[this._x,this._y]=interpolateQuad(t._x,t._y,s),this._zElevation=t._zElevation,this._u=e.lerp(i.getLeft(),i.getRight(),t._u),this._v=e.lerp(i.getTop(),i.getBottom(),t._v)}_Interpolate_TexQuad(e,t,s){[this._x,this._y]=interpolateQuad(e._x,e._y,t),this._zElevation=e._zElevation,[this._u,this._v]=interpolateQuad(e._u,e._v,s)}SaveToJson(){return{x:this.GetX(),y:this.GetY(),z:this.GetZElevation(),u:this.GetU(),v:this.GetV()}}LoadFromJson(e){this.SetX(e.x),this.SetY(e.y),e.hasOwnProperty("z")&&this.SetZElevation(e.z),this.SetU(e.u),this.SetV(e.v)}GetMesh(){return this._mesh}GetColumn(){return this._col}GetRow(){return this._row}},e.Gfx.Mesh=class{constructor(t,s,i){if(t<2||s<2)throw new Error("invalid mesh size");this._hsize=t,this._vsize=s,this._owner=i||null,this._pts=[],this._minX=0,this._minY=0,this._maxX=1,this._maxY=1,this._maxZ=0,this._pointsChanged=!1;const r=t-1,n=s-1;for(let i=0;i<s;++i){const s=[];for(let a=0;a<t;++a){const t=e.New(e.Gfx.MeshPoint,this,a,i),o=a/r,h=i/n;t._Init(o,h,o,h),s.push(t)}this._pts.push(s)}}Release(){e.clearArray(this._pts)}GetHSize(){return this._hsize}GetVSize(){return this._vsize}GetOwner(){return this._owner}_GetPoints(){return this._pts}_SetPointsChanged(){this._pointsChanged=!0}_MaybeComputeBounds(){if(!this._pointsChanged)return;let e=1/0,t=1/0,s=-1/0,i=-1/0,r=0;for(const n of this._pts)for(const a of n){const n=a.GetX(),o=a.GetY();e=Math.min(e,n),t=Math.min(t,o),s=Math.max(s,n),i=Math.max(i,o),r=Math.max(r,a.GetZElevation())}this._minX=e,this._minY=t,this._maxX=s,this._maxY=i,this._maxZ=r,this._pointsChanged=!1}GetMinX(){return this._MaybeComputeBounds(),this._minX}GetMinY(){return this._MaybeComputeBounds(),this._minY}GetMaxX(){return this._MaybeComputeBounds(),this._maxX}GetMaxY(){return this._MaybeComputeBounds(),this._maxY}GetMaxZ(){return this._MaybeComputeBounds(),this._maxZ}HasAnyZElevation(){return this.GetMaxZ()>0}GetMeshPointAt(e,t){return e=Math.floor(e),t=Math.floor(t),e<0||e>=this._hsize||t<0||t>=this._vsize?null:this._pts[t][e]}CalculateTransformedMesh(t,s,i){const r=i instanceof e.Rect;if(t.GetHSize()!==this.GetHSize()||t.GetVSize()!==this.GetVSize())throw new Error("source mesh wrong size");const n=t._pts,a=this._pts;for(let e=0,t=a.length;e<t;++e){const t=n[e],o=a[e];for(let e=0,n=o.length;e<n;++e){const n=t[e],a=o[e];r?a._Interpolate_TexRect(n,s,i):a._Interpolate_TexQuad(n,s,i)}}}Draw(e){const s=this._pts;let i=s[0];for(let r=1,n=s.length;r<n;++r){const n=s[r];let a=i[0],o=n[0];for(let s=1,r=n.length;s<r;++s){const r=i[s],h=n[s];t.set(a.GetU(),a.GetV(),r.GetU(),r.GetV(),h.GetU(),h.GetV(),o.GetU(),o.GetV()),e.Quad3D2(a.GetX(),a.GetY(),a.GetZElevation(),r.GetX(),r.GetY(),r.GetZElevation(),h.GetX(),h.GetY(),h.GetZElevation(),o.GetX(),o.GetY(),o.GetZElevation(),t),a=r,o=h}i=n}}Outline(e,t){t||(t=(e,t,s)=>[e,t,s]);const s=this._pts;let i=s[0];for(let r=1,n=s.length;r<n;++r){const a=s[r];let o=i[0],h=a[0];for(let s=1,l=a.length;s<l;++s){const c=i[s],u=a[s],[_,d,p]=t(o.GetX(),o.GetY(),o.GetZElevation()),[f,m,g]=t(c.GetX(),c.GetY(),c.GetZElevation()),[S,y,G]=t(u.GetX(),u.GetY(),u.GetZElevation()),[I,T,b]=t(h.GetX(),h.GetY(),h.GetZElevation());e.Line3D(_,d,p,f,m,g),e.Line3D(_,d,p,S,y,G),e.Line3D(_,d,p,I,T,b),s===l-1&&e.Line3D(f,m,g,S,y,G),r===n-1&&e.Line3D(I,T,b,S,y,G),o=c,h=u}i=a}}InsertPolyMeshVertices(t){const s=.001,i=.99999999,r=t.pointsArr(),n=[],a=this.GetHSize()-1,o=this.GetVSize()-1,h=1/a,l=1/o,c=a-1,u=o-1;let _=r[0],d=r[1],p=e.clamp(Math.floor(_*a),0,c),f=e.clamp(Math.floor(d*o),0,u),m=!0,g=0,S=0,y=0;let G=-1;const I=()=>{_=e.clamp(e.lerp(_,g,y),0,1),d=e.clamp(e.lerp(d,S,y),0,1),n.push(_,d)};for(let t=0,T=r.length;t<T;t+=2){_=r[t],d=r[t+1],n.push(_,d),p=e.clamp(Math.floor(_*a),0,c),f=e.clamp(Math.floor(d*o),0,u);const b=(t+2)%T;for(g=r[b],S=r[b+1],G=-1;;){if(n.length>1e6)throw new Error("Too many mesh poly points");const t=p*h,r=f*l,a=(p+1)*h,o=(f+1)*l;if(m=e.isPointInTriangleInclusive(_,d,t,r,a,r,a,o),0!==G&&(y=e.rayIntersectExtended(_,d,g,S,t,r,a,o,-.001),y>=0&&y<=i))I(),m=!m,G=0;else if(f>0&&2!==G&&(y=e.rayIntersectExtended(_,d,g,S,t,r,a,r,s),y>=0&&y<=i))I(),f--,m=!1,G=4;else if(p<c&&3!==G&&(y=e.rayIntersectExtended(_,d,g,S,a,r,a,o,s),y>=0&&y<=i))I(),p++,m=!1,G=1;else if(p>0&&1!==G&&(y=e.rayIntersectExtended(_,d,g,S,t,r,t,o,s),y>=0&&y<=i))I(),p--,m=!0,G=3;else{if(!(f<u&&4!==G&&(y=e.rayIntersectExtended(_,d,g,S,t,o,a,o,s),y>=0&&y<=i)))break;I(),f++,m=!0,G=2}}}return e.New(e.CollisionPoly,n)}TransformCollisionPoly(e,t){const s=this._TransformPolyPoints(e);this._SimplifyPoly(s),t.setPoints(s)}_TransformPolyPoints(e){const t=[],s=e.pointsArr();for(let e=0,i=s.length;e<i;e+=2){const i=s[e],r=s[e+1],[n,a]=this.TransformPoint(i,r);t.push(n,a)}return t}TransformPoint(t,s){const i=this.GetHSize()-1,r=this.GetVSize()-1,n=1/i,a=1/r,o=e.clamp(Math.floor(t*i),0,i-1),h=e.clamp(Math.floor(s*r),0,r-1),l=o*n,c=h*a,u=(o+1)*n,_=(h+1)*a,d=this.GetMeshPointAt(o,h),p=this.GetMeshPointAt(o+1,h+1),f=e.isPointInTriangleInclusive(t,s,l,c,u,c,u,_),m=f?l+n:l,g=f?c:c+a,S=this.GetMeshPointAt(o+(f?1:0),h+(f?0:1)),[y,G,I]=e.triangleCartesianToBarycentric(t,s,l,c,m,g,u,_);return e.triangleBarycentricToCartesian(y,G,I,d.GetX(),d.GetY(),S.GetX(),S.GetY(),p.GetX(),p.GetY())}_SimplifyPoly(t){const s=[],i=1e-7;let r=t[0],n=t[1],a=r-t.at(-2),o=n-t.at(-1);for(let e=0,h=t.length;e<h;e+=2){const l=(e+2)%h,c=t[l],u=t[l+1],_=c-r,d=u-n,p=Math.abs(_)<i&&Math.abs(a)<i&&Math.sign(d)===Math.sign(o),f=Math.abs(d)<i&&Math.abs(o)<i&&Math.sign(_)===Math.sign(a);(!p&&!f&&Math.abs(_/a-d/o)>.001||0==_&&0===d)&&s.push(r,n),r=c,n=u,a=_,o=d}s.length>=6&&s.length<t.length&&e.shallowAssignArray(t,s)}SaveToJson(){return{cols:this.GetHSize(),rows:this.GetVSize(),points:this._pts.map((e=>e.map((e=>e.SaveToJson()))))}}LoadFromJson(e){const t=this.GetHSize(),s=this.GetVSize();if(e.cols!==t||e.rows!==s)throw new Error("mesh data wrong size");const i=e.points;for(let e=0;e<s;++e){const s=i[e];for(let i=0;i<t;++i){this.GetMeshPointAt(i,e).LoadFromJson(s[i])}}}}}{const e=self.C3,t=new Set(["rgba8","rgb8","rgba4","rgb5_a1","rgb565"]),s=new Set(["nearest","bilinear","trilinear"]),i=new Set(["default","low","high"]),r=new Set(["clamp-to-edge","repeat","mirror-repeat"]);function GetFormatSpecifiers(e,t){let s,i,r,n;switch(e){case"rgba8":s=t.RGBA8,i=t.RGBA,r=t.RGBA,n=t.UNSIGNED_BYTE;break;case"rgb8":s=t.RGB8,i=t.RGB,r=t.RGB,n=t.UNSIGNED_BYTE;break;case"rgba4":s=t.RGBA4,i=t.RGBA,r=t.RGBA,n=t.UNSIGNED_SHORT_4_4_4_4;break;case"rgb5_a1":s=t.RGB5_A1,i=t.RGBA,r=t.RGBA,n=t.UNSIGNED_SHORT_5_5_5_1;break;case"rgb565":s=t.RGB565,i=t.RGB,r=t.RGB,n=t.UNSIGNED_SHORT_5_6_5;break;default:throw new Error("invalid pixel format")}return{sizedinternalformat:s,internalformat:i,format:r,type:n}}const n={wrapX:"clamp-to-edge",wrapY:"clamp-to-edge",sampling:"trilinear",anisotropy:0,pixelFormat:"rgba8",mipMap:!0,mipMapQuality:"default",premultiplyAlpha:!0,isSvg:!1,width:-1,height:-1},a={premultiplyAlpha:!0,flipY:!1},o=new Set;e.Gfx.WebGLRendererTexture=class{constructor(e){this._renderer=e,this._texture=null,this._width=0,this._height=0,this._isStatic=!0,this._wrapX="clamp-to-edge",this._wrapY="clamp-to-edge",this._sampling="trilinear",this._anisotropy=0,this._pixelFormat="rgba8",this._isMipMapped=!1,this._mipMapQuality="default",this._refCount=0}_CreateStatic(a,h){if(!("undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&a instanceof OffscreenCanvas||a instanceof ImageData||a instanceof ArrayBuffer||null===a))throw new Error("invalid texture source");if(h=Object.assign({},n,h),this._texture)throw new Error("already created texture");if(this._wrapX=h.wrapX,this._wrapY=h.wrapY,this._sampling=h.sampling,this._anisotropy=h.anisotropy,this._pixelFormat=h.pixelFormat,this._isMipMapped=!!h.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=h.mipMapQuality,!r.has(this._wrapX)||!r.has(this._wrapY))throw new Error("invalid wrap mode");if(!s.has(this._sampling))throw new Error("invalid sampling");if(!t.has(this._pixelFormat))throw new Error("invalid pixel format");if(!i.has(this._mipMapQuality))throw new Error("invalid mipmap quality");if(this._isStatic=!0,a instanceof ArrayBuffer||null===a||h.isSvg){if(this._width=h.width,this._height=h.height,a instanceof ArrayBuffer&&a.byteLength!==this._width*this._height*4)throw new Error("ArrayBuffer wrong size")}else this._width=a.width,this._height=a.height;if(this._width<=0||this._height<=0)throw new Error("invalid texture data size");if(h.isSvg){const t=e.CreateCanvas(this._width,this._height);t.getContext("2d").drawImage(a,0,0,this._width,this._height),a=t}const l=e.isPOT(this._width)&&e.isPOT(this._height),c=this._renderer.GetMaxTextureSize();if(this._width>c||this._height>c)throw new Error("texture data exceeds maximum texture size");const u=this._renderer.GetContext(),_=this._renderer.GetWebGLVersionNumber();this._texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this._texture),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h.premultiplyAlpha),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!1);const d=GetFormatSpecifiers(this._pixelFormat,u);if(this._renderer.SupportsNPOTTextures()||l||!this._IsTiled())if(_>=2){let e;e=this._isMipMapped?Math.floor(Math.log2(Math.max(this._width,this._height))+1):1,u.texStorage2D(u.TEXTURE_2D,e,d.sizedinternalformat,this._width,this._height),a instanceof ArrayBuffer?u.texSubImage2D(u.TEXTURE_2D,0,0,0,this._width,this._height,d.format,d.type,new Uint8Array(a)):null!==a&&u.texSubImage2D(u.TEXTURE_2D,0,0,0,d.format,d.type,a)}else a instanceof ArrayBuffer?u.texImage2D(u.TEXTURE_2D,0,d.internalformat,this._width,this._height,0,d.format,d.type,new Uint8Array(a)):null===a?u.texImage2D(u.TEXTURE_2D,0,d.internalformat,this._width,this._height,0,d.format,d.type,null):u.texImage2D(u.TEXTURE_2D,0,d.internalformat,d.format,d.type,a);else{if(null===a)throw new Error("cannot pass null data when creating a NPOT tiled texture without NPOT support");if(a instanceof ArrayBuffer&&(a=new ImageData(new Uint8ClampedArray(a),this._width,this._height)),a instanceof ImageData){const t=e.CreateCanvas(this._width,this._height);t.getContext("2d").putImageData(a,0,0),a=t}const t=e.CreateCanvas(e.nextHighestPowerOfTwo(this._width),e.nextHighestPowerOfTwo(this._height)),s=t.getContext("2d");s.imageSmoothingEnabled="nearest"!==this._sampling,s.drawImage(a,0,0,this._width,this._height,0,0,t.width,t.height),u.texImage2D(u.TEXTURE_2D,0,d.internalformat,d.format,d.type,t)}null!==a&&this._SetTextureParameters(u),u.bindTexture(u.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,o.add(this)}_CreateDynamic(a,h,l){if(l=Object.assign({},n,l),this._texture)throw new Error("already created texture");if(this._wrapX=l.wrapX,this._wrapY=l.wrapY,this._sampling=l.sampling,this._pixelFormat=l.pixelFormat,this._isMipMapped=!!l.mipMap&&this._renderer.AreMipmapsEnabled(),this._mipMapQuality=l.mipMapQuality,!r.has(this._wrapX)||!r.has(this._wrapY))throw new Error("invalid wrap mode");if(!s.has(this._sampling))throw new Error("invalid sampling");if(!t.has(this._pixelFormat))throw new Error("invalid pixel format");if(!i.has(this._mipMapQuality))throw new Error("invalid mipmap quality");this._isStatic=!1,this._width=Math.floor(a),this._height=Math.floor(h);const c=e.isPOT(this._width)&&e.isPOT(this._height),u=this._renderer.GetMaxTextureSize();if(this._width<=0||this._height<=0)throw new Error("invalid texture size");if(this._width>u||this._height>u)throw new Error("texture exceeds maximum texture size");if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!c)throw new Error("non-power-of-two tiled textures not supported");const _=this._renderer.GetContext(),d=this._renderer.GetWebGLVersionNumber();this._texture=_.createTexture(),_.bindTexture(_.TEXTURE_2D,this._texture),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l.premultiplyAlpha),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,!1);const p=GetFormatSpecifiers(this._pixelFormat,_),f=d>=2?p.sizedinternalformat:p.internalformat;_.texImage2D(_.TEXTURE_2D,0,f,this._width,this._height,0,p.format,p.type,null),this._SetTextureParameters(_),_.bindTexture(_.TEXTURE_2D,null),this._renderer._ResetLastTexture(),this._refCount=1,o.add(this)}_GetMipMapHint(e){if("default"===this._mipMapQuality)return this._isStatic?e.NICEST:e.FASTEST;if("low"===this._mipMapQuality)return e.FASTEST;if("high"===this._mipMapQuality)return e.NICEST;throw new Error("invalid mipmap quality")}_IsTiled(){return"clamp-to-edge"!==this._wrapX||"clamp-to-edge"!==this._wrapY}_GetTextureWrapMode(e,t){if("clamp-to-edge"===t)return e.CLAMP_TO_EDGE;if("repeat"===t)return e.REPEAT;if("mirror-repeat"===t)return e.MIRRORED_REPEAT;throw new Error("invalid wrap mode")}_SetTextureParameters(t){const s=e.isPOT(this._width)&&e.isPOT(this._height);if(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._GetTextureWrapMode(t,this._wrapX)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._GetTextureWrapMode(t,this._wrapY)),"nearest"===this._sampling)t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),this._isMipMapped=!1;else if(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),(s||this._renderer.SupportsNPOTTextures())&&this._isMipMapped){t.hint(t.GENERATE_MIPMAP_HINT,this._GetMipMapHint(t)),t.generateMipmap(t.TEXTURE_2D);const e="trilinear"===this._sampling&&!this._renderer.HasMajorPerformanceCaveat();t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.LINEAR_MIPMAP_NEAREST)}else t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),this._isMipMapped=!1;const i=this._renderer._GetAnisotropicExtension();i&&this._anisotropy>0&&"nearest"!==this._sampling&&t.texParameterf(t.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this._anisotropy,this._renderer._GetMaxAnisotropy()))}_Update(t,s){if(!("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||t instanceof ImageData))throw new Error("invalid texture source");if(!this._texture||this._refCount<=0)throw new Error("texture not created");if(this._isStatic)throw new Error("cannot update static texture");s=Object.assign({},a,s);const i=t.width||t.videoWidth,r=t.height||t.videoHeight,n=this._renderer.GetWebGLVersionNumber(),o=this._renderer.GetContext();o.bindTexture(o.TEXTURE_2D,this._texture),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!!s.flipY);const h=GetFormatSpecifiers(this._pixelFormat,o),l=n>=2?h.sizedinternalformat:h.internalformat;try{if(this._width===i&&this._height===r){const s=e.isPOT(this._width)&&e.isPOT(this._height);o.texSubImage2D(o.TEXTURE_2D,0,0,0,h.format,h.type,t),(s||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(o.hint(o.GENERATE_MIPMAP_HINT,this._GetMipMapHint(o)),o.generateMipmap(o.TEXTURE_2D))}else{this._width=i,this._height=r;const s=e.isPOT(this._width)&&e.isPOT(this._height);if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!s)throw new Error("non-power-of-two tiled textures not supported");o.texImage2D(o.TEXTURE_2D,0,l,h.format,h.type,t),(s||this._renderer.SupportsNPOTTextures())&&this._isMipMapped&&(o.hint(o.GENERATE_MIPMAP_HINT,this._GetMipMapHint(o)),o.generateMipmap(o.TEXTURE_2D))}}catch(e){}o.bindTexture(o.TEXTURE_2D,null),this._renderer._ResetLastTexture()}_Delete(){if(this._refCount>0)throw new Error("texture still has references");if(!this._texture)throw new Error("already deleted texture");o.delete(this);this._renderer.GetContext().deleteTexture(this._texture),this._texture=null}IsValid(){return!!this._texture}_GetTexture(){return this._texture}GetRenderer(){return this._renderer}AddReference(){this._refCount++}SubtractReference(){if(this._refCount<=0)throw new Error("no more references");this._refCount--}GetReferenceCount(){return this._refCount}GetWidth(){return this._width}GetHeight(){return this._height}IsStatic(){return this._isStatic}GetEstimatedMemoryUsage(){let e=this._width*this._height;switch(this._pixelFormat){case"rgba8":e*=4;break;case"rgb8":e*=3;break;case"rgba4":case"rgb5_a1":case"rgb565":e*=2;break}return this._isMipMapped&&(e+=Math.floor(e/3)),e}static OnContextLost(){o.clear()}static allTextures(){return o.values()}}}{const e=self.C3,t=self.assert,s=self.glMatrix,i=s.vec3,r=s.mat4,n=new Set(["nearest","bilinear","trilinear"]),a={sampling:"trilinear",alpha:!0,depth:!1,isSampled:!0,isDefaultSize:!0,multisampling:0},o=new Set;e.Gfx.WebGLRenderTarget=class{constructor(e){this._renderer=e,this._frameBuffer=null,this._frameBufferNoDepth=null,this._texture=null,this._renderBuffer=null,this._width=0,this._height=0,this._isDefaultSize=!0,this._sampling="trilinear",this._alpha=!0,this._depth=!1,this._isSampled=!0,this._multisampling=0,this._projectionMatrix=r.create(),this._lastFov=0,this._lastNearZ=0,this._lastFarZ=0}_Create(e,t,s){s=Object.assign({},a,s);const i=this._renderer.GetWebGLVersionNumber();if(this._texture||this._renderBuffer)throw new Error("already created render target");if(this._sampling=s.sampling,this._alpha=!!s.alpha,this._depth=!!s.depth,this._isSampled=!!s.isSampled,this._isDefaultSize=!!s.isDefaultSize,this._multisampling=s.multisampling,!n.has(this._sampling))throw new Error("invalid sampling");if(this._multisampling>0&&(i<2||this._isSampled))throw new Error("invalid use of multisampling");if(i<2&&(this._isSampled=!0),this._width=e,this._height=t,this._width<=0||this._height<=0)throw new Error("invalid render target size");this._CalculateProjection();const r=this._renderer.GetContext();if(this._frameBuffer=r.createFramebuffer(),this._depth&&(this._frameBufferNoDepth=r.createFramebuffer()),this._isSampled){this._texture=this._renderer.CreateDynamicTexture(this._width,this._height,{sampling:this._sampling,pixelFormat:this._alpha?"rgba8":"rgb8",mipMap:!1});const e=this._texture._GetTexture();r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this._depth&&(r.bindFramebuffer(r.FRAMEBUFFER,this._frameBufferNoDepth),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0))}else{this._renderBuffer=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,this._renderBuffer);const e=this._alpha?r.RGBA8:r.RGB8;if(this._multisampling>0){const t=r.getInternalformatParameter(r.RENDERBUFFER,e,r.SAMPLES);if(t&&t[0]){const e=t[0];this._multisampling>e&&(this._multisampling=e)}else this._multisampling=0}0===this._multisampling?r.renderbufferStorage(r.RENDERBUFFER,e,this._width,this._height):r.renderbufferStorageMultisample(r.RENDERBUFFER,this._multisampling,e,this._width,this._height),r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,this._renderBuffer),this._depth&&(r.bindFramebuffer(r.FRAMEBUFFER,this._frameBufferNoDepth),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,this._renderBuffer)),r.bindRenderbuffer(r.RENDERBUFFER,null)}const h=this._renderer._GetDepthBuffer();this._depth&&h&&(r.bindFramebuffer(r.FRAMEBUFFER,this._frameBuffer),this._renderer._CanSampleDepth()?r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,h,0):r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,h)),r.bindFramebuffer(r.FRAMEBUFFER,null),o.add(this)}_Resize(e,t){if(this._width===e&&this._height===t)return;this._width=e,this._height=t,this._CalculateProjection();const s=this._renderer.GetContext();s.bindFramebuffer(s.FRAMEBUFFER,this._frameBuffer),this._texture?this._texture._Update(new ImageData(this._width,this._height)):(s.bindRenderbuffer(s.RENDERBUFFER,this._renderBuffer),s.renderbufferStorage(s.RENDERBUFFER,this._alpha?s.RGBA8:s.RGB8,this._width,this._height),s.bindRenderbuffer(s.RENDERBUFFER,null));const i=this._renderer._GetDepthBuffer();this._depth&&i&&(this._renderer._CanSampleDepth()?s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,i,0):s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,i)),s.bindFramebuffer(s.FRAMEBUFFER,null)}_Delete(){if(!this._texture&&!this._renderBuffer)throw new Error("already deleted render target");o.delete(this);const e=this._renderer.GetContext();this._texture?(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)),this._renderer.DeleteTexture(this._texture),this._texture=null):this._renderBuffer&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null),this._depth&&(e.bindFramebuffer(e.FRAMEBUFFER,this._frameBufferNoDepth),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null)),e.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null),e.bindFramebuffer(e.FRAMEBUFFER,null),this._renderer.GetWebGLVersionNumber()>=2&&(e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)),e.deleteFramebuffer(this._frameBuffer),this._depth&&e.deleteFramebuffer(this._frameBufferNoDepth);const t=this._renderer.GetBatchState();t.currentFramebuffer=null,t.currentFramebufferNoDepth=null,this._frameBuffer=null}_CalculateProjection(){this._renderer.CalculatePerspectiveMatrix(this._projectionMatrix,this._width/this._height),this._lastFov=this._renderer.GetFovY(),this._lastNearZ=this._renderer.GetNearZ(),this._lastFarZ=this._renderer.GetFarZ()}_GetFramebuffer(){return this._frameBuffer}_GetFramebufferNoDepth(){return this._frameBufferNoDepth}GetRenderer(){return this._renderer}GetTexture(){return this._texture}GetProjectionMatrix(){return this._renderer.GetFovY()===this._lastFov&&this._renderer.GetNearZ()===this._lastNearZ&&this._renderer.GetFarZ()===this._lastFarZ||this._CalculateProjection(),this._projectionMatrix}IsLinearSampling(){return"nearest"!==this._sampling}HasAlpha(){return this._alpha}IsSampled(){return this._isSampled}HasDepthBuffer(){return this._depth}GetWidth(){return this._width}GetHeight(){return this._height}IsDefaultSize(){return this._isDefaultSize}GetMultisampling(){return this._multisampling}GetOptions(){const e={sampling:this._sampling,alpha:this._alpha,isSampled:this._isSampled};return this._isDefaultSize||(e.width=this._width,e.height=this._height),e}IsCompatibleWithOptions(e){return"nearest"!==(e=Object.assign({},a,e)).sampling===this.IsLinearSampling()&&(!!e.alpha===this.HasAlpha()&&(!!e.depth===this.HasDepthBuffer()&&(!(this._renderer.GetWebGLVersionNumber()>=2&&!!e.isSampled!==this.IsSampled())&&("number"==typeof e.width||"number"==typeof e.height?!this.IsDefaultSize()&&this.GetWidth()===e.width&&this.GetHeight()===e.height:this.IsDefaultSize()))))}_GetWebGLTexture(){return this._texture?this._texture._GetTexture():null}GetEstimatedMemoryUsage(){return this._texture?this._texture.GetEstimatedMemoryUsage():this._width*this._height*(this._alpha?4:3)}static async DebugReadPixelsToBlob(t,s){const i=await t.ReadBackRenderTargetToImageData(s,!0);return await e.ImageDataToBlob(i)}static OnContextLost(){o.clear()}static allRenderTargets(){return o.values()}static ResizeAll(e,t){for(const s of o)s.IsDefaultSize()&&s._Resize(e,t)}}}{const e=self.C3,t=self.glMatrix,s=t.vec3,i=t.mat4,r=new Set(["aPos","aTex","aPoints","matP","matMV","samplerFront","samplerBack","samplerDepth","destStart","destEnd","srcStart","srcEnd","srcOriginStart","srcOriginEnd","pixelSize","seconds","devicePixelRatio","layerScale","layerAngle","layoutStart","layoutEnd","color","color2_","pointTexStart","pointTexEnd","zElevation","tileSize","tileSpacing","outlineThickness","zNear","zFar"]);e.Gfx.WebGLShaderProgram=class extends e.Gfx.ShaderProgramBase{static async Compile(t,s,i,r){const n=t.GetContext(),a=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(a,s),n.compileShader(a);const o=n.createShader(n.VERTEX_SHADER);n.shaderSource(o,i),n.compileShader(o);const h=n.createProgram();n.attachShader(h,a),n.attachShader(h,o),n.bindAttribLocation(h,0,"aPos"),n.bindAttribLocation(h,1,"aTex"),n.bindAttribLocation(h,2,"aPoints"),n.linkProgram(h);const l=t._GetParallelShaderCompileExtension();if(l?await t._WaitForObjectReady((()=>n.getProgramParameter(h,l.COMPLETION_STATUS_KHR))):await e.Wait(5),!n.getShaderParameter(a,n.COMPILE_STATUS)){const e=n.getShaderInfoLog(a);throw n.deleteShader(a),n.deleteShader(o),n.deleteProgram(h),new Error("Error compiling fragment shader: "+e)}if(!n.getShaderParameter(o,n.COMPILE_STATUS)){const e=n.getShaderInfoLog(o);throw n.deleteShader(a),n.deleteShader(o),n.deleteProgram(h),new Error("Error compiling vertex shader: "+e)}if(!n.getProgramParameter(h,n.LINK_STATUS)){const e=n.getProgramInfoLog(h);throw n.deleteShader(a),n.deleteShader(o),n.deleteProgram(h),new Error("Error linking shader program: "+e)}const c=e.FilterUnprintableChars(n.getProgramInfoLog(h)||"").trim();return c&&e.IsStringAllWhitespace(c),n.deleteShader(a),n.deleteShader(o),h}static async Create(t,s,i,r){const n=await e.Gfx.WebGLShaderProgram.Compile(t,s.src,i,r);return new e.Gfx.WebGLShaderProgram(t,n,s,r)}constructor(t,s,i,r){super(t,r,i);const n=t.GetContext(),a=t.GetBatchState();t.EndBatch(),n.useProgram(s),this._gl=n,this._shaderProgram=s,this._isDeviceTransform="<default-device-transform>"===r;const o=n.getAttribLocation(s,"aPos"),h=n.getAttribLocation(s,"aTex");this._locAPoints=n.getAttribLocation(s,"aPoints"),-1!==o&&(n.bindBuffer(n.ARRAY_BUFFER,t._vertexBuffer),n.vertexAttribPointer(o,t.GetNumVertexComponents(),n.FLOAT,!1,0,0),n.enableVertexAttribArray(o)),-1!==h&&(n.bindBuffer(n.ARRAY_BUFFER,t._texcoordBuffer),n.vertexAttribPointer(h,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(h)),-1!==this._locAPoints&&(n.bindBuffer(n.ARRAY_BUFFER,t._pointBuffer),n.vertexAttribPointer(this._locAPoints,4,n.FLOAT,!1,0,0),n.enableVertexAttribArray(this._locAPoints)),n.bindBuffer(n.ARRAY_BUFFER,null),this._uMatP=new e.Gfx.WebGLShaderUniform(this,"matP","mat4"),this._uMatMV=new e.Gfx.WebGLShaderUniform(this,"matMV","mat4"),this._uColor=new e.Gfx.WebGLShaderUniform(this,"color","vec4"),this._uSamplerFront=new e.Gfx.WebGLShaderUniform(this,"samplerFront","sampler"),this._uPointTexStart=new e.Gfx.WebGLShaderUniform(this,"pointTexStart","vec2"),this._uPointTexEnd=new e.Gfx.WebGLShaderUniform(this,"pointTexEnd","vec2"),this._uZElevation=new e.Gfx.WebGLShaderUniform(this,"zElevation","float"),this._uTileSize=new e.Gfx.WebGLShaderUniform(this,"tileSize","vec2"),this._uTileSpacing=new e.Gfx.WebGLShaderUniform(this,"tileSpacing","vec2"),this._uColor2=new e.Gfx.WebGLShaderUniform(this,"color2_","vec4"),this._uOutlineThickness=new e.Gfx.WebGLShaderUniform(this,"outlineThickness","float"),this._uSamplerBack=new e.Gfx.WebGLShaderUniform(this,"samplerBack","sampler"),this._uSamplerDepth=new e.Gfx.WebGLShaderUniform(this,"samplerDepth","sampler"),this._uDestStart=new e.Gfx.WebGLShaderUniform(this,"destStart","vec2"),this._uDestEnd=new e.Gfx.WebGLShaderUniform(this,"destEnd","vec2"),this._uSrcStart=new e.Gfx.WebGLShaderUniform(this,"srcStart","vec2"),this._uSrcEnd=new e.Gfx.WebGLShaderUniform(this,"srcEnd","vec2"),this._uSrcOriginStart=new e.Gfx.WebGLShaderUniform(this,"srcOriginStart","vec2"),this._uSrcOriginEnd=new e.Gfx.WebGLShaderUniform(this,"srcOriginEnd","vec2"),this._uPixelSize=new e.Gfx.WebGLShaderUniform(this,"pixelSize","vec2"),this._uSeconds=new e.Gfx.WebGLShaderUniform(this,"seconds","float"),this._uDevicePixelRatio=new e.Gfx.WebGLShaderUniform(this,"devicePixelRatio","float"),this._uLayerScale=new e.Gfx.WebGLShaderUniform(this,"layerScale","float"),this._uLayerAngle=new e.Gfx.WebGLShaderUniform(this,"layerAngle","float"),this._uLayoutStart=new e.Gfx.WebGLShaderUniform(this,"layoutStart","vec2"),this._uLayoutEnd=new e.Gfx.WebGLShaderUniform(this,"layoutEnd","vec2"),this._uZNear=new e.Gfx.WebGLShaderUniform(this,"zNear","float"),this._uZFar=new e.Gfx.WebGLShaderUniform(this,"zFar","float"),this._hasAnyOptionalUniforms=!!(this._uPixelSize.IsUsed()||this._uSeconds.IsUsed()||this._uSamplerBack.IsUsed()||this._uDestStart.IsUsed()||this._uDestEnd.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed()||this._uDevicePixelRatio.IsUsed()||this._uLayerScale.IsUsed()||this._uLayerAngle.IsUsed()||this._uLayoutStart.IsUsed()||this._uLayoutEnd.IsUsed());const l=i.parameters||[];this._uCustomParameters=[],this._usesAnySrcRectOrPixelSize=this._uPixelSize.IsUsed()||this._uSrcStart.IsUsed()||this._uSrcEnd.IsUsed()||this._uSrcOriginStart.IsUsed()||this._uSrcOriginEnd.IsUsed(),this._hasCurrentMatP=!1,this._hasCurrentMatMV=!1,this._uColor.Init4f(1,1,1,1),this._uColor2.Init4f(1,1,1,1),this._uSamplerFront.Init1i(0),this._uSamplerBack.Init1i(1),this._uSamplerDepth.Init1i(2),this._uPointTexStart.Init2f(0,0),this._uPointTexEnd.Init2f(1,1),this._uZElevation.Init1f(0),this._uTileSize.Init2f(0,0),this._uTileSpacing.Init2f(0,0),this._uDestStart.Init2f(0,0),this._uDestEnd.Init2f(1,1),this._uSrcStart.Init2f(0,0),this._uSrcEnd.Init2f(0,0),this._uSrcOriginStart.Init2f(0,0),this._uSrcOriginEnd.Init2f(0,0),this._uPixelSize.Init2f(0,0),this._uDevicePixelRatio.Init1f(1),this._uZNear.Init1f(t.GetNearZ()),this._uZFar.Init1f(t.GetFarZ()),this._uLayerScale.Init1f(1),this._uLayerAngle.Init1f(0),this._uSeconds.Init1f(0),this._uLayoutStart.Init2f(0,0),this._uLayoutEnd.Init2f(0,0),this._uOutlineThickness.Init1f(1);for(const t of l){const s=t[0],i=t[2],r=new e.Gfx.WebGLShaderUniform(this,s,i);"color"===i?r.Init3f(0,0,0):r.Init1f(0),this._uCustomParameters.push(r)}this._isDeviceTransform?this._UpdateDeviceTransformUniforms(a.currentMatP):(this.UpdateMatP(a.currentMatP,!0),this.UpdateMatMV(a.currentMV,!0));const c=a.currentShader;n.useProgram(c?c._shaderProgram:null)}Release(){this._gl.deleteProgram(this._shaderProgram),this._shaderProgram=null,this._renderer._RemoveShaderProgram(this),this._gl=null,super.Release()}GetWebGLContext(){return this._gl}GetShaderProgram(){return this._shaderProgram}GetParameterCount(){return this._uCustomParameters.length}GetParameterType(e){return e<0||e>=this._uCustomParameters.length?null:this._uCustomParameters[e].GetType()}AreCustomParametersAlreadySetInBatch(e){for(let t=0,s=e.length;t<s;++t)if(!this._uCustomParameters[t].IsSetToCustomInBatch(e[t]))return!1;return!0}SetCustomParametersInBatch(e){for(let t=0,s=e.length;t<s;++t)this._uCustomParameters[t].SetBatchValueCustom(e[t])}AreOptionalUniformsAlreadySetInBatch(e,t,s,i,r,n,a,o,h,l){return!this._uSamplerBack.IsUsed()&&(!(this._uPixelSize.IsUsed()&&!this._uPixelSize.IsSetTo2InBatch(r,n))&&(!(this._uDestStart.IsUsed()&&!this._uDestStart.IsSetTo2InBatch(e.getLeft(),e.getTop()))&&(!(this._uDestEnd.IsUsed()&&!this._uDestEnd.IsSetTo2InBatch(e.getRight(),e.getBottom()))&&(!(this._uDevicePixelRatio.IsUsed()&&!this._uDevicePixelRatio.IsSetTo1InBatch(a))&&(!(this._uLayerScale.IsUsed()&&!this._uLayerScale.IsSetTo1InBatch(o))&&(!(this._uLayerAngle.IsUsed()&&!this._uLayerAngle.IsSetTo1InBatch(h))&&(!(this._uSrcStart.IsUsed()&&!this._uSrcStart.IsSetTo2InBatch(t.getLeft(),t.getTop()))&&(!(this._uSrcEnd.IsUsed()&&!this._uSrcEnd.IsSetTo2InBatch(t.getRight(),t.getBottom()))&&(!(this._uSrcOriginStart.IsUsed()&&!this._uSrcOriginStart.IsSetTo2InBatch(s.getLeft(),s.getTop()))&&(!(this._uSrcOriginEnd.IsUsed()&&!this._uSrcOriginEnd.IsSetTo2InBatch(s.getRight(),s.getBottom()))&&(!(this._uLayoutStart.IsUsed()&&!this._uLayoutStart.IsSetTo2InBatch(i.getLeft(),i.getTop()))&&(!(this._uLayoutEnd.IsUsed()&&!this._uLayoutEnd.IsSetTo2InBatch(i.getTop(),i.getBottom()))&&!(this._uSeconds.IsUsed()&&!this._uSeconds.IsSetTo1InBatch(l))))))))))))))}SetOptionalUniformsInBatch(e,t,s,i,r,n,a,o,h,l){this._uSamplerBack.IsUsed()||(this._uPixelSize.IsUsed()&&this._uPixelSize.SetBatch2(r,n),this._uDestStart.IsUsed()&&this._uDestStart.SetBatch2(e.getLeft(),e.getTop()),this._uDestEnd.IsUsed()&&this._uDestEnd.SetBatch2(e.getRight(),e.getBottom()),this._uDevicePixelRatio.IsUsed()&&this._uDevicePixelRatio.SetBatch1(a),this._uLayerScale.IsUsed()&&this._uLayerScale.SetBatch1(o),this._uLayerAngle.IsUsed()&&this._uLayerAngle.SetBatch1(h),this._uSrcStart.IsUsed()&&this._uSrcStart.SetBatch2(t.getLeft(),t.getTop()),this._uSrcEnd.IsUsed()&&this._uSrcEnd.SetBatch2(t.getRight(),t.getBottom()),this._uSrcOriginStart.IsUsed()&&this._uSrcOriginStart.SetBatch2(s.getLeft(),s.getTop()),this._uSrcOriginEnd.IsUsed()&&this._uSrcOriginEnd.SetBatch2(s.getRight(),s.getBottom()),this._uLayoutStart.IsUsed()&&this._uLayoutStart.SetBatch2(i.getLeft(),i.getTop()),this._uLayoutEnd.IsUsed()&&this._uLayoutEnd.SetBatch2(i.getTop(),i.getBottom()),this._uSeconds.IsUsed()&&this._uSeconds.SetBatch1(l))}UpdateMatP(e,t){this._hasCurrentMatP&&!t||this._isDeviceTransform||(this._uMatP.IsUsed()&&this._uMatP.UpdateMatrix4fv(e),this._hasCurrentMatP=!0)}SetMatPStale(){this._hasCurrentMatP=!1}UpdateMatMV(e,t){this._hasCurrentMatMV&&!t||this._isDeviceTransform||(this._uMatMV.IsUsed()&&this._uMatMV.UpdateMatrix4fv(e),this._hasCurrentMatMV=!0)}SetMatMVStale(){this._hasCurrentMatMV=!1}_UpdateDeviceTransformUniforms(e){if(!this._isDeviceTransform)throw new Error("not device transform shader");this._uMatP.UpdateMatrix4fv(e);const t=this._renderer,s=t.GetWidth()/2,i=t.GetHeight()/2,r=t.CalculateLookAtModelView2(s,i,t.GetDefaultCameraZ(t.GetHeight()),s,i,0,t.GetHeight());this._uMatMV.UpdateMatrix4fv(r)}UpdateColor(e){this._uColor.IsUsed()&&this._uColor.Update4f(e[0],e[1],e[2],e[3])}static GetReservedUniformNames(){return r}static GetDefaultVertexShaderSource(e){const t=e?"highmedp":"mediump";return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","attribute highp vec3 aPos;",`attribute ${t} vec2 aTex;`,`varying ${t} vec2 vTex;`,"uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos, 1.0);","\tvTex = aTex;","}"].join("\n")}static GetDefaultVertexShaderSource_WebGL2(e){const t=e?"highp":"mediump";return["#version 300 es","in highp vec3 aPos;",`in ${t} vec2 aTex;`,`out ${t} vec2 vTex;`,"uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos, 1.0);","\tvTex = aTex;","}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTextureFillFragmentShaderSource_WebGL2(){return["#version 300 es","in mediump vec2 vTex;","out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\toutColor = texture(samplerFront, vTex) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(){return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);","\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);","\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTilemapFragmentShaderSource_WebGL2(){return["#version 300 es","in highp vec2 vTex;","out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highp vec2 srcStart;","uniform highp vec2 pixelSize;","uniform highp vec2 tileSize;","uniform highp vec2 tileSpacing;","void main(void) {","\thighp vec2 tile = floor(vTex);","\thighp vec2 tex = fract(vTex);","\thighp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\toutColor = texture(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetTileRandomizationFragmentShaderSource(e,t,s){let i="";return e>=2?i="#version 300 es\n":(t&&(i="#extension GL_EXT_frag_depth : enable\n"),s&&(i+="#extension GL_EXT_shader_texture_lod : enable\n",i+="#extension GL_OES_standard_derivatives : enable\n")),i+`\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision highmedp float;\n${e>=2?"in":"varying"} vec2 vTex;\n${e>=2?"out lowp vec4 outColor;":""}\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform vec2 pixelSize;\n\nuniform vec2 tileSize;\nuniform vec2 tileSpacing;\nuniform float outlineThickness;\n\nconst float PI = 3.1415926;\n\nlowp vec4 cospVec4(lowp vec4 a, lowp vec4 b, float x)\n{\n\treturn (a + b + (a - b) * cos(x * PI)) / 2.0;\n}\n\nvec3 randVec3(vec2 seed)\n{\n\treturn vec3(fract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(12.9898,78.233))) * 43758.5453),\n\t\t\t\tfract(sin(dot(seed.yx + vec2(0.1, 0.1), vec2(12.9898,-78.233))) * 43758.5453),\n\t\t\t\tfract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(-12.9898,-78.233))) * 43758.5453));\n}\n\nlowp vec4 sampleTile(vec2 tile, vec2 uv, vec2 ddx, vec2 ddy)\n{\n\tvec2 posRandom = tileSize;\n\tfloat angleRandom = outlineThickness;\n\t\n\tvec3 rand = (randVec3(floor(tile + 0.5)) - 0.5) * 2.0;\n\t\n\tfloat angle = angleRandom * rand.z * PI;\n\tfloat sin_a = sin(angle);\n\tfloat cos_a = cos(angle);\n\tfloat aspect = pixelSize.x / pixelSize.y;\n\n\tvec2 mid = tile + vec2(0.5, 0.5);\n\tvec2 dp = uv - mid;\n\tdp.x /= aspect;\n\tvec2 r = vec2(dp.x * cos_a - dp.y * sin_a,\n\t\t\t\t  dp.y * cos_a + dp.x * sin_a);\n\tr.x *= aspect;\n\n\tvec2 p = mid + r + (posRandom * rand.xy / 2.0);\n\t\n\t${e>=2?"return textureGrad(samplerFront, p, ddx, ddy);":""}\n\t${e<2&&s?"return texture2DGradEXT(samplerFront, p, ddx, ddy);":""}\n\t${e<2&&!s?"return texture2D(samplerFront, p);":""}\n}\n\nvoid main(void) {\n\t\n\t${e<2?"lowp vec4 outColor;":""}\n\t\n\tfloat blendMarginX = tileSpacing.x;\n\tfloat blendMarginY = tileSpacing.y;\n\t\n\tvec2 tile = floor(vTex);\n\tvec2 tex = fract(vTex);\n\tvec2 ddx = ${e>=2||s?"dFdx(vTex)":"vec2(0.0, 0.0)"};\n\tvec2 ddy = ${e>=2||s?"dFdy(vTex)":"vec2(0.0, 0.0)"};\n\t\n\tvec4 curTile = sampleTile(tile, vTex, ddx, ddy);\n\t\n\tbool inLeftMargin = (tex.x < blendMarginX);\n\tbool inRightMargin = (tex.x > 1.0 - blendMarginX);\n\tbool inTopMargin = (tex.y < blendMarginY);\n\tbool inBottomMargin = (tex.y > 1.0 - blendMarginY);\n\t\n\tif (inLeftMargin)\n\t{\n\t\tlowp vec4 leftTile = sampleTile(tile + vec2(-1.0, 0.0), vTex, ddx, ddy);\n\t\tfloat leftMix = (tex.x / (blendMarginX * 2.0)) + 0.5;\n\t\tlowp vec4 leftMixedTile = cospVec4(leftTile, curTile, leftMix);\n\t\t\n\t\tif (inTopMargin)\n\t\t{\n\t\t\tlowp vec4 topTile =     sampleTile(tile + vec2(0.0,  -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topLeftTile = sampleTile(tile + vec2(-1.0, -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topLeftMixedTile = cospVec4(topLeftTile, topTile, leftMix);\n\t\t\t\n\t\t\toutColor = cospVec4(topLeftMixedTile, leftMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);\n\t\t}\n\t\telse if (inBottomMargin)\n\t\t{\n\t\t\tlowp vec4 bottomTile =     sampleTile(tile + vec2(0.0,  1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomLeftTile = sampleTile(tile + vec2(-1.0, 1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomLeftMixedTile = cospVec4(bottomLeftTile, bottomTile, leftMix);\n\t\t\t\n\t\t\toutColor = cospVec4(leftMixedTile, bottomLeftMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));\n\t\t}\n\t\telse\n\t\t{\n\t\t\toutColor = leftMixedTile;\n\t\t}\n\t}\n\telse if (inRightMargin)\n\t{\n\t\tlowp vec4 rightTile = sampleTile(tile + vec2(1.0, 0.0), vTex, ddx, ddy);\n\t\tfloat rightMix = (tex.x - (1.0 - blendMarginX)) / (blendMarginX * 2.0);\n\t\tlowp vec4 rightMixedTile = cospVec4(curTile, rightTile, rightMix);\n\t\t\n\t\tif (inTopMargin)\n\t\t{\n\t\t\tlowp vec4 topTile =      sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topRightTile = sampleTile(tile + vec2(1.0, -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topRightMixedTile = cospVec4(topTile, topRightTile, rightMix);\n\t\t\t\n\t\t\toutColor = cospVec4(topRightMixedTile, rightMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);\n\t\t}\n\t\telse if (inBottomMargin)\n\t\t{\n\t\t\tlowp vec4 bottomTile =      sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomRightTile = sampleTile(tile + vec2(1.0, 1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomRightMixedTile = cospVec4(bottomTile, bottomRightTile, rightMix);\n\t\t\t\n\t\t\toutColor = cospVec4(rightMixedTile, bottomRightMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));\n\t\t}\n\t\telse\n\t\t{\n\t\t\toutColor = rightMixedTile;\n\t\t}\n\t}\n\telse if (inTopMargin)\n\t{\n\t\tlowp vec4 topTile = sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);\n\t\toutColor = cospVec4(topTile, curTile, (tex.y / (blendMarginY * 2.0)) + 0.5);\n\t}\n\telse if (inBottomMargin)\n\t{\n\t\tlowp vec4 bottomTile = sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);\n\t\toutColor = cospVec4(curTile, bottomTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));\n\t}\n\telse\n\t{\n\t\toutColor = curTile;\n\t}\n\t\n\toutColor *= color;\n\t${e<2?"gl_FragColor = outColor;":""}\n\t${e>=2?"gl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}\n\t${e<2&&t?"gl_FragDepthEXT = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":""}\n}\n`}static GetPointVertexShaderSource_WebGL1(){return["attribute vec4 aPoints;","varying float pointOpacity;","uniform float zElevation;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n")}static GetPointVertexShaderSource_WebGL2(){return["#version 300 es","in vec4 aPoints;","out float pointOpacity;","uniform float zElevation;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n")}static GetPointFragmentShaderSource_WebGL1_NoFragDepth(){return["uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, mix(pointTexStart, pointTexEnd, gl_PointCoord)) * color * pointOpacity;","}"].join("\n")}static GetPointFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, mix(pointTexStart, pointTexEnd, gl_PointCoord)) * color * pointOpacity;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetPointFragmentShaderSource_WebGL2(){return["#version 300 es","uniform lowp sampler2D samplerFront;","in lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","out lowp vec4 outColor;","void main(void) {","\toutColor = texture(samplerFront, mix(pointTexStart, pointTexEnd, gl_PointCoord)) * color * pointOpacity;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n")}static GetColorFillFragmentShaderSource(){return["uniform lowp vec4 color;","void main(void) {","\tgl_FragColor = color;","}"].join("\n")}static GetLinearGradientFillFragmentShaderSource(){return["precision lowp float;","varying mediump vec2 vTex;","uniform vec4 color;","uniform vec4 color2_;","vec3 fromLinear(vec3 linearRGB)","{","\tbvec3 cutoff = lessThan(linearRGB, vec3(0.0031308));","\tvec3 higher = vec3(1.055) * pow(abs(linearRGB), vec3(1.0/2.4)) - vec3(0.055);","\tvec3 lower = linearRGB * vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","vec3 toLinear(vec3 sRGB)","{","\tbvec3 cutoff = lessThan(sRGB, vec3(0.04045));","\tvec3 higher = pow(abs((sRGB + vec3(0.055))/vec3(1.055)), vec3(2.4));","\tvec3 lower = sRGB/vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","void main(void) {","\tvec3 linearGrad = mix(toLinear(color.rgb), toLinear(color2_.rgb), vTex.x);","\tfloat a = mix(color.a, color2_.a, vTex.x);","\tgl_FragColor = vec4(fromLinear(linearGrad) * a, a);","}"].join("\n")}static GetPenumbraFillFragmentShaderSource(){return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","precision lowp float;","varying highmedp vec2 vTex;","uniform vec4 color;","void main(void) {","\thighmedp float grad = vTex.x / (1.0 - vTex.y);","\tgl_FragColor = color * (1.0 - (cos(grad * 3.141592653589793) + 1.0) / 2.0);","}"].join("\n")}static GetSmoothLineFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tlowp float f = 1.0 - abs(vTex.y - 0.5) * 2.0;","\tgl_FragColor = color * f;","}"].join("\n")}static GetHardEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float f = step(diffSq.x + diffSq.y, 0.25);","\tgl_FragColor = color * f;","}"].join("\n")}static GetHardEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump float innerF = step(distSq, 0.25);","\tmediump vec2 innerEdge = halfNorm - pixelSize * norm * outlineThickness;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float outerF = step(innerEdgeSq.x + innerEdgeSq.y, distSq);","\tgl_FragColor = color * innerF * outerF;","}"].join("\n")}static GetSmoothEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 innerEdge = halfNorm - pixelSize * norm;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float f = smoothstep(halfNormSq.x + halfNormSq.y, innerEdgeSq.x + innerEdgeSq.y, diffSq.x + diffSq.y);","\tgl_FragColor = color * f;","}"].join("\n")}static GetSmoothEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 pxNorm = pixelSize * norm;","\tmediump vec2 innerEdge1 = halfNorm - pxNorm;","\tmediump vec2 innerEdge1Sq = innerEdge1 * innerEdge1;","\tmediump float innerF = smoothstep(halfNormSq.x + halfNormSq.y, innerEdge1Sq.x + innerEdge1Sq.y, distSq);","\tmediump vec2 innerEdge2 = halfNorm - pxNorm * outlineThickness;","\tmediump vec2 innerEdge2Sq = innerEdge2 * innerEdge2;","\tmediump vec2 innerEdge3 = halfNorm - pxNorm * (outlineThickness + 1.0);","\tmediump vec2 innerEdge3Sq = innerEdge3 * innerEdge3;","\tmediump float outerF = smoothstep(innerEdge3Sq.x + innerEdge3Sq.y, innerEdge2Sq.x + innerEdge2Sq.y, distSq);","\tgl_FragColor = color * innerF * outerF;","}"].join("\n")}}}{const e=self.C3,t=self.glMatrix,s=t.mat4,i=new Map([["float",1],["percent",1],["sampler",1],["vec2",2],["vec3",3],["color",3],["vec4",4],["mat4",16]]);e.Gfx.WebGLShaderUniform=class{constructor(e,t,s){if(!i.has(s))throw new Error("invalid uniform type");this._owner=e,this._gl=this._owner.GetWebGLContext(),this._name=t,this._type=s,this._isColorType="color"===this._type,this._location=this._gl.getUniformLocation(this._owner.GetShaderProgram(),t),this._isUsed=!!this._location;const r=i.get(s);this._lastValue=new Float32Array(r),this._lastBatchValue=new Float32Array(r)}Release(){this._owner=null,this._gl=null,this._location=null}IsUsed(){return this._isUsed}GetType(){return this._type}IsColorType(){return this._isColorType}Init1f(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1f(this._location,e))}Init1i(e){this.IsUsed()&&(this._lastValue[0]=e,this._lastBatchValue.set(this._lastValue),this._gl.uniform1i(this._location,e))}Init2f(e,t){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastBatchValue.set(this._lastValue),this._gl.uniform2f(this._location,e,t))}Init3f(e,t,s){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=s,this._lastBatchValue.set(this._lastValue),this._gl.uniform3f(this._location,e,t,s))}Init4f(e,t,s,i){this.IsUsed()&&(this._lastValue[0]=e,this._lastValue[1]=t,this._lastValue[2]=s,this._lastValue[3]=i,this._lastBatchValue.set(this._lastValue),this._gl.uniform4f(this._location,e,t,s,i))}Update1f(e){e=Math.fround(e);const t=this._lastValue;t[0]!==e&&(t[0]=e,this._gl.uniform1f(this._location,e))}Update1i(e){const t=this._lastValue;t[0]!==e&&(t[0]=e,this._gl.uniform1i(this._location,e))}Update2f(e,t){e=Math.fround(e),t=Math.fround(t);const s=this._lastValue;s[0]===e&&s[1]===t||(s[0]=e,s[1]=t,this._gl.uniform2f(this._location,e,t))}Update3f(e,t,s){e=Math.fround(e),t=Math.fround(t),s=Math.fround(s);const i=this._lastValue;i[0]===e&&i[1]===t&&i[2]===s||(i[0]=e,i[1]=t,i[2]=s,this._gl.uniform3f(this._location,e,t,s))}Update4f(e,t,s,i){e=Math.fround(e),t=Math.fround(t),s=Math.fround(s),i=Math.fround(i);const r=this._lastValue;r[0]===e&&r[1]===t&&r[2]===s&&r[3]===i||(r[0]=e,r[1]=t,r[2]=s,r[3]=i,this._gl.uniform4f(this._location,e,t,s,i))}UpdateMatrix4fv(t){const i=this._lastValue;s.exactEquals(i,t)||(e.typedArraySet16(i,t,0),this._gl.uniformMatrix4fv(this._location,!1,t))}IsSetToCustomInBatch(e){const t=this._lastBatchValue;return this.IsColorType()?t[0]===Math.fround(e.getR())&&t[1]===Math.fround(e.getG())&&t[2]===Math.fround(e.getB()):t[0]===Math.fround(e)}SetBatchValueCustom(e){const t=this._lastBatchValue;this.IsColorType()?(t[0]=e.getR(),t[1]=e.getG(),t[2]=e.getB()):t[0]=e}IsSetTo1InBatch(e){return this._lastBatchValue[0]===Math.fround(e)}IsSetTo2InBatch(e,t){const s=this._lastBatchValue;return s[0]===Math.fround(e)&&s[1]===Math.fround(t)}SetBatch1(e){this._lastBatchValue[0]=e}SetBatch2(e,t){const s=this._lastBatchValue;s[0]=e,s[1]=t}}}{const e=self.C3,t=self.glMatrix,s=t.vec4,i=t.mat4,r=0,n=1,a=2,o=3,h=4,l=5,c=6,u=7,_=8,d=9,p=10,f=11,m=12,g=13,S=14,y=15,G=16,I=17,T=18,b=19,C=20,P=21,v=22,x=23,R=24,w=25,A=26,M=27,D=28,E=29;e.Gfx.BatchState=class{constructor(t){this.renderer=t,this.currentMV=i.create(),this.currentMatP=i.create(),this.currentFramebuffer=null,this.currentFramebufferNoDepth=null,this.isDepthSamplingEnabled=!1,this.currentColor=s.fromValues(1,1,1,1),this.currentShader=null,this.pointTexCoords=new e.Rect,this.clearColor=e.New(e.Color,0,0,0,0)}},e.Gfx.WebGLBatchJob=class{constructor(e){const t=new ArrayBuffer(96);this._type=0,this._batchState=e,this._gl=e.renderer.GetContext(),this._startIndex=0,this._indexCount=0,this._texParam=null,this._mat4param=new Float32Array(t,0,16),this._colorParam=new Float32Array(t,64,4),this._srcOriginRect=new Float32Array(t,80,4),this._shaderParams=[]}InitQuad(e,t){this._type=n,this._startIndex=e,this._indexCount=t}DoQuad(){const e=this._gl;e.drawElements(e.TRIANGLES,this._indexCount,e.UNSIGNED_SHORT,this._startIndex)}InitSetTexture(e){this._type=a,this._texParam=e}DoSetTexture(){const e=this._gl,t=this._texParam;e.bindTexture(e.TEXTURE_2D,t?t._GetTexture():null)}InitSetColor(e){this._type=o,e.writeToTypedArray(this._colorParam,0)}DoSetColor(){const e=this._colorParam,t=this._batchState;s.copy(t.currentColor,e),t.currentShader.UpdateColor(e)}InitSetGradientColor(e){this._type=P,e.writeToTypedArray(this._colorParam,0)}DoSetGradientColor(){const e=this._colorParam,t=this._batchState.currentShader;t._uColor2.IsUsed()&&t._uColor2.Update4f(e[0],e[1],e[2],e[3])}InitSetBlend(e,t){this._type=h,this._startIndex=e,this._indexCount=t}DoSetBlend(){this._gl.blendFunc(this._startIndex,this._indexCount)}InitSetViewport(e,t,s,i){this._type=l;const r=this._colorParam;r[0]=e,r[1]=t,r[2]=s,r[3]=i}DoSetViewport(){const e=this._colorParam;this._gl.viewport(e[0],e[1],e[2],e[3])}InitSetProjection(e){this._type=c,i.copy(this._mat4param,e)}DoSetProjection(){const e=this._batchState,t=e.renderer._allShaderPrograms,s=e.currentShader,r=this._mat4param;for(let e=0,i=t.length;e<i;++e){const i=t[e];i===s?i.UpdateMatP(r,!0):i.SetMatPStale()}i.copy(e.currentMatP,r)}InitSetModelView(e){this._type=u,i.copy(this._mat4param,e)}DoSetModelView(){const e=this._batchState,t=e.renderer._allShaderPrograms,s=e.currentShader,r=this._mat4param;for(let e=0,i=t.length;e<i;++e){const i=t[e];i===s?i.UpdateMatMV(r,!0):i.SetMatMVStale()}i.copy(e.currentMV,r)}InitSetRenderTarget(e){this._type=_,this._texParam=e}DoSetRenderTarget(){const e=this._gl,t=this._texParam,s=this._batchState;t?(s.currentFramebuffer=t._GetFramebuffer(),s.currentFramebufferNoDepth=t._GetFramebufferNoDepth(),s.isDepthSamplingEnabled&&s.currentFramebufferNoDepth?e.bindFramebuffer(e.FRAMEBUFFER,s.currentFramebufferNoDepth):e.bindFramebuffer(e.FRAMEBUFFER,s.currentFramebuffer)):(s.currentFramebuffer=null,s.currentFramebufferNoDepth=null,e.bindFramebuffer(e.FRAMEBUFFER,null))}InitClearSurface(e){this._type=d,e.writeToTypedArray(this._mat4param,0)}InitClearSurface2(e,t,s,i){this._type=d;const r=this._mat4param;r[0]=e,r[1]=t,r[2]=s,r[3]=i}DoClearSurface(){const e=this._gl,t=this._mat4param,s=this._batchState.clearColor,i=t[0],r=t[1],n=t[2],a=t[3];s.equalsRgba(i,r,n,a)||(e.clearColor(i,r,n,a),s.setRgba(i,r,n,a)),e.clear(e.COLOR_BUFFER_BIT)}InitSetPointTexCoords(e){this._type=y,e.writeToTypedArray(this._mat4param,0)}DoSetPointTextureCoords(){const e=this._mat4param;this._batchState.pointTexCoords.set(e[0],e[1],e[2],e[3])}InitPoints(e,t){this._type=p,this._startIndex=e,this._indexCount=1,this._mat4param[0]=t}DoPoints(){const e=this._gl,t=this._batchState,s=t.renderer._spPoints;e.useProgram(s._shaderProgram),s.UpdateMatP(t.currentMatP,!1),s.UpdateMatMV(t.currentMV,!1);const i=t.pointTexCoords;s._uPointTexStart.IsUsed()&&s._uPointTexStart.Update2f(i.getLeft(),i.getTop()),s._uPointTexEnd.IsUsed()&&s._uPointTexEnd.Update2f(i.getRight(),i.getBottom());const r=this._mat4param[0];if(s._uZElevation.IsUsed()&&s._uZElevation.Update1f(r),s._uColor.IsUsed()){const e=t.currentColor;s._uColor.Update4f(e[0],e[1],e[2],e[3])}e.drawArrays(e.POINTS,this._startIndex/4,this._indexCount),e.useProgram(t.currentShader._shaderProgram)}InitSetProgram(e){this._type=f,this._texParam=e}DoSetProgram(){const e=this._gl,t=this._batchState,s=this._texParam;if(t.currentShader=s,e.useProgram(s._shaderProgram),s.UpdateMatP(t.currentMatP,!1),s.UpdateMatMV(t.currentMV,!1),s._uColor.IsUsed()){const e=t.currentColor;s._uColor.Update4f(e[0],e[1],e[2],e[3])}}InitSetProgramParameters(){this._type=m}DoSetProgramParameters(){const e=this._batchState.currentShader,t=this._gl,s=this._mat4param,i=this._colorParam,r=this._srcOriginRect;if(e._uSamplerBack.IsUsed()){const e=this._batchState.renderer,s=this._texParam;e._lastTexture1!==s&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s?s._GetTexture():null),e._lastTexture1=s,t.activeTexture(t.TEXTURE0))}e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(s[0],s[1]),e._uDestStart.IsUsed()&&e._uDestStart.Update2f(s[2],s[3]),e._uDestEnd.IsUsed()&&e._uDestEnd.Update2f(s[4],s[5]),e._uDevicePixelRatio.IsUsed()&&e._uDevicePixelRatio.Update1f(this._indexCount),e._uLayerScale.IsUsed()&&e._uLayerScale.Update1f(s[6]),e._uLayerAngle.IsUsed()&&e._uLayerAngle.Update1f(s[7]),e._uSrcStart.IsUsed()&&e._uSrcStart.Update2f(s[12],s[13]),e._uSrcEnd.IsUsed()&&e._uSrcEnd.Update2f(s[14],s[15]),e._uSrcOriginStart.IsUsed()&&e._uSrcOriginStart.Update2f(r[0],r[1]),e._uSrcOriginEnd.IsUsed()&&e._uSrcOriginEnd.Update2f(r[2],r[3]),e._uLayoutStart.IsUsed()&&e._uLayoutStart.Update2f(i[0],i[1]),e._uLayoutEnd.IsUsed()&&e._uLayoutEnd.Update2f(i[2],i[3]),e._uSeconds.IsUsed()&&e._uSeconds.Update1f(this._startIndex)}InitSetProgramCustomParameters(){this._type=g}DoSetProgramCustomParameters(){const e=this._batchState.currentShader._uCustomParameters,t=this._shaderParams;for(let s=0,i=e.length;s<i;++s){const i=e[s],r=t[s];i.IsColorType()?i.Update3f(r.getR(),r.getG(),r.getB()):i.Update1f(r)}}InitInvalidateFramebuffer(e){this._type=S,this._texParam=e}DoInvalidateFramebuffer(){const e=this._gl,t=this._texParam,s=this._batchState.currentFramebuffer;t!==s&&e.bindFramebuffer(e.FRAMEBUFFER,t),e.invalidateFramebuffer(e.FRAMEBUFFER,[e.COLOR_ATTACHMENT0]),t!==s&&e.bindFramebuffer(e.FRAMEBUFFER,s)}InitBlitFramebuffer(t,s,i){this._type=I;const r=this._mat4param,n=this._batchState.renderer;r[0]=t.GetWidth(),r[1]=t.GetHeight(),r[2]=s?s.GetWidth():n.GetWidth(),r[3]=s?s.GetHeight():n.GetHeight(),r[4]=t.IsLinearSampling()?1:0,r[5]="stretch"===i;const a=this._shaderParams;e.clearArray(a),a.push(t._GetFramebuffer()),a.push(s?s._GetFramebuffer():null)}DoBlitFramebuffer(){const e=this._mat4param,t=this._shaderParams,s=this._gl,i=e[0],r=e[1],n=e[2],a=e[3],o=0!==e[4],h=0!==e[5],l=t[0],c=t[1];if(s.bindFramebuffer(s.READ_FRAMEBUFFER,l),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,c),h)s.blitFramebuffer(0,0,i,r,0,0,n,a,s.COLOR_BUFFER_BIT,o?s.LINEAR:s.NEAREST);else{const e=Math.min(i,n),t=Math.min(r,a),o=Math.max(r-a,0),h=Math.max(a-r,0);s.blitFramebuffer(0,o,e,t+o,0,h,e,t+h,s.COLOR_BUFFER_BIT,s.NEAREST)}}InitStartQuery(e){this._type=T,this._texParam=e}DoStartQuery(){this._texParam.BeginTimeElapsed(),this._texParam=null}InitEndQuery(e){this._type=b,this._texParam=e}DoEndQuery(){this._texParam.EndTimeElapsed(),this._texParam=null}InitSetEllipseParams(e,t,s){this._type=C;const i=this._mat4param;i[0]=e,i[1]=t,i[2]=s}DoSetEllipseParams(){const e=this._batchState.currentShader,t=this._mat4param;e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[0],t[1]),e._uOutlineThickness.IsUsed()&&e._uOutlineThickness.Update1f(t[2])}InitSetTilemapInfo(e,t,s,i,r,n,a){this._type=G;const o=this._mat4param;e.writeToTypedArray(o,0),o[4]=1/t,o[5]=1/s,o[6]=i/t,o[7]=r/s,o[8]=n/t,o[9]=a/s}DoSetTilemapInfo(){const e=this._batchState.currentShader,t=this._mat4param;e._uSrcStart.IsUsed()&&e._uSrcStart.Update2f(t[0],t[1]),e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[4],t[5]),e._uTileSize.IsUsed()&&e._uTileSize.Update2f(t[6],t[7]),e._uTileSpacing.IsUsed()&&e._uTileSpacing.Update2f(t[8],t[9])}InitSetTileRandomizationInfo(e,t,s,i,r,n,a){this._type=E;const o=this._mat4param;o[0]=1/e,o[1]=1/t,o[2]=s,o[3]=i,o[4]=r,o[5]=n,o[6]=a}DoSetTileRandomizationInfo(){const e=this._batchState.currentShader,t=this._mat4param;e._uPixelSize.IsUsed()&&e._uPixelSize.Update2f(t[0],t[1]),e._uTileSize.IsUsed()&&e._uTileSize.Update2f(t[2],t[3]),e._uOutlineThickness.IsUsed()&&e._uOutlineThickness.Update1f(t[4]),e._uTileSpacing.IsUsed()&&e._uTileSpacing.Update2f(t[5],t[6])}InitClearDepth(e){this._type=v,this._startIndex=e?1:0}DoClearDepth(){const e=this._gl,t=0!==this._startIndex;t||e.depthMask(!0),e.clear(e.DEPTH_BUFFER_BIT),t||e.depthMask(!1)}InitSetDepthEnabled(e){this._type=x,this._startIndex=e?1:0}DoSetDepthEnabled(){const e=this._gl;0===this._startIndex?(e.disable(e.DEPTH_TEST),e.depthMask(!1)):(e.enable(e.DEPTH_TEST),e.depthMask(!0))}InitSetDepthSamplingEnabled(e){this._type=R,this._startIndex=e?1:0}DoSetDepthSamplingEnabled(){const e=this._gl,t=this._batchState,s=t.renderer,i=0!==this._startIndex;t.isDepthSamplingEnabled=i,e.activeTexture(e.TEXTURE2),i?(t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebufferNoDepth),e.bindTexture(e.TEXTURE_2D,s._GetDepthBuffer())):(e.bindTexture(e.TEXTURE_2D,null),t.currentFramebufferNoDepth&&e.bindFramebuffer(e.FRAMEBUFFER,t.currentFramebuffer)),e.activeTexture(e.TEXTURE0)}InitCoplanarStartStencilPass(){this._type=w}DoCoplanarStartStencilPass(){const e=this._gl;e.clear(e.STENCIL_BUFFER_BIT),e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.colorMask(!1,!1,!1,!1)}InitCoplanarStartColorPass(){this._type=A}DoCoplanarStartColorPass(){const e=this._gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,1,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}InitCoplanarRestore(){this._type=M}DoCoplanarRestore(){const e=this._gl;e.disable(e.STENCIL_TEST)}InitSetScissor(e,t,s,i,r){this._type=D,this._startIndex=e?1:0;const n=this._mat4param;n[0]=t,n[1]=s,n[2]=i,n[3]=r}DoSetScissor(){const e=this._gl,t=this._mat4param;1===this._startIndex?(e.enable(e.SCISSOR_TEST),e.scissor(t[0],t[1],t[2],t[3])):e.disable(e.SCISSOR_TEST)}Run(){switch(this._type){case 1:return void this.DoQuad();case 2:return void this.DoSetTexture();case 3:return void this.DoSetColor();case 4:return void this.DoSetBlend();case 5:return void this.DoSetViewport();case 6:return void this.DoSetProjection();case 7:return void this.DoSetModelView();case 8:return void this.DoSetRenderTarget();case 9:return void this.DoClearSurface();case 10:return void this.DoPoints();case 11:return void this.DoSetProgram();case 12:return void this.DoSetProgramParameters();case 13:return void this.DoSetProgramCustomParameters();case 14:return void this.DoInvalidateFramebuffer();case 15:return void this.DoSetPointTextureCoords();case 16:return void this.DoSetTilemapInfo();case 17:return void this.DoBlitFramebuffer();case 18:return void this.DoStartQuery();case 19:return void this.DoEndQuery();case 20:return void this.DoSetEllipseParams();case 21:return void this.DoSetGradientColor();case 22:return void this.DoClearDepth();case 23:return void this.DoSetDepthEnabled();case 24:return void this.DoSetDepthSamplingEnabled();case 25:return void this.DoCoplanarStartStencilPass();case 26:return void this.DoCoplanarStartColorPass();case 27:return void this.DoCoplanarRestore();case 28:return void this.DoSetScissor();case 29:return void this.DoSetTileRandomizationInfo()}}}}{const e=self.C3,t=4096,s=4,i=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),r={timeout:60},n=new e.Color(0,0,0,1),a=new Set(["left","center","right"]),o=new Set(["top","center","bottom"]),h=new Set(["word","character"]),l=new Set;function fillOrStrokeText(t,s,i,r,n,a){s?"Gecko"===e.Platform.BrowserEngine?t.strokeText(i,r,n,a):t.strokeText(i,r,n):"Gecko"===e.Platform.BrowserEngine?t.fillText(i,r,n,a):t.fillText(i,r,n)}function fillOrStrokeRect(e,t,s,i,r,n){t?e.strokeRect(s,i,r,n):e.fillRect(s,i,r,n)}function ptToPx(e){return e*(4/3)}e.FontManager&&e.FontManager.addEventListener("fontload",(t=>{const s=t.font.GetName();for(const t of l)(t.IsBBCodeEnabled()||e.equalsNoCase(t.GetFontName(),s))&&t._SetTextChanged()}));let c=!1,u=!1;e.Gfx.RendererText=class{constructor(t,s){s=Object.assign({},r,s),this._renderer=t,this._fontName="Arial",this._fontSize=16,this._fontSizeScale=1,this._lineHeight=0,this._isBold=!1,this._isItalic=!1,this._colorStr="black",this._isBBcodeEnabled=!1,this.onloadfont=null,this._alreadyLoadedFonts=new Set,this._horizontalAlign="left",this._verticalAlign="top",this._text="",this._bbString=null,this._wrappedText=e.New(e.WordWrap),this._wrapMode="word",this._textChanged=!1,this._isUpdating=!1,this._isAsync=!0,this._drawMaxCharCount=-1,this._drawCharCount=0,this._cssWidth=0,this._cssHeight=0,this._width=0,this._height=0,this._zoom=1,this._changed=!1,this._textCanvas=null,this._textContext=null,this._measureContext=null,this._measureContextTop=null,this._lastCanvasWidth=-1,this._lastCanvasHeight=-1,this._lastTextCanvasFont="",this._lastMeasureCanvasFont="",this._lastTextCanvasFillStyle="",this._lastTextCanvasOpacity=1,this._lastTextCanvasLineWidth=1,this._measureTextCallback=(e,t)=>this._MeasureText(e,t),this._texture=null,this._textureWidth=0,this._textureHeight=0,this._rcTex=new e.Rect,this._scaleFactor=1,this._needToRecreateTexture=!1,this._textureTimeout=new e.IdleTimeout((()=>{this.ReleaseTexture(),this._SetTextCanvasSize(8,8)}),s.timeout),this.ontextureupdate=null,this._wasReleased=!1,l.add(this)}Release(){this.onloadfont=null,this._alreadyLoadedFonts.clear(),this._bbString=null,this._textCanvas=null,this._textContext=null,this._measureContext=null,this._measureContextTop=null,this._measureTextCallback=null,this._textureTimeout.Release(),this.ontextureupdate=null,this.ReleaseTexture(),this._wrappedText.Clear(),this._wrappedText=null,this._renderer=null,this._wasReleased=!0,l.delete(this)}_SetChanged(){this._changed=!0}_SetTextChanged(){this._SetChanged(),this._wrappedText.Clear(),this._textChanged=!0}SetIsAsync(e){this._isAsync=!!e}IsAsync(){return this._isAsync}SetBBCodeEnabled(e){if(e=!!e,this._isBBcodeEnabled===e)return;this._isBBcodeEnabled=e;const t=this._isBBcodeEnabled?"alphabetic":"top";this._textContext&&(this._textContext.textBaseline=t),this._measureContext&&(this._measureContext.textBaseline=t),this._SetTextChanged()}IsBBCodeEnabled(){return this._isBBcodeEnabled}SetFontName(e){e||(e="serif"),this._fontName!==e&&(this._fontName=e,this._SetTextChanged())}GetFontName(){return this._fontName}SetFontSize(e){e<.1&&(e=.1),this._fontSize!==e&&(this._fontSize=e,this._SetTextChanged())}SetFontSizeScale(e){this._fontSizeScale!==e&&(this._fontSizeScale=e,this._SetTextChanged())}SetLineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this._SetChanged())}SetBold(e){e=!!e,this._isBold!==e&&(this._isBold=e,this._SetTextChanged())}SetItalic(e){e=!!e,this._isItalic!==e&&(this._isItalic=e,this._SetTextChanged())}SetDrawMaxCharacterCount(e){e=Math.floor(e),this._drawMaxCharCount!==e&&(this._drawMaxCharCount=e,this._SetChanged())}GetDrawMaxCharacterCount(){return this._drawMaxCharCount}_GetStyleTag(e,t){for(let s=e.length-1;s>=0;--s){const i=e[s];if(i.tag===t)return i}return null}_HasStyleTag(e,t){return!!this._GetStyleTag(e,t)}_GetFontString(e,t){let s=[];(this._isBold||this._HasStyleTag(t,"b"))&&s.push("bold"),(this._isItalic||this._HasStyleTag(t,"i"))&&s.push("italic");const r=this._GetStyleTag(t,"size"),n=(r?parseFloat(r.param):this._fontSize)*this._fontSizeScale;e?s.push(n+"pt"):s.push(n*this._scaleFactor*this._zoom*self.devicePixelRatio+"pt");let a=this._fontName;const o=this._GetStyleTag(t,"font");return o&&o.param&&(a=o.param,this.onloadfont&&!this._alreadyLoadedFonts.has(a)&&(this.onloadfont(a),this._alreadyLoadedFonts.add(a))),a&&(i.has(a)?s.push(a):s.push('"'+a+'"')),s.join(" ")}SetColor(t){t instanceof e.Color&&(t=t.getCssRgb()),this._colorStr!==t&&(this._colorStr=t,this._SetChanged())}SetColorRgb(e,t,s){n.setRgb(e,t,s),this.SetColor(n)}SetHorizontalAlignment(e){if(!a.has(e))throw new Error("invalid horizontal alignment");this._horizontalAlign!==e&&(this._horizontalAlign=e,this._SetChanged())}SetVerticalAlignment(e){if(!o.has(e))throw new Error("invalid vertical alignment");this._verticalAlign!==e&&(this._verticalAlign=e,this._SetChanged())}SetWordWrapMode(e){if(!h.has(e))throw new Error("invalid word wrap mode");this._wrapMode!==e&&(this._wrapMode=e,this._SetTextChanged())}SetText(e){this._text!==e&&(this._text=e,this._SetTextChanged())}SetSize(e,s,i){if(void 0===i&&(i=1),e<=0||e<=0)return;if(this._cssWidth===e&&this._cssHeight===s&&this._zoom===i)return;1===this._zoom!=(1===i)&&(this._needToRecreateTexture=!0);const r=this._cssWidth,n=this._zoom;this._cssWidth=e,this._cssHeight=s,this._zoom=i;const a=self.devicePixelRatio;this._width=this._cssWidth*this._zoom*a,this._height=this._cssHeight*this._zoom*a;const o=Math.max(this._width,this._height),h=Math.min(this._renderer.GetMaxTextureSize(),t);let l=1;o>h&&(l=h/o,this._width=Math.min(this._width*l,h),this._height=Math.min(this._height*l,h)),this._scaleFactor=l,this._textureWidth>0&&this._textureHeight>0&&this._zoom===n&&this._rcTex.set(0,0,this._width/this._textureWidth,this._height/this._textureHeight),this._cssWidth!==r?this._SetTextChanged():this._SetChanged()}GetWidth(){return this._width}GetHeight(){return this._height}GetTextWidth(){return this._MaybeWrapText(),this._wrappedText.GetMaxLineWidth()}GetTextHeight(){return this._MaybeWrapText(),this._wrappedText.GetTotalLineHeight()+this._wrappedText.GetLineCount()*(this._lineHeight+s)-this._lineHeight}GetTexture(){return this._textureTimeout.Reset(),this._MaybeUpdate(),this._texture}_MaybeUpdate(){(!this._texture||this._changed||this._textChanged)&&(this._isUpdating||this._width<=0||this._height<=0||(this._changed=!1,this._isUpdating=!0,this._isAsync?e.Asyncify((()=>this._DoUpdate())):this._DoUpdate()))}_DoUpdate(){this._wasReleased||(this._SetTextCanvasSize(Math.ceil(this._width),Math.ceil(this._height)),this._MaybeWrapText(),this._DrawTextToCanvas(),this._UpdateTexture(),this._textureTimeout.Reset(),this._isUpdating=!1)}_SetTextCanvasSize(t,s){this._textCanvas||(this._textCanvas=e.CreateCanvas(16,16));let i=!1;this._lastCanvasWidth===t&&this._lastCanvasHeight===s||(this._lastCanvasWidth=t,this._lastCanvasHeight=s,this._textCanvas.width=t,this._textCanvas.height=s,i=!0),this._textContext||(this._textContext=this._textCanvas.getContext("2d"),i=!0),i?(this._textContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._textContext.font=this._lastTextCanvasFont,this._textContext.fillStyle=this._lastTextCanvasFillStyle,this._textContext.strokeStyle=this._lastTextCanvasFillStyle,this._textContext.globalAlpha=this._lastTextCanvasOpacity,this._textContext.lineWidth=this._lastTextCanvasLineWidth):this._textContext.clearRect(0,0,t,s)}_MaybeCreateMeasureContext(){this._measureContext||(this._measureContext=e.CreateCanvas(16,16).getContext("2d"),this._measureContextTop=e.CreateCanvas(16,16).getContext("2d"),this._measureContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top",this._measureContextTop.textBaseline="top")}_SetMeasureFontString(e){this._lastMeasureCanvasFont!==e&&(this._lastMeasureCanvasFont=e,this._measureContext.font=e,this._measureContextTop.font=e)}_SupportsFontBoundingBoxMeasurements(){if(!c){c=!0,this._MaybeCreateMeasureContext();const e=this._measureContext.measureText("test");u="number"==typeof e.fontBoundingBoxAscent&&"number"==typeof e.fontBoundingBoxDescent}return u}_MaybeWrapText(){this._textChanged&&(this._MaybeCreateMeasureContext(),!this._isBBcodeEnabled||this._bbString&&this._bbString.toString()===this._text||(this._bbString=new e.BBString(this._text,{noEscape:!0})),this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,this._measureTextCallback,this._cssWidth,this._wrapMode,0),this._textChanged=!1)}_MeasureText(e,t){const s=e.join("");this._SetMeasureFontString(this._GetFontString(!0,t));const i=this._GetStyleTag(t,"size"),r=(i?parseFloat(i.param):this._fontSize)*this._fontSizeScale,n=this._measureContext.measureText(s);let a=0;if(this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements()){const e=this._measureContextTop.measureText(s);a=n.fontBoundingBoxAscent-e.fontBoundingBoxAscent}return{width:n.width,height:ptToPx(r),fontBoundingBoxAscent:n.fontBoundingBoxAscent||0,fontBoundingBoxDescent:n.fontBoundingBoxDescent||0,topToAlphabeticDistance:a}}_SetDrawFontString(e){this._lastTextCanvasFont!==e&&(this._lastTextCanvasFont=e,this._textContext.font=e)}_SetDrawCanvasColor(e){this._lastTextCanvasFillStyle!==e&&(this._lastTextCanvasFillStyle=e,this._textContext.fillStyle=e,this._textContext.strokeStyle=e)}_SetDrawCanvasOpacity(e){this._lastTextCanvasOpacity!==e&&(this._lastTextCanvasOpacity=e,this._textContext.globalAlpha=e)}_SetDrawCanvasLineWith(e){this._lastTextCanvasLineWidth!==e&&(this._lastTextCanvasLineWidth=e,this._textContext.lineWidth=e)}_DrawTextToCanvas(){this._drawCharCount=0;const e=this._scaleFactor*this._zoom*self.devicePixelRatio,t=(s+this._lineHeight)*e;let i=0;const r=this._wrappedText.GetLines();if(0===r.length)return;const n=this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements();let a=r[0].height*e;if("center"===this._verticalAlign){const s=r.reduce(((s,i)=>s+i.height*e+t),0)-t;i=Math.max(this._height/2-s/2,0),n&&(a=r[0].topToAlphabeticDistance*e)}else if("bottom"===this._verticalAlign){const s=r.reduce(((s,i)=>s+i.height*e+t),0)-this._lineHeight*e,a=n?r.at(-1).fontBoundingBoxDescent*e:0;i=this._height-s-a-2}for(let n=0,o=r.length;n<o;++n){const o=r[n],h=o.height*e,l=i;if(this._isBBcodeEnabled){if(i+=0===n?a:h,n>0&&i>this._height-s*e)break}else if(n>0&&i>=this._height-h)break;l>=0&&this._DrawTextLine(o,i,e),this._isBBcodeEnabled||(i+=h),i+=t}}_DrawTextLine(e,t,s){let i=0;"center"===this._horizontalAlign?i=(this._width-e.width*s)/2:"right"===this._horizontalAlign&&(i=this._width-e.width*s);for(const r of e.fragments)this._DrawTextFragment(r,i,t,s,e.height),i+=r.width*s}_DrawTextFragment(t,i,r,n,a){const o=this._textContext,h=a/16;let l=t.width*n;const c=t.height*n,u=t.height/16,_=(s+this._lineHeight)*n,d=t.styles;let p=t.chArr;if(-1!==this._drawMaxCharCount){if(this._drawCharCount>=this._drawMaxCharCount)return;this._drawCharCount+p.length>this._drawMaxCharCount&&(p=p.slice(0,this._drawMaxCharCount-this._drawCharCount),l=this._MeasureText(p,d).width*n),this._drawCharCount+=p.length}const f=this._GetStyleTag(d,"background"),m=this._HasStyleTag(d,"u"),g=this._HasStyleTag(d,"s");if(e.IsCharArrayAllWhitespace(p)&&!f&&!m&&!g||this._HasStyleTag(d,"hide"))return;const S=p.join(""),y=this._GetStyleTag(d,"offsetx");i+=y?parseFloat(y.param)*n:0;const G=this._GetStyleTag(d,"offsety");r+=G?parseFloat(G.param)*n:0,f&&(this._SetDrawCanvasColor(f.param),o.fillRect(i,r-c,l,c+_));const I=this._GetStyleTag(d,"color");this._SetDrawCanvasColor(I?I.param:this._colorStr);const T=this._GetStyleTag(d,"opacity");this._SetDrawCanvasOpacity(T?parseFloat(T.param)/100:1);const b=this._GetStyleTag(d,"linethickness"),C=b?parseFloat(b.param):1,P=this._HasStyleTag(d,"stroke");if(P&&this._SetDrawCanvasLineWith(.5*u*C*this._scaleFactor*this._zoom*self.devicePixelRatio),this._SetDrawFontString(this._GetFontString(!1,d)),fillOrStrokeText(o,P,S,i,r,l),!P){this._SetDrawCanvasLineWith(.5*u*C*this._scaleFactor*this._zoom*self.devicePixelRatio);const e=this._GetStyleTag(d,"outline");e&&(this._SetDrawCanvasColor(e.param),fillOrStrokeText(o,!0,S,i,r,l))}if(this._SetDrawCanvasColor(I?I.param:this._colorStr),m&&fillOrStrokeRect(o,P,i,r+n*h,l,n*h*C),g){const e=n*u,t=r-c/4+e/2;o.fillRect(i,t-e*C/2,l,e*C)}}_UpdateTexture(){this._renderer.IsContextLost()||(this._textureWidth=Math.ceil(this._width),this._textureHeight=Math.ceil(this._height),this._rcTex.set(0,0,this._width/this._textureWidth,this._height/this._textureHeight),this._needToRecreateTexture&&(this.ReleaseTexture(),this._needToRecreateTexture=!1),this._texture||(this._texture=this._renderer.CreateDynamicTexture(this._textureWidth,this._textureHeight,{mipMap:1===this._zoom,mipMapQuality:"high"})),this._renderer.UpdateTexture(this._textCanvas,this._texture),this.ontextureupdate&&this.ontextureupdate())}GetTexRect(){return this._rcTex}ReleaseTexture(){this._texture&&(this._renderer.IsContextLost()||this._renderer.DeleteTexture(this._texture),this._texture=null)}static OnContextLost(){for(const e of l)e.ReleaseTexture()}static GetAll(){return l.values()}}}{const e=self.C3;class t{constructor(e){this._gl=e.GetContext(),this._version=e.GetWebGLVersionNumber(),this._timerExt=e._GetDisjointTimerQueryExtension(),this._query=null,this._isActive=!1,this._hasResult=!1,this._result=0,1===this._version?this._query=this._timerExt.createQueryEXT():this._query=this._gl.createQuery()}Release(){this._DeleteQueryObject(),this._gl=null,this._timerExt=null,this._hasResult=!1}_DeleteQueryObject(){this._query&&(1===this._version?this._timerExt.deleteQueryEXT(this._query):this._gl.deleteQuery(this._query),this._query=null)}BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");1===this._version?this._timerExt.beginQueryEXT(this._timerExt.TIME_ELAPSED_EXT,this._query):this._gl.beginQuery(this._timerExt.TIME_ELAPSED_EXT,this._query),this._isActive=!0}EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");1===this._version?this._timerExt.endQueryEXT(this._timerExt.TIME_ELAPSED_EXT):this._gl.endQuery(this._timerExt.TIME_ELAPSED_EXT),this._isActive=!1}CheckForResult(){if(!this._query||this._hasResult||this._isActive)return;let e=!1;e=1===this._version?this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_AVAILABLE_EXT):this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE);const t=this._gl.getParameter(this._timerExt.GPU_DISJOINT_EXT);e&&!t&&(1===this._version?this._result=this._timerExt.getQueryObjectEXT(this._query,this._timerExt.QUERY_RESULT_EXT):this._result=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT),this._result/=1e9,this._hasResult=!0),(e||t)&&this._DeleteQueryObject()}HasResult(){return this._hasResult}GetResult(){if(!this._hasResult)throw new Error("no result available");return this._result}}e.Gfx.WebGLTimeElapsedQuery=class{constructor(e){this._renderer=e,this._frameNumber=e.GetFrameNumber(),this._isActive=!1,this._parentQuery=null,this._isNested=!1,this._realQuery=null,this._queries=[]}Release(){for(const e of this._queries)e instanceof t&&e.Release();e.clearArray(this._queries),this._parentQuery=null,this._realQuery=null,this._renderer=null}BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");const e=this._renderer._GetTimeQueryStack();e.length>0?(this._isNested=!0,this._parentQuery=e.at(-1),this._parentQuery._EndReal(),this._parentQuery._queries.push(this)):(this._isNested=!1,this._parentQuery=null),this._isActive=!0,e.push(this),this._StartReal()}EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");if(this._renderer._GetTimeQueryStack().pop()!==this)throw new Error("can only end most nested query");this._isActive=!1,this._EndReal(),this._parentQuery&&(this._parentQuery._StartReal(),this._parentQuery=null)}_StartReal(){this._realQuery=e.New(t,this._renderer),this._queries.push(this._realQuery),this._realQuery.BeginTimeElapsed()}_EndReal(){this._realQuery.EndTimeElapsed(),this._realQuery=null}CheckForResult(){for(const e of this._queries)e.CheckForResult()}IsNested(){return this._isNested}HasResult(){return this._queries.every((e=>e.HasResult()))}GetResult(){return this._queries.reduce(((e,t)=>e+t.GetResult()),0)}GetFrameNumber(){return this._frameNumber}}}{const e=self.C3;e.Gfx.WebGLQueryResultBuffer=class{constructor(e,t=1e3){this._renderer=e,this._maxQueries=t,this._buffer=[],this._renderer._AddQueryResultBuffer(this)}Release(){this.Clear(),this._renderer._RemoveQueryResultBuffer(this),this._renderer=null}Clear(){for(const e of this._buffer)e.Release();e.clearArray(this._buffer)}AddTimeElapsedQuery(){const t=new e.Gfx.WebGLTimeElapsedQuery(this._renderer);if(this._buffer.push(t),this._buffer.length>this._maxQueries){this._buffer.shift().Release()}return t}CheckForResults(e){for(const t of this._buffer){if(t.GetFrameNumber()>=e)return;if(t.IsNested())return;t.CheckForResult()}}GetFrameRangeResultSum(e,t){if(t<=e)return NaN;let s=0;for(const i of this._buffer){if(i.GetFrameNumber()>=t)break;if(!(i.GetFrameNumber()<e)){if(!i.HasResult())return NaN;s+=i.GetResult()}}return s}DeleteAllBeforeFrameNumber(e){for(let t=0,s=this._buffer.length;t<s;++t){const s=this._buffer[t];if(!(s.GetFrameNumber()<e))return void(t>0&&this._buffer.splice(0,t));s.Release()}}}}{const e=self.C3,t=self.assert,s=self.glMatrix,i=s.vec3,r=s.vec4,n=s.mat4,a={powerPreference:"default",enableGpuProfiling:!0,alpha:!1,lowLatency:!1,depth:!1,canSampleDepth:!1,maxWebGLVersion:2,failIfMajorPerformanceCaveat:!1},o=new Set(["default","low-power","high-performance"]),h=8e3,l=h/2*3,c=8e3,u=c-4,_=262144,d=new e.Quad(0,0,1,0,1,1,0,1),p=n.create(),f=n.create(),m=new e.Quad,g=new e.Rect;let S=null;e.isDebug&&(self.debug_lose_webgl_context=function(){S&&S.loseContext()},self.debug_restore_webgl_context=function(){S&&S.restoreContext()});const y=new Set;let G=-1;function CheckPendingPolls(){G=-1;for(const e of y)e.checkFunc()&&(e.resolve(),y.delete(e));y.size>0&&(G=self.requestAnimationFrame(CheckPendingPolls))}e.Gfx.WebGLRenderer=class extends e.Gfx.RendererBase{constructor(t,s){if(super(s),s=Object.assign({},a,s),!o.has(s.powerPreference))throw new Error("invalid power preference");const i={alpha:!!s.alpha,depth:!1,antialias:!1,powerPreference:s.powerPreference,failIfMajorPerformanceCaveat:!!s.failIfMajorPerformanceCaveat};s.lowLatency&&(i.desynchronized=!0,i.preserveDrawingBuffer=!0);let u=null,_=0;if(s.maxWebGLVersion>=2&&(u=t.getContext("webgl2",i),_=2),u||(u=t.getContext("webgl",i),_=1),!u)throw new Error("renderer-unavailable (could not get WebGL context)");this._gl=u,this._attribs=u.getContextAttributes(),s.lowLatency&&this._attribs.desynchronized,this._versionString=u.getParameter(u.VERSION),this._version=_,this._viewport=r.create(),this._didChangeTransform=!1,this._bbProjectionMatrix=n.create(),this._usesDepthBuffer=!!s.depth,this._canSampleDepth=!(!s.depth||!s.canSampleDepth),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._depthBuffer=null,this._isAutoSizeDepthBuffer=!0,this._depthBufferWidth=0,this._depthBufferHeight=0,this._vertexBuffer=null,this._texcoordBuffer=null,this._indexBuffer=null,this._pointBuffer=null,this._vertexData=new Float32Array(h*this.GetNumVertexComponents()),this._indexData=new Uint16Array(l),this._texcoordData=new Float32Array(2*h),this._pointData=new Float32Array(4*c),this._vertexPtr=0,this._texPtr=0,this._pointPtr=0,this._lastVertexPtr=0,this._lastProgram=null,this._spDeviceTransformTextureFill=null,this._batch=[],this._batchPtr=0,this._topOfBatch=0,this._currentRenderTarget=null,this._lastPointZ=0,this._batchState=e.New(e.Gfx.BatchState,this),this._lastColor=e.New(e.Color,1,1,1,1),this._lastTexture0=null,this._lastTexture1=null,this._lastSrcBlend=0,this._lastDestBlend=0,this._lastPointTexCoords=new e.Rect,this._lastScissorRect=e.New(e.Rect,0,0,-1,-1),this._maxTextureSize=-1,this._minPointSize=0,this._maxPointSize=0,this._highpPrecision=0,this._unmaskedVendor="(unavailable)",this._unmaskedRenderer="(unavailable)",this._extensions=[],this._isInitialisingAfterContextRestored=!1,this._parallelShaderCompileExt=null,this._anisotropicExt=null,this._depthTextureExt=null,this._fragDepthExt=null,this._stdDerivativesExt=null,this._textureLodExt=null,this._maxAnisotropy=0,this._isGpuProfilingEnabled=!!s.enableGpuProfiling,this._timerExt=null,this._allQueryResultBuffers=new Set,this._timeQueryStack=[],this.FillIndexBufferData(this._indexData)}IsWebGL(){return!0}async InitState(){super.InitState();const t=this._gl,s=this.GetNumVertexComponents();this._lastColor.setRgba(1,1,1,1),this._lastTexture0=null,this._lastTexture1=null,this._vertexPtr=0,this._pointPtr=0,this._lastVertexPtr=h*s-4*s,e.clearArray(this._batch),this._batchPtr=0,this._topOfBatch=0,this._lastProgram=null,this._currentRenderTarget=null,this._lastPointTexCoords.set(0,0,1,1),this._lastPointZ=0;const i=this._batchState;i.currentShader=null,i.currentFramebuffer=null,i.currentFramebufferNoDepth=null,r.set(i.currentColor,1,1,1,1),i.clearColor.setRgba(0,0,0,0),i.pointTexCoords.set(0,0,1,1),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this._lastSrcBlend=t.ONE,this._lastDestBlend=t.ONE_MINUS_SRC_ALPHA,this._InitBlendModes(t),t.disable(t.CULL_FACE),t.disable(t.STENCIL_TEST),t.disable(t.DITHER),this._usesDepthBuffer?(t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LEQUAL)):(t.disable(t.DEPTH_TEST),t.depthMask(!1)),this._isDepthEnabled=this._usesDepthBuffer,this._isDepthSamplingEnabled=!1,this._pointBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._pointBuffer),t.bufferData(t.ARRAY_BUFFER,this._pointData.byteLength,t.DYNAMIC_DRAW),this._vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this._vertexData.byteLength,t.DYNAMIC_DRAW),this._texcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._texcoordBuffer),t.bufferData(t.ARRAY_BUFFER,this._texcoordData.byteLength,t.DYNAMIC_DRAW),this._indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indexData,t.STATIC_DRAW),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,null),this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE);const n=t.getParameter(t.ALIASED_POINT_SIZE_RANGE);this._minPointSize=n[0],this._maxPointSize=n[1];const a=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),o=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);this._highpPrecision=a&&o?Math.min(a.precision,o.precision):0,this._maxPointSize>2048&&(this._maxPointSize=2048),this._extensions=t.getSupportedExtensions();const l=t.getExtension("WEBGL_debug_renderer_info");if(l&&(this._unmaskedVendor=t.getParameter(l.UNMASKED_VENDOR_WEBGL),this._unmaskedRenderer=t.getParameter(l.UNMASKED_RENDERER_WEBGL)),this._parallelShaderCompileExt=t.getExtension("KHR_parallel_shader_compile"),e.isDebug&&(S=t.getExtension("WEBGL_lose_context")),this._isGpuProfilingEnabled&&(1===this.GetWebGLVersionNumber()?("Chromium"!==e.Platform.BrowserEngine||e.Platform.BrowserVersionNumber>=81||"undefined"!=typeof document)&&(this._timerExt=t.getExtension("EXT_disjoint_timer_query")):this._timerExt=t.getExtension("EXT_disjoint_timer_query_webgl2")||t.getExtension("EXT_disjoint_timer_query")),this._anisotropicExt=t.getExtension("EXT_texture_filter_anisotropic"),this._anisotropicExt?this._maxAnisotropy=t.getParameter(this._anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):this._maxAnisotropy=0,this.GetWebGLVersionNumber()<2&&this._usesDepthBuffer&&this._canSampleDepth&&(this._depthTextureExt=t.getExtension("WEBGL_depth_texture"),!this._depthTextureExt))throw new Error("no depth texture support");this.GetWebGLVersionNumber()<2&&(this._fragDepthExt=t.getExtension("EXT_frag_depth"),this._stdDerivativesExt=t.getExtension("OES_standard_derivatives"),this._textureLodExt=t.getExtension("EXT_shader_texture_lod"));const c=e.Gfx.WebGLShaderProgram,u=c.GetDefaultVertexShaderSource(!1);let _=c.GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(),d=u,p=c.GetPointFragmentShaderSource_WebGL1_NoFragDepth(),f=c.GetPointVertexShaderSource_WebGL1(),m=c.GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(),g=c.GetDefaultVertexShaderSource(!0),y=!1;this._usesDepthBuffer&&("Safari"!==e.Platform.Browser||e.Platform.BrowserVersionNumber>=15.5)&&(this.GetWebGLVersionNumber()<2?this._fragDepthExt&&(_=c.GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(),p=c.GetPointFragmentShaderSource_WebGL1_FragDepthEXT(),m=c.GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(),y=!0):(d=c.GetDefaultVertexShaderSource_WebGL2(),_=c.GetTextureFillFragmentShaderSource_WebGL2(),p=c.GetPointFragmentShaderSource_WebGL2(),f=c.GetPointVertexShaderSource_WebGL2(),m=c.GetTilemapFragmentShaderSource_WebGL2(),g=c.GetDefaultVertexShaderSource_WebGL2(!0)));const G=c.GetTileRandomizationFragmentShaderSource(this.GetWebGLVersionNumber(),y,this._stdDerivativesExt&&this._textureLodExt),I=this.GetWebGLVersionNumber()>=2?c.GetDefaultVertexShaderSource_WebGL2():u,T=[[_,d,"<default>"],[_,d,"<default-device-transform>"],[p,f,"<point>"],[c.GetColorFillFragmentShaderSource(),u,"<fill>"],[c.GetLinearGradientFillFragmentShaderSource(),u,"<lineargradient>"],[c.GetPenumbraFillFragmentShaderSource(),u,"<penumbra>"],[c.GetHardEllipseFillFragmentShaderSource(),u,"<hardellipse>"],[c.GetHardEllipseOutlineFragmentShaderSource(),u,"<hardellipseoutline>"],[c.GetSmoothEllipseFillFragmentShaderSource(),u,"<smoothellipse>"],[c.GetSmoothEllipseOutlineFragmentShaderSource(),u,"<smoothellipseoutline>"],[c.GetSmoothLineFillFragmentShaderSource(),u,"<smoothline>"],[m,g,"<tilemap>"],[G,I,"<tilerandomization>"]],b=await Promise.all(T.map((e=>this.CreateShaderProgram({src:e[0]},e[1],e[2]))));this._spTextureFill=b[0],this._spDeviceTransformTextureFill=b[1],this._spPoints=b[2],this._spColorFill=b[3],this._spLinearGradientFill=b[4],this._spPenumbraFill=b[5],this._spHardEllipseFill=b[6],this._spHardEllipseOutline=b[7],this._spSmoothEllipseFill=b[8],this._spSmoothEllipseOutline=b[9],this._spSmoothLineFill=b[10],this._spTilemapFill=b[11],this._spTileRandomization=b[12],this.SetTextureFillMode()}async CreateShaderProgram(t,s,i){const r=await e.Gfx.WebGLShaderProgram.Create(this,t,s,i);return this._AddShaderProgram(r),r}ResetLastProgram(){this._lastProgram=null}SetSize(e,t,s){if(this._width===e&&this._height===t&&!s)return;this.EndBatch();const i=this._gl,r=this._batchState;this._width=e,this._height=t,this._SetViewport(0,0,e,t),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,e/t),this.SetProjectionMatrix(this._bbProjectionMatrix),this._spDeviceTransformTextureFill&&(i.useProgram(this._spDeviceTransformTextureFill.GetShaderProgram()),this._spDeviceTransformTextureFill._UpdateDeviceTransformUniforms(this._matP),this._lastProgram=this._spDeviceTransformTextureFill,this._batchState.currentShader=this._spDeviceTransformTextureFill),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(i.TEXTURE0),this._lastTexture0=null,this._lastTexture1=null,this._usesDepthBuffer&&this._isAutoSizeDepthBuffer&&this._SetDepthBufferSize(this._width,this._height),this._currentRenderTarget&&this._currentRenderTarget._Resize(this._width,this._height),i.bindFramebuffer(i.FRAMEBUFFER,null),this._currentRenderTarget=null,r.currentFramebuffer=null,r.currentFramebufferNoDepth=null}_SetDepthBufferSize(e,t){const s=this._gl;this._depthBuffer&&this._depthBufferWidth===e&&this._depthBufferHeight===t||(this._canSampleDepth?(this._depthBuffer&&s.deleteTexture(this._depthBuffer),this._depthBuffer=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this._depthBuffer),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),this.GetWebGLVersionNumber()>=2?s.texImage2D(s.TEXTURE_2D,0,s.DEPTH24_STENCIL8,e,t,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):this._depthTextureExt&&s.texImage2D(s.TEXTURE_2D,0,s.DEPTH_STENCIL,e,t,0,s.DEPTH_STENCIL,this._depthTextureExt.UNSIGNED_INT_24_8_WEBGL,null),s.bindTexture(s.TEXTURE_2D,null)):(this._depthBuffer&&s.deleteRenderbuffer(this._depthBuffer),this._depthBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this._depthBuffer),s.renderbufferStorage(s.RENDERBUFFER,this._version>=2?s.DEPTH24_STENCIL8:s.DEPTH_STENCIL,e,t),s.bindRenderbuffer(s.RENDERBUFFER,null)),this._depthBufferWidth=e,this._depthBufferHeight=t)}SetFixedSizeDepthBuffer(e,t){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!1,this._SetDepthBufferSize(e,t))}SetAutoSizeDepthBuffer(){this._usesDepthBuffer&&(this._isAutoSizeDepthBuffer=!0,this._SetDepthBufferSize(this._width,this._height))}_SetViewport(e,t,s,i){const n=this._viewport;if(n[0]===e&&n[1]===t&&n[2]===s&&n[3]===i)return;this.PushBatch().InitSetViewport(e,t,s,i),r.set(n,e,t,s,i),this._topOfBatch=0}SetFovY(e){super.SetFovY(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetNearZ(e){super.SetNearZ(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetFarZ(e){super.SetFarZ(e),this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height)}SetProjectionMatrix(e){if(n.exactEquals(this._matP,e))return;this.PushBatch().InitSetProjection(e),n.copy(this._matP,e),this._topOfBatch=0,this._didChangeTransform=!0}SetDefaultRenderTargetProjectionState(){let e,t,s;const i=this._currentRenderTarget;null===i?(e=this._bbProjectionMatrix,t=this.GetWidth(),s=this.GetHeight()):(e=i.GetProjectionMatrix(),t=i.GetWidth(),s=i.GetHeight()),this.SetProjectionMatrix(e),this._SetViewport(0,0,t,s)}SetModelViewMatrix(e){if(n.exactEquals(this._matMV,e))return;this.PushBatch().InitSetModelView(e),n.copy(this._matMV,e),this._topOfBatch=0,this._didChangeTransform=!0}ResetDidChangeTransformFlag(){this._didChangeTransform=!1}DidChangeTransform(){return this._didChangeTransform}GetBatchState(){return this._batchState}PushBatch(){const t=this._batch;return this._batchPtr===t.length&&t.push(new e.Gfx.WebGLBatchJob(this._batchState)),t[this._batchPtr++]}EndBatch(){0!==this._batchPtr&&(this.IsContextLost()||(this._WriteBuffers(),this._ExecuteBatch(),this._batchPtr=0,this._vertexPtr=0,this._texPtr=0,this._pointPtr=0,this._topOfBatch=0))}_WriteBuffers(){const e=this._gl;this._pointPtr>0&&(e.bindBuffer(e.ARRAY_BUFFER,this._pointBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._pointData.subarray(0,this._pointPtr))),this._vertexPtr>0&&(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._vertexData.subarray(0,this._vertexPtr)),e.bindBuffer(e.ARRAY_BUFFER,this._texcoordBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._texcoordData.subarray(0,this._texPtr)))}_ExecuteBatch(){const e=this._batch;for(let t=0,s=this._batchPtr;t<s;++t)e[t].Run()}GetOpacity(){return this._lastColor.getA()}SetColorRgba(e,t,s,i){const r=this._lastColor;if(r.equalsRgba(e,t,s,i))return;r.setRgba(e,t,s,i);this.PushBatch().InitSetColor(r),this._topOfBatch=0,this._currentStateGroup=null}SetOpacity(e){const t=this._lastColor;if(t.getA()===e)return;t.setA(e);this.PushBatch().InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null}SetColor(e){const t=this._lastColor;if(t.equals(e))return;t.set(e);this.PushBatch().InitSetColor(t),this._topOfBatch=0,this._currentStateGroup=null}ResetColor(){this.SetColorRgba(1,1,1,1)}GetColor(){return this._lastColor}SetTexture(e){if(e===this._lastTexture0)return;this.PushBatch().InitSetTexture(e),this._lastTexture0=e,this._topOfBatch=0}_ResetLastTexture(){this._lastTexture0=null}SetBlendMode(e){const t=this._GetBlendByIndex(e);this._SetBlend(t[0],t[1])}SetNamedBlendMode(e){const t=this.GetNamedBlend(e);this._SetBlend(t.srcBlend,t.destBlend)}_SetBlend(e,t){if(e===this._lastSrcBlend&&t===this._lastDestBlend)return;this.PushBatch().InitSetBlend(e,t),this._lastSrcBlend=e,this._lastDestBlend=t,this._topOfBatch=0,this._currentStateGroup=null}IsPremultipliedAlphaBlend(){return this._lastSrcBlend===this._gl.ONE&&this._lastDestBlend===this._gl.ONE_MINUS_SRC_ALPHA}SetAlphaBlend(){this._SetBlend(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)}SetNoPremultiplyAlphaBlend(){this._SetBlend(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA)}SetCopyBlend(){this._SetBlend(this._gl.ONE,this._gl.ZERO)}Rect(e){this.Rect2(e.getLeft(),e.getTop(),e.getRight(),e.getBottom())}Rect2(e,t,s,i){this.Quad2(e,t,s,t,s,i,e,i)}_ExtendQuadBatch(){let e=this._vertexPtr;if(e>=this._lastVertexPtr&&(this.EndBatch(),e=0),1===this._topOfBatch)this._batch[this._batchPtr-1]._indexCount+=6;else{this.PushBatch().InitQuad(e,6),this._topOfBatch=1}}_WriteQuadToVertexBuffer(e){e.writeToTypedArray3D(this._vertexData,this._vertexPtr,this._baseZ+this._currentZ),this._vertexPtr+=12}Quad(e){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),d.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad2(e,t,s,i,r,n,a,o){this._ExtendQuadBatch();const h=this._vertexData;let l=this._vertexPtr;const c=this._baseZ+this._currentZ;h[l++]=e,h[l++]=t,h[l++]=c,h[l++]=s,h[l++]=i,h[l++]=c,h[l++]=r,h[l++]=n,h[l++]=c,h[l++]=a,h[l++]=o,h[l++]=c,this._vertexPtr=l,d.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad4(e,t){this._ExtendQuadBatch(),this._WriteQuadToVertexBuffer(e),t.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D(e,t,s,i,r,n,a,o,h,l,c,u,_){this._ExtendQuadBatch();const d=this._vertexData;let p=this._vertexPtr;const f=this._baseZ+this._currentZ;d[p++]=e,d[p++]=t,d[p++]=f+s,d[p++]=i,d[p++]=r,d[p++]=f+n,d[p++]=a,d[p++]=o,d[p++]=f+h,d[p++]=l,d[p++]=c,d[p++]=f+u,this._vertexPtr=p,_.writeAsQuadToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}Quad3D2(e,t,s,i,r,n,a,o,h,l,c,u,_){this._ExtendQuadBatch();const d=this._vertexData;let p=this._vertexPtr;const f=this._baseZ+this._currentZ;d[p++]=e,d[p++]=t,d[p++]=f+s,d[p++]=i,d[p++]=r,d[p++]=f+n,d[p++]=a,d[p++]=o,d[p++]=f+h,d[p++]=l,d[p++]=c,d[p++]=f+u,this._vertexPtr=p,_.writeToTypedArray(this._texcoordData,this._texPtr),this._texPtr+=8}FullscreenQuad(e,t){n.copy(p,this._matP),n.copy(f,this._matMV),this.SetDefaultRenderTargetProjectionState();const[s,i]=this.GetRenderTargetSize(this._currentRenderTarget),r=this.CalculateLookAtModelView2(0,0,this.GetDefaultCameraZ(i),0,0,0,i);if(this.SetModelViewMatrix(r),"crop"===e&&this._currentRenderTarget&&t){const e=this._width/2,s=this._height/2,i=t.GetWidth(),r=t.GetHeight(),n=this._currentRenderTarget.GetWidth(),a=this._currentRenderTarget.GetHeight(),o=Math.min(n,i),h=Math.min(a,r),l=Math.max(r-a,0),c=Math.max(a-r,0);g.set(-e,s-c,-e+o,s-h-c),m.setFromRect(g),g.set(0,l,o,h+l),g.divide(i,r),this.Quad3(m,g)}else{const e=s/2,t=i/2;this.Rect2(-e,t,e,-t)}this.SetProjectionMatrix(p),this.SetModelViewMatrix(f)}StartRenderingPoints(e){if(this._lastPointTexCoords.equals(e))return;this._lastPointTexCoords.copy(e);this.PushBatch().InitSetPointTexCoords(e),this._topOfBatch=0}FinishRenderingPoints(){}Point(e,t,s,i){this._pointPtr>=u&&this.EndBatch();let r=this._pointPtr;const n=this._baseZ+this._currentZ;if(2===this._topOfBatch&&this._lastPointZ===n)this._batch[this._batchPtr-1]._indexCount++;else{this.PushBatch().InitPoints(r,n),this._topOfBatch=2,this._lastPointZ=n}const a=this._pointData;a[r++]=e,a[r++]=t,a[r++]=s,a[r++]=i,this._pointPtr=r}SetProgram(e){if(this._lastProgram===e)return;this.PushBatch().InitSetProgram(e),this._lastProgram=e,this._topOfBatch=0,this._currentStateGroup=null}SetDeviceTransformTextureFillMode(){this.SetProgram(this._spDeviceTransformTextureFill)}SetGradientColor(e){this.PushBatch().InitSetGradientColor(e),this._topOfBatch=0}SetEllipseParams(e,t,s=1){this.PushBatch().InitSetEllipseParams(e,t,s),this._topOfBatch=0}SetTilemapInfo(e,t,s,i,r,n,a){if(this._lastProgram!==this._spTilemapFill)throw new Error("must set tilemap fill mode first");this.PushBatch().InitSetTilemapInfo(e,t,s,i,r,n,a),this._topOfBatch=0}SetTileRandomizationInfo(e,t,s,i,r,n,a){if(this._lastProgram!==this._spTileRandomization)throw new Error("must set tile randomization mode first");this.PushBatch().InitSetTileRandomizationInfo(e,t,s,i,r,n,a),this._topOfBatch=0}SetProgramParameters(e,t,s,i,r,n,a,o,h,l,c){const u=this._lastProgram;if(c%=10800,!u._hasAnyOptionalUniforms||u.AreOptionalUniformsAlreadySetInBatch(t,s,i,r,n,a,o,h,l,c))return;const _=this.PushBatch();_.InitSetProgramParameters(),u.SetOptionalUniformsInBatch(t,s,i,r,n,a,o,h,l,c);const d=_._mat4param;d[0]=n,d[1]=a,t.writeToTypedArray(d,2),d[6]=h,d[7]=l,s.writeToTypedArray(d,12);const p=_._colorParam;r.writeToTypedArray(p,0);const f=p[1];p[1]=p[3],p[3]=f,i.writeToTypedArray(_._srcOriginRect,0),_._startIndex=c,_._indexCount=o,u._uSamplerBack.IsUsed()?_._texParam=e?e.GetTexture():null:_._texParam=null,this._topOfBatch=0}SetProgramCustomParameters(t){const s=this._lastProgram;if(0===t.length||s.AreCustomParametersAlreadySetInBatch(t))return;const i=this.PushBatch();i.InitSetProgramCustomParameters(),s.SetCustomParametersInBatch(t),e.shallowAssignArray(i._shaderParams,t),this._topOfBatch=0}ClearRgba(e,t,s,i){this.PushBatch().InitClearSurface2(e,t,s,i),this._topOfBatch=0}Clear(e){this.PushBatch().InitClearSurface(e),this._topOfBatch=0}Start(){}Finish(){super.Finish(),this._gl.flush()}ClearDepth(){if(!this._usesDepthBuffer||!this._currentRenderTarget||!this._currentRenderTarget.HasDepthBuffer())return;this.PushBatch().InitClearDepth(this._isDepthEnabled),this._topOfBatch=0}SetDepthEnabled(e){if(e=!!e,this._isDepthEnabled===e)return;if(!this._usesDepthBuffer)return;this._isDepthEnabled=e;this.PushBatch().InitSetDepthEnabled(e),this._topOfBatch=0}IsDepthEnabled(){return this._isDepthEnabled}_GetDepthBuffer(){return this._depthBuffer}_CanSampleDepth(){return this._canSampleDepth}SetDepthSamplingEnabled(e){if(e=!!e,!this._canSampleDepth)return;if(this._isDepthSamplingEnabled===e)return;if(e&&this.IsDepthEnabled())throw new Error("depth still enabled");this._isDepthSamplingEnabled=e;this.PushBatch().InitSetDepthSamplingEnabled(e),this._topOfBatch=0}SetScissorRect(e,t,s,i,r=0){if(e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),i=Math.floor(i),this._lastScissorRect.equalsWH(e,t,s,i))return;this._lastScissorRect.setWH(e,t,s,i);t=(r||this.GetRenderTargetSize(this.GetRenderTarget())[1])-t-i;this.PushBatch().InitSetScissor(!0,e,t,s,i),this._topOfBatch=0}RemoveScissorRect(){if(-1===this._lastScissorRect.getRight())return;this._lastScissorRect.set(0,0,-1,-1);this.PushBatch().InitSetScissor(!1,0,0,0,0),this._topOfBatch=0}CheckForQueryResults(){for(const e of this._allQueryResultBuffers)e.CheckForResults(this._frameNumber)}IsContextLost(){return!this._gl||this._gl.isContextLost()||this._isInitialisingAfterContextRestored}OnContextLost(){super.OnDeviceOrContextLost(),e.Gfx.WebGLRendererTexture.OnContextLost(),e.Gfx.WebGLRenderTarget.OnContextLost(),e.Gfx.RendererText.OnContextLost();for(const e of this._allQueryResultBuffers)e.Clear();this._extensions=[],this._timerExt=null,this._parallelShaderCompileExt=null,this._anisotropicExt=null,this._depthTextureExt=null,this._fragDepthExt=null,this._stdDerivativesExt=null,this._textureLodExt=null,this._maxAnisotropy=0,this._unmaskedVendor="(unavailable)",this._unmaskedRenderer="(unavailable)",this._lastProgram=null,this._spDeviceTransformTextureFill=null,this._depthBuffer=null;for(const e of this._stateGroups.values())e.OnContextLost()}async OnContextRestored(){this._isInitialisingAfterContextRestored=!0,await this.InitState(),this._isInitialisingAfterContextRestored=!1;for(const e of this._stateGroups.values())e.OnContextRestored(this);this.SetSize(this._width,this._height,!0)}CreateStaticTexture(t,s){if(this.IsContextLost())throw new Error("context lost");this.EndBatch();const i=e.New(e.Gfx.WebGLRendererTexture,this);return i._CreateStatic(t,s),i}async CreateStaticTextureAsync(t,s){if(this.IsContextLost())throw new Error("context lost");if(s=Object.assign({},s),!e.Supports.ImageBitmapOptions||"Safari"===e.Platform.Browser&&t instanceof ImageData&&"undefined"!=typeof Image){if(t instanceof Blob){if("undefined"==typeof Image)throw new Error("texture upload variant not supported in worker");const s=await e.BlobToImage(t);t=s}return await e.Asyncify((()=>this.CreateStaticTexture(t,s)))}{let i=await createImageBitmap(t,{premultiplyAlpha:"premultiply"});const r=s.wrapX&&"clamp-to-edge"!==s.wrapX||s.wrapY&&"clamp-to-edge"!==s.wrapY,n=e.isPOT(i.width)&&e.isPOT(i.height);return this.SupportsNPOTTextures()||n||!r?s.premultiplyAlpha=!1:e.Supports.ImageBitmapOptionsResize?(i=await createImageBitmap(t,{premultiplyAlpha:"premultiply",resizeWidth:e.nextHighestPowerOfTwo(i.width),resizeHeight:e.nextHighestPowerOfTwo(i.height)}),s.premultiplyAlpha=!1):i=await createImageBitmap(t,{premultiplyAlpha:"none"}),await e.Asyncify((()=>this.CreateStaticTexture(i,s)))}}CreateDynamicTexture(t,s,i){this.EndBatch();const r=e.New(e.Gfx.WebGLRendererTexture,this);return r._CreateDynamic(t,s,i),r}UpdateTexture(e,t,s){this.EndBatch(),t._Update(e,s)}DeleteTexture(e){e&&(e.SubtractReference(),e.GetReferenceCount()>0||(this.EndBatch(),e===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),e===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()))}CreateRenderTarget(t){let s=this._width,i=this._height,r=!0;if(t&&("number"==typeof t.width&&(s=t.width,r=!1),"number"==typeof t.height&&(i=t.height,r=!1)),s<=0||i<=0)throw new Error("invalid size");this.EndBatch();const n=e.New(e.Gfx.WebGLRenderTarget,this);return n._Create(s,i,Object.assign({isDefaultSize:r},t)),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,n}SetRenderTarget(e,t=!0){if(e===this._currentRenderTarget)return;e&&e.IsDefaultSize()&&e._Resize(this._width,this._height);this.PushBatch().InitSetRenderTarget(e),this._currentRenderTarget=e,this._topOfBatch=0,t&&this.SetDefaultRenderTargetProjectionState()}GetRenderTarget(){return this._currentRenderTarget}GetRenderTargetSize(e){return e?[e.GetWidth(),e.GetHeight()]:[this._width,this._height]}CopyRenderTarget(e,t="stretch"){if(this._version<2||this._currentRenderTarget&&this._currentRenderTarget.GetMultisampling()>0)this.SetCopyBlend(),this.ResetColor(),this.DrawRenderTarget(e,t);else{this.PushBatch().InitBlitFramebuffer(e,this._currentRenderTarget,t),this._topOfBatch=0}}DrawRenderTarget(e,t="stretch"){const s=e.GetTexture();if(!s)throw new Error("not a texture-backed render target");this.SetTexture(s),this.FullscreenQuad(t,s)}InvalidateRenderTarget(e){if(this._version<2)return;this.PushBatch().InitInvalidateFramebuffer(e._GetFramebuffer()),this._topOfBatch=0}DeleteRenderTarget(e){this.SetRenderTarget(null),this.EndBatch();const t=e.GetTexture();t===this._lastTexture0&&(this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._lastTexture0=null),t===this._lastTexture1&&(this._gl.activeTexture(this._gl.TEXTURE1),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.activeTexture(this._gl.TEXTURE0),this._lastTexture1=null),e._Delete()}async ReadBackRenderTargetToImageData(t,s,i){this.EndBatch();const r=this._currentRenderTarget;let n,a,o;t?(n=t.GetWidth(),a=t.GetHeight(),o=t._GetFramebuffer()):(n=this.GetWidth(),a=this.GetHeight(),o=null);let h=0,l=0,c=n,u=a;if(i){h=e.clamp(Math.floor(i.getLeft()),0,n-1),l=e.clamp(Math.floor(i.getTop()),0,a-1);let t=i.width();t=0===t?n-h:e.clamp(Math.floor(t),0,n-h);let s=i.height();s=0===s?a-l:e.clamp(Math.floor(s),0,a-l),c=t,u=s,l=a-(l+u)}const _=this._gl;_.bindFramebuffer(_.FRAMEBUFFER,o);const d=()=>{_.bindFramebuffer(_.FRAMEBUFFER,null),this._currentRenderTarget=null,this._batchState.currentFramebuffer=null,this._batchState.currentFramebufferNoDepth=null,this.SetRenderTarget(r)};let p;if(!s&&this.GetWebGLVersionNumber()>=2){_.bindFramebuffer(_.READ_FRAMEBUFFER,o);const e=_.createBuffer(),t=c*u*4,s=_.PIXEL_PACK_BUFFER;_.bindBuffer(s,e),_.bufferData(s,t,_.STREAM_READ),_.readPixels(h,l,c,u,_.RGBA,_.UNSIGNED_BYTE,0),_.bindFramebuffer(_.READ_FRAMEBUFFER,null),_.bindBuffer(s,null),d();const i=_.fenceSync(_.SYNC_GPU_COMMANDS_COMPLETE,0);await this._WaitForObjectReady((()=>_.getSyncParameter(i,_.SYNC_STATUS)===_.SIGNALED)),_.deleteSync(i),p=new ImageData(c,u),_.bindBuffer(s,e),_.getBufferSubData(s,0,new Uint8Array(p.data.buffer),0,t),_.bindBuffer(s,null),_.deleteBuffer(e)}else p=new ImageData(c,u),_.readPixels(h,l,c,u,_.RGBA,_.UNSIGNED_BYTE,new Uint8Array(p.data.buffer)),d();return p}CoplanarStartStencilPass(){this.SetDepthEnabled(!0);this.PushBatch().InitCoplanarStartStencilPass(),this._topOfBatch=0}CoplanarStartColorPass(){this.SetDepthEnabled(!1);this.PushBatch().InitCoplanarStartColorPass(),this._topOfBatch=0}CoplanarRestoreStandardRendering(){this.SetDepthEnabled(!0);this.PushBatch().InitCoplanarRestore(),this._topOfBatch=0}StartQuery(e){if(!this.SupportsGPUProfiling())return;this.PushBatch().InitStartQuery(e),this._topOfBatch=0}EndQuery(e){if(!this.SupportsGPUProfiling())return;this.PushBatch().InitEndQuery(e),this._topOfBatch=0}_WaitForObjectReady(e){const t=new Promise((t=>y.add({resolve:t,checkFunc:e})));return-1===G&&(G=self.requestAnimationFrame(CheckPendingPolls)),t}IsDesynchronized(){return!!this._attribs.desynchronized}GetEstimatedBackBufferMemoryUsage(){return this._width*this._height*(this._attribs.alpha?4:3)}GetEstimatedRenderBufferMemoryUsage(){let t=0;for(const s of e.Gfx.WebGLRenderTarget.allRenderTargets())s.GetTexture()||(t+=s.GetEstimatedMemoryUsage());return t}GetEstimatedTextureMemoryUsage(){let t=0;for(const s of e.Gfx.WebGLRendererTexture.allTextures())t+=s.GetEstimatedMemoryUsage();return t}GetEstimatedTotalMemoryUsage(){return this.GetEstimatedBackBufferMemoryUsage()+this.GetEstimatedRenderBufferMemoryUsage()+this.GetEstimatedTextureMemoryUsage()}GetWebGLVersionString(){return this._versionString}GetWebGLVersionNumber(){return this._version}GetDisplayName(){return"webgl"+this.GetWebGLVersionNumber()}SupportsNPOTTextures(){return this.GetWebGLVersionNumber()>=2}GetMaxTextureSize(){return this._maxTextureSize}GetMinPointSize(){return this._minPointSize}GetMaxPointSize(){return this._maxPointSize}SupportsHighP(){return 0!==this._highpPrecision}GetHighPPrecision(){return this._highpPrecision}GetUnmaskedVendor(){return this._unmaskedVendor}GetUnmaskedRenderer(){return this._unmaskedRenderer}GetWebGLExtensionsAnalyticsString(){if(this.GetWebGLVersionNumber()>=2)return"webgl2";{const e=[];return this._fragDepthExt&&e.push("EXT_frag_depth"),this._stdDerivativesExt&&e.push("OES_standard_derivatives"),this._textureLodExt&&e.push("EXT_shader_texture_lod"),e.length>0?"webgl1:"+e.join(","):"webgl1:none"}}GetExtensions(){return this._extensions}SupportsGPUProfiling(){return!!this._timerExt}_GetDisjointTimerQueryExtension(){return this._timerExt}_GetParallelShaderCompileExtension(){return this._parallelShaderCompileExt}_GetAnisotropicExtension(){return this._anisotropicExt}_GetMaxAnisotropy(){return this._maxAnisotropy}_AddQueryResultBuffer(e){this._allQueryResultBuffers.add(e)}_RemoveQueryResultBuffer(e){this._allQueryResultBuffers.delete(e)}_GetTimeQueryStack(){return this._timeQueryStack}GetContext(){return this._gl}_InitBlendModes(e){this._InitBlendModeData([["normal",e.ONE,e.ONE_MINUS_SRC_ALPHA],["additive",e.ONE,e.ONE],["xor",e.ONE,e.ONE_MINUS_SRC_ALPHA],["copy",e.ONE,e.ZERO],["destination-over",e.ONE_MINUS_DST_ALPHA,e.ONE],["source-in",e.DST_ALPHA,e.ZERO],["destination-in",e.ZERO,e.SRC_ALPHA],["source-out",e.ONE_MINUS_DST_ALPHA,e.ZERO],["destination-out",e.ZERO,e.ONE_MINUS_SRC_ALPHA],["source-atop",e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],["destination-atop",e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA]])}CreateRendererText(){return e.New(e.Gfx.RendererText,this)}CreateWebGLText(){return this.CreateRendererText()}}}{const e=self.C3,t={getDrawSize:null,getRenderTarget:null,releaseRenderTarget:null,getTime:null,redraw:null};e.Gfx.EffectChainManager=class{constructor(e){e=Object.assign({},t,e),this._cbGetDrawSize=e.getDrawSize,this._cbGetRenderTarget=e.getRenderTarget,this._cbReleaseRenderTarget=e.releaseRenderTarget,this._cbGetTime=e.getTime,this._cbRedraw=e.redraw,this._webgpuBackTexture=null,this._allEffectChains=new Set}_AddEffectChain(e){this._allEffectChains.add(e)}_RemoveEffectChain(e){this._allEffectChains.delete(e)}OnContextLost(){this._webgpuBackTexture=null;for(const e of this._allEffectChains)e.OnContextLost()}GetDrawSize(e){return this._cbGetDrawSize?this._cbGetDrawSize(e):[e.GetWidth(),e.GetHeight()]}GetRenderTarget(e){return this._cbGetRenderTarget(e)}ReleaseRenderTarget(e,t){this._cbReleaseRenderTarget(e,t)}GetTime(){return this._cbGetTime()}Redraw(e){this._cbRedraw(e)}_GetWebGPUBackTexture(e,t,s){return!this._webgpuBackTexture||this._webgpuBackTexture.GetWidth()===t&&this._webgpuBackTexture.GetHeight()===s||(e.DeleteTexture(this._webgpuBackTexture),this._webgpuBackTexture=null),null===this._webgpuBackTexture&&(this._webgpuBackTexture=e.CreateStaticTexture(null,{width:t,height:s,sampling:"nearest",mipMap:!1})),this._webgpuBackTexture}}}{const e=self.C3,t=self.assert,s=self.glMatrix,i=s.mat4,r=e.New(e.Rect),n=e.New(e.Rect),a=e.New(e.Rect),o=e.New(e.Rect),h=i.create(),l=i.create(),c={drawContent:null,getSourceTextureInfo:null,getShaderParameters:null,invalidateRenderTargets:!1},u={indexMap:null,forcePreDraw:!1,forcePostDraw:!1,is3D:!1,isSourceTextureRotated:!1,isRotatedOrNegativeSizeInstance:!1,useFullSurface:!1};e.Gfx.EffectChain=class{constructor(t,s){s=Object.assign({},c,s),this._manager=t,this._cbDrawContent=s.drawContent,this._cbGetSourceTextureInfo=s.getSourceTextureInfo,this._cbGetShaderParameters=s.getShaderParameters,this._cbDrawContentHook=null,this._shaderProgramList=[],this._shaderProgramIndices=[],this._steps=[],this._needsRebuild=!1,this._blendMode=0,this._isAnyShaderAnimated=!1,this._isAnyShaderDepthSampling=!1,this._isAnyShaderBackgroundBlending=!1,this._isAnyShaderCrossSampling=!1,this._isAnyIsSrcTexRotated=!1,this._useCopyTextureBackgroundSampling=!1,this._didChangeTransform=!1,this._depthEnabledAtStart=!1,this._canUseFastPath=!1,this._useFullSurface=!1,this._isSourceTextureRotated=!1,this._numTempSurfacesRequired=0,this._renderTargets=[null,null,null],this._invalidateRenderTargets=!!s.invalidateRenderTargets,this._boxExtendHorizontal=0,this._boxExtendVertical=0,this._drawWidth=0,this._drawHeight=0,this._contentObject=null,this._contextObject=null,this._layoutRect=e.New(e.Rect),this._drawSurfaceRect=e.New(e.Rect),this._rcTexOriginal=e.New(e.Rect),this._rcTexBounce=e.New(e.Rect),this._rcTexDest=e.New(e.Rect),this._devicePixelRatio=1,this._layerScale=1,this._layerAngle=0,this._time=0,this._destRenderTarget=null,this._backTex=null,this._compositOffX=0,this._compositOffY=0,this._updateOwnProjection=!1,this._projectionMatrix=i.create(),this._modelViewMatrix=i.create(),this._manager._AddEffectChain(this)}Release(){this._manager._RemoveEffectChain(this),e.clearArray(this._steps),e.clearArray(this._shaderProgramList),e.clearArray(this._shaderProgramIndices),this._contentObject=null,this._contextObject=null,this._cbDrawContent=null,this._cbGetSourceTextureInfo=null,this._cbGetShaderParameters=null}OnContextLost(){this._needsRebuild=!0,e.clearArray(this._steps),e.clearArray(this._shaderProgramList),e.clearArray(this._shaderProgramIndices)}NeedsRebuild(){return this._needsRebuild}BuildSteps(t,s){if(s=Object.assign({},u,s),e.clearArray(this._steps),this._boxExtendHorizontal=0,this._boxExtendVertical=0,this._isAnyShaderAnimated=!1,this._isAnyShaderDepthSampling=!1,this._isAnyShaderBackgroundBlending=!1,this._isAnyShaderCrossSampling=!1,this._isAnyIsSrcTexRotated=!1,this._useCopyTextureBackgroundSampling=!1,this._numTempSurfacesRequired=0,this._isSourceTextureRotated=!!s.isSourceTextureRotated,this._useFullSurface=!!s.useFullSurface,this._needsRebuild=!1,e.shallowAssignArray(this._shaderProgramList,t),0===t.length)return;if(s.indexMap){if(s.indexMap.length!==t.length)throw new Error("incorrect indexMap length");e.shallowAssignArray(this._shaderProgramIndices,s.indexMap)}else{e.clearArray(this._shaderProgramIndices);for(let e=0,s=t.length;e<s;++e)this._shaderProgramIndices.push(e)}for(const e of t)this._boxExtendHorizontal+=e.GetBoxExtendHorizontal(),this._boxExtendVertical+=e.GetBoxExtendVertical(),e.IsAnimated()&&(this._isAnyShaderAnimated=!0),e.UsesDepth()&&(this._isAnyShaderDepthSampling=!0),e.BlendsBackground()&&(this._isAnyShaderBackgroundBlending=!0),e.UsesCrossSampling()&&(this._isAnyShaderCrossSampling=!0),e.UsesIsSrcTexRotated()&&(this._isAnyIsSrcTexRotated=!0);this._useCopyTextureBackgroundSampling=this._ShouldUseCopyTextureBackgroundSampling(t[0].GetRenderer());const i=this._ShouldPreDraw(t[0],s),r=this._ShouldPostDraw(t.at(-1),s);if(1===t.length&&!i&&!r)return void(this._canUseFastPath=!0);this._canUseFastPath=!1;let n=0;i&&(this._numTempSurfacesRequired=1,this._steps.push(e.New(e.Gfx.EffectChain.Step.PreDraw,this,-1,1)),n=1);for(let s=0,a=t.length;s<a;++s)if(0!==s||i){let t=1===n?2:1;s!==a-1||r||(t=0),this._numTempSurfacesRequired=Math.max(this._numTempSurfacesRequired,t),this._steps.push(e.New(e.Gfx.EffectChain.Step.Bounce,this,n,t,s)),n=t}else this._numTempSurfacesRequired=1,this._steps.push(e.New(e.Gfx.EffectChain.Step.FirstBounce,this,-1,1,s)),n=1;r&&this._steps.push(e.New(e.Gfx.EffectChain.Step.PostDraw,this,n,0))}_ShouldPreDraw(e,t){return!(!(t.forcePreDraw||e.MustPreDraw()||t.is3D||e.UsesDepth()&&!this._useFullSurface)&&(0===this._boxExtendHorizontal&&0===this._boxExtendVertical||this._useFullSurface))||!!e.GetRenderer().IsWebGL()&&(e.BlendsBackground()&&(t.isRotatedOrNegativeSizeInstance||t.isSourceTextureRotated)||e.UsesAnySrcRectOrPixelSize()&&t.isSourceTextureRotated)}_ShouldPostDraw(e,t){return!!t.forcePostDraw||(e.GetRenderer().IsWebGL()?e.BlendsBackground()||e.UsesCrossSampling():(e.BlendsBackground()||e.UsesCrossSampling())&&this._UseRenderTargetBackgroundSampling())}_ShouldUseCopyTextureBackgroundSampling(e){return e.IsWebGPU()&&this._isAnyShaderBackgroundBlending&&!this._isAnyShaderCrossSampling}Render(e,t,s){e.IsWebGPU()&&null===t&&(t=e.GetBackbufferRenderTarget()),this._destRenderTarget=t,this._contentObject=s.contentObject||null,this._contextObject=s.contextObject||null,this._blendMode=s.blendMode||0,this._devicePixelRatio=s.devicePixelRatio||1,this._layerScale=s.layerScale||1,this._layerAngle=s.layerAngle||0,this._time="number"==typeof s.time?s.time:this._manager.GetTime(),this._didChangeTransform=!1,e.ResetDidChangeTransformFlag(),this._isAnyShaderAnimated&&this._Redraw();let i=!1;if(this._UseCopyTextureBackgroundSampling()&&(this._CalculateDrawSizeAndRectangles(e,s),i=!0,this._backTex=this._manager._GetWebGPUBackTexture(e,this._drawWidth,this._drawHeight),r.copy(this._drawSurfaceRect),r.roundOuter(),e.CopyTextureToTexture(this._destRenderTarget.GetTexture(),this._backTex,r.getLeft(),r.getTop(),r.width(),r.height())),this._canUseFastPath)this._Render_FastPath(e,s);else{i||this._CalculateDrawSizeAndRectangles(e,s),e.ResetColor(),e.SetBaseZ(0),e.SetCurrentZ(0),this._cbDrawContentHook=s.drawContentHook||null,this._compositOffX=s.compositOffX||0,this._compositOffY=s.compositOffY||0,this._updateOwnProjection=!!s.updateOwnProjection,this._OnBeforeStartEffectChain(e),this._renderTargets[0]=t,this._renderTargets[1]=this._numTempSurfacesRequired>=1?this._GetRenderTarget():null,this._renderTargets[2]=2===this._numTempSurfacesRequired?this._GetRenderTarget():null;for(const t of this._steps){const s=this._GetRenderTargetForId(t.GetSrcTargetId()),i=this._GetRenderTargetForId(t.GetDestTargetId());e.IsWebGPU()?t.Run_WebGPU(e,s,i):t.Run_WebGL(e,s,i)}this._renderTargets[1]&&this._ReleaseRenderTarget(this._renderTargets[1]),this._renderTargets[2]&&this._ReleaseRenderTarget(this._renderTargets[2]),this._renderTargets.fill(null),this._OnAfterEndEffectChain(e),this._destRenderTarget=null,this._backTex=null,this._contentObject=null,this._contextObject=null,this._cbDrawContentHook=null}}_CalculateDrawSizeAndRectangles(e,t){const[s,i]=this._manager.GetDrawSize(e);this._SetDrawSize(e,s,i),this._CalculateRectangles(t)}_SetDrawSize(e,t,s){if(t<=0||s<=0)throw new Error("invalid draw size");this._drawWidth===t&&this._drawHeight===s||this._CalculateDeviceTransformMatrices(e,t,s,0,0,this._projectionMatrix,this._modelViewMatrix),this._drawWidth=t,this._drawHeight=s}_CalculateDeviceTransformMatrices(e,t,s,r,n,a,o){const h=t/2+r,l=s/2+n;e.CalculatePerspectiveMatrix(a,t/s);const c=e.CalculateLookAtModelView2(h,l,e.GetDefaultCameraZ(s),h,l,0,s);i.copy(o,c)}_CalculateRectangles(e){this._layoutRect.copy(e.layoutRect),e.drawSurfaceRect?this._drawSurfaceRect.copy(e.drawSurfaceRect):this._drawSurfaceRect.set(0,0,this._drawWidth,this._drawHeight),this._rcTexOriginal.copy(this._drawSurfaceRect),this._rcTexOriginal.divide(this._drawWidth,this._drawHeight);const t=this._layerScale*this._devicePixelRatio;this._drawSurfaceRect.inflate(this._boxExtendHorizontal*t,this._boxExtendVertical*t),this._rcTexDest.copy(this._drawSurfaceRect),this._rcTexDest.divide(this._drawWidth,this._drawHeight),this._drawSurfaceRect.clamp(0,0,this._drawWidth,this._drawHeight),this._rcTexBounce.copy(this._drawSurfaceRect),this._rcTexBounce.divide(this._drawWidth,this._drawHeight)}_OnBeforeStartEffectChain(e){if(this._depthEnabledAtStart=e.IsDepthEnabled(),this._useFullSurface)e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0);else{if(r.copy(this._drawSurfaceRect),e.IsWebGL()){const e=this._layerScale*this._devicePixelRatio;r.inflate(Math.max(this._boxExtendHorizontal,1)*e,Math.max(this._boxExtendVertical,1)*e),r.roundOuter(),r.clamp(0,0,this._drawWidth,this._drawHeight)}else r.roundOuter();e.SetScissorRect(r.getLeft(),r.getTop(),r.width(),r.height(),this._drawHeight)}}_OnAfterEffectChainDrawContent(e){e.ResetColor(),this._useFullSurface||(e.SetDepthEnabled(!1),this._isAnyShaderDepthSampling&&e.SetDepthSamplingEnabled(!0)),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!0)}_OnAfterEndEffectChain(e){e.SetDepthSamplingEnabled(!1),e.SetDepthEnabled(this._depthEnabledAtStart),this._useFullSurface||e.RemoveScissorRect(),e.IsWebGPU()&&e.SetNormalizedCoordsProgramVariant(!1),this._didChangeTransform=e.DidChangeTransform()}_ClampRcTexDest(){this._rcTexDest.clamp(0,0,1,1)}_GetRenderTargetForId(e){return e<0?null:this._renderTargets[e]}_GetRenderTarget(){return this._manager.GetRenderTarget(this)}_GetDestRenderTarget(){return this._destRenderTarget}_ReleaseRenderTarget(e){this._manager.ReleaseRenderTarget(e,this)}_GetShaderProgramAt(e){return this._shaderProgramList[e]}_DrawContent(e){this._cbDrawContentHook?this._cbDrawContentHook(this,e,(()=>this._cbDrawContent(e,this))):this._cbDrawContent(e,this),this._canUseFastPath||this._OnAfterEffectChainDrawContent(e)}_IsRenderTargetSameSizeAndOffset(e){if(this._useFullSurface)return!0;if(0!==this._compositOffX||0!==this._compositOffY)return!1;const[t,s]=e.GetRenderTargetSize(e.GetRenderTarget());return t===this._drawWidth&&s===this._drawHeight}_SetDeviceTransform(e,t){let s=this._projectionMatrix,i=this._modelViewMatrix;if(t&&!this._IsRenderTargetSameSizeAndOffset(e)){s=h,i=l;const[t,r]=e.GetRenderTargetSize(e.GetRenderTarget());this._CalculateDeviceTransformMatrices(e,t,r,this._compositOffX,this._compositOffY,s,i),this._useFullSurface||e.RemoveScissorRect()}e.SetProjectionMatrix(s),e.SetModelViewMatrix(i)}_Redraw(){this._manager.Redraw(this)}_GetShaderParameters(e){return this._cbGetShaderParameters(this._shaderProgramIndices[e])}_SetProgramParameters(e,t){let s=this._rcTexDest,i=this._rcTexBounce,r=this._rcTexOriginal;e.IsWebGL()&&(n.copy(s),n.flipAround(1),s=n,a.copy(i),a.flipAround(1),i=a,o.copy(r),o.flipAround(1),r=o),this._DoSetProgramParameters(e,t,i,r,s,1/this._drawWidth,1/this._drawHeight)}_SetFirstBounceProgramParameters(e,t){let s=this._rcTexBounce,i=this._rcTexOriginal,h=1/this._drawWidth,l=1/this._drawHeight;if(this._cbGetSourceTextureInfo){let{srcTexRect:e,srcWidth:t,srcHeight:n}=this._cbGetSourceTextureInfo(this._contentObject);e||(r.set(0,0,0,0),e=r),t||(t=this._drawWidth),n||(n=this._drawHeight),s=e,i=e,h=1/t,l=1/n}else e.IsWebGL()&&(a.copy(s),a.flipAround(1),s=a,o.copy(i),o.flipAround(1),i=o);let c=this._rcTexDest;e.IsWebGL()&&(c=n,c.copy(this._rcTexDest),c.flipAround(1)),this._DoSetProgramParameters(e,t,s,i,c,h,l),e.IsWebGPU()&&this._isAnyIsSrcTexRotated&&e.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated)}_GetBackTex(e){return this._isAnyShaderBackgroundBlending?e.IsWebGPU()?this._UseCopyTextureBackgroundSampling()?this._backTex:this._destRenderTarget.GetTexture():this._destRenderTarget:null}_DoSetProgramParameters(e,t,s,i,r,n,a){e.SetProgramParameters(this._GetBackTex(e),r,s,i,this._layoutRect,n,a,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time),e.SetProgramCustomParameters(this._GetShaderParameters(t))}_Render_FastPath(e,t){const s=this._shaderProgramList[0],i=e.IsDepthEnabled(),r=s.UsesDepth();r&&(e.SetDepthEnabled(!1),e.SetDepthSamplingEnabled(!0),this._rcTexDest.set(0,0,1,1),this._rcTexOriginal.set(0,0,1,1)),e.SetProgram(s),e.SetBlendMode(this._blendMode),e.SetRenderTarget(this._destRenderTarget);let n=0,a=1;if(this._rcTexOriginal.set(0,0,1,1),s.UsesAnySrcRectOrPixelSize()&&this._cbGetSourceTextureInfo){const{srcTexRect:e,srcWidth:t,srcHeight:s}=this._cbGetSourceTextureInfo(this._contentObject);e&&this._rcTexOriginal.copy(e),n=Number.isFinite(t)?1/t:0,a=Number.isFinite(s)?1/s:0}else{const[t,s]=this._manager.GetDrawSize(e);n=1/t,a=1/s}t.layoutRect?this._layoutRect.copy(t.layoutRect):this._layoutRect.set(0,0,0,0),e.SetProgramParameters(this._GetBackTex(e),this._rcTexDest,this._rcTexOriginal,this._rcTexOriginal,this._layoutRect,n,a,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time),e.SetProgramCustomParameters(this._GetShaderParameters(0)),e.IsWebGPU()&&this._isAnyIsSrcTexRotated&&e.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated),e.SetBaseZ(0),this._DrawContent(e),r&&(e.SetDepthSamplingEnabled(!1),e.SetDepthEnabled(i))}_UseCopyTextureBackgroundSampling(){return this._useCopyTextureBackgroundSampling}_UseRenderTargetBackgroundSampling(){return!this._useCopyTextureBackgroundSampling}IsAnyShaderBackgroundBlending(){return this._isAnyShaderBackgroundBlending}CanSkipCalculatingDrawSurfaceRect(){return!!this._canUseFastPath&&!this._UseCopyTextureBackgroundSampling()}UseFullSurface(){return this._useFullSurface}GetContentObject(){return this._contentObject}GetContextObject(){return this._contextObject}_GetBlendMode(){return this._blendMode}_UpdateOwnProjection(){return this._updateOwnProjection}DidChangeTransform(){return this._didChangeTransform}_GetDrawSurfaceRect(){return this._drawSurfaceRect}_GetRcTexBounce(){return this._rcTexBounce}_ShouldInvalidateRenderTargets(){return this._invalidateRenderTargets}async DebugLogRenderTargetContents(e,t,s){}}}{const e=self.C3;e.Gfx.EffectChain.Step=class{constructor(e,t,s,i=-1){this._effectChain=e,this._srcTargetId=t,this._destTargetId=s,this._index=i}GetEffectChain(){return this._effectChain}GetSrcTargetId(){return this._srcTargetId}GetDestTargetId(){return this._destTargetId}GetIndex(){return this._index}GetShaderProgram(){return this.GetEffectChain()._GetShaderProgramAt(this.GetIndex())}Run_WebGL(e,t,s){}Run_WebGPU(e,t,s){}}}{const e=self.C3;e.Gfx.EffectChain.Step.PreDraw=class extends e.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,t,s){const i=this.GetEffectChain();e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(s,i._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),i._DrawContent(e),i._ClampRcTexDest()}Run_WebGPU(e,t,s){const i=this.GetEffectChain();e.SetAlphaBlend(),e.SetTextureFillMode(),e.SetRenderTarget(s,!1),e.ClearRgba(0,0,0,0),i._DrawContent(e),i._ClampRcTexDest()}}}{const e=self.C3,t=e.New(e.Rect),s=e.New(e.Quad);e.Gfx.EffectChain.Step.PostDraw=class extends e.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,i,r){const n=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(r),n._SetDeviceTransform(e,!0),e.SetBlendMode(n._GetBlendMode()),e.SetTexture(i.GetTexture()),s.setFromRect(n._GetDrawSurfaceRect()),t.copy(n._GetRcTexBounce()),t.flipAround(1),e.Quad3(s,t),n._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(i)}Run_WebGPU(e,t,i){const r=this.GetEffectChain();e.SetTextureFillMode(),e.SetRenderTarget(i,!1),r._IsRenderTargetSameSizeAndOffset(e)?s.setFromRect(r._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),r._SetDeviceTransform(e,!0),s.setFromRect(r._GetDrawSurfaceRect())),e.SetBackTexture(null),e.SetBlendMode(r._GetBlendMode()),e.SetTexture(t.GetTexture()),r.UseFullSurface()?e.FullscreenQuad():e.Quad3(s,r._GetRcTexBounce())}}}{const e=self.C3;e.Gfx.EffectChain.Step.FirstBounce=class extends e.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,t,s){const i=this.GetEffectChain();e.SetRenderTarget(s,i._UpdateOwnProjection()),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),i._SetFirstBounceProgramParameters(e,this.GetIndex()),i._DrawContent(e),i._ClampRcTexDest()}Run_WebGPU(e,t,s){const i=this.GetEffectChain();e.SetRenderTarget(s,!1),e.ClearRgba(0,0,0,0),e.SetCopyBlend(),e.SetProgram(this.GetShaderProgram()),i._SetFirstBounceProgramParameters(e,this.GetIndex()),i._DrawContent(e),i._ClampRcTexDest()}}}{const e=self.C3,t=e.New(e.Rect),s=e.New(e.Quad);e.Gfx.EffectChain.Step.Bounce=class extends e.Gfx.EffectChain.Step{constructor(e,t,s,i){super(e,t,s,i)}Run_WebGL(e,i,r){const n=this.GetEffectChain();e.SetRenderTarget(r);const a=0===this.GetDestTargetId();a?e.SetBlendMode(n._GetBlendMode()):(e.ClearRgba(0,0,0,0),e.SetCopyBlend()),e.SetProgram(this.GetShaderProgram()),n._SetProgramParameters(e,this.GetIndex()),e.SetTexture(i.GetTexture()),n._SetDeviceTransform(e,a),s.setFromRect(n._GetDrawSurfaceRect()),t.copy(n._GetRcTexBounce()),t.flipAround(1),e.Quad3(s,t),n._ShouldInvalidateRenderTargets()&&e.InvalidateRenderTarget(i)}Run_WebGPU(e,t,i){const r=this.GetEffectChain();e.SetRenderTarget(i,!1);0===this.GetDestTargetId()?(e.SetBlendMode(r._GetBlendMode()),e.SetBackTexture(null),r._IsRenderTargetSameSizeAndOffset(e)?s.setFromRect(r._GetRcTexBounce()):(e.SetNormalizedCoordsProgramVariant(!1),r._SetDeviceTransform(e,!0),s.setFromRect(r._GetDrawSurfaceRect()))):(e.ClearRgba(0,0,0,0),e.SetCopyBlend(),s.setFromRect(r._GetRcTexBounce())),e.SetProgram(this.GetShaderProgram()),r._SetProgramParameters(e,this.GetIndex()),e.SetTexture(t.GetTexture()),r.UseFullSurface()?e.FullscreenQuad():e.Quad3(s,r._GetRcTexBounce())}}}{const e=self.C3,t=self.C3X;let s=null;const i=new Set;function SortZOrderList(e,t){const s=e[0]-t[0];if(0!==s)return s;return e[1]-t[1]}const r=[],n=[];let a=!1;self.IRuntime=class{constructor(e,t){s=e,Object.defineProperties(this,{assets:{value:s.GetAssetManager().GetIAssetManager(),writable:!1},objects:{value:t,writable:!1},globalVars:{value:{},writable:!1},projectName:{value:s.GetProjectName(),writable:!1},projectVersion:{value:s.GetProjectVersion(),writable:!1},storage:{value:new self.IStorage(s),writable:!1},isInWorker:{value:s.IsInWorker(),writable:!1},viewportWidth:{value:s.GetOriginalViewportWidth(),writable:!1},viewportHeight:{value:s.GetOriginalViewportHeight(),writable:!1}}),s.UserScriptDispatcher().addEventListener("keydown",(e=>{i.has(e.key)?e.stopPropagation():i.add(e.key)})),s.UserScriptDispatcher().addEventListener("keyup",(e=>i.delete(e.key))),s.Dispatcher().addEventListener("window-blur",(()=>i.clear())),s.IsInWorker()&&(self.alert=e=>(a||(a=!0),this.alert(e)))}_InitGlobalVars(e){Object.defineProperties(this.globalVars,e)}addEventListener(e,t){s.UserScriptDispatcher().addEventListener(e,t)}removeEventListener(e,t){s.UserScriptDispatcher().removeEventListener(e,t)}callFunction(e,...i){t.RequireString(e);const r=s.GetEventSheetManager(),n=r.GetFunctionBlockByName(e);if(!n)throw new Error(`cannot find function name '${e}'`);if(!n.IsEnabled())return n.GetDefaultReturnValue();if(i.length<n.GetFunctionParameterCount())throw new Error(`not enough function parameters passed for '${e}' (${i.length} passed, ${n.GetFunctionParameterCount()} expected)`);const a=n.GetEventBlock();let o=null;const h=r.GetCurrentEvent();if(h){const e=h.GetSolModifiersIncludingParents();e.length>0&&(o=e,n.IsCopyPicked()?r.PushCopySol(e):r.PushCleanSol(e))}const l=a.RunAsExpressionFunctionCall(a.GetSolModifiersIncludingParents(),n.IsCopyPicked(),n.GetReturnType(),n.GetDefaultReturnValue(),...i);return o&&r.PopSol(o),l}setReturnValue(e){const t=s.GetEventStack().GetCurrentExpFuncStackFrame();if(!t)throw new Error("not in a function which returns a value");switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:"number"!=typeof e&&"string"!=typeof e||t.SetFunctionReturnValue(e);break}}getViewportSize(){return[s.GetOriginalViewportWidth(),s.GetOriginalViewportHeight()]}get dt(){return s.GetDt()}get dtRaw(){return s.GetDtRaw()}get gameTime(){return s.GetGameTime()}get wallTime(){return s.GetWallTime()}get fps(){return s.GetFPS()}get cpuUtilisation(){return s.GetMainThreadTime()}get gpuUtilisation(){return s.GetGPUUtilisation()}random(){return s.Random()}get layout(){return s.GetMainRunningLayout().GetILayout()}getLayout(e){const t=s.GetLayoutManager();let i=null;if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(i=t.GetLayout(e),!i)throw new Error("invalid layout");return i.GetILayout()}getAllLayouts(){return s.GetLayoutManager().GetAllLayouts().map((e=>e.GetILayout()))}goToLayout(e){const t=s.GetLayoutManager();let i=null;if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");if(i=t.GetLayout(e),!i)throw new Error("invalid layout");t.IsPendingChangeMainLayout()||t.ChangeMainLayout(i)}get keyboard(){const e=s._GetCommonScriptInterfaces().keyboard;if(!e)throw new Error("runtime.keyboard used but Keyboard object missing - add it to your project first");return e}get mouse(){const e=s._GetCommonScriptInterfaces().mouse;if(!e)throw new Error("runtime.mouse used but Mouse object missing - add it to your project first");return e}get touch(){const e=s._GetCommonScriptInterfaces().touch;if(!e)throw new Error("runtime.touch used but Touch object missing - add it to your project first");return e}invokeDownload(e,i){t.RequireString(e),t.RequireString(i),s.InvokeDownload(e,i)}getInstanceByUid(e){t.RequireFiniteNumber(e);const i=s.GetInstanceByUID(e);return i?i.GetInterfaceClass():null}sortZOrder(i,a){t.RequireFunction(a);const o=s.GetCurrentLayout();for(const e of i){const t=s._UnwrapIWorldInstance(e),i=t.GetWorldInfo();r.push([i.GetLayer().GetIndex(),i.GetZIndex()]),n.push(t)}if(0===r.length)return;r.sort(SortZOrderList),n.sort(((e,t)=>a(e.GetInterfaceClass(),t.GetInterfaceClass())));let h=!1;for(let e=0,t=r.length;e<t;++e){const t=n[e],s=o.GetLayerByIndex(r[e][0]),i=r[e][1],a=s._GetInstances();a[i]!==t&&(a[i]=t,t.GetWorldInfo()._SetLayer(s,!0),s.SetZIndicesChanged(),h=!0)}h&&s.UpdateRender(),e.clearArray(r),e.clearArray(n)}async createWorker(e,t){const i=new MessageChannel,r=i.port1,n=i.port2;return await s.PostComponentMessageToDOMAsync("runtime","script-create-worker",{url:e,opts:t,port2:n},[n]),r}alert(e){return s.PostComponentMessageToDOMAsync("runtime","alert",{message:e+(s.IsInWorker()?" [via Web Worker]":"")})}}}{const e=self.C3,t=self.C3X;let s=null;self.IAssetManager=class{constructor(e){s=e,Object.defineProperties(this,{isWebMOpusSupported:{value:s.IsAudioFormatSupported("audio/webm; codecs=opus"),writable:!1}})}fetchText(e){return s.FetchText(e)}fetchJson(e){return s.FetchJson(e)}fetchBlob(e){return s.FetchBlob(e)}fetchArrayBuffer(e){return s.FetchArrayBuffer(e)}getProjectFileUrl(e){return s.GetProjectFileUrl(e)}getMediaFileUrl(t){return"flat"===s.GetFileStructure()&&e.IsRelativeURL(t)&&(t=t.toLowerCase()),s.GetMediaFileUrl(t)}get mediaFolder(){return s.GetMediaSubfolder()}async decodeWebMOpus(e,t){if(this.isWebMOpusSupported)throw new Error("decodeWebMOpus(): not supported because WebM Opus is supported by the platform");const i=await s.GetRuntime()._WasmDecodeWebMOpus(t),r=new Float32Array(i),n=e.createBuffer(1,r.length,48e3);return n.getChannelData(0).set(r),n}loadScripts(...e){return s.LoadScripts(...e)}compileWebAssembly(e){return s.CompileWebAssembly(e)}loadStyleSheet(e){return s.LoadStyleSheet(e)}}}{const e=self.C3,t=self.C3X;self.IStorage=class{constructor(e){this._storage=e._GetProjectStorage()}getItem(e){return t.RequireString(e),this._storage.getItem(e)}setItem(e,s){return t.RequireString(e),this._storage.setItem(e,s)}removeItem(e){return t.RequireString(e),this._storage.removeItem(e)}clear(){return this._storage.clear()}keys(){return this._storage.keys()}}}{const e=self.C3,t=self.C3X,s=new WeakMap;self.IObjectClass=class{constructor(e){s.set(this,e),Object.defineProperties(this,{name:{value:e.GetName(),writable:!1}}),e.GetRuntime()._MapScriptInterface(this,e)}addEventListener(e,i){t.RequireString(e),t.RequireFunction(i),s.get(this).UserScriptDispatcher().addEventListener(e,i)}removeEventListener(e,i){t.RequireString(e),t.RequireFunction(i),s.get(this).UserScriptDispatcher().removeEventListener(e,i)}getAllInstances(){return[...this.instances()]}getFirstInstance(){return e.first(this.instances())}getPickedInstances(){return[...this.pickedInstances()]}getFirstPickedInstance(){return e.first(this.pickedInstances())}*instances(){for(const e of s.get(this).instancesIncludingPendingCreate())yield e.GetInterfaceClass()}*pickedInstances(){for(const e of s.get(this).GetCurrentSol().GetInstances())yield e.GetInterfaceClass()}setInstanceClass(e){t.RequireFunction(e);if(s.get(this).GetInstanceCount()>0)throw new Error("setInstanceClass() called too late, because instances have already been created - call in runOnStartup");s.get(this)._SetUserScriptInstanceClass(e)}createInstance(e,i,r,n,a){if(t.RequireNumber(i),t.RequireNumber(r),"number"!=typeof e&&"string"!=typeof e)throw new TypeError("invalid layer parameter");const o=s.get(this),h=o.GetRuntime(),l=h.GetMainRunningLayout().GetLayer(e);if(!l)throw new Error("invalid layer");const c=h.CreateInstance(o,l,i,r,n,a);n&&l.SortAndAddInstancesByZIndex(c);const u=h.GetEventSheetManager();return u.BlockFlushingInstances(!0),c._TriggerOnCreatedOnSelfAndRelated(),u.BlockFlushingInstances(!1),u.IsInEventEngine()||h.GetLayoutManager().IsEndingLayout()||h.FlushPendingInstances(),c.GetInterfaceClass()}}}{const e=self.C3,t=self.C3X,s=new WeakMap;self.ILayout=class{constructor(e){s.set(this,e);const t=[],i=e.GetEffectList(),r=i.GetAllEffectTypes().length;for(let e=0;e<r;++e)t.push(new self.IEffectInstance(i,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},index:{value:e.GetIndex(),writable:!1},effects:{value:t,writable:!1}})}addEventListener(e,i){t.RequireString(e),t.RequireFunction(i),s.get(this).UserScriptDispatcher().addEventListener(e,i)}removeEventListener(e,i){t.RequireString(e),t.RequireFunction(i),s.get(this).UserScriptDispatcher().removeEventListener(e,i)}get width(){return s.get(this).GetWidth()}set width(e){t.RequireFiniteNumber(e),s.get(this).SetWidth(e)}get height(){return s.get(this).GetHeight()}set height(e){t.RequireFiniteNumber(e),s.get(this).SetHeight(e)}setSize(e,i){t.RequireFiniteNumber(e),t.RequireFiniteNumber(i);const r=s.get(this);r.SetWidth(e),r.SetHeight(i)}getSize(){const e=s.get(this);return[e.GetWidth(),e.GetHeight()]}set scale(e){t.RequireFiniteNumber(e),s.get(this).SetScale(e)}get scale(){return s.get(this).GetScale()}set angle(e){t.RequireFiniteNumber(e),s.get(this).SetAngle(e)}get angle(){return s.get(this).GetAngle()}set scrollX(e){t.RequireNumber(e),s.get(this).SetScrollX(e)}get scrollX(){return s.get(this).GetScrollX()}set scrollY(e){t.RequireNumber(e),s.get(this).SetScrollY(e)}get scrollY(){return s.get(this).GetScrollY()}scrollTo(e,i){t.RequireNumber(e),t.RequireNumber(i);const r=s.get(this);r.SetScrollX(e),r.SetScrollY(i)}getScrollPosition(){const e=s.get(this);return[e.GetScrollX(),e.GetScrollY()]}getLayer(e){const t=s.get(this);let i=null;if("number"!=typeof e&&"string"!=typeof e)throw new TypeError("expected string or number");return i=t.GetLayer(e),i?i.GetILayer():null}getAllLayers(){return s.get(this).GetLayers().map((e=>e.GetILayer()))}*allLayers(){for(const e of s.get(this).allLayers())yield e.GetILayer()}setVanishingPoint(e,i){t.RequireFiniteNumber(e),t.RequireFiniteNumber(i),s.get(this).SetVanishingPointXY(e,i)}getVanishingPoint(){return s.get(this)._GetVanishingPoint()}set projection(e){t.RequireString(e);const i=s.get(this);if("perspective"===e)i.SetPerspectiveProjection();else{if("orthographic"!==e)throw new Error("invalid projection");i.SetOrthographicProjection()}}get projection(){return s.get(this).IsOrthographicProjection()?"orthographic":"perspective"}}}{const e=self.C3,t=self.C3X,s=new WeakMap,i=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),r=new Map([...i.entries()].map((e=>[e[1],e[0]]))),n=e.New(e.Color);self.ILayer=class{constructor(e){s.set(this,e);const t=[],i=e.GetEffectList(),r=i.GetAllEffectTypes().length;for(let e=0;e<r;++e)t.push(new self.IEffectInstance(i,e));Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},index:{value:e.GetIndex(),writable:!1},layout:{value:e.GetLayout().GetILayout(),writable:!1},effects:{value:t,writable:!1}})}static _Unwrap(e){return s.get(e)}get parentLayer(){const e=s.get(this).GetParentLayer();return e?e.GetILayer():null}*parentLayers(){for(const e of s.get(this).parentLayers())yield e.GetILayer()}*subLayers(){for(const e of s.get(this).GetSubLayers())yield e.GetILayer()}*allSubLayers(){for(const e of s.get(this).GetSubLayers())for(const t of e.selfAndAllSubLayers())yield t.GetILayer()}get isVisible(){return s.get(this)._IsVisibleFlagSet()}set isVisible(e){s.get(this).SetVisible(e)}get isSelfAndParentsVisible(){return s.get(this).IsVisible()}get isInteractive(){return s.get(this).IsInteractive()}set isInteractive(e){s.get(this).SetInteractive(e)}get isSelfAndParentsInteractive(){return s.get(this).IsSelfAndParentsInteractive()}get opacity(){return s.get(this).GetOpacity()}set opacity(t){t=e.clamp(+t,0,1),isNaN(t)||s.get(this).SetOpacity(t)}set scale(e){t.RequireFiniteNumber(e),s.get(this).SetOwnScale(e)}get scale(){return s.get(this).GetOwnScale()}set scaleRate(e){t.RequireFiniteNumber(e),s.get(this).SetScaleRate(e)}get scaleRate(){return s.get(this).GetScaleRate()}set angle(e){t.RequireFiniteNumber(e),s.get(this).SetAngle(e)}get angle(){return s.get(this).GetOwnAngle()}set parallaxX(e){t.RequireFiniteNumber(e),s.get(this).SetParallaxX(e)}get parallaxX(){return s.get(this).GetParallaxX()}set parallaxY(e){t.RequireFiniteNumber(e),s.get(this).SetParallaxY(e)}get parallaxY(){return s.get(this).GetParallaxY()}set zElevation(e){t.RequireFiniteNumber(e),s.get(this).SetZElevation(e)}get zElevation(){return s.get(this).GetZElevation()}set isTransparent(e){s.get(this).SetTransparent(e)}get isTransparent(){return s.get(this).IsTransparent()}set isForceOwnTexture(e){s.get(this).SetForceOwnTexture(e)}get isForceOwnTexture(){return s.get(this).IsForceOwnTexture()}set blendMode(e){t.RequireString(e);const r=i.get(e);if("number"!=typeof r)throw new Error("invalid blend mode");s.get(this).SetBlendMode(r)}get blendMode(){return r.get(s.get(this).GetBlendMode())}set backgroundColor(e){if(t.RequireArray(e),e.length<3)throw new Error("expected 3 elements");n.setRgb(e[0],e[1],e[2]);const i=s.get(this),r=i.GetBackgroundColor();r.equalsIgnoringAlpha(n)||(r.copyRgb(n),i.GetRuntime().UpdateRender())}get backgroundColor(){const e=s.get(this).GetBackgroundColor();return[e.getR(),e.getG(),e.getB()]}set scrollX(e){t.RequireNumber(e);const i=s.get(this);i.SetOwnScrollPositionEnabled(!0),i.SetScrollX(e)}get scrollX(){return s.get(this).GetScrollX()}set scrollY(e){t.RequireNumber(e);const i=s.get(this);i.SetOwnScrollPositionEnabled(!0),i.SetScrollY(e)}get scrollY(){return s.get(this).GetScrollY()}scrollTo(e,i){t.RequireNumber(e),t.RequireNumber(i);const r=s.get(this);r.SetOwnScrollPositionEnabled(!0),r.SetScrollX(e),r.SetScrollY(i)}getScrollPosition(){const e=s.get(this);return[e.GetScrollX(),e.GetScrollY()]}restoreScrollPosition(){s.get(this).SetOwnScrollPositionEnabled(!1)}getViewport(){return s.get(this).GetViewport().toDOMRect()}cssPxToLayer(e,i,r=0){t.RequireNumber(e),t.RequireNumber(i),t.RequireNumber(r);const n=s.get(this),a=n.GetRuntime();return n.CanvasCssToLayer(e-a.GetCanvasClientX(),i-a.GetCanvasClientY(),r)}layerToCssPx(e,i,r=0){t.RequireNumber(e),t.RequireNumber(i),t.RequireNumber(r);const n=s.get(this),a=n.GetRuntime(),[o,h]=n.LayerToCanvasCss(e,i,r);return[o+a.GetCanvasClientX(),h+a.GetCanvasClientY()]}}}{const e=self.C3,t=self.C3X,s=new WeakMap,i=new WeakMap;function GetDispatcher(t){let s=i.get(t);return s||(s=e.New(e.Event.Dispatcher),i.set(t,s),s)}let r=null;self.IInstance=class{constructor(){s.set(this,r);const e={runtime:{value:r.GetRuntime().GetIRuntime(),writable:!1},objectType:{value:r.GetObjectClass().GetIObjectClass(),writable:!1},uid:{value:r.GetUID(),writable:!1}};r._GetInstVarsScriptDescriptor(e),r._GetBehaviorsScriptDescriptor(e),Object.defineProperties(this,e),r.GetRuntime()._MapScriptInterface(this,r)}static _Init(e){r=e}static _GetInitInst(){return r}_Release(){const e=i.get(this);e&&(e.Release(),i.delete(this)),s.delete(this)}addEventListener(e,s,i){t.RequireString(e),t.RequireFunction(s),GetDispatcher(this).addEventListener(e,s,i)}removeEventListener(e,s,i){t.RequireString(e),t.RequireFunction(s),GetDispatcher(this).removeEventListener(e,s,i)}dispatchEvent(e){GetDispatcher(this).dispatchEvent(e)}destroy(){const e=s.get(this),t=e.GetRuntime();t.DestroyInstance(e),t.GetEventSheetManager().IsInEventEngine()||t.GetLayoutManager().IsEndingLayout()||t.FlushPendingInstances()}getOtherContainerInstances(){const e=s.get(this).GetSiblings();return e?e.map((e=>e.GetInterfaceClass())):[]}*otherContainerInstances(){const e=s.get(this);if(e.IsInContainer())for(const t of e.siblings())yield t.GetInterfaceClass()}}}{const e=self.C3,t=self.C3X,s=self.IInstance,i=self.ILayer,r=new WeakMap,n=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]),a=new Map([...n.entries()].map((e=>[e[1],e[0]]))),o=e.New(e.Color);self.IWorldInstance=class h extends s{constructor(){super();const e=s._GetInitInst();r.set(this,e);const t=[],i=e.GetWorldInfo(),n=i.GetInstanceEffectList();if(n){const e=i.GetObjectClass().GetEffectList().GetAllEffectTypes().length;for(let s=0;s<e;++s)t.push(new self.IEffectInstance(n,s))}const a={effects:{value:t,writable:!1}};Object.defineProperties(this,a)}get layout(){return r.get(this).GetWorldInfo().GetLayout().GetILayout()}get layer(){return r.get(this).GetWorldInfo().GetLayer().GetILayer()}get x(){return r.get(this).GetWorldInfo().GetX()}set x(e){e=+e;const t=r.get(this).GetWorldInfo();isNaN(e)||t.GetX()===e||(t.SetX(e),t.SetBboxChanged())}get y(){return r.get(this).GetWorldInfo().GetY()}set y(e){e=+e;const t=r.get(this).GetWorldInfo();isNaN(e)||t.GetY()===e||(t.SetY(e),t.SetBboxChanged())}setPosition(e,t){e=+e,t=+t;const s=r.get(this).GetWorldInfo();isNaN(e)||isNaN(t)||s.GetX()===e&&s.GetY()===t||(s.SetXY(e,t),s.SetBboxChanged())}getPosition(){const e=r.get(this).GetWorldInfo();return[e.GetX(),e.GetY()]}offsetPosition(e,t){if(e=+e,t=+t,isNaN(e)||isNaN(t)||0===e&&0===t)return;const s=r.get(this).GetWorldInfo();s.OffsetXY(e,t),s.SetBboxChanged()}get zElevation(){return r.get(this).GetWorldInfo().GetZElevation()}set zElevation(e){e=+e;const t=r.get(this),s=t.GetWorldInfo();isNaN(e)||s.GetZElevation()===e||(s.SetZElevation(e),t.GetRuntime().UpdateRender())}get totalZElevation(){return r.get(this).GetWorldInfo().GetTotalZElevation()}get width(){return r.get(this).GetWorldInfo().GetWidth()}set width(e){e=+e;const t=r.get(this).GetWorldInfo();isNaN(e)||t.GetWidth()===e||(t.SetWidth(e),t.SetBboxChanged())}get height(){return r.get(this).GetWorldInfo().GetHeight()}set height(e){e=+e;const t=r.get(this).GetWorldInfo();isNaN(e)||t.GetHeight()===e||(t.SetHeight(e),t.SetBboxChanged())}setSize(e,t){e=+e,t=+t;const s=r.get(this).GetWorldInfo();isNaN(e)||isNaN(t)||s.GetWidth()===e&&s.GetHeight()===t||(s.SetSize(e,t),s.SetBboxChanged())}getSize(){const e=r.get(this).GetWorldInfo();return[e.GetWidth(),e.GetHeight()]}get angle(){return r.get(this).GetWorldInfo().GetAngle()}set angle(t){t=e.clampAngle(+t);const s=r.get(this).GetWorldInfo();isNaN(t)||s.GetAngle()===t||(s.SetAngle(t),s.SetBboxChanged())}get angleDegrees(){return e.toDegrees(this.angle)}set angleDegrees(t){this.angle=e.toRadians(t)}getBoundingBox(){return r.get(this).GetWorldInfo().GetBoundingBox().toDOMRect()}getBoundingQuad(){return r.get(this).GetWorldInfo().GetBoundingQuad().toDOMQuad()}get isVisible(){return r.get(this).GetWorldInfo().IsVisible()}set isVisible(e){e=!!e;const t=r.get(this),s=t.GetWorldInfo();s.IsVisible()!==e&&(s.SetVisible(e),t.GetRuntime().UpdateRender())}get opacity(){return r.get(this).GetWorldInfo().GetOpacity()}set opacity(t){t=e.clamp(+t,0,1);const s=r.get(this),i=s.GetWorldInfo();isNaN(t)||i.GetOpacity()===t||(i.SetOpacity(t),s.GetRuntime().UpdateRender())}set colorRgb(e){if(t.RequireArray(e),e.length<3)throw new Error("expected 3 elements");o.setRgb(e[0],e[1],e[2]);const s=r.get(this),i=s.GetWorldInfo();i.GetUnpremultipliedColor().equalsIgnoringAlpha(o)||(i.SetUnpremultipliedColor(o),s.GetRuntime().UpdateRender())}get colorRgb(){const e=r.get(this).GetWorldInfo().GetUnpremultipliedColor();return[e.getR(),e.getG(),e.getB()]}set blendMode(e){t.RequireString(e);const s=n.get(e);if("number"!=typeof s)throw new Error("invalid blend mode");const i=r.get(this);i.GetWorldInfo().SetBlendMode(s),i.GetRuntime().UpdateRender()}get blendMode(){return a.get(r.get(this).GetWorldInfo().GetBlendMode())}moveToTop(){r.get(this).GetWorldInfo().ZOrderMoveToTop()}moveToBottom(){r.get(this).GetWorldInfo().ZOrderMoveToBottom()}moveToLayer(e){t.RequireInstanceOf(e,i);const s=i._Unwrap(e);if(!s)throw new Error("invalid layer");r.get(this).GetWorldInfo().ZOrderMoveToLayer(s)}moveAdjacentToInstance(e,s){t.RequireInstanceOf(e,h),r.get(this).GetWorldInfo().ZOrderMoveAdjacentToInstance(r.get(e),s)}get zIndex(){return r.get(this).GetWorldInfo().GetZIndex()}containsPoint(e,s){return t.RequireNumber(e),t.RequireNumber(s),r.get(this).GetWorldInfo().ContainsPoint(+e,+s)}testOverlap(e){t.RequireInstanceOf(e,h);const s=r.get(this),i=r.get(e);return s.GetRuntime().GetCollisionEngine().TestOverlap(s,i)}testOverlapSolid(){const e=r.get(this),t=e.GetRuntime().GetCollisionEngine().TestOverlapSolid(e);return t?t.GetInterfaceClass():null}getParent(){const e=r.get(this).GetParent();return e?e.GetInterfaceClass():null}getTopParent(){const e=r.get(this).GetTopParent();return e?e.GetInterfaceClass():null}*parents(){for(const e of r.get(this).parents())yield e.GetInterfaceClass()}getChildCount(){return r.get(this).GetChildCount()}getChildAt(e){const t=r.get(this).GetChildAt(e);return t?t.GetInterfaceClass():null}*children(){for(const e of r.get(this).children())yield e.GetInterfaceClass()}*allChildren(){for(const e of r.get(this).allChildren())yield e.GetInterfaceClass()}addChild(e,s){t.RequireInstanceOf(e,h),t.RequireOptionalObject(s),s||(s={});const i=r.get(this),n=r.get(e);i.AddChild(n,s)}removeChild(e){t.RequireInstanceOf(e,h);const s=r.get(this),i=r.get(e);s.RemoveChild(i)}removeFromParent(){const e=r.get(this);if(!e.HasParent())return;e.GetParent().RemoveChild(e)}createMesh(e,s){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),r.get(this).GetWorldInfo().CreateMesh(e,s)}releaseMesh(){const e=r.get(this).GetWorldInfo();e.ReleaseMesh(),e.SetBboxChanged()}setMeshPoint(e,s,i){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireObject(i);const n=r.get(this).GetWorldInfo();n.SetMeshPoint(e,s,i)&&n.SetBboxChanged()}getMeshSize(){const e=r.get(this).GetWorldInfo();if(!e.HasMesh())return[0,0];const t=e.GetSourceMesh();return[t.GetHSize(),t.GetVSize()]}}}{const e=self.C3,t=self.C3X,s=new WeakMap;self.IDOMInstance=class extends self.IWorldInstance{constructor(){super(),s.set(this,self.IInstance._GetInitInst())}getElement(){return s.get(this).GetSdkInstance()._GetElementInDOMMode()}focus(){s.get(this).GetSdkInstance().FocusElement()}blur(){s.get(this).GetSdkInstance().BlurElement()}setCssStyle(e,i){t.RequireString(e),s.get(this).GetSdkInstance().SetElementCSSStyle(e,i)}}}{const e=self.C3,t=self.C3X,s=new WeakMap,i=new WeakMap;function GetDispatcher(t){let s=i.get(t);return s||(s=e.New(e.Event.Dispatcher),i.set(t,s),s)}let r=null;self.IBehaviorInstance=class{constructor(){s.set(this,r);const e={runtime:{value:r.GetRuntime().GetIRuntime(),writable:!1},behavior:{value:r.GetBehavior().GetIBehavior(),writable:!1}};Object.defineProperties(this,e)}static _Init(e){r=e}static _GetInitInst(){return r}get instance(){return s.get(this).GetObjectInstance().GetInterfaceClass()}_Release(){const e=i.get(this);e&&(e.Release(),i.delete(this)),s.delete(this)}addEventListener(e,s,i){t.RequireString(e),t.RequireFunction(s),GetDispatcher(this).addEventListener(e,s,i)}removeEventListener(e,s,i){t.RequireString(e),t.RequireFunction(s),GetDispatcher(this).removeEventListener(e,s,i)}dispatchEvent(e){GetDispatcher(this).dispatchEvent(e)}}}{const e=self.C3,t=self.C3X,s=new WeakMap;self.IBehavior=class{constructor(e){s.set(this,e);const t={runtime:{value:e.GetRuntime().GetIRuntime(),writable:!1}};Object.defineProperties(this,t)}getAllInstances(){return s.get(this).GetInstances().map((e=>e.GetInterfaceClass()))}}}{const e=self.C3,t=self.C3X,s=new WeakMap,i=e.New(e.Color);self.IEffectInstance=class{constructor(e,t){s.set(this,e);const i={index:{value:t,writable:!1}};Object.defineProperties(this,i)}get name(){return s.get(this).GetAllEffectTypes()[this.index].GetName()}get isActive(){return s.get(this).IsEffectIndexActive(this.index)}set isActive(e){e=!!e;const t=s.get(this);t.IsEffectIndexActive(this.index)!==e&&(t.SetEffectIndexActive(this.index,e),t.UpdateActiveEffects(),t.GetRuntime().UpdateRender())}setParameter(r,n){t.RequireFiniteNumber(r),r=Math.floor(+r);const a=s.get(this),o=a.GetEffectParameter(this.index,r);if(null===o)throw new RangeError("invalid index");if(o instanceof e.Color){if(!Array.isArray(n)||n.length<3)throw new TypeError("expected array with 3 elements");i.setRgb(n[0],n[1],n[2]),n=i}else if("number"!=typeof n)throw new TypeError("expected number");a.SetEffectParameter(this.index,r,n)&&a.IsEffectIndexActive(this.index)&&a.GetRuntime().UpdateRender()}getParameter(i){t.RequireFiniteNumber(i),i=Math.floor(+i);const r=s.get(this).GetEffectParameter(this.index,i);if(null===r)throw new RangeError("invalid index");return r instanceof e.Color?[r.getR(),r.getG(),r.getB()]:r}}}{const e=self.C3,t=self.C3X,s=new WeakMap;self.IAnimation=class{constructor(e){s.set(this,e),Object.defineProperties(this,{name:{value:e.GetName(),writable:!1},speed:{value:e.GetSpeed(),writable:!1},isLooping:{value:e.IsLooping(),writable:!1},repeatCount:{value:e.GetRepeatCount(),writable:!1},repeatTo:{value:e.GetRepeatTo(),writable:!1},isPingPong:{value:e.IsPingPong(),writable:!1},frameCount:{value:e.GetFrameCount(),writable:!1}})}getFrames(){return s.get(this).GetFrames().map((e=>e.GetIAnimationFrame()))}*frames(){for(const e of s.get(this).GetFrames())yield e.GetIAnimationFrame()}}}{const e=self.C3,t=self.C3X,s=new WeakMap;self.IImageInfo=class{constructor(e){s.set(this,e)}get width(){return s.get(this).GetWidth()}get height(){return s.get(this).GetHeight()}getSize(){const e=s.get(this);return[e.GetWidth(),e.GetHeight()]}}}{const e=self.C3,t=self.C3X,s=new WeakMap;self.IAnimationFrame=class extends self.IImageInfo{constructor(e){super(e.GetImageInfo()),s.set(this,e),Object.defineProperties(this,{duration:{value:e.GetDuration(),writable:!1},originX:{value:e.GetOriginX(),writable:!1},originY:{value:e.GetOriginY(),writable:!1}})}getOrigin(){const e=s.get(this);return[e.GetOriginX(),e.GetOriginY()]}}}{const e=self.C3,t=self.C3X,s=new WeakMap;function GetTimelineState(e){const t=s.get(e);if(t.IsReleased())throw new Error("timeline/tween was released and is no longer valid");return t}self.ITimelineState=class{constructor(e){s.set(this,e)}pause(){GetTimelineState(this).Stop()}resume(){GetTimelineState(this).Resume()}hasTags(e){return GetTimelineState(this).HasTags(e)}set time(e){t.RequireFiniteNumber(e),GetTimelineState(this).SetTime(e)}get time(){return GetTimelineState(this).GetTime()}set totalTime(e){t.RequireFiniteNumber(e),GetTimelineState(this).SetTotalTime(e)}get totalTime(){return GetTimelineState(this).GetTotalTime()}set isLooping(e){GetTimelineState(this).SetLoop(!!e)}get isLooping(){return GetTimelineState(this).GetLoop()}set isPingPong(e){GetTimelineState(this).SetPingPong(!!e)}get isPingPong(){return GetTimelineState(this).GetPingPong()}set playbackRate(e){t.RequireFiniteNumber(e),GetTimelineState(this).SetPlaybackRate(e)}get playbackRate(){return GetTimelineState(this).GetPlaybackRate()}get progress(){const e=GetTimelineState(this);return e.GetTime()/e.GetTotalTime()}get tags(){return GetTimelineState(this).GetTags()}get finished(){return GetTimelineState(this).GetPlayPromise()}get isPlaying(){return GetTimelineState(this).IsPlaying()}get isPaused(){return GetTimelineState(this).IsPaused()}get isReleased(){return s.get(this).IsReleased()}}}{const e=self.C3,t=self.C3X,s=new WeakMap,i=new WeakMap;let r=null;function GetTweenState(e){const t=s.get(e);if(t.IsReleased())throw new Error("timeline/tween was released and is no longer valid");return t}self.ITweenState=class extends self.ITimelineState{constructor(e,t,n){super(e),r||(r=n.easeToIndexFunc),s.set(this,e),t&&i.set(this,t)}stop(){const e=GetTweenState(this);i.get(this).ReleaseTween(e)}setEase(e){t.RequireString(e);const s=self.Ease.GetEaseFromIndex(r(e));GetTweenState(this).SetEase(s)}get instance(){const e=GetTweenState(this).GetInstance();return e?e.GetInterfaceClass():null}get isDestroyOnComplete(){return GetTweenState(this).GetDestroyInstanceOnComplete()}set isDestroyOnComplete(e){GetTweenState(this).SetDestroyInstanceOnComplete(!!e)}get value(){const e=GetTweenState(this);if("value"!==e.GetId())throw new Error("not a value tween");return e.GetPropertyTrack("value").GetSourceAdapterValue()}}}{const e=self.C3,t=new Set(["local","remote"]),s=new Map([["mp4","video/mp4"],["webm","video/webm"],["m4a","audio/mp4"],["mp3","audio/mpeg"],["js","application/javascript"],["wasm","application/wasm"],["svg","image/svg+xml"],["html","text/html"]]);function GetTypeFromFileExtension(e){if(!e)return"";const t=e.split(".");if(t.length<2)return"";const i=t.at(-1).toLowerCase();return s.get(i)||""}function AddScript(e){return new Promise(((t,s)=>{const i=document.createElement("script");i.onload=t,i.onerror=s,i.async=!1,i.type="module",i.src=e,document.head.appendChild(i)}))}e.AssetManager=class extends e.DefendedBase{constructor(t,s){super();const i=s.exportType;this._runtime=t,this._fileStructure="folders",this._localUrlBlobs=new Map,this._localBlobUrlCache=new Map,this._localBlobSWUrls=new Map,this._isCordova="cordova"===i,this._isiOSCordova=!!s.isiOSCordova,this._isFileProtocol=!!s.isFileProtocol,this._swClientId=s.swClientId,this._supportedAudioFormats=s.supportedAudioFormats||{},this._audioFiles=new Map,this._preloadSounds=!1,this._mediaSubfolder="",this._fontsSubfolder="",this._iconsSubfolder="";const r="html5"===i||"scirra-arcade"===i||"instant-games"===i;this._defaultLoadPolicy=r?"remote":"local",this._allAssets=[],this._assetsByUrl=new Map,this._webFonts=[],this._loadPromises=[],this._hasFinishedInitialLoad=!1,this._totalAssetSizeToLoad=0,this._assetSizeLoaded=0,this._lastLoadProgress=0,this._hasHadErrorLoading=!1,this._loadingRateLimiter=e.New(e.RateLimiter,(()=>this._FireLoadingProgressEvent()),50),this._promiseThrottle=new e.PromiseThrottle(Math.max(e.hardwareConcurrency,8));const n=s.previewImageBlobs;if(n){const e=s.previewProjectFileBlobs;e&&Object.assign(n,e);const t=s.projectData;t&&(n["data.json"]=t);for(const[e,t]of Object.entries(n))this._localUrlBlobs.set(e,t)}const a=s.previewProjectFileSWUrls;if(a)for(const[e,t]of Object.entries(a))this._localBlobSWUrls.set(e,t);this._iAssetManager=new self.IAssetManager(this)}Release(){this._localUrlBlobs.clear();for(const e of this._localBlobUrlCache.values())e.startsWith("blob:")&&URL.revokeObjectURL(e);this._localBlobUrlCache.clear();for(const e of this._allAssets)e.Release();e.clearArray(this._allAssets),this._assetsByUrl.clear(),e.clearArray(this._loadPromises),this._runtime=null}GetRuntime(){return this._runtime}_SetFileStructure(e){if(this._fileStructure=e,"flat"===e){const e=new Map;for(const[t,s]of this._localUrlBlobs.entries())e.set(t.toLowerCase(),s);this._localUrlBlobs=e}}GetFileStructure(){return this._fileStructure}_SetMediaSubfolder(e){this._mediaSubfolder=e}GetMediaSubfolder(){return this._mediaSubfolder}_SetFontsSubfolder(e){this._fontsSubfolder=e}GetFontsSubfolder(){return this._fontsSubfolder}_SetIconsSubfolder(e){this._iconsSubfolder=e}GetIconsSubfolder(){return this._iconsSubfolder}IsFileProtocol(){return this._isFileProtocol}_HasLocalUrlBlob(e){return"flat"===this._fileStructure&&(e=e.toLowerCase()),this._localUrlBlobs.has(e)}_GetLocalUrlBlob(e){return"flat"===this._fileStructure&&(e=e.toLowerCase()),this._localUrlBlobs.get(e)||null}GetLocalUrlAsBlobUrl(e){if("flat"===this._fileStructure&&(e=e.toLowerCase()),!this._HasLocalUrlBlob(e))return e;let t=this._localBlobUrlCache.get(e);if(!t){const s=this._GetLocalUrlBlob(e);t=URL.createObjectURL(s),this._localBlobUrlCache.set(e,t)}return t}FetchBlob(t,s){s=s||this._defaultLoadPolicy;const i=this._GetLocalUrlBlob(t);return i?Promise.resolve(i):e.IsRelativeURL(t)?("flat"===this._fileStructure&&(t=t.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlob(t):"local"===s?this._promiseThrottle.Add((()=>e.FetchBlob(t))):e.FetchBlob(t)):e.FetchBlob(t)}FetchArrayBuffer(t){const s=this._GetLocalUrlBlob(t);return s?e.BlobToArrayBuffer(s):e.IsRelativeURL(t)?("flat"===this._fileStructure&&(t=t.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsArrayBuffer(t):"local"===this._defaultLoadPolicy?this._promiseThrottle.Add((()=>e.FetchArrayBuffer(t))):e.FetchArrayBuffer(t)):e.FetchArrayBuffer(t)}FetchText(t){const s=this._GetLocalUrlBlob(t);return s?e.BlobToString(s):e.IsRelativeURL(t)?("flat"===this._fileStructure&&(t=t.toLowerCase()),this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsText(t):"local"===this._defaultLoadPolicy?this._promiseThrottle.Add((()=>e.FetchText(t))):e.FetchText(t)):e.FetchText(t)}async FetchJson(e){const t=await this.FetchText(e);return JSON.parse(t)}_CordovaFetchLocalFileAs(e,t){return"flat"===this._fileStructure&&(e=e.toLowerCase()),this._runtime.PostComponentMessageToDOMAsync("runtime","cordova-fetch-local-file",{filename:e,as:t})}CordovaFetchLocalFileAsText(e){return this._CordovaFetchLocalFileAs(e,"text")}async CordovaFetchLocalFileAsBlob(e){const t=await this._CordovaFetchLocalFileAs(e,"buffer"),s=GetTypeFromFileExtension(e);return new Blob([t],{type:s})}async CordovaFetchLocalFileAsBlobURL(e){"flat"===this._fileStructure&&(e=e.toLowerCase());let t=this._localBlobUrlCache.get(e);if(t)return t;const s=await this.CordovaFetchLocalFileAsBlob(e);return t=URL.createObjectURL(s),this._localBlobUrlCache.set(e,t),t}CordovaFetchLocalFileAsArrayBuffer(e){return this._CordovaFetchLocalFileAs(e,"buffer")}GetMediaFileUrl(e){return"flat"===this._fileStructure&&(e=e.toLowerCase()),e=this._mediaSubfolder+e,this._HasLocalUrlBlob(e)?this.GetLocalUrlAsBlobUrl(e):e}GetProjectFileUrl(t){return e.IsAbsoluteURL(t)?Promise.resolve(t):this._HasLocalUrlBlob(t)?Promise.resolve(this.GetLocalUrlAsBlobUrl(t)):this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlobURL(t):("flat"===this._fileStructure&&(t=t.toLowerCase()),Promise.resolve(t))}GetProjectFileIframeUrl(t){if(e.IsAbsoluteURL(t))return Promise.resolve(t);{const e=t.indexOf("?"),s=-1===e?"":t.substr(e),i=-1===e?t:t.substr(0,e);if(this._HasLocalUrlBlob(i)){let e=this._localBlobSWUrls.get(i)||this.GetLocalUrlAsBlobUrl(i);if(!e.startsWith("blob:")&&this._swClientId){const t=new URL(e),i=new URLSearchParams(s);i.set("__c3_client_id",this._swClientId),t.search=i.toString(),e=t.toString()}return Promise.resolve(e)}return this._isCordova&&this._isFileProtocol?this.CordovaFetchLocalFileAsBlobURL(i):("flat"===this._fileStructure&&(t=t.toLowerCase()),Promise.resolve(t))}}LoadProjectFileUrl(e){return this.GetProjectFileUrl(e)}LoadImage(s){if(s.loadPolicy&&!t.has(s.loadPolicy))throw new Error("invalid load policy");let i=this._assetsByUrl.get(s.url);return i||(i=e.New(e.ImageAsset,this,{url:s.url,size:s.size||0,loadPolicy:s.loadPolicy||this._defaultLoadPolicy}),this._allAssets.push(i),this._assetsByUrl.set(i.GetURL(),i),this._hasFinishedInitialLoad||(this._totalAssetSizeToLoad+=i.GetSize(),this._loadPromises.push(i.Load().then((()=>this._AddLoadedSize(i.GetSize()))))),i)}async WaitForAllToLoad(){try{await Promise.all(this._loadPromises),this._lastLoadProgress=1}catch(e){this._hasHadErrorLoading=!0,this._FireLoadingProgressEvent()}}SetInitialLoadFinished(){this._hasFinishedInitialLoad=!0}HasHadErrorLoading(){return this._hasHadErrorLoading}_AddLoadedSize(e){this._assetSizeLoaded+=e,this._loadingRateLimiter.Call()}_FireLoadingProgressEvent(){const t=e.New(e.Event,"loadingprogress");this._lastLoadProgress=e.clamp(this._assetSizeLoaded/this._totalAssetSizeToLoad,0,1),t.progress=this._lastLoadProgress,this._runtime.Dispatcher().dispatchEvent(t)}GetLoadProgress(){return this._lastLoadProgress}_SetWebFonts(t){e.shallowAssignArray(this._webFonts,t),this._webFonts.length&&this._loadPromises.push(this._LoadWebFonts())}async _LoadWebFonts(){const e=[],t=[];for(const[s,i,r]of this._webFonts)this._totalAssetSizeToLoad+=r,e.push(this._LoadWebFont(s,i,t).then((()=>this._AddLoadedSize(r))));await Promise.all(e),this._runtime.IsInWorker()&&t.length>0&&await this._runtime.PostComponentMessageToDOMAsync("runtime","load-webfonts",{webfonts:t})}async _LoadWebFont(e,t,s){try{const i=await this.GetProjectFileUrl(t),r=new FontFace(e,`url('${i}')`);this._runtime.IsInWorker()?self.fonts.add(r):document.fonts.add(r),await r.load(),this._runtime.IsInWorker()&&s.push({name:e,url:i})}catch(e){}}IsAudioFormatSupported(e){return!!this._supportedAudioFormats[e]}_SetAudioFiles(e,t){this._preloadSounds=!!t;for(const[t,s,i]of e)this._audioFiles.set(t,{fileName:t,formats:s.map((e=>({type:e[0],fileExtension:e[1],fullName:t+e[1],fileSize:e[2]}))),isMusic:i})}GetPreferredAudioFile(e){"flat"===this._fileStructure&&(e=e.toLowerCase());const t=this._audioFiles.get(e);if(!t)return null;let s=null;for(const e of t.formats)if(s||"audio/webm; codecs=opus"!==e.type||(s=e),this.IsAudioFormatSupported(e.type))return e;return s}GetProjectAudioFileUrl(e){const t=this.GetPreferredAudioFile(e);return t?{url:this.GetMediaFileUrl(t.fullName),type:t.type}:null}GetAudioToPreload(){if(this._preloadSounds){const e=[];for(const t of this._audioFiles.values()){if(t.isMusic)continue;const s=this.GetPreferredAudioFile(t.fileName);s&&e.push({originalUrl:t.fileName,url:this.GetMediaFileUrl(s.fullName),type:s.type,fileSize:s.fileSize})}return e}return[]}GetIAssetManager(){return this._iAssetManager}async LoadScripts(...t){const s=await Promise.all(t.map((e=>this.GetProjectFileUrl(e))));if(this._runtime.IsInWorker())if(1===t.length){const s=t[0];await self.c3_import((e.IsRelativeURL(s)?"./":"")+s)}else{const s=t.map((t=>`import "${e.IsRelativeURL(t)?"./":""}${t}";`)).join("\n"),i=URL.createObjectURL(new Blob([s],{type:"application/javascript"}));await self.c3_import(i)}else await Promise.all(s.map((e=>AddScript(e))))}async CompileWebAssembly(t){if(WebAssembly.compileStreaming){const e=await this.GetProjectFileUrl(t);return await WebAssembly.compileStreaming(fetch(e))}{const s=await e.FetchArrayBuffer(t);return await WebAssembly.compile(s)}}async LoadStyleSheet(e){const t=await this.GetProjectFileUrl(e);return await this._runtime.PostComponentMessageToDOMAsync("runtime","add-stylesheet",{url:t})}}}{const e=self.C3;e.Asset=class extends e.DefendedBase{constructor(e,t){super(),this._assetManager=e,this._runtime=e.GetRuntime(),this._url=t.url,this._size=t.size,this._loadPolicy=t.loadPolicy,this._blob=null,this._isLoaded=!1,this._loadPromise=null}Release(){this._loadPromise=null,this._assetManager=null,this._runtime=null,this._blob=null}GetURL(){return this._url}GetSize(){return this._size}Load(){return"local"===this._loadPolicy||this._blob?(this._isLoaded=!0,Promise.resolve()):(this._loadPromise||(this._loadPromise=this._assetManager.FetchBlob(this._url,this._loadPolicy).then((e=>(this._isLoaded=!0,this._loadPromise=null,this._blob=e,e))).catch((e=>{}))),this._loadPromise)}IsLoaded(){return this._isLoaded}GetBlob(){return this._blob?Promise.resolve(this._blob):this._loadPromise?this._loadPromise:this._assetManager.FetchBlob(this._url,this._loadPolicy)}}}{const e=self.C3,t=new e.PromiseThrottle,s=new Set;e.ImageAsset=class extends e.Asset{constructor(e,t){super(e,t),this._texturePromise=null,this._webglTexture=null,this._refCount=0,this._imageWidth=-1,this._imageHeight=-1,s.add(this)}Release(){if(this.ReleaseTexture(),0!==this._refCount)throw new Error("released image asset which still has texture references");this._texturePromise=null,s.delete(this),super.Release()}static OnRendererContextLost(){for(const e of s)e._texturePromise=null,e._webglTexture=null,e._refCount=0}LoadStaticTexture(e,s){return s=s||{},this._refCount++,this._webglTexture?Promise.resolve(this._webglTexture):(this._texturePromise||(s.anisotropy=this._runtime.GetCanvasManager().GetTextureAnisotropy(),this._texturePromise=this.GetBlob().then((i=>t.Add((()=>e.CreateStaticTextureAsync(i,s).then((t=>(this._texturePromise=null,0===this._refCount?(e.DeleteTexture(t),null):(this._webglTexture=t,this._imageWidth=t.GetWidth(),this._imageHeight=t.GetHeight(),this._webglTexture)))))))).catch((e=>{throw e}))),this._texturePromise)}ReleaseTexture(){if(this._refCount<=0)throw new Error("texture released too many times");if(this._refCount--,0===this._refCount&&this._webglTexture){this._webglTexture.GetRenderer().DeleteTexture(this._webglTexture),this._webglTexture=null}}GetTexture(){return this._webglTexture}GetWidth(){return this._imageWidth}GetHeight(){return this._imageHeight}async LoadToDrawable(){const t=await this.GetBlob();return e.Supports.ImageBitmapOptions?await createImageBitmap(t,{premultiplyAlpha:"none"}):e.Supports.ImageBitmap?await createImageBitmap(t):await e.BlobToImage(t)}}}{const e=self.C3,t=self.assert;function SortByInstLastCachedZIndex(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()}e.RenderCell=class extends e.DefendedBase{constructor(e,t,s){super(),this._grid=e,this._x=t,this._y=s,this._instances=[],this._isSorted=!0,this._pendingRemoval=new Set,this._isAnyPendingRemoval=!1}Release(){e.clearArray(this._instances),this._pendingRemoval.clear(),this._grid=null}Reset(){e.clearArray(this._instances),this._isSorted=!0,this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1}SetChanged(){this._isSorted=!1}IsEmpty(){return!this._instances.length||!(this._instances.length>this._pendingRemoval.size)&&(this._FlushPending(),!0)}Insert(e){if(this._pendingRemoval.has(e))return this._pendingRemoval.delete(e),void(0===this._pendingRemoval.size&&(this._isAnyPendingRemoval=!1));this._instances.push(e),this._isSorted=1===this._instances.length}Remove(e){this._pendingRemoval.add(e),this._isAnyPendingRemoval=!0,this._pendingRemoval.size>=50&&this._FlushPending()}_FlushPending(){this._isAnyPendingRemoval&&(this._instances.length!==this._pendingRemoval.size?(e.arrayRemoveAllInSet(this._instances,this._pendingRemoval),this._pendingRemoval.clear(),this._isAnyPendingRemoval=!1):this.Reset())}_EnsureSorted(){this._isSorted||(this._instances.sort(SortByInstLastCachedZIndex),this._isSorted=!0)}Dump(e){this._FlushPending(),this._EnsureSorted(),this._instances.length&&e.push(this._instances)}}}{const e=self.C3;e.RenderGrid=class extends e.DefendedBase{constructor(t,s){super(),this._cellWidth=t,this._cellHeight=s,this._cells=e.New(e.PairMap)}Release(){this._cells.Release(),this._cells=null}GetCell(t,s,i){let r=this._cells.Get(t,s);return r||(i?(r=e.New(e.RenderCell,this,t,s),this._cells.Set(t,s,r),r):null)}XToCell(e){return Math.floor(e/this._cellWidth)}YToCell(e){return Math.floor(e/this._cellHeight)}Update(e,t,s){if(t)for(let i=t.getLeft(),r=t.getRight();i<=r;++i)for(let r=t.getTop(),n=t.getBottom();r<=n;++r){if(s&&s.containsPoint(i,r))continue;const t=this.GetCell(i,r,!1);t&&(t.Remove(e),t.IsEmpty()&&this._cells.Delete(i,r))}if(s)for(let i=s.getLeft(),r=s.getRight();i<=r;++i)for(let r=s.getTop(),n=s.getBottom();r<=n;++r)t&&t.containsPoint(i,r)||this.GetCell(i,r,!0).Insert(e)}QueryRange(e,t){let s=this.XToCell(e.getLeft());const i=this.YToCell(e.getTop()),r=this.XToCell(e.getRight()),n=this.YToCell(e.getBottom());for(;s<=r;++s)for(let e=i;e<=n;++e){const i=this.GetCell(s,e,!1);i&&i.Dump(t)}}MarkRangeChanged(e){let t=e.getLeft();const s=e.getTop(),i=e.getRight(),r=e.getBottom();for(;t<=i;++t)for(let e=s;e<=r;++e){const s=this.GetCell(t,e,!1);s&&s.SetChanged()}}}}{const e=self.C3,t=new e.Rect,s=new e.Quad,i=[],r=new e.Rect,n=new e.Rect,a=self.glMatrix,o=a.vec3,h=a.vec4,l=a.mat4,c=l.create(),u=o.create(),_=h.create(),d=o.create(),p=o.create(),f=o.create(),m=e.New(e.Vector2),g=e.New(e.Rect);function SortByInstLastCachedZIndex(e,t){return e.GetWorldInfo()._GetLastCachedZIndex()-t.GetWorldInfo()._GetLastCachedZIndex()}function SortByInstZElevation(e,t){return e.GetWorldInfo().GetZElevation()-t.GetWorldInfo().GetZElevation()}const S=[],y=[],G=[];e.Layer=class extends e.DefendedBase{constructor(t,s,i){super(),this._layout=t,this._runtime=t.GetRuntime(),this._parentLayer=s,this._name=i[0],this._index=-1,this._sid=i[2],this._isVisible=!!i[3],this._isInteractive=!!i[13],this._backgroundColor=e.New(e.Color),this._backgroundColor.setFromJSON(i[4].map((e=>e/255))),this._isTransparent=!!i[5],this._parallaxX=i[6],this._parallaxY=i[7],this._color=e.New(e.Color,1,1,1,i[8]),this._premultipliedColor=e.New(e.Color),this._isForceOwnTexture=i[9],this._renderAs3d=i[17],this._useCameraDistanceDrawOrder=i[18],this._useRenderCells=i[10],this._scaleRate=i[11],this._blendMode=i[12],this._curRenderTarget=null,this._scale=1,this._zElevation=i[16],this._angle=0,this._scrollX=0,this._scrollY=0,this._hasOwnScrollPosition=!1,this._viewport=e.New(e.Rect),this._viewportZ0=e.New(e.Rect),this._viewport3D=e.New(e.Rect),this._isViewportChanged=!0,this._projectionMatrix=l.create(),this._isProjectionMatrixChanged=!0,this._modelViewMatrix=l.create(),this._isMVMatrixChanged=!0,this._viewFrustum=e.New(e.Gfx.ViewFrustum),this._isViewFrustumChanged=!0,this._startupInitialInstances=[],this._initialInstancesData=i[14],this._initialInstances=[],this._createdGlobalUids=[],this._initialUIDsToInstanceData=new Map,this._instances=[],this._zIndicesUpToDate=!1,this._anyInstanceZElevated=!1;const r=this._runtime.GetCanvasManager();this._effectList=e.New(e.EffectList,this,i[15]),this._effectChain=e.New(e.Gfx.EffectChain,r.GetEffectChainManager(),{drawContent:(e,t)=>{const s=t.GetContentObject(),i=s.GetRenderTarget();e.SetColor(s.GetPremultipliedColor()),e.DrawRenderTarget(i),e.InvalidateRenderTarget(i),r.ReleaseAdditionalRenderTarget(i)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)}),this._needsRebuildEffectChainSteps=!0,this._wasDefaultColor=!0,this._renderGrid=null,this._lastRenderList=[],this._isRenderListUpToDate=!1,this._lastRenderCells=e.New(e.Rect,0,0,-1,-1),this._curRenderCells=e.New(e.Rect,0,0,-1,-1),this._iLayer=null,this._UpdatePremultipliedColor(),this.UsesRenderCells()&&(this._renderGrid=e.New(e.RenderGrid,this._runtime.GetOriginalViewportWidth(),this._runtime.GetOriginalViewportHeight())),this._subLayers=i[19].map((t=>e.New(e.Layer,this._layout,this,t)))}_Init(){for(const e of this._initialInstancesData){const t=this._runtime.GetObjectClassByIndex(e[1]);this._layout._AddInitialObjectClass(t),t.GetDefaultInstanceData()||(t.SetDefaultInstanceData(e),t._SetDefaultLayerIndex(this._index)),this._initialInstances.push(e),this._initialUIDsToInstanceData.set(e[2],e)}e.shallowAssignArray(this._startupInitialInstances,this._initialInstances),this._initialInstancesData=null,this._iLayer=new self.ILayer(this)}Release(){this._layout=null,this._runtime=null}GetInitialInstanceData(e){return this._initialUIDsToInstanceData.get(e)}CreateInitialInstances(t){const s=this._layout.IsFirstVisit();let i=0;const r=this._initialInstances;for(let e=0,n=r.length;e<n;++e){const n=r[e],a=this._runtime.GetObjectClassByIndex(n[1]);let o=!0;if(!a.HasPersistBehavior()||s){const e=this._runtime.CreateInstanceFromData(n,this,!0);t.push(e),a.IsGlobal()&&(o=!1,this._createdGlobalUids.push(e.GetUID()))}o&&(r[i]=r[e],++i)}e.truncateArray(r,i),this._runtime.FlushPendingInstances(),this.SetZIndicesChanged()}_AddInstance(e,t){if(!e.GetPlugin().IsWorldType())throw new Error("instance is not of world type");const s=e.GetWorldInfo();if(s.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.push(e),0!==s.GetZElevation()&&(this._anyInstanceZElevated=!0),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged(),this.SetZIndicesChanged()}_MaybeAddInstance(e){this._instances.includes(e)||(this._instances.push(e),0!==e.GetWorldInfo().GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged())}_PrependInstance(e,t){const s=e.GetWorldInfo();if(s.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.unshift(e),0!==s.GetZElevation()&&(this._anyInstanceZElevated=!0),this.SetZIndicesChanged(),t&&this.UsesRenderCells()&&e.GetWorldInfo().SetBboxChanged()}_RemoveInstance(e,t){const s=this._instances.indexOf(e);s<0||(t&&this.UsesRenderCells()&&e.GetWorldInfo()._RemoveFromRenderCells(),this._instances.splice(s,1),this.SetZIndicesChanged(),this._MaybeResetAnyInstanceZElevatedFlag())}_SetAnyInstanceZElevated(){this._anyInstanceZElevated=!0}_MaybeResetAnyInstanceZElevatedFlag(){0===this._instances.length&&(this._anyInstanceZElevated=!1)}_SortInstancesByLastCachedZIndex(e){if(e){const e=new Set;for(const t of this._instances){const s=t.GetWorldInfo()._GetLastCachedZIndex();s>=0&&e.add(s)}let t=-1;for(const s of this._instances){const i=s.GetWorldInfo();if(!(i._GetLastCachedZIndex()>=0)){for(++t;e.has(t);)++t;i._SetZIndex(t)}}}this._instances.sort(SortByInstLastCachedZIndex)}_Start(){}_End(){for(const e of this._instances)e.GetObjectClass().IsGlobal()||this._runtime.DestroyInstance(e);this._runtime.FlushPendingInstances(),e.clearArray(this._instances),this._anyInstanceZElevated=!1,this.SetZIndicesChanged()}RecreateInitialObjects(e,t,s,i,r){const n=this._runtime.GetEventSheetManager(),a=this._runtime.GetAllObjectClasses(),o=e.IsFamily(),h=[];for(const l of this._initialInstances){const c=l[0],u=c[0],_=c[1];if(!t.containsPoint(u,_))continue;const d=a[l[1]];if(d!==e){if(!o)continue;if(!e.FamilyHasMember(d))continue}let p=this;const f=this._runtime.GetCurrentLayout();this.GetLayout()!==f&&(p=f.GetLayerByName(this.GetName()),p||(p=f.GetLayerByIndex(this.GetIndex())));const m=this._runtime.CreateInstanceFromData(l,p,!1,void 0,void 0,!1,r);p.SortAndAddInstancesByZIndex(m);const g=m.GetWorldInfo();g.OffsetXY(s,i),g.SetBboxChanged(),n.BlockFlushingInstances(!0),m._TriggerOnCreatedOnSelfAndRelated(),n.BlockFlushingInstances(!1),h.push(m)}return h}GetInstanceCount(){return this._instances.length}GetLayout(){return this._layout}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}GetSID(){return this._sid}GetRuntime(){return this._runtime}GetDevicePixelRatio(){return this._runtime.GetDevicePixelRatio()}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){const e=this.HasDefaultColor();if(!this._needsRebuildEffectChainSteps&&e===this._wasDefaultColor&&!this._effectChain.NeedsRebuild())return;const t=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(t.map((e=>e.GetShaderProgram())),{indexMap:t.map((e=>e.GetIndex())),forcePreDraw:!e,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasDefaultColor=e}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}UsesRenderCells(){return this._useRenderCells&&!this._useCameraDistanceDrawOrder}GetRenderGrid(){return this._renderGrid}SetRenderListStale(){this._isRenderListUpToDate=!1}IsVisible(){for(const e of this.selfAndParentLayers())if(!e._IsVisibleFlagSet())return!1;return!0}_IsVisibleFlagSet(){return this._isVisible}SetVisible(e){e=!!e,this._isVisible!==e&&(this._isVisible=e,this._runtime.UpdateRender())}SetInteractive(e){this._isInteractive=!!e}IsInteractive(){return this._isInteractive}IsSelfAndParentsInteractive(){for(const e of this.selfAndParentLayers())if(!e.IsInteractive())return!1;return!0}SetOwnScrollPositionEnabled(e){if(e=!!e,this._hasOwnScrollPosition!==e){if(this._hasOwnScrollPosition=e,e){const e=this.GetLayout();this._scrollX=e.GetScrollX(),this._scrollY=e.GetScrollY()}this._SetMVMatrixChanged(),this._runtime.UpdateRender()}}IsOwnScrollPositionEnabled(){return this._hasOwnScrollPosition}SetScrollX(e){const t=this.GetLayout(),s=t.GetScrollLeftBound(),i=t.GetScrollRightBound();e>i&&(e=i),e<s&&(e=s),this._scrollX!==e&&(this._scrollX=e,this.IsOwnScrollPositionEnabled()&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender()))}SetScrollY(e){const t=this.GetLayout(),s=t.GetScrollTopBound(),i=t.GetScrollBottomBound();e>i&&(e=i),e<s&&(e=s),this._scrollY!==e&&(this._scrollY=e,this.IsOwnScrollPositionEnabled()&&(this._SetMVMatrixChanged(),this._runtime.UpdateRender()))}GetScrollX(){return this.IsOwnScrollPositionEnabled()?this._scrollX:this.GetLayout().GetScrollX()}GetScrollY(){return this.IsOwnScrollPositionEnabled()?this._scrollY:this.GetLayout().GetScrollY()}GetViewport(){return this._MaybeUpdateViewport(),this._viewport}_GetViewportZ0(){return this._MaybeUpdateViewport(),this._viewportZ0}GetViewport3D(){return this._MaybeUpdateViewport(),this._viewport3D}_GetVanishingPoint(){const e=this.GetLayout();return[e.GetVanishingPointX(),e.GetVanishingPointY()]}GetDefaultCameraZ(e){return this._runtime.GetDefaultCameraZ(e)}GetViewportForZ(t,s){const i=this._GetViewportZ0();if(0===t)s.copy(i);else{let r=i.midX(),n=i.midY();const a=this.Get2DScaleFactorToZ(t),o=i.width()/a,h=i.height()/a,[l,c]=this._GetVanishingPoint();if(.5!==l||.5!==c){const s=this.GetCameraZ(),i=this._runtime,a=this.GetDefaultCameraZ()/s;let o=(l-.5)*i.GetViewportWidth()/a,h=(c-.5)*i.GetViewportHeight()/a;const u=this.GetAngle();0!==u&&(m.set(o,h),m.rotate(u),o=m.getX(),h=m.getY());const _=e.unlerp(s,0,t);r+=e.lerp(o,0,_),n+=e.lerp(h,0,_)}s.set(r-o/2,n-h/2,r+o/2,n+h/2)}}GetOpacity(){return this._color.getA()}SetOpacity(t){t=e.clamp(t,0,1),this._color.getA()!==t&&(this._color.setA(t),this._UpdatePremultipliedColor(),this._runtime.UpdateRender())}_UpdatePremultipliedColor(){this._premultipliedColor.copy(this._color),this._premultipliedColor.premultiply()}GetPremultipliedColor(){return this._premultipliedColor}HasDefaultColor(){return this._color.equalsRgba(1,1,1,1)}GetScaleRate(){return this._scaleRate}SetScaleRate(e){this._scaleRate!==e&&(this._scaleRate=e,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetParallaxX(){return this._parallaxX}GetParallaxY(){return this._parallaxY}SetParallax(e,t){if((this._parallaxX!==e||this._parallaxY!==t)&&(this._parallaxX=e,this._parallaxY=t,this._SetMVMatrixChanged(),this._runtime.UpdateRender(),1!==this._parallaxX||1!==this._parallaxY))for(const e of this._instances)e.GetObjectClass()._SetAnyInstanceParallaxed(!0)}SetParallaxX(e){this.SetParallax(e,this.GetParallaxY())}SetParallaxY(e){this.SetParallax(this.GetParallaxX(),e)}SetZElevation(e){this._zElevation!==e&&(this._zElevation=e,this._runtime.UpdateRender())}GetZElevation(){return this._zElevation}SetAngle(t){t=e.clampAngle(t),this._angle!==t&&(this._angle=t,this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetAngle(){return e.clampAngle(this._layout.GetAngle()+this._angle)}GetOwnAngle(){return this._angle}HasInstances(){return this._instances.length>0}_GetInstances(){return this._instances}_GetInstancesInDrawOrder(){return this.RendersIn3DMode()&&this._useCameraDistanceDrawOrder?(e.shallowAssignArray(G,this._GetInstances()),G.sort(((e,t)=>this._SortInstancesByCameraDistance(e,t))),G):this._GetInstances()}_AppendAllInstancesIncludingSubLayersInDrawOrder(t){e.appendArray(t,this._GetInstancesInDrawOrder());for(const e of this._subLayers)e.IsVisible()&&e.GetOpacity()>0&&e._AppendAllInstancesIncludingSubLayersInDrawOrder(t)}_SortInstancesByCameraDistance(e,t){const s=this.GetLayout().Get3DCameraPosition(),i=s[0],r=s[1],n=s[2],a=e.GetWorldInfo(),o=t.GetWorldInfo(),h=a.GetX()-i,l=a.GetY()-r,c=a.GetZElevation()-n,u=o.GetX()-i,_=o.GetY()-r,d=o.GetZElevation()-n;return u*u+_*_+d*d-(h*h+l*l+c*c)}GetBackgroundColor(){return this._backgroundColor}IsTransparent(){return this._isTransparent}SetTransparent(e){e=!!e,this._isTransparent!==e&&(this._isTransparent=e,this._runtime.UpdateRender())}IsForceOwnTexture(){return this._isForceOwnTexture}SetForceOwnTexture(e){e=!!e,this._isForceOwnTexture!==e&&(this._isForceOwnTexture=e,this._runtime.UpdateRender())}RendersIn2DMode(){return!this.GetRuntime().Uses3DFeatures()||!this._renderAs3d}RendersIn3DMode(){return!this.RendersIn2DMode()}Has3DCamera(){return this.RendersIn3DMode()&&this.GetLayout().Is3DCameraEnabled()}SelfAndAllSubLayersHave3DCamera(){if(!this.Has3DCamera())return!1;for(const e of this._subLayers)if(!e.SelfAndAllSubLayersHave3DCamera())return!1;return!0}SetBlendMode(e){this._blendMode!==e&&(this._blendMode=e,this._runtime.UpdateRender())}GetBlendMode(){return this._blendMode}IsRootLayer(){return!this._parentLayer}GetParentLayer(){return this._parentLayer}GetSubLayers(){return this._subLayers}HasAnySubLayers(){return this._subLayers.length>0}HasAnyVisibleSubLayer(){for(const e of this._subLayers)if(e.ShouldDraw())return!0;return!1}*selfAndAllSubLayers(){for(const e of this._subLayers)yield*e.selfAndAllSubLayers();yield this}*parentLayers(){let e=this.GetParentLayer();for(;e;)yield e,e=e.GetParentLayer()}*selfAndParentLayers(){yield this,yield*this.parentLayers()}IsTransformCompatibleWith(e){return this===e||this._parallaxX===e._parallaxX&&this._parallaxY===e._parallaxY&&this._scale===e._scale&&this._scaleRate===e._scaleRate&&this._angle===e._angle&&this.GetScrollX()===e.GetScrollX()&&this.GetScrollY()===e.GetScrollY()}SaveTransform(){return{parallaxX:this.GetParallaxX(),parallaxY:this.GetParallaxY(),scale:this.GetOwnScale(),scaleRate:this.GetScaleRate(),angle:this.GetOwnAngle(),hasOwnScroll:this.IsOwnScrollPositionEnabled(),scrollX:this.GetScrollX(),scrollY:this.GetScrollY()}}RestoreTransform(e){this.SetParallax(e.parallaxX,e.parallaxY),this.SetOwnScale(e.scale),this.SetScaleRate(e.scaleRate),this.SetAngle(e.angle),this.SetOwnScrollPositionEnabled(e.hasOwnScroll),this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY),this._MaybeUpdateViewport()}_RemoveAllInstancesInSet(t){if(0===t.size)return;e.arrayRemoveAllInSet(this._instances,t)>0&&(this._MaybeResetAnyInstanceZElevatedFlag(),this.SetZIndicesChanged())}SetZIndicesChanged(){this._zIndicesUpToDate=!1,this._isRenderListUpToDate=!1}_UpdateZIndices(){if(!this._zIndicesUpToDate){if(this._instances.sort(SortByInstZElevation),this.UsesRenderCells())for(let e=0,t=this._instances.length;e<t;++e){const t=this._instances[e].GetWorldInfo();t._SetZIndex(e),this._renderGrid.MarkRangeChanged(t.GetRenderCellRange())}else for(let e=0,t=this._instances.length;e<t;++e)this._instances[e].GetWorldInfo()._SetZIndex(e);this._zIndicesUpToDate=!0}}MoveInstanceAdjacent(t,s,i){const r=t.GetWorldInfo(),n=s.GetWorldInfo();if(r.GetLayer()!==this||n.GetLayer()!==this)throw new Error("can't arrange Z order unless both objects on this layer");const a=r.GetZIndex();let o=n.GetZIndex();return a!==o+(i?1:-1)&&(e.arrayRemove(this._instances,a),a<o&&o--,i&&o++,o===this._instances.length?this._instances.push(t):this._instances.splice(o,0,t),this.SetZIndicesChanged(),!0)}_MergeSortedZArrays(e,t){const s=[];let i=0,r=0,n=e.length,a=t.length;for(;i<n&&r<a;){const n=e[i],a=t[r];n.GetWorldInfo()._GetLastCachedZIndex()<a.GetWorldInfo()._GetLastCachedZIndex()?(s.push(n),++i):(s.push(a),++r)}for(;i<n;++i)s.push(e[i]);for(;r<a;++r)s.push(t[r]);return s}_MergeAllSortedZArrays_pass(e){const t=[],s=e.length;for(let i=0;i<s-1;i+=2){const s=e[i],r=e[i+1];t.push(this._MergeSortedZArrays(s,r))}return s%2==1&&t.push(e[s-1]),t}_MergeAllSortedZArrays(e){for(;e.length>1;)e=this._MergeAllSortedZArrays_pass(e);return e[0]}_GetRenderCellInstancesToDraw(){return this._UpdateZIndices(),e.clearArray(i),this._renderGrid.QueryRange(this.GetViewport(),i),i.length?1===i.length?i[0]:this._MergeAllSortedZArrays(i):[]}ShouldDraw(){return this.IsVisible()&&this.GetOpacity()>0&&this._DrawsAnyContentInSelfOrSubLayers()}_DrawsAnyContentInSelfOrSubLayers(){if(this.HasInstances()||!this.IsTransparent())return!0;for(const e of this._subLayers)if(e._DrawsAnyContentInSelfOrSubLayers())return!0;return!1}UsesOwnTexture(){return this.IsForceOwnTexture()||!this.HasDefaultColor()||0!==this.GetBlendMode()||this._effectList.HasAnyActiveEffect()}SelfOrAnySubLayerUsesOwnTexture(){if(this.UsesOwnTexture())return!0;for(const e of this._subLayers)if(e.SelfOrAnySubLayerUsesOwnTexture())return!0;return!1}GetRenderTarget(){return this._curRenderTarget}Get2DScaleFactorToZ(e){if(this._layout.IsOrthographicProjection())return 1;{const t=this.GetCameraZ();return t/(t-e)}}GetCameraZ(e){return this.GetDefaultCameraZ(e)/this.GetNormalScale()}_SetMVMatrixChanged(){this._isMVMatrixChanged=!0,this._isViewFrustumChanged=!0,this._isViewportChanged=!0}_GetModelViewMatrix(e){return this._isMVMatrixChanged&&(this._CalculateModelViewMatrix(e,this._modelViewMatrix,0,0,null),this._isMVMatrixChanged=!1),this._modelViewMatrix}GetCameraPosition(){if(this.Has3DCamera()){const e=this.GetLayout().Get3DCameraPosition();return[e[0],e[1],e[2]]}return this._Get2DCameraPosition()}_Get2DCameraPosition(e=0,t=0,s=0){const i=this._runtime,r=this.GetLayout(),n=i.GetParallaxXOrigin(),a=i.GetParallaxYOrigin();let o=(this.GetScrollX()-n)*this._parallaxX+n,h=(this.GetScrollY()-a)*this._parallaxY+a;i.IsPixelRoundingEnabled()&&(o=Math.round(o),h=Math.round(h));let l=o+e,c=h+t;const u=r.IsOrthographicProjection()?this.GetDefaultCameraZ(s):this.GetCameraZ(s),[_,d]=this._GetVanishingPoint();if(.5!==_||.5!==d){const e=this.GetDefaultCameraZ(s)/u;let t=(_-.5)*i.GetViewportWidth()/e,r=(d-.5)*i.GetViewportHeight()/e;const n=this.GetAngle();0!==n&&(m.set(t,r),m.rotate(n),t=m.getX(),r=m.getY()),l+=t,c+=r}return[l,c,u]}_CalculateModelViewMatrix(e,t,s,i,r){const n=this._runtime,a=this.GetLayout();if(this.Has3DCamera()){o.copy(d,a.Get3DCameraPosition()),o.copy(p,a.Get3DCameraLookAt()),o.copy(f,a.Get3DCameraUpVector());const e=n.GetParallaxXOrigin(),t=n.GetParallaxYOrigin(),s=p[0]-d[0],i=p[1]-d[1],r=p[2]-d[2];d[0]=(d[0]-e)*this._parallaxX+e,d[1]=(d[1]-t)*this._parallaxY+t,d[2]*=Math.max(this._parallaxX,this._parallaxY),p[0]=d[0]+s,p[1]=d[1]+i,p[2]=d[2]+r}else{const[e,t,n]=this._Get2DCameraPosition(s,i,r);o.set(d,e,t,n),o.set(p,e,t,n-100);const a=this.GetAngle();0===a?o.set(f,0,1,0):o.set(f,Math.sin(a),Math.cos(a),0)}e.CalculateLookAtModelView(t,d,p,f,r||n.GetViewportHeight())}_SetProjectionMatrixChanged(){this._isProjectionMatrixChanged=!0,this._isViewFrustumChanged=!0,this._isViewportChanged=!0}_GetProjectionMatrix(e){return this._isProjectionMatrixChanged&&(this._CalculateProjectionMatrix(e),this._isProjectionMatrixChanged=!1),this._projectionMatrix}_CalculateProjectionMatrix(e){const t=this._runtime.GetCanvasManager(),[s,i]=this._GetVanishingPoint();if(this._layout.IsOrthographicProjection())e.CalculateOrthographicMatrix(this._projectionMatrix,t.GetDrawWidth(),t.GetDrawHeight());else if(.5===s&&.5===i)l.copy(this._projectionMatrix,t.GetDefaultProjectionMatrix());else{const r=t.GetDrawWidth(),n=t.GetDrawHeight();e.CalculatePerspectiveMatrix(this._projectionMatrix,r/n,s,i)}}_SetTransform(e,t=!0,s=0,i=0,r=0){t&&e.SetProjectionMatrix(this._GetProjectionMatrix(e));let n=null;0===s&&0===i&&0===r?n=this._GetModelViewMatrix(e):(this._CalculateModelViewMatrix(e,c,s,i,r),n=c),e.SetModelViewMatrix(n)}PrepareForDraw(e){this._SetTransform(e),e.SetBaseZ(this.GetZElevation())}Draw(e,t,s){const i=this._runtime.GetCanvasManager(),r=this.UsesOwnTexture();let n=null,a=null;if(this._runtime.IsGPUProfiling())if(e.IsWebGL()){const t=i.GetLayerTimingsBuffer(this);t&&(a=t.AddTimeElapsedQuery(),e.StartQuery(a))}else e.IsWebGPU()&&e.WriteTimestamp(2*(this.GetIndex()+1));if(r){const t={sampling:this._runtime.GetSampling(),isSampled:!0,canReadPixels:!!e.IsWebGPU()&&this._runtime.UsesAnyBackgroundBlending()};"low"===i.GetCurrentFullscreenScalingQuality()&&(t.width=i.GetDrawWidth(),t.height=i.GetDrawHeight()),n=this._runtime.GetAdditionalRenderTarget(t),this._curRenderTarget=n,e.SetRenderTarget(n),this.IsTransparent()&&e.ClearRgba(0,0,0,0)}else this._curRenderTarget=t,e.SetRenderTarget(t);if(this.IsTransparent()||e.Clear(this._backgroundColor),this._layout._DrawLayerList(e,this._curRenderTarget,this._subLayers,r&&this.IsTransparent()),this._SetTransform(e),e.SetBaseZ(this.GetZElevation()),e.SetDepthEnabled(this.RendersIn3DMode()),this.GetNormalScale()>Number.EPSILON){this._UpdateZIndices();const t=this.UsesRenderCells()&&0===this.GetZElevation()&&!this._anyInstanceZElevated;this.Has3DCamera()?this._DrawInstances_3DCamera(e):t?this._DrawInstances_RenderCells(e):this._DrawInstances(e,this._GetInstancesInDrawOrder())}e.SetBaseZ(0),e.SetCurrentZ(0),r&&(e.SetDepthEnabled(!1),this._DrawLayerOwnTextureToRenderTarget(e,n,t,s)),a&&e.EndQuery(a),this._runtime.IsGPUProfiling()&&e.IsWebGPU()&&e.WriteTimestamp(2*(this.GetIndex()+1)+1),this._curRenderTarget=null}_DrawInstances(e,t){const s=this.GetViewport(),i=this._curRenderTarget,r=this.GetLayout().IsOrthographicProjection(),n=this.GetLayout().HasVanishingPointOutsideViewport();let a=null;for(let o=0,h=t.length;o<h;++o){const h=t[o];if(h===a)continue;a=h;const l=h.GetWorldInfo();l.IsVisible()&&l.IsInViewport(s,n,r)&&this._DrawInstanceMaybeWithEffects(h,l,e,i)}}_DrawInstances_3DCamera(t){const s=this._curRenderTarget,i=this._GetViewFrustum(),r=S,n=y,a=this._GetInstancesInDrawOrder();for(let o=0,h=a.length;o<h;){const l=a[o],c=l.GetWorldInfo();if(!c.IsVisible()||!c.IsInViewport3D(i)){++o;continue}(!l.RendersToOwnZPlane()||c.GetDepth()>0)&&n.push(l);const u=l.GetWorldInfo().GetTotalZElevation();r.push(l);let _=o+1;for(;_<h;++_){const e=a[_],t=e.GetWorldInfo();if(t.IsVisible()&&t.IsInViewport3D(i)){if(t.GetTotalZElevation()!==u)break;e.RendersToOwnZPlane()?(t.GetDepth()>0&&n.push(e),r.push(e)):n.push(e)}}if(1!==r.length||r[0].MustMitigateZFighting()){this._DrawCoplanarInstances_3DCamera(t,r);for(let e=0,i=n.length;e<i;++e){const i=n[e],r=i.GetWorldInfo();r._SetDrawNonBackFacesOnly(!0),this._DrawInstanceMaybeWithEffects(i,r,t,s),r._SetDrawNonBackFacesOnly(!1)}}else{this._DrawInstanceMaybeWithEffects(l,c,t,s);for(let e=0,i=n.length;e<i;++e){const i=n[e];if(i===l)continue;const r=i.GetWorldInfo();r.GetLayer()._DrawInstanceMaybeWithEffects(i,r,t,s)}}o=_,e.clearArray(r),e.clearArray(n)}}_DrawCoplanarInstances_3DCamera(e,t){const s=this._curRenderTarget;e.CoplanarStartStencilPass();for(let s=0,i=t.length;s<i;++s){const i=t[s],r=i.GetWorldInfo();r._SetDrawBackFaceOnly(!0),this._DrawInstance(i,r,e)}e.CoplanarStartColorPass();for(let i=0,r=t.length;i<r;++i){const r=t[i],n=r.GetWorldInfo();this._DrawInstanceMaybeWithEffects(r,n,e,s),n._SetDrawBackFaceOnly(!1)}e.CoplanarRestoreStandardRendering()}_DrawInstances_RenderCells(t){const s=this._renderGrid,i=this._curRenderCells,r=this._lastRenderCells,n=this.GetViewport();let a;i.set(s.XToCell(n.getLeft()),s.YToCell(n.getTop()),s.XToCell(n.getRight()),s.YToCell(n.getBottom())),this._isRenderListUpToDate&&i.equals(r)?a=this._lastRenderList:(a=this._GetRenderCellInstancesToDraw(),this._isRenderListUpToDate=!0,r.copy(i)),this._DrawInstances(t,a),a!==this._lastRenderList&&e.shallowAssignArray(this._lastRenderList,a)}_DrawInstanceMaybeWithEffects(e,t,s,i){t.HasAnyActiveEffect()?this._DrawInstanceWithEffectsAndRestore(e,t,s,i):this._DrawInstance(e,t,s)}_DrawInstance(e,t,s){const i=t.GetRendererStateGroup();s.GetCurrentStateGroup()!==i&&i.Apply(),e.Draw(s)}_DrawInstanceWithEffectsAndRestore(e,t,s,i){this._DrawInstanceWithEffects(e,t,s,i,null)&&this._SetTransform(s)}_DrawInstanceWithEffects(e,t,s,i,r){const n=t.GetInstanceEffectList().GetEffectChain();return n.Render(s,i,{contentObject:e,blendMode:t.GetBlendMode(),devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),time:e.GetInstanceGameTime(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:t.GetBoundingBox(),drawSurfaceRect:n.CanSkipCalculatingDrawSurfaceRect()?null:this._InstanceBoxToDrawSurface(t),drawContentHook:r&&r.drawContentHook,compositOffX:r&&r.compositOffX,compositOffY:r&&r.compositOffY,updateOwnProjection:r&&r.updateOwnProjection}),s.SetBaseZ(this.GetZElevation()),n.DidChangeTransform()}_DrawLayerOwnTextureToRenderTarget(e,t,s,i){const r=this._effectList.GetActiveEffectTypes(),n=this._runtime;0===r.length?(e.SetRenderTarget(s),e.SetTextureFillMode(),i&&0===this._blendMode&&this.HasDefaultColor()?e.CopyRenderTarget(t):(e.SetBlendMode(this._blendMode),e.SetColor(this._premultipliedColor),e.DrawRenderTarget(t)),e.InvalidateRenderTarget(t),n.ReleaseAdditionalRenderTarget(t)):this.GetEffectChain().Render(e,s,{contentObject:this,blendMode:this.GetBlendMode(),devicePixelRatio:n.GetEffectDevicePixelRatioParam(),layerScale:n.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:this.GetViewport(),drawSurfaceRect:null,invalidateRenderTargets:!0})}GetOwnScale(){return this._scale}SetOwnScale(e){this._scale!==e&&(this._scale=e,this._layout.BoundScrolling(),this._SetMVMatrixChanged(),this._runtime.UpdateRender())}GetRenderScale(){return this.GetNormalScale()*this._runtime.GetRenderScale()}GetDisplayScale(){return this.GetNormalScale()*this._runtime.GetDisplayScale()}GetNormalScale(){return(this._scale*this._layout.GetScale()-1)*this._scaleRate+1}_MaybeUpdateViewport(){if(!this._isViewportChanged)return;this._isViewportChanged=!1;const e=this._runtime.GetParallaxXOrigin(),i=this._runtime.GetParallaxYOrigin(),r=(this.GetScrollX()-e)*this._parallaxX+e,n=(this.GetScrollY()-i)*this._parallaxY+i,a=this.GetNormalScale(),o=this._runtime.GetViewportWidth()/a,h=this._runtime.GetViewportHeight()/a;let l=r-o/2,c=n-h/2;this._runtime.IsPixelRoundingEnabled()&&(l=Math.round(l),c=Math.round(c));const u=this._viewportZ0;u.set(l,c,l+o,c+h);const _=this.GetAngle();0!==_&&(t.copy(u),t.offset(-u.midX(),-u.midY()),s.setFromRotatedRect(t,_),s.getBoundingBox(t),t.offset(u.midX(),u.midY()),u.copy(t));const d=this._zElevation;this.GetViewportForZ(d,this._viewport),this.Has3DCamera()?this.CalculateViewport3D(d,this._viewport3D):this._viewport3D.copy(this._viewport)}CalculateViewport3D(e,t){const s=this._runtime.GetCanvasManager(),i=s.GetCssWidth(),r=s.GetCssHeight(),[n,a]=this.CanvasCssToLayer(0,0,e),[o,h]=this.CanvasCssToLayer(i,0,e),[l,c]=this.CanvasCssToLayer(i,r,e),[u,_]=this.CanvasCssToLayer(0,r,e);let d=Math.min(n,o,l,u),p=Math.min(a,h,c,_),f=Math.max(n,o,l,u),m=Math.max(a,h,c,_);isFinite(d)||(d=-1/0),isFinite(p)||(p=-1/0),isFinite(f)||(f=1/0),isFinite(m)||(m=1/0),t.set(d,p,f,m)}CanvasCssToLayer(e,t,s=0){return this._CanvasToLayer(e,t,s,this.GetDisplayScale())}DrawSurfaceToLayer(e,t,s=0){return this._CanvasToLayer(e,t,s,this.GetRenderScale()*this.GetDevicePixelRatio())}_CanvasToLayer(t,s,i,r){const n=this._runtime,a=n.GetRenderer(),o=this.GetNormalScale(),l=n.GetViewportWidth()/o,c=n.GetViewportHeight()/o,d=_;h.set(d,0,0,l,c),t/=r,s=d[3]-s/r;const p=this._GetProjectionMatrix(a),f=this._GetModelViewMatrix(a),m=u;return e.Gfx.UnprojectScreenToWorldZ(t,s,i,f,p,d,m)?[m[0],m[1]]:[NaN,NaN]}CanvasCssToLayer_DefaultTransform(e,t){const s=this._scale,i=this._scaleRate,r=this._parallaxX,n=this._parallaxY,a=this._angle;this._scale=1,this._scaleRate=1,this._parallaxX=1,this._parallaxY=1,this._angle=0,this._SetMVMatrixChanged();const o=this.CanvasCssToLayer(e,t);return this._scale=s,this._scaleRate=i,this._parallaxX=r,this._parallaxY=n,this._angle=a,this._SetMVMatrixChanged(),o}LayerToCanvasCss(e,t,s=0){return this._LayerToCanvas(e,t,s,this.GetDisplayScale())}LayerToDrawSurface(e,t,s=0){return this._LayerToCanvas(e,t,s,this.GetRenderScale()*this.GetDevicePixelRatio())}_LayerToCanvas(t,s,i,r){const n=this._runtime,a=n.GetRenderer(),o=this.GetNormalScale(),l=n.GetViewportWidth()/o,c=n.GetViewportHeight()/o,d=_;h.set(d,0,0,l,c);const p=this._GetProjectionMatrix(a),f=this._GetModelViewMatrix(a),m=u;return e.Gfx.Project(t,s,i,f,p,d,m)?[m[0]*r,(d[3]-m[1])*r]:[NaN,NaN]}_GetLayerToDrawSurfaceScale(e,t){return e*=this.GetRenderScale()*this.GetDevicePixelRatio(),0!==t&&(e*=this.Get2DScaleFactorToZ(t)),e}_InstanceBoxToDrawSurface(e){const s=e.GetBoundingBox(),i=e.GetTotalZElevation(),r=e.GetDepth(),n=i+r,a=s.getLeft(),o=s.getTop(),h=s.getRight(),l=s.getBottom();if(this.Has3DCamera()){if(this._IsPointBehindNearPlane(a,o,i)||this._IsPointBehindNearPlane(h,o,i)||this._IsPointBehindNearPlane(h,l,i)||this._IsPointBehindNearPlane(a,l,i))return null;if(r>0&&(this._IsPointBehindNearPlane(a,o,n)||this._IsPointBehindNearPlane(h,o,n)||this._IsPointBehindNearPlane(h,l,n)||this._IsPointBehindNearPlane(a,l,n)))return null}else if(n>=this.GetCameraZ())return null;let[c,u]=this.LayerToDrawSurface(a,o,i),[_,d]=this.LayerToDrawSurface(h,l,i);if(0!==this.GetAngle()||r>0||this.Has3DCamera()){const[e,t]=this.LayerToDrawSurface(h,o,i),[s,p]=this.LayerToDrawSurface(a,l,i);if(r>0){const[i,r]=this.LayerToDrawSurface(a,o,n),[f,m]=this.LayerToDrawSurface(h,o,n),[g,S]=this.LayerToDrawSurface(h,l,n),[y,G]=this.LayerToDrawSurface(a,l,n);let I=Math.min(c,_,e,s,i,f,g,y);_=Math.max(c,_,e,s,i,f,g,y),c=I,I=Math.min(u,d,t,p,r,m,S,G),d=Math.max(u,d,t,p,r,m,S,G),u=I}else{let i=Math.min(c,_,e,s);_=Math.max(c,_,e,s),c=i,i=Math.min(u,d,t,p),d=Math.max(u,d,t,p),u=i}}return t.set(c,u,_,d),t}_GetViewFrustum(){return this._isViewFrustumChanged&&(this._UpdateViewFrustum(),this._isViewFrustumChanged=!1),this._viewFrustum}_UpdateViewFrustum(){const e=this._runtime.GetRenderer(),t=this._GetProjectionMatrix(e),s=this._GetModelViewMatrix(e);this._viewFrustum.CalculatePlanes(s,t)}_IsPointBehindNearPlane(e,t,s){return this._GetViewFrustum().IsBehindNearPlane(e,t,s)}_SaveToJson(){return{s:this.GetOwnScale(),a:this.GetOwnAngle(),v:this._IsVisibleFlagSet(),i:this.IsInteractive(),bc:this._backgroundColor.toJSON(),t:this.IsTransparent(),sx:this._scrollX,sy:this._scrollY,hosp:this._hasOwnScrollPosition,px:this.GetParallaxX(),py:this.GetParallaxY(),c:this._color.toJSON(),sr:this.GetScaleRate(),fx:this._effectList.SaveToJson(),cg:this._createdGlobalUids}}_LoadFromJson(t){this._scale=t.s,this._angle=t.a,this._isVisible=!!t.v,this._isInteractive=!t.hasOwnProperty("i")||t.i,this._backgroundColor.setFromJSON(t.bc),this._isTransparent=!!t.t,t.hasOwnProperty("sx")&&(this._scrollX=t.sx),t.hasOwnProperty("sy")&&(this._scrollY=t.sy),t.hasOwnProperty("hosp")&&(this._hasOwnScrollPosition=!!t.hosp),this._parallaxX=t.px,this._parallaxY=t.py,this._color.setFromJSON(t.c),this._UpdatePremultipliedColor(),this._scaleRate=t.sr,e.shallowAssignArray(this._createdGlobalUids,t.cg),e.shallowAssignArray(this._initialInstances,this._startupInitialInstances);const s=new Set(this._createdGlobalUids);let i=0;for(let e=0,t=this._initialInstances.length;e<t;++e)s.has(this._initialInstances[e][2])||(this._initialInstances[i]=this._initialInstances[e],++i);e.truncateArray(this._initialInstances,i),this._effectList.LoadFromJson(t.fx),this._needsRebuildEffectChainSteps=!0,this._SortInstancesByLastCachedZIndex(!1),this.SetZIndicesChanged(),this._SetMVMatrixChanged(),this._SetProjectionMatrixChanged()}GetILayer(){return this._iLayer}SortAndAddInstancesByZIndex(e,t=!1){if(this._instances.includes(e))t&&this._instances.sort(((e,t)=>e.GetWorldInfo().GetSceneGraphZIndex()-t.GetWorldInfo().GetSceneGraphZIndex()));else if(e.HasChildren()){const t=[...e.allChildren()];t.push(e),t.sort(((e,t)=>e.GetWorldInfo().GetSceneGraphZIndex()-t.GetWorldInfo().GetSceneGraphZIndex()));for(const e of t)if(e.IsInContainer())for(const s of e.siblings()){if(t.includes(s))continue;const e=[...s.allChildren()];e.push(s),e.sort(((e,t)=>e.GetWorldInfo().GetSceneGraphZIndex()-t.GetWorldInfo().GetSceneGraphZIndex())),e&&e.length&&t.splice(t.length,0,...e)}for(const e of t)e.GetPlugin().IsWorldType()&&this._AddInstance(e,!0)}else{if(e.GetPlugin().IsWorldType()&&this._AddInstance(e,!0),!e.IsInContainer())return;for(const t of e.siblings()){const e=[...t.allChildren()];if(e.push(t),e.sort(((e,t)=>e.GetWorldInfo().GetSceneGraphZIndex()-t.GetWorldInfo().GetSceneGraphZIndex())),e&&e.length)for(const t of e)t.GetPlugin().IsWorldType()&&this._AddInstance(t,!0)}}}}}{const e=self.C3,t=self.C3Debugger,s=self.assert,i=e.New(e.Rect),r=e.New(e.Rect),n=e.New(e.Rect),a=e.New(e.Color),o=self.glMatrix,h=o.vec3,l=[],c=[],u=[],_=[];function vec3EqualsXYZ(e,t,s,i){return e[0]===Math.fround(t)&&e[1]===Math.fround(s)&&e[2]===Math.fround(i)}let d=null;function MaybePrepareLayerDraw(e,t){d!==e&&(e.PrepareForDraw(t),d=e)}e.Layout=class extends e.DefendedBase{constructor(t,s,i){super(),this._layoutManager=t,this._runtime=t.GetRuntime(),this._name=i[0],this._originalWidth=i[1],this._originalHeight=i[2],this._width=i[1],this._height=i[2],this._isUnboundedScrolling=!!i[3],this._isOrthographicProjection=!!i[4],this._vanishingPointX=i[5],this._vanishingPointY=i[6],this._eventSheetName=i[7],this._eventSheet=null,this._sid=i[8],this._index=s,this._scrollX=0,this._scrollY=0,this._scale=1,this._angle=0,this._initialObjectClasses=new Set,this._textureLoadedTypes=new Set,this._textureLoadPendingPromises=new Set,this._createdInstances=[],this._createdPersistedInstances=[],this._createdPersistedInstancesToDataMap=new Map,this._createdPersistedIndexToInstanceMap=new Map,this._initialNonWorld=[],this._is3dCameraEnabled=!1,this._cam3dposition=h.create(),this._cam3dlook=h.create(),this._cam3dup=h.create(),this._rootLayers=[],this._allLayersFlat=[],this._layersByName=new Map,this._layersBySid=new Map;const r=this._runtime.GetCanvasManager();this._effectList=e.New(e.EffectList,this,i[11]),this._effectChain=e.New(e.Gfx.EffectChain,r.GetEffectChainManager(),{drawContent:(e,t)=>{const s=t.GetContentObject().GetRenderTarget();e.ResetColor(),e.DrawRenderTarget(s),e.InvalidateRenderTarget(s),r.ReleaseAdditionalRenderTarget(s)},getShaderParameters:e=>this.GetEffectList()._GetEffectChainShaderParametersForIndex(e)}),this._needsRebuildEffectChainSteps=!0,this._wasFullScreenQualityLow=!1,this._curRenderTarget=null,this._persistData={},this._persistedIntances=new Map,this._isFirstVisit=!0,this._iLayout=new self.ILayout(this),this._userScriptDispatcher=e.New(e.Event.Dispatcher);for(const t of i[9])this._rootLayers.push(e.New(e.Layer,this,null,t));this._allLayersFlat=[...this.allLayers()];for(let e=0,t=this._allLayersFlat.length;e<t;++e){const t=this._allLayersFlat[e];t._SetIndex(e),t._Init(),this._layersByName.set(t.GetName().toLowerCase(),t),this._layersBySid.set(t.GetSID(),t)}for(const e of i[10]){const t=this._runtime.GetObjectClassByIndex(e[1]);if(!t)throw new Error("missing nonworld object class");t.GetDefaultInstanceData()||t.SetDefaultInstanceData(e),this._initialNonWorld.push(e),this._AddInitialObjectClass(t)}}Release(){for(const e of this._allLayersFlat)e.Release();e.clearArray(this._allLayersFlat),this._textureLoadPendingPromises.clear(),this._eventSheet=null,this._layoutManager=null,this._runtime=null}GetRuntime(){return this._runtime}GetName(){return this._name}GetSID(){return this._sid}GetIndex(){return this._index}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}_MaybeRebuildEffectChainSteps(){const e="low"===this._runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality();if(!this._needsRebuildEffectChainSteps&&this._wasFullScreenQualityLow===e&&!this._effectChain.NeedsRebuild())return;const t=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(t.map((e=>e.GetShaderProgram())),{indexMap:t.map((e=>e.GetIndex())),forcePostDraw:e,useFullSurface:!0}),this._needsRebuildEffectChainSteps=!1,this._wasFullScreenQualityLow=e}UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects(),this._needsRebuildEffectChainSteps=!0}GetMinLayerScale(){let e=this._allLayersFlat[0].GetNormalScale();for(let t=1,s=this._allLayersFlat.length;t<s;++t){const s=this._allLayersFlat[t];0===s.GetParallaxX()&&0===s.GetParallaxY()||(e=Math.min(e,s.GetNormalScale()))}return e}_GetScrollBoundMarginHorizontal(){return.5*this._runtime.GetViewportWidth()/this.GetMinLayerScale()}_GetScrollBoundMarginVertical(){return.5*this._runtime.GetViewportHeight()/this.GetMinLayerScale()}GetScrollLeftBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginHorizontal()}GetScrollRightBound(){return this.IsUnboundedScrolling()?1/0:this.GetWidth()-this._GetScrollBoundMarginHorizontal()}GetScrollTopBound(){return this.IsUnboundedScrolling()?-1/0:this._GetScrollBoundMarginVertical()}GetScrollBottomBound(){return this.IsUnboundedScrolling()?1/0:this.GetHeight()-this._GetScrollBoundMarginVertical()}SetScrollX(e){const t=this.GetScrollLeftBound(),s=this.GetScrollRightBound();e>s&&(e=s),e<t&&(e=t),this._scrollX!==e&&(this._scrollX=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollX(){return this._scrollX}SetScrollY(e){const t=this.GetScrollTopBound(),s=this.GetScrollBottomBound();e>s&&(e=s),e<t&&(e=t),this._scrollY!==e&&(this._scrollY=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetScrollY(){return this._scrollY}IsUnboundedScrolling(){return this._isUnboundedScrolling}BoundScrolling(){this.SetScrollX(this.GetScrollX()),this.SetScrollY(this.GetScrollY());for(const e of this._allLayersFlat)e.IsOwnScrollPositionEnabled()&&(e.SetScrollX(e.GetScrollX()),e.SetScrollY(e.GetScrollY()))}SetVanishingPointXY(e,t){this._vanishingPointX===e&&this._vanishingPointY===t||(this._vanishingPointX=e,this._vanishingPointY=t,this.IsPerspectiveProjection()&&(this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender()))}GetVanishingPointX(){return this.IsOrthographicProjection()?.5:this._vanishingPointX}GetVanishingPointY(){return this.IsOrthographicProjection()?.5:this._vanishingPointY}HasVanishingPointOutsideViewport(){const e=this.GetVanishingPointX(),t=this.GetVanishingPointY();return e<0||e>1||t<0||t>1}SetPerspectiveProjection(){this._isOrthographicProjection&&(this._isOrthographicProjection=!1,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}SetOrthographicProjection(){this._isOrthographicProjection||(this._isOrthographicProjection=!0,this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}IsOrthographicProjection(){return this._isOrthographicProjection}IsPerspectiveProjection(){return!this.IsOrthographicProjection()}Set3DCameraEnabled(e){e=!!e,this._is3dCameraEnabled!==e&&(this._is3dCameraEnabled=e,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}Is3DCameraEnabled(){return this._is3dCameraEnabled}Set3DCameraOrientation(e,t,s,i,r,n,a,o,l){vec3EqualsXYZ(this._cam3dposition,e,t,s)&&vec3EqualsXYZ(this._cam3dlook,i,r,n)&&vec3EqualsXYZ(this._cam3dup,a,o,l)||(h.set(this._cam3dposition,e,t,s),h.set(this._cam3dlook,i,r,n),h.set(this._cam3dup,a,o,l),this.Set3DCameraChanged())}Set3DCameraChanged(){this._SetAllLayersMVChanged(),this._runtime.UpdateRender()}Get3DCameraPosition(){return this._cam3dposition}Get3DCameraLookAt(){return this._cam3dlook}Get3DCameraUpVector(){return this._cam3dup}GetScale(){return this._scale}SetScale(e){this._scale!==e&&(this._scale=e,this._SetAllLayersMVChanged(),this.BoundScrolling(),this._runtime.UpdateRender())}SetAngle(t){t=e.clampAngle(t),this._angle!==t&&(this._angle=t,this._SetAllLayersMVChanged(),this._runtime.UpdateRender())}GetAngle(){return this._angle}GetWidth(){return this._width}SetWidth(e){!isFinite(e)||e<1||(this._width=e)}GetHeight(){return this._height}SetHeight(e){!isFinite(e)||e<1||(this._height=e)}GetEventSheet(){return this._eventSheet}*allLayers(){for(const e of this._rootLayers)yield*e.selfAndAllSubLayers()}GetLayers(){return this._allLayersFlat}GetLayerCount(){return this._allLayersFlat.length}GetLayer(e){return"number"==typeof e?this.GetLayerByIndex(e):this.GetLayerByName(e.toString())}GetLayerByIndex(t){return t=e.clamp(Math.floor(t),0,this._allLayersFlat.length-1),this._allLayersFlat[t]}GetLayerByName(e){return this._layersByName.get(e.toLowerCase())||null}GetLayerBySID(e){return this._layersBySid.get(e)||null}_SetAllLayersProjectionChanged(){for(const e of this._allLayersFlat)e._SetProjectionMatrixChanged()}_SetAllLayersMVChanged(){for(const e of this._allLayersFlat)e._SetMVMatrixChanged()}SaveTransform(){return{scrollX:this.GetScrollX(),scrollY:this.GetScrollY(),scale:this.GetScale(),angle:this.GetAngle(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY()}}RestoreTransform(e){this.SetScrollX(e.scrollX),this.SetScrollY(e.scrollY),this.SetScale(e.scale),this.SetAngle(e.angle),this.SetVanishingPointXY(e.vpX,e.vpY)}GetLayoutBackgroundColor(){let e=this._rootLayers.filter((e=>e.ShouldDraw()))[0];for(;e;){if(!e.IsTransparent())return a.copyRgb(e.GetBackgroundColor()),a.setA(1),a;if(e.UsesOwnTexture())return a.setRgba(0,0,0,0),a;e=e.GetSubLayers().filter((e=>e.ShouldDraw()))[0]}return a.setRgba(0,0,0,0),a}IsFirstVisit(){return this._isFirstVisit}_GetInitialObjectClasses(){return[...this._initialObjectClasses]}_AddInitialObjectClass(e){if(e.IsInContainer())for(const t of e.GetContainer().GetObjectTypes())this._initialObjectClasses.add(t);else this._initialObjectClasses.add(e)}_GetTextureLoadedObjectTypes(){return[...this._textureLoadedTypes]}_Load(t,s){if(t===this||!s)return Promise.resolve();t&&(e.CopySet(this._textureLoadedTypes,t._textureLoadedTypes),t._textureLoadedTypes.clear());const i=[];for(const e of this._initialObjectClasses)this._textureLoadedTypes.has(e)||(i.push(e.LoadTextures(s)),this._textureLoadedTypes.add(e));return Promise.all(i)}async MaybeLoadTexturesFor(e){if(e.IsFamily())throw new Error("cannot load textures for family");const t=this._runtime.GetRenderer();if(!t||t.IsContextLost()||this._textureLoadedTypes.has(e))return;this._textureLoadedTypes.add(e);const s=e.LoadTextures(t);this._AddPendingTextureLoadPromise(s),await s,e.OnDynamicTextureLoadComplete(),this._runtime.UpdateRender()}_AddPendingTextureLoadPromise(e){this._textureLoadPendingPromises.add(e),e.then((()=>this._textureLoadPendingPromises.delete(e))).catch((()=>this._textureLoadPendingPromises.delete(e)))}WaitForPendingTextureLoadsToComplete(){return Promise.all([...this._textureLoadPendingPromises])}MaybeUnloadTexturesFor(e){if(e.IsFamily()||e.GetInstanceCount()>0)throw new Error("cannot unload textures");const t=this._runtime.GetRenderer();t&&this._textureLoadedTypes.has(e)&&(this._textureLoadedTypes.delete(e),e.ReleaseTextures(t))}_Unload(e,t){if(e!==this&&t)for(const t of this._textureLoadedTypes)t.IsGlobal()||e._initialObjectClasses.has(t)||(t.ReleaseTextures(),this._textureLoadedTypes.delete(t))}_OnRendererContextLost(){this._textureLoadedTypes.clear()}async _StartRunning(t){const s=this._runtime,i=this._layoutManager,r=s.GetEventSheetManager();this._eventSheetName&&(this._eventSheet=r.GetEventSheetByName(this._eventSheetName),this._eventSheet._UpdateDeepIncludes()),i._SetMainRunningLayout(this),this._width=this._originalWidth,this._height=this._originalHeight,this._scrollX=s.GetOriginalViewportWidth()/2,this._scrollY=s.GetOriginalViewportHeight()/2,this.BoundScrolling(),this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged(),this._MoveGlobalObjectsToThisLayout(t),this._runtime.SetUsingCreatePromises(!0),this._CreateInitialInstances(),this._isFirstVisit||this._CreatePersistedInstances(),this._CreateAndLinkContainerInstances(this._createdInstances),this._CreateAndLinkContainerInstances(this._createdPersistedInstances),this._CreateInitialNonWorldInstances(),i.ClearPendingChangeLayout(),s.FlushPendingInstances(),this._runtime.SetUsingCreatePromises(!1);const n=this._runtime.GetCreatePromises();if(await Promise.all(n),e.clearArray(n),!s.IsLoadingState()){for(const e of this._createdInstances)e.SetupInitialSceneGraphConnections();for(const e of this._createdPersistedInstances)e.SetupPersistedSceneGraphConnections(this._createdPersistedInstancesToDataMap,this._createdPersistedIndexToInstanceMap);for(const[t,s]of Object.entries(this._persistData)){const i=this._runtime.GetObjectClassBySID(parseInt(t,10));i&&!i.IsFamily()&&i.HasPersistBehavior()&&e.clearArray(s)}for(const e of this._createdInstances)e._TriggerOnCreated();for(const e of this._createdPersistedInstances)e._TriggerOnCreated()}e.clearArray(this._createdInstances),e.clearArray(this._createdPersistedInstances),this._createdPersistedInstancesToDataMap.clear(),this._createdPersistedIndexToInstanceMap.clear(),await Promise.all([...this._initialObjectClasses].map((e=>e.PreloadTexturesWithInstances(this._runtime.GetRenderer())))),t&&(s.Dispatcher().dispatchEvent(new e.Event("beforefirstlayoutstart")),await s.DispatchUserScriptEventAsyncWait(new e.Event("beforeprojectstart"))),s.Dispatcher().dispatchEvent(new e.Event("beforelayoutstart")),await this.DispatchUserScriptEventAsyncWait(new e.Event("beforelayoutstart")),s.IsLoadingState()||await s.TriggerAsync(e.Plugins.System.Cnds.OnLayoutStart,null,null),s.Dispatcher().dispatchEvent(new e.Event("afterlayoutstart")),await this.DispatchUserScriptEventAsyncWait(new e.Event("afterlayoutstart")),t&&(s.Dispatcher().dispatchEvent(new e.Event("afterfirstlayoutstart")),await s.DispatchUserScriptEventAsyncWait(new e.Event("afterprojectstart"))),r._RunQueuedTriggers(i),await this.WaitForPendingTextureLoadsToComplete(),this._isFirstVisit=!1}_MoveGlobalObjectsToThisLayout(t){for(const t of this._runtime.GetAllObjectClasses())if(!t.IsFamily()&&t.IsWorldType())for(const s of t.GetInstances()){const t=s.GetWorldInfo(),i=t.GetLayer(),r=e.clamp(i.GetIndex(),0,this._allLayersFlat.length-1),n=this._allLayersFlat[r];t._SetLayer(n),n._MaybeAddInstance(s)}if(!t)for(const e of this._allLayersFlat)e._SortInstancesByLastCachedZIndex(!1)}_CreateInitialInstances(){for(const e of this._allLayersFlat)e.CreateInitialInstances(this._createdInstances),e._Start()}_CreatePersistedInstances(){let e=!1;for(const[t,s]of Object.entries(this._persistData)){const i=this._runtime.GetObjectClassBySID(parseInt(t,10));if(i&&!i.IsFamily()&&i.HasPersistBehavior())for(const t of s){let s=null;if(i.IsWorldType()&&(s=t.hasOwnProperty("instJson")?this.GetLayerBySID(t.instJson.w.l):this.GetLayerBySID(t.w.l),!s))continue;const r=this._runtime.CreateInstanceFromData(i,s,!1,0,0,!0);t.hasOwnProperty("instJson")?r.LoadFromJson(t.instJson):r.LoadFromJson(t),e=!0,this._createdPersistedInstances.push(r),t.hasOwnProperty("instJson")&&(this._createdPersistedInstancesToDataMap.set(r,t),this._createdPersistedIndexToInstanceMap.set(t.index,r))}}for(const e of this._allLayersFlat)e._SortInstancesByLastCachedZIndex(!0),e.SetZIndicesChanged();e&&(this._runtime.FlushPendingInstances(),this._runtime._RefreshUidMap())}_CreateAndLinkContainerInstances(e){for(const t of e){if(!t.IsInContainer())continue;const s=t.GetWorldInfo(),i=t.GetIID();for(const r of t.GetObjectClass().GetContainer().objectTypes()){if(r===t.GetObjectClass())continue;const n=r.GetInstances();if(n.length>i)t._AddSibling(n[i]);else{let i;i=s?this._runtime.CreateInstanceFromData(r,s.GetLayer(),!0,s.GetX(),s.GetY(),!0):this._runtime.CreateInstanceFromData(r,null,!0,0,0,!0),this._runtime.FlushPendingInstances(),r._UpdateIIDs(),t._AddSibling(i),e.push(i)}}}}_CreateInitialNonWorldInstances(){for(const e of this._initialNonWorld){this._runtime.GetObjectClassByIndex(e[1]).IsInContainer()||this._runtime.CreateInstanceFromData(e,null,!0)}}_CreateGlobalNonWorlds(){const t=[],s=this._initialNonWorld;let i=0;for(let e=0,r=s.length;e<r;++e){const r=s[e],n=this._runtime.GetObjectClassByIndex(r[1]);n.IsGlobal()?n.IsInContainer()&&n.GetContainer().HasAnyWorldType()||t.push(this._runtime.CreateInstanceFromData(r,null,!0)):(s[i]=r,++i)}e.truncateArray(s,i),this._runtime.FlushPendingInstances(),this._CreateAndLinkContainerInstances(t)}RecreateInitialObjects(e,t,s,i,r,n){if(s)return s.RecreateInitialObjects(e,t,i,r,n);{const s=[];for(const a of this._allLayersFlat)s.push(a.RecreateInitialObjects(e,t,i,r,n));return s.flat()}}async _StopRunning(){const t=this._layoutManager;this._runtime.IsLoadingState()||(await this.DispatchUserScriptEventAsyncWait(new e.Event("beforelayoutend")),await this._runtime.TriggerAsync(e.Plugins.System.Cnds.OnLayoutEnd,null,null),await this.DispatchUserScriptEventAsyncWait(new e.Event("afterlayoutend"))),t.SetIsEndingLayout(!0),this._runtime.GetEventSheetManager().ClearAllScheduledWaits(),this._isFirstVisit||this._SavePersistData();for(const e of this._allLayersFlat)e._End();for(const e of this._runtime.GetAllObjectClasses())if(!(e.IsGlobal()||e.IsWorldType()||e.GetPlugin().IsSingleGlobal()||e.IsFamily())){for(const t of e.GetInstances())this._runtime.DestroyInstance(t);this._runtime.FlushPendingInstances()}t.SetIsEndingLayout(!1),t.GetMainRunningLayout()===this&&t._SetMainRunningLayout(null)}_SaveInstanceToPersist(e,t){const s=e.GetObjectClass().GetSID().toString();this._persistData.hasOwnProperty(s)||(this._persistData[s]=[]);const i=this._persistData[s],r={index:t,instJson:e.SaveToJson(),sceneGraphJson:{children:[]}};i.push(r),this._persistedIntances.set(e,r)}_SaveSceneGraphInfoToPersist(t){const s=this._persistedIntances.get(t);for(const i of t.GetChildren()){const t=this._persistedIntances.get(i);t&&s.sceneGraphJson.children.push({index:t.index,flags:e.SceneGraphInfo._GetFlagsNumber(i.GetWorldInfo())})}}_SavePersistData(){this._persistedIntances.clear();let e=0;for(const t of this._allLayersFlat){t._UpdateZIndices();for(const s of t._GetInstances()){const t=s.GetObjectClass();!t.IsGlobal()&&t.HasPersistBehavior()&&(this._SaveInstanceToPersist(s,e),e++)}}for(const e of this._allLayersFlat)for(const t of e._GetInstances()){const e=t.GetObjectClass();!e.IsGlobal()&&e.HasPersistBehavior()&&this._SaveSceneGraphInfoToPersist(t)}this._persistedIntances.clear()}ResetPersistData(){this._persistData={},this._isFirstVisit=!0}GetRenderTarget(){return this._curRenderTarget}UsesOwnTexture(){const e=this._runtime,t=e.GetRenderer().IsWebGL();return"low"===e.GetCanvasManager().GetCurrentFullscreenScalingQuality()||t&&e.UsesAnyBackgroundBlending()||"low-latency"===e.GetCompositingMode()||this._effectList.HasAnyActiveEffect()||t&&e.Uses3DFeatures()}Draw(e){const t=this._runtime.GetCanvasManager(),s=this.UsesOwnTexture();if(s){"low-latency"!==this._runtime.GetCompositingMode()&&(e.SetRenderTarget(null),e.ClearRgba(0,0,0,0));const s={sampling:this._runtime.GetSampling(),isSampled:e.IsWebGPU()||this._runtime.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect(),canReadPixels:!!e.IsWebGPU()&&this._runtime.UsesAnyBackgroundBlending()};"low"===t.GetCurrentFullscreenScalingQuality()&&(s.width=t.GetDrawWidth(),s.height=t.GetDrawHeight()),this._curRenderTarget=this._runtime.GetAdditionalRenderTarget(s)}else this._curRenderTarget=null;e.SetRenderTarget(this._curRenderTarget),e.Clear(this.GetLayoutBackgroundColor()),this._runtime.Uses3DFeatures()&&e.ClearDepth(),this._DrawLayerList(e,this._curRenderTarget,this._rootLayers,!0),s&&(e.SetDepthEnabled(!1),this._DrawLayoutOwnTextureToRenderTarget(e,this._curRenderTarget)),this._curRenderTarget=null}_DrawLayerList(t,s,i,r){const n=i.filter((e=>e.ShouldDraw()));for(let i=0,a=n.length;i<a;){const o=n[i];if(o.SelfAndAllSubLayersHave3DCamera()&&!o.SelfOrAnySubLayerUsesOwnTexture()){l.push(o);for(let e=i+1;e<a;++e){const t=n[e];if(!t.SelfAndAllSubLayersHave3DCamera()||t.SelfOrAnySubLayerUsesOwnTexture())break;l.push(n[e])}if(l.length>=2||1===l.length&&l[0].HasAnyVisibleSubLayer()){this._Draw3DLayers(t,s,l),i+=l.length,e.clearArray(l);continue}e.clearArray(l)}o.Draw(t,s,r&&0===i),++i}}_DrawLayoutOwnTextureToRenderTarget(e,t){const s=this._effectList.GetActiveEffectTypes(),i=this._runtime;0===s.length?(e.SetRenderTarget(null),e.SetTextureFillMode(),e.CopyRenderTarget(t),e.InvalidateRenderTarget(t),i.ReleaseAdditionalRenderTarget(t)):(n.set(0,0,i.GetViewportWidth(),i.GetViewportHeight()),this.GetEffectChain().Render(e,null,{contentObject:this,blendMode:3,devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetScale(),layerAngle:this.GetAngle(),layoutRect:n,drawSurfaceRect:null,invalidateRenderTargets:!0}))}_Draw3DLayers(t,s,i){i[0].IsTransparent()||(a.copyRgb(i[0].GetBackgroundColor()),a.setA(1),t.Clear(a));const r=this._runtime.GetCanvasManager();t.SetDepthEnabled(!0);const n=c,o=u,h=_;for(const e of i)e._UpdateZIndices(),e._AppendAllInstancesIncludingSubLayersInDrawOrder(n);const l=i[0];let p=null;if(this._runtime.IsGPUProfiling())if(t.IsWebGL()){const e=r.GetLayerTimingsBuffer(l);e&&(p=e.AddTimeElapsedQuery(),t.StartQuery(p))}else t.IsWebGPU()&&t.WriteTimestamp(2*(l.GetIndex()+1));for(let i=0,r=n.length;i<r;){const a=n[i],l=a.GetWorldInfo(),c=l.GetLayer();if(!l.IsVisible()||!l.IsInViewport3D(c._GetViewFrustum())){++i;continue}(!a.RendersToOwnZPlane()||l.GetDepth()>0)&&h.push(a);const u=a.GetWorldInfo().GetTotalZElevation();o.push(a);let _=i+1;for(;_<r;++_){const e=n[_],t=e.GetWorldInfo();if(t.IsVisible()&&t.IsInViewport3D(t.GetLayer()._GetViewFrustum())){if(t.GetTotalZElevation()!==u)break;e.RendersToOwnZPlane()?(t.GetDepth()>0&&h.push(e),o.push(e)):h.push(e)}}if(1!==o.length||o[0].MustMitigateZFighting()){this._Draw3DLayersCoplanarInstances(t,s,o);for(let e=0,i=h.length;e<i;++e){const i=h[e],r=i.GetWorldInfo(),n=r.GetLayer();r._SetDrawNonBackFacesOnly(!0),MaybePrepareLayerDraw(n,t),n._DrawInstanceMaybeWithEffects(i,r,t,s),r._SetDrawNonBackFacesOnly(!1)}}else{MaybePrepareLayerDraw(c,t),c._DrawInstanceMaybeWithEffects(a,l,t,s);for(let e=0,i=h.length;e<i;++e){const i=h[e];if(i===a)continue;const r=i.GetWorldInfo(),n=r.GetLayer();MaybePrepareLayerDraw(n,t),n._DrawInstanceMaybeWithEffects(i,r,t,s)}}i=_,e.clearArray(o),e.clearArray(h)}p&&t.EndQuery(p),this._runtime.IsGPUProfiling()&&t.IsWebGPU()&&t.WriteTimestamp(2*(l.GetIndex()+1)+1),e.clearArray(n),d=null}_Draw3DLayersCoplanarInstances(e,t,s){e.CoplanarStartStencilPass();for(let t=0,i=s.length;t<i;++t){const i=s[t],r=i.GetWorldInfo(),n=r.GetLayer();r._SetDrawBackFaceOnly(!0),MaybePrepareLayerDraw(n,e),n._DrawInstance(i,r,e)}e.CoplanarStartColorPass();for(let i=0,r=s.length;i<r;++i){const r=s[i],n=r.GetWorldInfo(),a=n.GetLayer();MaybePrepareLayerDraw(a,e),a._DrawInstanceMaybeWithEffects(r,n,e,t),n._SetDrawBackFaceOnly(!1)}e.CoplanarRestoreStandardRendering()}_SaveToJson(){const e={sx:this.GetScrollX(),sy:this.GetScrollY(),s:this.GetScale(),a:this.GetAngle(),w:this.GetWidth(),h:this.GetHeight(),ortho:this.IsOrthographicProjection(),vpX:this.GetVanishingPointX(),vpY:this.GetVanishingPointY(),fv:this._isFirstVisit,persist:this._persistData,fx:this._effectList.SaveToJson(),layers:{}};for(const t of this._allLayersFlat)e.layers[t.GetSID().toString()]=t._SaveToJson();return e}_LoadFromJson(e){this._scrollX=e.sx,this._scrollY=e.sy,this._scale=e.s,this._angle=e.a,this._width=e.w,this._height=e.h,this._isOrthographicProjection=!!e.ortho,e.hasOwnProperty("vpX")&&(this._vanishingPointX=e.vpX),e.hasOwnProperty("vpY")&&(this._vanishingPointY=e.vpY),this._isFirstVisit=!!e.fv,this._persistData=e.persist,this._effectList.LoadFromJson(e.fx),this._needsRebuildEffectChainSteps=!0;for(const[t,s]of Object.entries(e.layers)){const e=parseInt(t,10),i=this.GetLayerBySID(e);i&&i._LoadFromJson(s)}this._SetAllLayersProjectionChanged(),this._SetAllLayersMVChanged()}GetILayout(){return this._iLayout}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.layout=this.GetILayout();const s=this._runtime,i=s.IsDebug()&&!s.GetEventSheetManager().IsInEventEngine();i&&t.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),i&&t.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.layout=this.GetILayout(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}}}{const e=self.C3;e.LayoutManager=class extends e.DefendedBase{constructor(e){super(),this._runtime=e,this._allLayouts=[],this._layoutsByName=new Map,this._layoutsBySid=new Map,this._mainRunningLayout=null,this._runningSubLayouts=[],this._firstLayout=null,this._isEndingLayout=0,this._pendingChangeLayout=null}Release(){this._runtime=null,this._mainRunningLayout=null,this._firstLayout=null,this._pendingChangeLayout=null,e.clearArray(this._allLayouts),this._layoutsByName.clear(),this._layoutsBySid.clear(),e.clearArray(this._runningSubLayouts)}Create(t){const s=e.New(e.Layout,this,this._allLayouts.length,t);this._allLayouts.push(s),this._layoutsByName.set(s.GetName().toLowerCase(),s),this._layoutsBySid.set(s.GetSID(),s)}GetRuntime(){return this._runtime}SetFirstLayout(e){this._firstLayout=e}GetFirstLayout(){if(this._firstLayout)return this._firstLayout;if(this._allLayouts.length)return this._allLayouts[0];throw new Error("no first layout")}GetLayoutByName(e){return this._layoutsByName.get(e.toLowerCase())||null}GetLayoutBySID(e){return this._layoutsBySid.get(e)||null}GetLayoutByIndex(t){return t=e.clamp(Math.floor(t),0,this._allLayouts.length-1),this._allLayouts[t]}GetLayout(e){return"number"==typeof e?this.GetLayoutByIndex(e):this.GetLayoutByName(e.toString())}GetAllLayouts(){return this._allLayouts}_SetMainRunningLayout(e){this._mainRunningLayout=e}GetMainRunningLayout(){return this._mainRunningLayout}_AddRunningSubLayout(e){if(this._runningSubLayouts.includes(e))throw new Error("layout already running");this._runningSubLayouts.push(e)}_RemoveRunningSubLayout(e){const t=this._runningSubLayouts.indexOf(e);if(-1===t)throw new Error("layout not running");this._runningSubLayouts.splice(t,1)}*runningLayouts(){this._mainRunningLayout&&(yield this._mainRunningLayout),this._runningSubLayouts.length&&(yield*this._runningSubLayouts)}IsLayoutRunning(e){return this._mainRunningLayout===e||this._runningSubLayouts.includes(e)}SetIsEndingLayout(e){if(e)this._isEndingLayout++;else{if(this._isEndingLayout<=0)throw new Error("already unset");this._isEndingLayout--}}IsEndingLayout(){return this._isEndingLayout>0}ChangeMainLayout(e){this._pendingChangeLayout=e}ClearPendingChangeLayout(){this._pendingChangeLayout=null}IsPendingChangeMainLayout(){return!!this._pendingChangeLayout}GetPendingChangeMainLayout(){return this._pendingChangeLayout}SetAllLayerProjectionChanged(){const e=this.GetMainRunningLayout();e&&e._SetAllLayersProjectionChanged()}SetAllLayerMVChanged(){const e=this.GetMainRunningLayout();e&&e._SetAllLayersMVChanged()}}}{const e=self.C3,t=new RegExp("<(.+?)>","g");e.TimelineManager=class extends e.DefendedBase{constructor(t){super(),this._runtime=t,this._timelineDataManager=e.New(e.TimelineDataManager),this._pluginInstance=null,this._timelines=[],this._timelinesByName=new Map,this._objectClassToTimelineMap=new Map,this._timelinesCreatedByTemplate=new Map,this._scheduledTimelines=[],this._playingTimelines=[],this._markedForRemovalTimelines=[],this._hasRuntimeListeners=!1,this._changingLayout=!1,this._isTickingTimelines=!1,this._tickFunc=()=>this._OnTick(),this._tick2Func=()=>this._OnTick2(),this._beforeLayoutChange=()=>this._OnBeforeChangeLayout(),this._layoutChange=()=>this._OnAfterChangeLayout(),this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance),this._beforeLoad=e=>this._OnBeforeLoad(),this._afterLoad=e=>this._OnAfterLoad(),this._afterLayoutStart=e=>this._OnAfterLayoutStart(),this._destroyedWhileLoadingState=[],this._renderChange=0}Release(){this.RemoveRuntimeListeners(),this._tickFunc=null,this._tick2Func=null,this._beforeLayoutChange=null,this._layoutChange=null,this._instanceDestroy=null,this._afterLoad=null;for(const e of this._timelines)e.Stop(),e.Release();e.clearArray(this._timelines),this._timelines=null,this._timelineDataManager.Release(),this._timelineDataManager=null,e.clearArray(this._scheduledTimelines),this._scheduledTimelines=null,e.clearArray(this._playingTimelines),this._playingTimelines=null,e.clearArray(this._markedForRemovalTimelines),this._markedForRemovalTimelines=null,this._timelinesByName.clear(),this._timelinesByName=null,this._objectClassToTimelineMap.clear(),this._objectClassToTimelineMap=null,this._timelinesCreatedByTemplate.clear(),this._timelinesCreatedByTemplate=null,e.clearArray(this._destroyedWhileLoadingState),this._destroyedWhileLoadingState=null,this._runtime=null}AddRuntimeListeners(){const e=this._runtime.Dispatcher();e.addEventListener("pretick",this._tickFunc),e.addEventListener("tick2",this._tick2Func),e.addEventListener("beforelayoutchange",this._beforeLayoutChange),e.addEventListener("layoutchange",this._layoutChange),e.addEventListener("instancedestroy",this._instanceDestroy),e.addEventListener("beforeload",this._beforeLoad),e.addEventListener("afterload",this._afterLoad),e.addEventListener("afterlayoutstart",this._afterLayoutStart)}RemoveRuntimeListeners(){const e=this._runtime.Dispatcher();e.removeEventListener("pretick",this._tickFunc),e.removeEventListener("tick2",this._tick2Func),e.removeEventListener("beforelayoutchange",this._beforeLayoutChange),e.removeEventListener("layoutchange",this._layoutChange),e.removeEventListener("instancedestroy",this._instanceDestroy),e.removeEventListener("beforeload",this._beforeLoad),e.removeEventListener("afterload",this._afterLoad),e.removeEventListener("afterlayoutstart",this._afterLayoutStart)}Create(t){this._timelineDataManager.Add(t);const s=e.TimelineState.CreateInitial(t,this);this.Add(s),this.SetTimelineObjectClassesToMap(s),this._timelinesCreatedByTemplate.set(s.GetName(),0)}CreateFromTemplate(t){const s=this.GetTimelineDataManager(),i=t.GetTemplateName(),r=s.Get(i),n=e.TimelineState.CreateFromTemplate(`${i}:${this._timelinesCreatedByTemplate.get(i)}`,r,this);return this._IncreaseTemplateTimelinesCount(i),this.Add(n),n}_IncreaseTemplateTimelinesCount(e){this._timelinesCreatedByTemplate.set(e,this._timelinesCreatedByTemplate.get(e)+1)}_SetCreatedTemplateTimelinesCount(){for(const e of this._timelines){if(e.IsTemplate())continue;const t=e.GetTemplateName();this._IncreaseTemplateTimelinesCount(t)}}_ClearCreatedTemplateTimelinesCount(){for(const e of this._timelinesCreatedByTemplate.keys())this._timelinesCreatedByTemplate.set(e,0)}Add(e){this._timelines.push(e),this._timelinesByName.set(e.GetName().toLowerCase(),e)}Remove(t){t.Removed(),t.IsTemplate()||(e.arrayFindRemove(this._timelines,t),e.arrayFindRemove(this._scheduledTimelines,t),e.arrayFindRemove(this._playingTimelines,t),e.arrayFindRemove(this._markedForRemovalTimelines,t),this._timelinesByName.delete(t.GetName().toLowerCase()),this.RemoveTimelineFromObjectClassMap(t),t.IsReleased()||t.Release())}Trigger(e){this._runtime.Trigger(e,this._pluginInstance,null)}GetRuntime(){return this._runtime}GetTimelineDataManager(){return this._timelineDataManager}SetPluginInstance(e){this._pluginInstance=e}GetPluginInstance(){return this._pluginInstance}*GetTimelines(){for(const e of this._timelines)yield e}*GetPlayingTimelines(){for(const e of this._playingTimelines)yield e}SetTimelineObjectClassToMap(e,t){this._objectClassToTimelineMap.has(e)||this._objectClassToTimelineMap.set(e,new Set),this._objectClassToTimelineMap.get(e).add(t)}SetTimelineObjectClassesToMap(e){for(const t of e.GetObjectClasses())this.SetTimelineObjectClassToMap(t,e)}RemoveTimelineFromObjectClassMap(e){for(const[t,s]of this._objectClassToTimelineMap.entries())s.has(e)&&(s.delete(e),0===s.size&&this._objectClassToTimelineMap.delete(t))}GetTimelinesForObjectClass(e){if(this._objectClassToTimelineMap.has(e))return this._objectClassToTimelineMap.get(e)}GetTimelineOfTemplateForInstances(e,t){if(t)for(const s of this._timelines){if(t.every((e=>s.HasTrackInstance(e.instance,e.trackId)))&&s.GetName().includes(e.GetName()))return s}}GetTimelineByName(e){return this._timelinesByName.get(e.toLowerCase())||null}GetScheduledOrPlayingTimelineByName(e){for(const t of this._scheduledTimelines)if(t.GetName()===e)return t;for(const t of this._playingTimelines)if(t.GetName()===e)return t;return null}*GetTimelinesByName(e){if(t.test(e)){let s;t.lastIndex=0;const i=new Set;do{if(s=t.exec(e),s){const e=s[1].split(",");for(const t of e)i.add(t)}}while(s);for(const e of i.values()){const t=this.GetTimelineByName(e);t&&(yield t)}i.clear()}else{const t=this.GetTimelineByName(e);t&&(yield t)}}*GetTimelinesByTags(e){for(const t of this._timelines)t.HasTags(e)&&(yield t)}AddScheduledTimeline(e){this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e),this._MaybeEnableRuntimeListeners()}RemovePlayingTimeline(t){e.arrayFindRemove(this._playingTimelines,t),this._MaybeDisableRuntimeListeners()}ScheduleTimeline(e){this._playingTimelines.includes(e)?(e.SetPlaying(!0),e.SetScheduled(!1),e.SetMarkedForRemoval(!1)):(e.SetPlaying(!1),e.SetScheduled(!0),e.SetMarkedForRemoval(!1),this._scheduledTimelines.includes(e)||this._scheduledTimelines.push(e)),this._MaybeEnableRuntimeListeners()}DeScheduleTimeline(t){t.SetPlaying(!1),t.SetScheduled(!1),t.ResolvePlayPromise(),e.arrayFindRemove(this._scheduledTimelines,t),this._MaybeDisableRuntimeListeners()}CompleteTimeline(t){t.SetPlaying(!1),t.SetScheduled(!1),this._playingTimelines.includes(t)&&(t.SetMarkedForRemoval(!0),this._markedForRemovalTimelines.push(t),e.arrayFindRemove(this._playingTimelines,t))}CompleteTimelineBeforeChangeOfLayout(t){t.SetPlaying(!1),t.SetScheduled(!1),t.SetMarkedForRemoval(!1),t.SetPlaybackRate(1),e.arrayFindRemove(this._playingTimelines,t)}CompleteTimelineAndResolve(e){this.CompleteTimeline(e),e.ResolvePlayPromise()}_OnTick(){if(this.GetRuntime().IsLoadingState())return;if(!this._hasRuntimeListeners)return;if(this._changingLayout)return;for(this._isTickingTimelines=!0;this._scheduledTimelines.length;){const e=this._scheduledTimelines.pop();e.SetInitialState(),0!==e.GetRenderChange()&&(this._renderChange=1),this._playingTimelines.push(e)}const e=this._runtime._GetDtFast(),t=this._runtime.GetDt1(),s=this._runtime.GetTimeScale();for(let i=this._playingTimelines.length-1;i>=0;i--){const r=this._playingTimelines[i];r&&r.Tick(e,s,t)}this._isTickingTimelines=!1,0!==this._renderChange&&this.GetRuntime().UpdateRender()}_OnTick2(){if(this.GetRuntime().IsLoadingState())return;if(!this._hasRuntimeListeners)return;if(this._changingLayout)return;let t;for(let e=0,s=this._markedForRemovalTimelines.length;e<s;e++){const s=this._markedForRemovalTimelines[e];t||(t=new Set),s.Removed(),this._MaybeExecuteTimelineFinishTriggers(s),t.add(s)}if(t){e.arrayRemoveAllInSet(this._markedForRemovalTimelines,t),this._renderChange=0;for(let e=0,t=this._playingTimelines.length;e<t;e++)if(0!==this._playingTimelines[e].GetRenderChange()){this._renderChange=1;break}}this._MaybeDisableRuntimeListeners()}_MaybeExecuteTimelineFinishTriggers(e){e.IsReleased()||e.HasValidTracks()&&e.IsComplete()&&e.InitialStateSet()&&e.FinishTriggers()}_MaybeEnableRuntimeListeners(){this._hasRuntimeListeners||(this._hasRuntimeListeners=!0)}_MaybeDisableRuntimeListeners(){this._markedForRemovalTimelines.length||this._playingTimelines.length||this._scheduledTimelines.length||this._isTickingTimelines||(this._hasRuntimeListeners=!1)}_OnBeforeChangeLayout(){for(this._changingLayout=!0;this._scheduledTimelines.length;)this.DeScheduleTimeline(this._scheduledTimelines.pop());const t=new Set;for(const e of this._playingTimelines){e._OnBeforeChangeLayout()&&(e.Removed(),t.add(e))}e.arrayRemoveAllInSet(this._playingTimelines,t),t.clear();for(const e of this._markedForRemovalTimelines){e._OnBeforeChangeLayout()&&(e.Removed(),t.add(e))}e.arrayRemoveAllInSet(this._markedForRemovalTimelines,t),this._MaybeDisableRuntimeListeners();for(const e of this._timelines)e.CleanCaches()}_OnAfterChangeLayout(){this._changingLayout=!1}_OnInstanceDestroy(e){const t=e.GetObjectClass(),s=this.GetTimelinesForObjectClass(t);if(s)if(this._runtime.IsLoadingState())this._destroyedWhileLoadingState.push(e);else for(const e of s)e.IsTemplate()||(e.IsReleased()?this.Remove(e):e.HasValidTracks()||(this._MaybeExecuteTimelineFinishTriggers(e),this.Remove(e)))}_OnBeforeLoad(){for(const e of this._scheduledTimelines.map((e=>e)))this._MaybeExecuteTimelineFinishTriggers(e),this.Remove(e);for(const e of this._playingTimelines.map((e=>e)))this._MaybeExecuteTimelineFinishTriggers(e),this.Remove(e)}_OnAfterLoad(){for(const e of this._destroyedWhileLoadingState)this._OnInstanceDestroy(e);e.clearArray(this._destroyedWhileLoadingState)}_OnAfterLayoutStart(){const e=this._runtime.GetLayoutManager().GetMainRunningLayout();if(e)for(const t of this._timelines){const s=t.GetStartOnLayout();s&&(e.GetName()===s&&this.ScheduleTimeline(t))}}_SaveToJson(){return{timelinesJson:this._SaveTimelinesToJson(),scheduledTimelinesJson:this._SaveScheduledTimelinesToJson(),playingTimelinesJson:this._SavePlayingTimelinesToJson(),markedForRemovalTimelinesJson:this._SaveMarkedForRemovalTimelinesToJson(),hasRuntimeListeners:this._hasRuntimeListeners,changingLayout:this._changingLayout,isTickingTimelines:this._isTickingTimelines}}_LoadFromJson(e){e&&(this._ClearCreatedTemplateTimelinesCount(),this._LoadTimelinesFromJson(e.timelinesJson),this._LoadScheduledTimelinesFromJson(e.scheduledTimelinesJson),this._LoadPlayingTimelinesFromJson(e.playingTimelinesJson),this._LoadMarkedForRemovalTimelinesFromJson(e.markedForRemovalTimelinesJson),this._hasRuntimeListeners=!e.hasRuntimeListeners,this._changingLayout=!!e.changingLayout,this._isTickingTimelines=!!e.isTickingTimelines,this._SetCreatedTemplateTimelinesCount(),this._MaybeEnableRuntimeListeners(),this._MaybeDisableRuntimeListeners())}_SaveTimelinesToJson(){return this._timelines.map((e=>e._SaveToJson()))}_LoadTimelinesFromJson(e){for(const t of e){let e=this.GetTimelineByName(t.name);if(e)e._LoadFromJson(t);else{const s=this._GetTemplateNameFromJson(t);if(!s)continue;const i=this.GetTimelineByName(s);e=this.CreateFromTemplate(i),e._LoadFromJson(t)}e.HasTracks()||this.Remove(e)}}_GetTemplateNameFromJson(e){const t=e.name.split(":");return t&&2===t.length?t[0]:null}_SaveScheduledTimelinesToJson(){return this._SaveTimelines(this._scheduledTimelines)}_LoadScheduledTimelinesFromJson(e){this._LoadTimelines(e,this._scheduledTimelines)}_SavePlayingTimelinesToJson(){return this._SaveTimelines(this._playingTimelines)}_LoadPlayingTimelinesFromJson(e){this._LoadTimelines(e,this._playingTimelines)}_SaveMarkedForRemovalTimelinesToJson(){return this._SaveTimelines(this._markedForRemovalTimelines)}_LoadMarkedForRemovalTimelinesFromJson(e){this._LoadTimelines(e,this._markedForRemovalTimelines)}_IsTimelineInJson(e,t){if(!t)return!1;for(const s of t)if(s===e.GetName())return!0;return!1}_SaveTimelines(e){return e.map((e=>e.GetName()))}_LoadTimelines(t,s){const i=new Set;for(const e of s)this._IsTimelineInJson(e,t)||i.add(e);if(e.arrayRemoveAllInSet(s,i),t){const e=e=>t=>t.GetName()===e;for(const i of t){const t=this.GetTimelineByName(i);if(t){s.find(e(i))||s.push(t)}}}}}}{const e=self.C3,t=100,s=.01,i=30,r=[0,0],n=[0,0],a=[0,0,0,0,0];e.TimelineInfo=class{constructor(t,s){this._initialized=!1,this._timeline=t,this._segments=[];let i=null;if(i=s?this._timeline.GetTrackById(s):e.first(this._timeline.GetTracks()),!i)return;const r=i.GetPropertyTrack("offsetX"),n=i.GetPropertyTrack("offsetY");if(!r||!n)return;this._xTrack=r,this._yTrack=n;const a=r.GetPropertyKeyframeDataItemArrayIncludingDisabled(),o=n.GetPropertyKeyframeDataItemArrayIncludingDisabled();for(let t=1,s=Math.min(a.length,o.length);t<s;++t){const s=a[t],i=(s.GetNext(),s.GetPrevious()),r=o[t],n=(r.GetNext(),r.GetPrevious());i&&"cubic-bezier"===i.GetPathMode()&&n&&"cubic-bezier"===n.GetPathMode()?this._segments.push(e.New(e.TimelineCubicBezierSegmentInfo,i,n,s,r,this._segments.length)):(i&&"line"===i.GetPathMode()&&n&&n.GetPathMode(),this._segments.push(e.New(e.TimelineLineSegmentInfo,s,r,this._segments.length)))}this._initialized=!0}Release(){for(const e of this._segments)e.Release();e.clearArray(this._segments),this._segments=null,this._timeline=null,this._xTrack=null,this._yTrack=null}WasInitialized(){return this._initialized}segments(){return this._segments}SetOrigin(e){const t="relative"===this._xTrack.GetResultMode()?e.GetX():0,s="relative"===this._yTrack.GetResultMode()?e.GetY():0;for(const e of this._segments)e.SetOrigin(t,s)}Project(t,s,i){i&&i.tRange&&(e.IsFiniteNumber(i.tRange[0])||(i.tRange[0]=0),e.IsFiniteNumber(i.tRange[1])||(i.tRange[1]=1));const r=[];for(const e of this._segments)if("cubic-bezier"===e.GetType()){const n=e.Project(t,s,i?i.tRange:null);n[4]=e.GetIndex(),r.push(JSON.parse(JSON.stringify(n)))}return r.sort(((e,t)=>e[3]-t[3])),r[0]}Tangent(e,t){return this._segments[t].Tangent(e)}TangentAngle(e,t,s,i){return this._segments[i].TangentAngle(e,t,s)}},e.TimelineCubicBezierSegmentInfo=class{constructor(e,s,i,r,n){this._index=n;const a=e.GetAddOn("cubic-bezier"),o=i.GetAddOn("cubic-bezier"),h=s.GetAddOn("cubic-bezier"),l=r.GetAddOn("cubic-bezier");this._aX=e.GetValueWithResultMode(),this._aY=s.GetValueWithResultMode(),this._bX=e.GetValueWithResultMode()+a.GetStartAnchor(),this._bY=s.GetValueWithResultMode()+h.GetStartAnchor(),this._cX=i.GetValueWithResultMode()+o.GetEndAnchor(),this._cY=r.GetValueWithResultMode()+l.GetEndAnchor(),this._dX=i.GetValueWithResultMode(),this._dY=r.GetValueWithResultMode(),this._initialized=!1,this._len=t,this._arcLengths=new Array(this._len+1),this._arcLengths[0]=0,this._length=0,this._lut=[],this._CalculateLength()}Release(){e.clearArray(this._arcLengths),this._arcLengths=null,e.clearArray(this._lut),this._lut=null}GetType(){return"cubic-bezier"}GetIndex(){return this._index}GetStepCount(){return Math.floor(this._length/i)}GetStepIncrement(){return 1/this.GetStepCount()}SetOrigin(e,t){this._originX=e,this._originY=t,this._arcLengths=new Array(this._len+1),this._arcLengths[0]=0,this._CalculateLength()}Map(e){if(!this._initialized)return NaN;const t=this._Map(e);return n[0]=this._X(t),n[1]=this._Y(t),n}Project(e,s,i){const r=this._GenerateLUT(t),n=this._FindClosestFromLUT(e,s,r,i),o=this._RefineProjection(e,s,r,n);return a[0]=o.x,a[1]=o.y,a[2]=o.t,a[3]=o.distance,a}Tangent(e){const t=1-e,s=t*t,i=2*t*e,n=e*e,a=3*(this._bX+this._originX-(this._aX+this._originX)),o=3*(this._bY+this._originY-(this._aY+this._originY)),h=3*(this._cX+this._originX-(this._bX+this._originX)),l=3*(this._cY+this._originY-(this._bY+this._originY)),c=s*a+i*h+n*(3*(this._dX+this._originX-(this._cX+this._originX))),u=s*o+i*l+n*(3*(this._dY+this._originY-(this._cY+this._originY))),_=Math.hypot(c,u);return r[0]=c/_,r[1]=u/_,r}TangentAngle(t,s,i){const r=this.Tangent(i);return e.angleTo(t,s,t+r[0],s+r[1])}_Map(e){if(!this._initialized)return;let t=e*this._arcLengths[this._len],s=0,i=this._len,r=0;for(;s<i;)r=s+((i-s)/2|0),this._arcLengths[r]<t?s=r+1:i=r;this._arcLengths[r]>t&&r--;const n=this._arcLengths[r];return n===t?r/this._len:(r+(t-n)/(this._arcLengths[r+1]-n))/this._len}_X(e){return this._initialized?self.Ease.GetRuntimeEase("cubicbezier")(e,this._aX+this._originX,this._bX+this._originX,this._cX+this._originX,this._dX+this._originX):NaN}_Y(e){return this._initialized?self.Ease.GetRuntimeEase("cubicbezier")(e,this._aY+this._originY,this._bY+this._originY,this._cY+this._originY,this._dY+this._originY):NaN}_GenerateLUT(e){if(e=e||t,this._lut.length===e)return this._lut;this._lut=[],e++;for(let t=0;t<e;t++){const s=t/(e-1),i=this._X(s),r=this._Y(s);this._lut.push({x:i,y:r,t:s,distance:0})}return this._lut}_FindClosestFromLUT(t,s,i,r=null,n=Number.MAX_SAFE_INTEGER){let a=0;return i.forEach(((o,h)=>{o.t=h/(i.length-1),o.distance=e.distanceTo(t,s,o.x,o.y),r&&e.IsArray(r)&&e.IsFiniteNumber(r[0])&&e.IsFiniteNumber(r[1])?o.t>=r[0]&&o.t<=r[1]&&o.distance<n&&(n=o.distance,a=h):o.distance<n&&(n=o.distance,a=h)})),a}_RefineProjection(t,s,i,r,n=0,a=1){let o=i[r],h=1,l=Number.MAX_SAFE_INTEGER;do{let a=0===r?0:r-1,h=r===i.length-1?i.length-1:r+1,c=i[a].t,u=[],_=(i[h].t-c)/4;if(_<.001)break;u.push(i[a]);for(let i=1;i<=3;i++){const a=c+i*_,h=this._X(a),d=this._Y(a),p=Math.abs(e.distanceTo(h,d,t,s)-n);p<l&&(l=p,o={x:h,y:d,t:a,distance:p},r=i),u.push({x:h,y:d,t:a,distance:p})}u.push(i[h]),i=u}while(h++<25);return n&&l>a&&(o=null),o}_CalculateLength(){this._initialized=!0;let e=this._X(0),t=this._Y(0),i=0;for(let r=1;r<=this._len;r++){const n=this._X(r*s),a=this._Y(r*s),o=e-n,h=t-a;i+=Math.hypot(o,h),this._arcLengths[r]=i,e=n,t=a}this._length=i}},e.TimelineLineSegmentInfo=class{constructor(e,t,s){this._index=s,this._targetX=e.GetValueWithResultMode(),this._targetY=t.GetValueWithResultMode(),this._originX=0,this._originY=0}Release(){}GetType(){return"line"}GetIndex(){return this._index}SetOrigin(e,t){this._originX=e,this._originY=t}GetX(){return this._targetX+this._originX}GetY(){return this._targetY+this._originY}}}{const e=self.C3,t=0,s=1;e.TimelineState=class extends e.DefendedBase{constructor(e,s,i){super(),this._runtime=i.GetRuntime(),this._timelineManager=i,this._timelineDataItem=s,this._name=e,this._tracks=[],this._tracksLength=0,this._beforeAndAfterTracks=null,this._beforeAndAfterTracksLength=0,this.CreateTrackStates(),this._playPromise=null,this._playResolve=null,this._playheadTime=0,this._playbackRate=1,this._pingPongState=t,this._currentRepeatCount=1,this._isPlaying=!1,this._isScheduled=!1,this._initialStateSet=!1,this._complete=!0,this._released=!1,this._markedForRemoval=!1,this._completedTick=-1,this._implicitPause=!1,this._isTemplate=!1,this._finishedTriggers=!1,this._firstTick=!1,this._lastDelta=NaN,this._tags=[""],this._stringTags="",this._tagsChanged=!1,this._renderChange=0,this._hasNestedContent=0,this._iTimelineState=null}static CreateInitial(t,s){const i=s.GetTimelineDataManager(),r=i.GetNameId(),n=i.Get(t[r]),a=e.New(e.TimelineState,t[r],n,s);return a.SetIsTemplate(!0),a}static CreateFromTemplate(t,s,i){return e.New(e.TimelineState,t,s,i)}Release(){if(this.IsReleased())return;const t=this._runtime.Dispatcher();this._timelineManager.DeScheduleTimeline(this),this._timelineManager.CompleteTimelineAndResolve(this);for(const e of this._tracks)e.Release();e.clearArray(this._tracks),this._tracks=null,this._runtime=null,this._timelineManager=null,this._timelineDataItem=null,this._released=!0,this._playPromise=null,this._playResolve=null,this.FireReleaseEvent(t)}FireReleaseEvent(t){const s=e.New(e.Event,"timelinestatereleased");s.timelineState=this,t.dispatchEvent(s)}GetType(){return 0}CreateTrackStates(){for(const t of this._timelineDataItem.GetTrackData().trackDataItems())this._tracksLength=this._tracks.push(e.TrackState.Create(this,t))}GetTimelineManager(){return this._timelineManager}GetRuntime(){return this._runtime}GetTracks(){return this._tracks}GetSimilarPropertyTracks(e,t,s){if(!this._hasNestedContent)return;let i;for(let r=0;r<this._tracks.length;r++){let n=this._tracks[r];if(e!==n.GetInstance())continue;const a=n.GetPropertyTrack(s);a&&(t.constructor===a.GetSourceAdapter().constructor&&(i||(i=[]),i.push(a)))}return i}HasTracks(){return!!this._tracks.length}GetTrackById(t){for(const s of this._tracks)if(e.equalsNoCase(s.GetId(),t))return s;return null}GetTrackByName(t){for(const s of this._tracks)if(!s.IsInstanceTrack()&&e.equalsNoCase(s.GetName(),t))return s;return null}SetName(e){this._name=e}GetName(){return this._name}GetTimelineDataItem(){return this._timelineDataItem}GetTemplateName(){return this._timelineDataItem.GetName()}GetTotalTime(){return this._timelineDataItem.GetTotalTime()}SetTotalTime(e){this._timelineDataItem.SetTotalTime(e)}GetStep(){return this._timelineDataItem.GetStep()}SetStep(e){this._timelineDataItem.SetStep(e)}GetInterpolationMode(){return this._timelineDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._timelineDataItem.SetInterpolationMode(e)}GetResultMode(){return this._timelineDataItem.GetResultMode()}SetResultMode(e){this._timelineDataItem.GetResultMode(e)}SetEase(e){for(const t of this.GetTracks())t.SetEase(e)}GetLoop(){return this._timelineDataItem.GetLoop()}SetLoop(e){return this._timelineDataItem.SetLoop(e)}GetPingPong(){return this._timelineDataItem.GetPingPong()}SetPingPong(e){return this._timelineDataItem.SetPingPong(e)}GetRepeatCount(){return this._timelineDataItem.GetRepeatCount()}SetRepeatCount(e){return this._timelineDataItem.SetRepeatCount(e)}SetPlaybackRate(e){return this._playbackRate=e}GetPlaybackRate(){return this._playbackRate}GetStartOnLayout(){return this._timelineDataItem.GetStartOnLayout()}GetTransformWithSceneGraph(){return this._timelineDataItem.GetTransformWithSceneGraph()}GetUseSystemTimescale(){return this._timelineDataItem.GetUseSystemTimescale()}IsForwardPlayBack(){return!this.IsPlaying()||this._playbackRate>0}GetPlayPromise(){return this._playPromise||(this._playPromise=new Promise((e=>{this._playResolve=e}))),this._playPromise}ResolvePlayPromise(){this._playPromise&&(this._playResolve(),this._playPromise=null,this._playResolve=null)}SetTags(t){this._tags=e.TimelineState._GetTagArray(t),this._tagsChanged=!0}GetTags(){return this._tags}GetStringTags(){return this._tagsChanged&&(this._stringTags=this._tags.join(" ")),this._tagsChanged=!1,this._stringTags}HasTags(t){if(!this._tags)return!1;if(!this._tags.length)return!1;const s=e.TimelineState._GetTagArray(t);return!!s&&(!!s.length&&s.every(e.TimelineState._HasTag,this))}OnStarted(){e.Plugins.Timeline&&this.constructor===e.TimelineState&&(e.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineStarted),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineStartedByName),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineStartedByTags),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnAnyTimelineStarted),e.Plugins.Timeline.Cnds.PopTriggerTimeline())}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){this._finishedTriggers||(this._finishedTriggers=!0,e.Plugins.Timeline&&this.constructor===e.TimelineState&&(e.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineFinished),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineFinishedByName),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimelineFinishedByTags),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnAnyTimelineFinished),e.Plugins.Timeline.Cnds.PopTriggerTimeline()))}SetPlaying(e){this._isPlaying=e}IsCompletedTick(){return this._completedTick===this._runtime.GetTickCount()}IsPlaying(e=!1){return!!this.IsCompletedTick()||(!(!this.IsScheduled()||e)||this._isPlaying)}_IsPlaying(){return this.IsPlaying(!0)}IsPaused(){return this._IsPaused()}_IsPaused(){return!this.IsReleased()&&(!this.IsScheduled()&&(!this._IsPlaying()&&!this.IsComplete()))}SetScheduled(e){this._isScheduled=e}IsScheduled(){return this._isScheduled}SetComplete(e){this._complete=e;const t=this.GetTime();(t<=0||t>=this.GetTotalTime())&&(this._complete=!0)}IsComplete(){return this._complete}IsReleased(){return this._released}SetMarkedForRemoval(e){this._markedForRemoval=e}IsMarkedForRemoval(){return this._markedForRemoval}SetImplicitPause(e){this._implicitPause=e}IsImplicitPause(){return this._implicitPause}SetIsTemplate(e){this._isTemplate=!!e}IsTemplate(){return this._isTemplate}InitialStateSet(){return this._initialStateSet}GetTime(){return this._playheadTime}SetTime(e){const t=this.GetTime();this._SetTime(e),this.SetComplete(!1),this.IsComplete()||this.SetImplicitPause(!0),(this._IsPlaying()||this.IsScheduled()||!this._initialStateSet)&&(this._IsPlaying()||this.IsScheduled()||this._initialStateSet?this._IsPlaying()?this.Stop():this.IsScheduled()&&(this._timelineManager.DeScheduleTimeline(this),this.SetInitialStateFromSetTime()):this.SetInitialStateFromSetTime()),this._SetUpdateStateBefore(),this._Interpolate(this.GetTime(),!1,!0,!0,t),this._SetUpdateStateAfter(),this._renderChange&&this.GetRuntime().UpdateRender(),this._OnSetTime()}_SetTime(t){e.IsFiniteNumber(t)||(t=this.GetTotalTime()),t<0?this._playheadTime=0:t>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=t}_SetTimeAndReset(t){e.IsFiniteNumber(t)||(t=this.GetTotalTime()),t<0?this._playheadTime=0:t>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=t;for(const e of this._tracks)e.SetResetState()}_OnSetTime(){e.Plugins.Timeline&&this.constructor===e.TimelineState&&(e.Plugins.Timeline.Cnds.PushTriggerTimeline(this),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimeSet),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimeSetByName),this._timelineManager.Trigger(e.Plugins.Timeline.Cnds.OnTimeSetByTags),e.Plugins.Timeline.Cnds.PopTriggerTimeline())}_CanResume(){if(this.GetLoop())return!0;if(this.GetPingPong()&&this._pingPongState===s){if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(this.GetTime()<=0)return!1}else if(!this.GetLoop()&&!this.GetPingPong())if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return!1}else if(this.GetTime()<=0)return!1;return!0}Resume(){this.IsReleased()||this._CanResume()&&this.Play(!0)}Play(e=!1){return!this.IsReleased()&&(!this.IsScheduled()&&(this._IsPlaying()&&this.IsCompletedTick()?this._SchedulePlayingTimeline():!this._IsPlaying()&&(!!(this.IsComplete()||e||this.IsImplicitPause())&&this._ScheduleStoppedTimeline())))}_SchedulePlayingTimeline(){return this.SetImplicitPause(!1),this._timelineManager.RemovePlayingTimeline(this),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}_ScheduleStoppedTimeline(){return this.SetImplicitPause(!1),this._timelineManager.ScheduleTimeline(this),this.GetPlayPromise(),!0}Stop(e=!1){this.IsReleased()||(this.SetComplete(e),this._timelineManager.CompleteTimeline(this),this.IsComplete()&&this.ResolvePlayPromise())}Reset(e=!0,t=!1){if(this.IsReleased())return;if(!this._IsPlaying()&&this.IsScheduled())return this._timelineManager.DeScheduleTimeline(this);if(this.IsComplete())return;this.Stop(!0),this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime());const s=this.GetTime();this._SetUpdateStateBefore(),t?this._InterpolateBeforeChangeLayout(s):this._Interpolate(s,!1,!1,!0),e&&this._OnSetTime(),this._SetUpdateStateAfter(),this._renderChange&&e&&this.GetRuntime().UpdateRender()}ResetBeforeChangeLayout(){this.Reset(!1,!0)}_InterpolateBeforeChangeLayout(e){this._Interpolate(e,!1,!1,!0,NaN,!1,!0)}_OnBeforeChangeLayout(){return!!this.IsReleased()||!(!this.GetRuntime().IsLoadingState()&&this.HasValidGlobalTracks())&&(this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.GetRuntime().IsLoadingState()||this.ResetBeforeChangeLayout(),!0)}SetInitialStateFromSetTime(){this.SetInitialState(!0)}SetInitialState(e){if(!this.IsMarkedForRemoval())if(e){this._finishedTriggers=!1,this._initialStateSet=!0,this._firstTick=!0,this._SetUpdateStateBefore();for(const e of this._tracks)e.SetInitialState();this._SetUpdateStateAfter()}else if(this.SetPlaying(!0),this.SetScheduled(!1),this.OnStarted(),this.IsComplete()){this._completedTick=-1,this._pingPongState!==t&&(this._playbackRate=Math.abs(this._playbackRate)),this._pingPongState=t,this._currentRepeatCount=1,this._complete=!1,this._finishedTriggers=!1,this._initialStateSet=!0,this._firstTick=!0,this.IsForwardPlayBack()?this._SetTime(0):this._SetTime(this.GetTotalTime()),this._SetUpdateStateBefore();for(const e of this._tracks)e.SetInitialState();this._SetUpdateStateAfter()}else{this._firstTick=!0,this._finishedTriggers=!1,this._SetUpdateStateBefore();for(const e of this._tracks)e.SetResumeState();this._SetUpdateStateAfter()}}GetRenderChange(){return this._renderChange}_SetUpdateStateBefore(){this._hasNestedContent=0;for(const e of this._tracks)e.IsNested()&&(this._hasNestedContent=1)}_SetUpdateStateAfter(){this._renderChange=0;for(const e of this._tracks)e._SetUpdateState(),0===this._renderChange&&1===e.GetRenderChange()&&(this._renderChange=1),this._beforeAndAfterTracks||1!==e.GetNeedsBeforeAndAfter()||(this._beforeAndAfterTracks||(this._beforeAndAfterTracks=[]),this._beforeAndAfterTracksLength=this._beforeAndAfterTracks.push(e))}Tick(i,r,n){if(this.GetUseSystemTimescale()){if(0===i&&0===this._lastDelta)return;this._lastDelta=i}else{if(0===n&&0===this._lastDelta)return;this._lastDelta=n,i=n,r=1}const a=this._playheadTime,o=a+i*r*this._playbackRate,h=this._timelineDataItem._totalTime;this._playheadTime=o<0?0:o>=h?h:o;let l=!1,c=!1;const u=this.GetLoop(),_=this.GetPingPong();let d;u||_?u&&!_?this._playbackRate>0?this._playheadTime>=h&&(this._SetTimeAndReset(0),c=!0):this._playheadTime<=0&&(this._SetTimeAndReset(h),c=!0):!u&&_?this._playbackRate>0?this._playheadTime>=h&&(this._SetTime(h),this.SetPlaybackRate(-1*this.GetPlaybackRate()),c=!0,this._pingPongState===s?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=t):l=!0:this._pingPongState===t&&(this._pingPongState=s)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),c=!0,this._pingPongState===s?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=t):l=!0:this._pingPongState===t&&(this._pingPongState=s)):u&&_&&(this._playbackRate>0?this._playheadTime>=h&&(this._SetTime(h),this.SetPlaybackRate(-1*this.GetPlaybackRate()),c=!0,this._pingPongState++,e.wrap(this._pingPongState,0,2)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),c=!0,this._pingPongState++,e.wrap(this._pingPongState,0,2))):this._playbackRate>0?this._playheadTime>=h&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),c=!0):(this._SetTime(h),l=!0)):this._playheadTime<=0&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(h),c=!0):(this._SetTime(0),l=!0));const p=this._tracksLength;if(l){for(d=0;d<p;d++)this._tracks[d].SetEndState();return this.Stop(!0),void this.OnCompleted()}const f=this._beforeAndAfterTracksLength;for(d=0;d<f;d++)this._beforeAndAfterTracks[d].BeforeInterpolate();if(1===this._hasNestedContent)for(d=0;d<p;d++){const e=this._tracks[d],t=e.GetStartOffset(),s=a-t;this._playheadTime-t<0&&s>0?(this._playheadTime=t<0?0:t>=h?h:t,e.Interpolate(t,!0,!1,c,this._firstTick,!1)):e.Interpolate(this._playheadTime,!0,!1,c,this._firstTick,!1)}else for(d=0;d<p;d++)this._tracks[d].Interpolate(this._playheadTime,!0,!1,c,this._firstTick,!1);for(d=0;d<f;d++)this._beforeAndAfterTracks[d].AfterInterpolate();this._firstTick&&(this._firstTick=!1)}_Interpolate(e,t=!1,s=!1,i=!1,r=NaN,n=!1,a=!1){for(const e of this._tracks)e.BeforeInterpolate();for(const n of this._tracks){let o=e;if("number"==typeof r&&!isNaN(r)){const e=this.GetTime()-n.GetStartOffset(),t=r-n.GetStartOffset();e<0&&t>0&&(o=n.GetStartOffset(),this._SetTime(o))}n.Interpolate(o,t,s,i,this._firstTick,a)}for(const e of this._tracks)e.AfterInterpolate();this._firstTick&&n&&(this._firstTick=!1)}AddTrack(){const t=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem(),s=e.TrackState.Create(this,t);return this._tracksLength=this._tracks.push(s),s}Removed(){if(!this.IsReleased())for(const e of this._tracks)e.TimelineRemoved()}CleanCaches(){for(const e of this._tracks)e.CleanCaches()}ClearTrackInstances(){for(const e of this._tracks)e.ClearInstance()}SetTrackInstance(e,t){if(t)for(const s of this._tracks)if(s.IsInstanceTrack()){if(e){if(s.GetId()!==e)continue;s.SetInstance(t),this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this);break}if(!s.HasInstance()){s.SetInstance(t),this._timelineManager.SetTimelineObjectClassToMap(t.GetObjectClass(),this);break}}}HasTrackInstance(e,t){for(const s of this._tracks)if(s.IsInstanceTrack())if(t){if(t===s.GetId()&&e===s.GetInstance())return!0}else if(e===s.GetInstance())return!0;return!1}HasValidTracks(){return this._tracks.some((e=>!e.IsInstanceTrack()||e.CanInstanceBeValid()))}HasValidGlobalTracks(){return this._tracks.some((e=>{if(e.IsInstanceTrack()){if(!e.CanInstanceBeValid())return!1;const t=e.GetObjectClass();return!!t&&t.IsGlobal()}return!1}))}GetPropertyTrack(e){for(const t of this.GetTracks())for(const s of t.GetPropertyTracks())if(s.GetPropertyName()===e)return s}GetTrackFromInstance(e){for(const t of this._tracks)if(e===t.GetInstance())return t;return null}GetKeyframeWithTags(e){let t=e?e.split(" "):[];const s=new Set(t.map((e=>e.toLowerCase().trim())));t=[...s.values()];for(const e of this.GetTracks())for(const s of e.GetKeyframeDataItems()){if(t.every((e=>s.HasTag(e))))return s}}GetObjectClasses(){const e=[];for(const t of this.GetTracks())e.push(t.GetObjectClass());return e.filter((e=>e))}_SaveToJson(){return{tracksJson:this._SaveTracksToJson(),name:this._name,playheadTime:this.GetTime(),playbackRate:this._playbackRate,pingPongState:this._pingPongState,currentRepeatCount:this._currentRepeatCount,isPlaying:this._isPlaying,isScheduled:this._isScheduled,initialStateSet:this._initialStateSet,finishedTriggers:this._finishedTriggers,complete:this._complete,released:this._released,markedForRemoval:this._markedForRemoval,completedTick:this._completedTick,implicitPause:this._implicitPause,isTemplate:this._isTemplate,tags:this._tags.join(" "),stringTags:this._stringTags,tagsChanged:this._tagsChanged,firstTick:this._firstTick}}_LoadFromJson(e){e&&(this._LoadTracksFromJson(e.tracksJson),this._name=e.name,this._playheadTime=e.playheadTime,this._playbackRate=e.playbackRate,this._pingPongState=e.pingPongState,this._currentRepeatCount=e.currentRepeatCount,this._isPlaying=!!e.isPlaying,this._isScheduled=!!e.isScheduled,this._initialStateSet=!!e.initialStateSet,this._finishedTriggers=!!e.hasOwnProperty("finishedTriggers")&&!!e.finishedTriggers,this._complete=!!e.complete,this._released=!!e.released,this._markedForRemoval=!!e.markedForRemoval,this._completedTick=e.completedTick,this._implicitPause=!!e.implicitPause,this._isTemplate=!!e.isTemplate,this._tags=e.tags.split(" "),this._stringTags=e.stringTags,this._tagsChanged=!!e.tagsChanged,this._firstTick=!!e.firstTick)}_SaveTracksToJson(){return this._tracks.map((e=>e._SaveToJson()))}_LoadTracksFromJson(e){e.forEach(((e,t)=>{this._tracks[t]._LoadFromJson(e)})),this._tracks.filter((e=>e.CanInstanceBeValid()))}static _HasTag(e){const t=this.GetTags();return""===e?1===t.length&&""===t[0]:t.map((e=>e.toLowerCase())).includes(e.toLowerCase())}static _GetTagArray(t){if(e.IsArray(t))return t.slice(0);if(e.IsString(t))return t.split(" ");throw new Error("invalid tags")}GetITimelineState(){return this._iTimelineState||(this._iTimelineState=e.New(self.ITimelineState,this)),this._iTimelineState}}}{const e=self.C3,t=0,s=1,i=2;e.TrackState=class extends e.DefendedBase{constructor(e,t){super(),this._timeline=e,this._trackDataItem=t,this._trackData=t.GetTrackData(),this._instanceUid=NaN,this._objectClassIndex=NaN,this._instance=null,this._worldInfo=null,this._isNested=t.GetStartOffset()>0,this._initialStateOfNestedSet=!1,this._endStateOfNestedSet=!1,this._lastKeyframeDataItem=null,this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray(),this._propertyTracks=[],this.CreatePropertyTrackStates(),this._worldInfoChange=0,this._renderChange=0,this._needsBeforeAndAfter=0}static Create(t,s){return e.New(e.TrackState,t,s)}Release(){this._keyframeDataItems=null;for(const e of this._propertyTracks)e.Release();e.clearArray(this._propertyTracks),this._propertyTracks=null,this._timeline=null,this._instance=null,this._worldInfo=null,this._trackDataItem=null,this._lastKeyframeDataItem=null}CreatePropertyTrackStates(){for(const t of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(e.PropertyTrackState.Create(this,t))}TimelineRemoved(){for(const e of this._propertyTracks)e.TimelineRemoved()}CleanCaches(){for(const e of this._propertyTracks)e.CleanCaches();this._instance=null,this._worldInfo=null}GetTimeline(){return this._timeline}GetRuntime(){return this._timeline.GetRuntime()}GetKeyframeDataItems(){return this._keyframeDataItems||(this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray()),this._keyframeDataItems}GetPropertyTracks(){return this._propertyTracks}GetPropertyTrack(e){for(let t=0;t<this._propertyTracks.length;t++){const s=this._propertyTracks[t];if(s.GetPropertyName()===e)return s}}MaybeGetInstance(){this._instance||this.GetInstance()}IsInstanceValid(){return!!this._instance&&!this._instance.IsDestroyed()}CanInstanceBeValid(){if(!this.IsInstanceTrack())return!1;const e=this.GetInstanceUID(),t=this.GetRuntime().GetInstanceByUID(e);return!!t&&!t.IsDestroyed()}GetObjectClass(){if(!this.IsInstanceTrack())return;const e=this.GetObjectClassIndex();return-1!==e?this.GetRuntime().GetObjectClassByIndex(e):void 0}ClearInstance(){this._instance=null,this._instanceUid=-1,this._worldInfo=null,this._objectClassIndex=-1}HasInstance(){return!!this._instance}GetInstance(){if(this._instance&&this.IsInstanceValid())return this._instance;const e=this.GetInstanceUID();return this._instance=this.GetRuntime().GetInstanceByUID(e),this._instance}SetInstance(e){if(this._instance!==e){this.CleanCaches(),this._instance=e,this._objectClassIndex=e.GetObjectClass().GetIndex(),this._instanceUid=e.GetUID(),this._worldInfo=e.GetWorldInfo();for(const t of this.propertyTrackItems()){const s=t.propertyTrack,i=t.sourceAdapter;switch(s.GetSourceAdapterId()){case"instance-variable":{i.GetEditorIndex();const s=e.GetObjectClass(),r=s.GetInstanceVariableIndexByName(t.name),n=s.GetInstanceVariableName(r),a=s.GetInstanceVariableType(r);n===t.name&&a===t.type&&i.UpdateInstanceVariableIndex(r);break}case"behavior":{const s=t.behaviorType,r=this.GetObjectClass(),n=e.GetObjectClass(),a=i.GetBehaviorType(n);if(s&&a){const e=s.GetName();r.GetBehaviorIndexByName(e),n.GetBehaviorIndexByName(e),i.GetEditorIndex();i.UpdateBehaviorTypeSid(a.GetSID())}break}}}}}*propertyTrackItems(){for(const e of this._propertyTracks){const t=e.GetSourceAdapter(),s=this.GetObjectClass(),i={propertyTrack:e,sourceAdapter:t};switch(e.GetSourceAdapterId()){case"world-instance":i.property=e.GetPropertyName();break;case"instance-variable":{const e=t.GetEditorIndex();i.name=s.GetInstanceVariableName(e),i.type=s.GetInstanceVariableType(e);break}case"effect":{const e=s.GetEffectList(),r=t.GetEffectType(e);i.effectType=r;break}case"behavior":{const e=t.GetBehaviorType(s);i.behaviorType=e;break}case"plugin":i.plugin=s.GetPlugin();break;case"value":break}yield i}}GetWorldInfo(){if(this._worldInfo&&this.IsInstanceValid())return this._worldInfo;const e=this.GetInstance();return e&&(this._worldInfo=e.GetWorldInfo()),this._worldInfo}GetTrackDataItem(){return this._trackDataItem}GetInstanceUID(){return this._instanceUid?this._instanceUid:this._trackDataItem.GetInstanceUID()}SetInstanceUID(e){this._trackDataItem.SetInstanceUID(e)}GetInterpolationMode(){return this._trackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._trackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._trackDataItem.GetResultMode()}GetId(){return this._trackDataItem.GetId()}GetStartOffset(){return this._trackDataItem.GetStartOffset()}GetLocalTotalTime(){return this._trackDataItem.GetLocalTotalTime()}SetLocalTotalTime(e){this._trackDataItem.SetLocalTotalTime(e)}SetResultMode(e){this._trackDataItem.SetResultMode(e)}SetEase(e){for(const t of this.GetKeyframeDataItems())t.SetEase(e);for(const t of this.GetPropertyTracks())t.SetEase(e)}GetEnable(){return this._trackDataItem.GetEnable()}SetEnable(e){this._trackDataItem.SetEnable(e)}GetObjectClassIndex(){return isNaN(this._objectClassIndex)?this._trackDataItem.GetObjectClassIndex():this._objectClassIndex}SetObjectClassIndex(e){this._trackDataItem.SetObjectClassIndex(e)}SetOriginalWidth(e){this._trackDataItem.SetOriginalWidth(e)}GetOriginalWidth(){const e=this.GetInstance();if(e){if(e.GetSdkInstance().IsOriginalSizeKnown())return e.GetSdkInstance().GetOriginalWidth()}return this._trackDataItem.GetOriginalWidth()}SetOriginalHeight(e){this._trackDataItem.SetOriginalHeight(e)}GetOriginalHeight(){const e=this.GetInstance();if(e){if(e.GetSdkInstance().IsOriginalSizeKnown())return e.GetSdkInstance().GetOriginalHeight()}return this._trackDataItem.GetOriginalHeight()}GetType(){return this._trackDataItem.GetType()}GetName(){return this._trackDataItem.GetName()}IsInstanceTrack(){return this.GetType()===t}IsValueTrack(){return this.GetType()===s}IsAudioTrack(){return this.GetType()===i}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}IsNested(){return this._isNested}SetResetState(){for(const e of this._propertyTracks)e.SetResetState()}SetInitialState(){if(this.MaybeGetInstance(),!this.IsInstanceValid()&&this.IsInstanceTrack())return;const e=this.GetTimeline().IsForwardPlayBack()?0:this.GetLocalTotalTime();for(const t of this._propertyTracks)t.SetInitialState(e),0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0;this._propertyTracks.some((e=>e.GetNeedsBeforeAndAfter()))&&(this._needsBeforeAndAfter=1),this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(e),this._initialStateOfNestedSet=!1,this._endStateOfNestedSet=!1,this.Interpolate(e),this.OnKeyframeReached(this._GetLastKeyFrameBeforeTime(e))}SetResumeState(){if(this.MaybeGetInstance(),!this.IsInstanceValid()&&this.IsInstanceTrack())return;this._timeline.IsForwardPlayBack();const e=this._timeline.GetTime()-this.GetStartOffset();this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(e);for(const t of this._propertyTracks)t.SetResumeState(e)}SetEndState(){if(!this.GetTimeline().IsComplete()&&(this.MaybeGetInstance(),(this.IsInstanceValid()||!this.IsInstanceTrack())&&!this._isNested)){const e=this._timeline.GetTime();e>=this.GetStartOffset()+this.GetLocalTotalTime()?this.Interpolate(this.GetLocalTotalTime(),!0,!1,!0,!1,!1,!0):e<=0&&this.Interpolate(0,!0,!1,!0,!1,!1,!0)}}_SetUpdateState(){for(let e=0,t=this._propertyTracks.length;e<t;e++){const t=this._propertyTracks[e];t._SetUpdateState(),0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1)}}BeforeInterpolate(){const e=this._propertyTracks.length;for(let t=0;t<e;t++)this._propertyTracks[t].BeforeInterpolate()}Interpolate(e,s=!1,i=!1,r=!1,n=!1,a=!1,o=!1){this._instance||this.GetInstance();const h=this._instance&&!this._instance.IsDestroyed(),l=this._trackDataItem._type===t;if((h||!l)&&!(a&&l&&this.GetObjectClass().IsGlobal()||(e-=this.GetStartOffset())<0)){this.MaybeSetInitialStateOfNestedTrack(e,s),this.MaybeTriggerKeyframeReachedConditions(e,s,n);for(let t=0,s=this._propertyTracks.length;t<s;t++)this._propertyTracks[t].Interpolate(e,i,r,o);this.MaybeSetEndStateOfNestedTrack(e,s),0!==this._worldInfoChange&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo&&this._worldInfo.SetBboxChanged())}}AfterInterpolate(){const e=this._propertyTracks.length;for(let t=0;t<e;t++)this._propertyTracks[t].AfterInterpolate()}MaybeSetInitialStateOfNestedTrack(e,t){if(!t)return;if(!this._isNested)return;if(this._initialStateOfNestedSet)return;if(this.GetTimeline().IsForwardPlayBack()){if(e<0)return;for(const e of this._propertyTracks)e.Interpolate(0,!1,!0)}else{if(e>this.GetLocalTotalTime())return;for(const e of this._propertyTracks)e.Interpolate(this.GetLocalTotalTime(),!1,!0)}for(const e of this._propertyTracks)e.SetInitialState();this._initialStateOfNestedSet=!0}MaybeSetEndStateOfNestedTrack(e,t){if(!t)return;if(!this._isNested)return;if(this._endStateOfNestedSet)return;if(this.GetTimeline().IsForwardPlayBack()){if(e>=this.GetLocalTotalTime()){for(const e of this._propertyTracks)e.Interpolate(this.GetLocalTotalTime(),!1,!0);this._endStateOfNestedSet=!0}}else if(e<=0){for(const e of this._propertyTracks)e.Interpolate(0,!1,!0);this._endStateOfNestedSet=!0}}MaybeTriggerKeyframeReachedConditions(t,s,i){if(i)return;if(!s)return;if(!e.Plugins.Timeline)return;const r=this.GetTimeline(),n=this._lastKeyframeDataItem.GetNext(),a=this._lastKeyframeDataItem.GetTime(),o=n?n.GetTime():r.GetTotalTime();if(t<=a||t>=o)if(this._lastKeyframeDataItem=this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(t,this._trackDataItem),r.IsForwardPlayBack())n&&this.OnKeyframeReached(this._lastKeyframeDataItem);else{const e=this._lastKeyframeDataItem.GetNext();e&&this.OnKeyframeReached(e)}}_GetLastKeyFrameBeforeTime(e){const t=this._trackData.GetKeyFrameDataItemAtTime(e,this._trackDataItem);return t||this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(e,this._trackDataItem)}OnKeyframeReached(t){const s=this.GetTimeline(),i=s.GetTimelineManager();e.Plugins.Timeline.Cnds.PushTriggerTimeline(s),e.Plugins.Timeline.Cnds.PushTriggerKeyframe(t),i.Trigger(e.Plugins.Timeline.Cnds.OnAnyKeyframeReached),i.Trigger(e.Plugins.Timeline.Cnds.OnKeyframeReached),e.Plugins.Timeline.Cnds.PopTriggerTimeline(s),e.Plugins.Timeline.Cnds.PopTriggerKeyframe(t)}AddKeyframe(){return this._trackDataItem.GetKeyframeData().AddEmptyKeyframeDataItem()}AddPropertyTrack(){const t=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem(),s=e.PropertyTrackState.Create(this,t);return this._propertyTracks.push(s),s}DeleteKeyframes(e){this._trackDataItem.GetKeyframeData().DeleteKeyframeDataItems(e)}DeletePropertyKeyframes(e){for(const t of this._propertyTracks)t.DeletePropertyKeyframes(e)}SaveState(){for(const e of this._propertyTracks)e.SaveState()}CompareInitialStateWithCurrent(){if(this.MaybeGetInstance(),this.IsInstanceValid()||!this.IsInstanceTrack())for(const e of this._propertyTracks)e.CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){if(this.MaybeGetInstance(),!this.IsInstanceValid()&&this.IsInstanceTrack())return;let e=!1;for(const t of this._propertyTracks){const s=t.CompareSaveStateWithCurrent();!e&&s&&(e=!0)}if(e){const e=this.AddKeyframe();e.SetTime(this.GetTimeline().GetTime()),e.SetEase("noease"),e.SetEnable(!0),e.SetTags("")}}_SaveToJson(){const e=this.GetInstance(),t=e?e.GetUID():this.GetInstanceUID();return{propertyTracksJson:this._SavePropertyTracksToJson(),lastKeyframeDataItemJson:this._SaveLastKeyframeDataItemToJson(),initialStateOfNestedSet:this._initialStateOfNestedSet,endStateOfNestedSet:this._endStateOfNestedSet,instanceUid:t}}_LoadFromJson(e){if(e){this._LoadPropertyTracksFromJson(e.propertyTracksJson),this._LoadLastKeyframeDataItemFromJson(e.lastKeyframeDataItemJson),this._LoadInstanceFromJson(e.instanceUid),this._initialStateOfNestedSet=!1,e.hasOwnProperty.initialStateOfNestedSet&&(this._initialStateOfNestedSet=e.initialStateOfNestedSet),this._endStateOfNestedSet=!1,e.hasOwnProperty.endStateOfNestedSet&&(this._endStateOfNestedSet=e.endStateOfNestedSet);for(const e of this._propertyTracks)0===this._worldInfoChange&&1===e.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===e.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0,this._propertyTracks.some((e=>e.GetNeedsBeforeAndAfter()))&&(this._needsBeforeAndAfter=1)}}_SaveLastKeyframeDataItemToJson(){return this._trackDataItem.GetKeyframeData().GetKeyframeDataItemIndex(this._lastKeyframeDataItem)}_SavePropertyTracksToJson(){return this._propertyTracks.map((e=>e._SaveToJson()))}_LoadPropertyTracksFromJson(e){e.forEach(((e,t)=>{this._propertyTracks[t]._LoadFromJson(e)}))}_LoadInstanceFromJson(t){if(!e.IsFiniteNumber(t))return;const s=this.GetRuntime().GetInstanceByUID(t);if(!s)return;const i=this.GetTimeline();i.ClearTrackInstances(),i.SetTrackInstance(this._trackDataItem.GetId(),s)}_LoadLastKeyframeDataItemFromJson(e){const t=this._trackDataItem.GetKeyframeData();this._lastKeyframeDataItem=t.GetKeyframeDataItemFromIndex(e)}}}{const e=self.C3;e.PropertyTrackState=class extends e.DefendedBase{constructor(e,t){super(),this._track=e,this._propertyTrackDataItem=t,this._propertyTrackData=t.GetPropertyTrackData(),this._worldInfoChange=0,this._renderChange=0,this._needsBeforeAndAfter=0,this._sourceAdapter=this.GetSourceAdapter(),this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),this._lastPropertyKeyframeDataItem=null,this._absoluteValueObject=null}static Create(t,s){return e.New(e.PropertyTrackState,t,s)}Release(){this._track=null,this._sourceAdapter&&(this._sourceAdapter.Release(),this._sourceAdapter=null),this._propertyKeyframeDataItems=null,this._propertyTrackDataItem=null,this._propertyTrackData=null}GetWorldInfoChange(){return this._worldInfoChange}GetRenderChange(){return this._renderChange}GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter}HasAbsoluteValueObject(){return!!this._absoluteValueObject}SetAbsoluteValueObject(e){this._absoluteValueObject=e}GetAbsoluteValueObject(){return this._absoluteValueObject}GetTrack(){return this._track}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyTrackData(){return this._propertyTrackData}GetTimeline(){return this._track.GetTimeline()}GetRuntime(){return this._track.GetRuntime()}GetInstance(){return this._track.GetInstance()}GetSourceAdapter(){if(this._sourceAdapter)return this._sourceAdapter;let t;switch(this._propertyTrackDataItem.GetSourceAdapterId()){case"behavior":t=new e.PropertyTrackState.BehaviorSourceAdapter(this);break;case"effect":t=new e.PropertyTrackState.EffectSourceAdapter(this),this._renderChange=1;break;case"instance-variable":t=new e.PropertyTrackState.InstanceVariableSourceAdapter(this);break;case"plugin":t=new e.PropertyTrackState.PluginSourceAdapter(this),this._renderChange=1;break;case"world-instance":t=new e.PropertyTrackState.PropertySourceAdapter(this),this._renderChange=1,this._worldInfoChange=1;break;case"value":t=new e.PropertyTrackState.ValueSourceAdapter(this);break;case"audio":t=new e.PropertyTrackState.AudioSourceAdapter(this);break}return this._sourceAdapter=t,this._sourceAdapter}GetSourceAdapterId(){return this._propertyTrackDataItem.GetSourceAdapterId()}SetSourceAdapterId(e){this._propertyTrackDataItem.SetSourceAdapterId(e)}GetSourceAdapterArgs(){return this._propertyTrackDataItem.GetSourceAdapterArguments()}SetSourceAdapterArgs(e){this._propertyTrackDataItem.SetSourceAdapterArguments(e)}GetSourceAdapterValue(){return this.GetSourceAdapter().GetValue()}GetPropertyName(){return this._propertyTrackDataItem.GetProperty()}SetPropertyName(e){this._propertyTrackDataItem.SetProperty(e)}GetPropertyType(){return this._propertyTrackDataItem.GetType()}SetPropertyType(e){this._propertyTrackDataItem.SetType(e)}GetPropertyKeyframeType(){return this.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem).GetType()}GetMin(){return this._propertyTrackDataItem.GetMin()}SetMin(e){this._propertyTrackDataItem.SetMin(e)}GetMax(){return this._propertyTrackDataItem.GetMax()}SetMax(e){this._propertyTrackDataItem.SetMax(e)}GetEnable(){return this._propertyTrackDataItem.GetEnable()}SetEnable(e){this._propertyTrackDataItem.SetEnable(e)}GetInterpolationMode(){return this._propertyTrackDataItem.GetInterpolationMode()}SetInterpolationMode(e){this._propertyTrackDataItem.SetInterpolationMode(e)}GetResultMode(){return this._propertyTrackDataItem.GetResultMode()}SetResultMode(e){this._propertyTrackDataItem.SetResultMode(e)}SetEase(e){for(const t of this.GetPropertyKeyframeDataItems())t.SetEase(e)}CanHavePropertyKeyframes(){return this._propertyTrackDataItem.CanHavePropertyKeyframes()}GetPropertyKeyframeDataItems(){return this._propertyKeyframeDataItems||(this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()),this._propertyKeyframeDataItems}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArrayIncludingDisabled()}GetPropertyKeyFrameDataItemAtTime(e){return this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem)}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e){return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem)}GetPropertyKeyframeDataItemPairForTime(e){let t,s=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem);return s?t=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherThan(e,this._propertyTrackDataItem):(s=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem),t=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,this._propertyTrackDataItem)),{start:s,end:t}}*GetPropertyKeyframeValues(){for(const e of this.GetPropertyKeyframeDataItems())yield e.GetValueWithResultMode()}*GetPropertyKeyframeTimes(){for(const e of this.GetPropertyKeyframeDataItems())yield e.GetTime()}TimelineRemoved(){this.GetSourceAdapter().TimelineRemoved()}CleanCaches(){this.GetSourceAdapter().CleanCaches()}GetCurrentState(){return this.GetSourceAdapter().GetCurrentState()}SetResetState(){this.GetSourceAdapter().SetResetState()}SetInitialState(e){this.GetSourceAdapter().SetInitialState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e),this._SetUpdateState()}SetResumeState(e){this.GetSourceAdapter().SetResumeState(),this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(e)}_SetUpdateState(){const e=this.GetTrack();if(this._needsBeforeAndAfter=0,e.IsInstanceTrack()){const t=this.GetTimeline(),s=e.GetInstance(),i=this.GetSourceAdapter(),r=this.GetPropertyName();if(i.MayNeedBeforeAndAfterInterpolate()){const e=t.GetSimilarPropertyTracks(s,i,r);e&&e.length&&(this._needsBeforeAndAfter=1)}else this._needsBeforeAndAfter=0}}_GetLastPropertyKeyFrameBeforeTime(e){const t=this.GetTimeline(),s=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(e,this._propertyTrackDataItem);return s||(t.IsForwardPlayBack()?this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem):this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,this._propertyTrackDataItem))}BeforeInterpolate(){this._sourceAdapter.BeforeInterpolate()}Interpolate(e,t=!1,s=!1,i=!1){let r,n;if(t)r=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){const t=this.GetTimeline(),s=this._lastPropertyKeyframeDataItem.GetNext(),i=this._lastPropertyKeyframeDataItem.GetTime(),r=s?s.GetTime():t.GetTotalTime();(e<=i||e>=r)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);r=this._lastPropertyKeyframeDataItem}r&&(n=r.GetNext()),this._sourceAdapter.Interpolate(e,r,n,t,s,i)}GetInterpolatedValue(e){if(this._lastPropertyKeyframeDataItem){const t=this.GetTimeline(),s=this._lastPropertyKeyframeDataItem.GetNext(),i=this._lastPropertyKeyframeDataItem.GetTime(),r=s?s.GetTime():t.GetTotalTime();(e<=i||e>=r)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);const t=this._lastPropertyKeyframeDataItem,s=t.GetNext();return this._sourceAdapter.GetInterpolatedValue(e,t,s)}GetInterpolatedValueFast(e,t,s){return this._sourceAdapter.GetInterpolatedValue(e,t,s)}AfterInterpolate(){this._sourceAdapter.AfterInterpolate()}static GetStartPropertyKeyframeForTime(e,t){const s=t.GetPropertyTrackDataItem();return t._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,s)}static GetEndPropertyKeyframeForTime(e,t){const s=t.GetPropertyTrackDataItem();return t._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,s)}AddPropertyKeyframe(){const e=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,e}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null;this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(e)}SaveState(){this.GetSourceAdapter().SaveState()}CompareInitialStateWithCurrent(){if(this.GetSourceAdapter().CompareInitialStateWithCurrent()){const e=this._propertyTrackData.GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem),t=this.GetSourceAdapter().GetCurrentState();e.SetAbsoluteValue(t)}}CompareSaveStateWithCurrent(){const e=this.GetSourceAdapter().CompareSaveStateWithCurrent();return e&&this.AddPropertyKeyframeAtCurrentTime(),this.GetSourceAdapter().ClearSaveState(),e}AddPropertyKeyframeAtCurrentTime(){const t=this.GetTimeline().GetTime(),s=this.GetSourceAdapter(),i=e.PropertyTrackState.GetStartPropertyKeyframeForTime(t,this),r=this.AddPropertyKeyframe();r.SetType(i.GetType()),r.SetTime(t),r.SetEase(i.GetEase()),r.SetEnable(!0),r.SetValue(s.GetValueAtTime()),r.SetAbsoluteValue(s.GetCurrentState())}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson)}}}{const e=self.C3,t=e.PropertyTrackState;t.PropertySourceAdapter=class{constructor(e){this._propertyTrack=e,this._propertyAdapter=null,this.GetPropertyAdapter()}Release(){this._propertyAdapter&&(this._propertyAdapter.Release(),this._propertyAdapter=null),this._propertyTrack=null}MayNeedBeforeAndAfterInterpolate(){return this._propertyAdapter.MayNeedBeforeAndAfterInterpolate()}GetPropertyTrack(){return this._propertyTrack}TimelineRemoved(){this._propertyAdapter&&this._propertyAdapter.TimelineRemoved()}CleanCaches(){this._propertyAdapter&&this._propertyAdapter.CleanCaches()}GetPropertyAdapter(){return this._propertyAdapter||(this._propertyAdapter=this._CreatePropertyAdapter()),this._propertyAdapter}GetEditorIndex(){}GetIndex(){return this.GetEditorIndex()}GetTarget(){}SetResetState(){this.GetPropertyAdapter().SetResetState()}SetInitialState(){this.GetPropertyAdapter().SetInitialState()}SetResumeState(){this.GetPropertyAdapter().SetResumeState()}BeforeInterpolate(){this._propertyAdapter.BeforeChangeProperty()}Interpolate(e,s,i,r,n,a){let o;switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":o=t.NumericTypeAdapter.Interpolate(e,s,i,this._propertyTrack);break;case"angle":o=t.AngleTypeAdapter.Interpolate(e,s,i,this._propertyTrack);break;case"boolean":o=t.BooleanTypeAdapter.Interpolate(e,s,i,this._propertyTrack);break;case"color":o=t.ColorTypeAdapter.Interpolate(e,s,i,this._propertyTrack);break;case"text":o=t.TextTypeAdapter.Interpolate(e,s,i,this._propertyTrack);break}this._propertyAdapter.ChangeProperty(e,o,s,i,r,n,a)}GetInterpolatedValue(e,s,i){switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":return t.NumericTypeAdapter.Interpolate(e,s,i,this._propertyTrack);case"angle":return t.AngleTypeAdapter.Interpolate(e,s,i,this._propertyTrack);case"boolean":return t.BooleanTypeAdapter.Interpolate(e,s,i,this._propertyTrack);case"color":return t.ColorTypeAdapter.Interpolate(e,s,i,this._propertyTrack);case"text":return t.TextTypeAdapter.Interpolate(e,s,i,this._propertyTrack)}}AfterInterpolate(){this._propertyAdapter.AfterChangeProperty()}SaveState(){this.GetPropertyAdapter().SetSaveState()}ClearSaveState(){this.GetPropertyAdapter().ClearSaveState()}GetCurrentState(){return this.GetPropertyAdapter().GetCurrentState()}CompareInitialStateWithCurrent(){return this.GetPropertyAdapter().CompareInitialStateWithCurrent()}CompareSaveStateWithCurrent(){return this.GetPropertyAdapter().CompareSaveStateWithCurrent()}GetValueAtTime(){const e=this._propertyTrack,s=e.GetTrack().GetTimeline().GetTime(),i=t.GetStartPropertyKeyframeForTime(s,e),r=i.GetNext();switch(e.GetPropertyKeyframeType()){case"numeric":return t.NumericTypeAdapter.Interpolate(s,i,r,e);case"angle":return t.AngleTypeAdapter.Interpolate(s,i,r,e);case"boolean":return t.BooleanTypeAdapter.Interpolate(s,i,r,e);case"color":return t.ColorTypeAdapter.Interpolate(s,i,r,e);case"text":return t.TextTypeAdapter.Interpolate(s,i,r,e)}}_CreatePropertyAdapter(){const e=this._propertyTrack;switch(e.CanHavePropertyKeyframes()?e.GetPropertyKeyframeType():""){case"combo":case"boolean":case"text":case"string":return new t.PropertyInterpolationAdapter.NoInterpolationAdapter(this);case"numeric":case"number":case"angle":return"combo"===this._propertyTrack.GetPropertyType()?new t.PropertyInterpolationAdapter.NoInterpolationAdapter(this):new t.PropertyInterpolationAdapter.NumericInterpolationAdapter(this);case"color":case"offsetColor":return new t.PropertyInterpolationAdapter.ColorInterpolationAdapter(this);default:return new t.PropertyInterpolationAdapter.NumericInterpolationAdapter(this)}}_SaveToJson(){return{propertyAdapterJson:this.GetPropertyAdapter()._SaveToJson()}}_LoadFromJson(e){e&&this.GetPropertyAdapter()._LoadFromJson(e.propertyAdapterJson)}}}{const e=self.C3,t=0;class s extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._updatedIndex=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[t]}GetIndex(){return this._updatedIndex?this._updatedIndex:super.GetIndex()}GetTarget(){return this._propertyTrack.GetTrack().GetInstance()}UpdateInstanceVariableIndex(e){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[t]!==e&&(this._updatedIndex=e)}Interpolate(e,t,s,i,r){this.GetPropertyAdapter().CanChange(t.GetValue())&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){if(this.GetPropertyAdapter().CanChange(t.GetValue()))return super.GetInterpolatedValue(e,t,s)}_SaveToJson(){return Object.assign(super._SaveToJson(),{index:this._updatedIndex})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._updatedIndex=e.index)}}e.PropertyTrackState.InstanceVariableSourceAdapter=s}{const e=self.C3,t=0,s=1,i=2;class r extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._sid=NaN}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[s]}GetTarget(){const e=this._propertyTrack.GetPropertyTrackDataItem(),s=this._propertyTrack.GetTrack(),i=this._sid?this._sid:e.GetSourceAdapterArguments()[t],r=s.GetInstance(),n=r.GetBehaviorIndexBySID(i);return r.GetBehaviorInstances()[n].GetSdkInstance()}GetBehaviorType(e){const t=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[i];return e.GetBehaviorTypeByName(t)}UpdateBehaviorTypeSid(e){this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[t]!==e&&(this._sid=e)}Interpolate(e,t,s,i,r){const n=this._propertyTrack.GetTrack().GetInstance();this.GetBehaviorType(n.GetObjectClass())&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){const i=this._propertyTrack.GetTrack().GetInstance();if(this.GetBehaviorType(i.GetObjectClass()))return super.GetInterpolatedValue(e,t,s)}_SaveToJson(){return Object.assign(super._SaveToJson(),{sid:this._sid})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._sid=e.sid)}}e.PropertyTrackState.BehaviorSourceAdapter=r}{const e=self.C3,t=0,s=1;class i extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[s]}GetTarget(){const e=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList(),t=e.GetEffectList(),s=this.GetEffectType(t).GetIndex();return e.IsEffectIndexActive(s)?e.GetEffectParametersForIndex(s):null}GetEffectType(e){const s=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[t];return e.GetEffectTypeByName(s)}Interpolate(e,t,s,i,r){this._IsEffectActive()&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){if(this._IsEffectActive())return super.GetInterpolatedValue(e,t,s)}_IsEffectActive(){const e=this._propertyTrack.GetTrack().GetWorldInfo().GetInstanceEffectList(),t=e.GetEffectList(),s=this.GetEffectType(t);if(!s)return;const i=s.GetIndex();return e.IsEffectIndexActive(i)}}e.PropertyTrackState.EffectSourceAdapter=i}{const e=self.C3,t=0;class s extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e)}GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[t]}GetTarget(){return this._propertyTrack.GetTrack().GetInstance().GetSdkInstance()}Interpolate(e,t,s,i,r){const n=this._propertyTrack.GetTrack();n.GetObjectClass().GetPlugin()===n.GetInstance().GetObjectClass().GetPlugin()&&super.Interpolate(e,t,s,i,r)}GetInterpolatedValue(e,t,s){const i=this._propertyTrack.GetTrack();if(i.GetObjectClass().GetPlugin()===i.GetInstance().GetObjectClass().GetPlugin())return super.GetInterpolatedValue(e,t,s)}}e.PropertyTrackState.PluginSourceAdapter=s}{const e=self.C3;class t extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._value=0,this._init=!1}MayNeedBeforeAndAfterInterpolate(){return!1}SetInitialState(){const e=this._propertyTrack.GetPropertyTrackData();let t=this._propertyTrack.GetPropertyTrackDataItem();t=e.GetFirstPropertyKeyframeDataItem(t),this._value=t.GetValueWithResultMode()}SetResumeState(){}GetValue(){return this._init||this._propertyTrack.Interpolate(0),this._value}Interpolate(t,s,i,r,n){this._value=e.PropertyTrackState.NumericTypeAdapter.Interpolate(t,s,i,this._propertyTrack),this._init=!0}SaveState(){}ClearSaveState(){}GetCurrentState(){return this._value}CompareInitialStateWithCurrent(){return!1}CompareSaveStateWithCurrent(){return!1}_SaveToJson(){return{value:this._value,init:this._init}}_LoadFromJson(e){e&&(this._value=e.value,this._init=!e.hasOwnProperty("init")||e.init)}}e.PropertyTrackState.ValueSourceAdapter=t}{const e=self.C3,t=0,s=0,i=1,r=1,n=2,a=3;class o extends e.PropertyTrackState.PropertySourceAdapter{constructor(e){super(e),this._audioPlaybackStarted=!1,this._sdkInstance=null,this._actions=null,this._expressions=null,this._timeline=this._propertyTrack.GetTimeline(),this._track=this._propertyTrack.GetTrack(),this._sourceAdapterArgs=this._propertyTrack.GetSourceAdapterArgs(),this._fileArgs=this._sourceAdapterArgs[t],this._startOffsetTime=this._sourceAdapterArgs[r],this._sourceAdapterArgs[a]?this._audioTag=this._sourceAdapterArgs[a]:this._audioTag=Math.random().toString(36).slice(2),this._pauseTime=NaN,this._pauseVolume=NaN,this._volume=NaN,this._audioSource=null,this._Initialize()}Release(){super.Release(),this._sdkInstance=null,this._actions=null,this._expressions=null,this._timeline=null,this._track=null,this._sourceAdapterArgs=null,this._fileArgs=null,this._audioSource=null}_Initialize(){if(!self.C3.Plugins.Audio)return;const e=this._propertyTrack.GetRuntime().GetObjectClassByName("audio");e&&(this._sdkInstance=e.GetSingleGlobalInstance().GetSdkInstance()),this._actions=self.C3.Plugins.Audio.Acts,this._expressions=self.C3.Plugins.Audio.Exps}_MaybeSetAudioSource(){if(this._audioSource)return;const e=this._propertyTrack.GetTrack().GetPropertyTrack("audioSource");e&&(this._audioSource=e.GetSourceAdapter())}_GetPauseVolume(){const e=this._propertyTrack.GetTrack().GetPropertyTrack("volume");return e?e.GetSourceAdapter()._pauseVolume:this._pauseVolume}TimelineRemoved(){super.TimelineRemoved(),this._audioPlaybackStarted=!1,this._sdkInstance&&(this._expressions&&(this._pauseTime=this._expressions.PlaybackTime.call(this._sdkInstance,this._audioTag),this._pauseVolume=this._expressions.Volume.call(this._sdkInstance,this._audioTag)),this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag))}GetAudioTag(){return this._audioTag}GetVolume(){return this._volume}SetVolume(e){this._volume=e}SetInitialState(){super.SetInitialState(),this._pauseTime=NaN,this._audioPlaybackStarted=!1}SetResumeState(){super.SetResumeState();const e=this._propertyTrack.GetTimeline().GetTime();switch(this._pauseTime=e-this._startOffsetTime,this._propertyTrack.GetPropertyName()){case"audioSource":break;case"volume":this._pauseVolume=this._propertyTrack.GetInterpolatedValue(e);break}this._audioPlaybackStarted=!1}Interpolate(e,t,s,i,r){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"audioSource":{if(!this._timeline.IsForwardPlayBack())return;if(i)return void(this._actions&&this._actions.Stop.call(this._sdkInstance,this._audioTag));if(e<this._startOffsetTime)return void(this._audioPlaybackStarted=!1);const t=this._expressions.PlaybackRate.call(this._sdkInstance,this._audioTag),s=this._timeline.GetPlaybackRate();if(s!==t&&this._actions.SetPlaybackRate.call(this._sdkInstance,this._audioTag,s),this._audioPlaybackStarted)return;if(this._audioPlaybackStarted=!0,isNaN(this._pauseTime)){const t=self.performance.now(),s=e-this._startOffsetTime;if("suspended"===this._sdkInstance.GetAudioContextState())return void(this._audioPlaybackStarted=!1);const i=s+(self.performance.now()-t)/1e3;if(this._actions){let e=this.GetVolume();isNaN(e)?(this.SetVolume(0),e=0):this.SetVolume(e),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,e,this._audioTag,i)}}else{const e=this._pauseTime;this._pauseTime=NaN;const t=this._GetPauseVolume();this._pauseVolume=NaN;if("suspended"===this._sdkInstance.GetAudioContextState())return void(this._audioPlaybackStarted=!1);this._actions&&(this.SetVolume(t),this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,t,this._audioTag,e))}break}case"volume":this._MaybeSetAudioSource(),super.Interpolate(e,t,s,i,r)}}GetInterpolatedValue(e,t,s){if(this._sdkInstance)switch(this._propertyTrack.GetPropertyName()){case"audioSource":return;case"volume":return this._MaybeSetAudioSource(),super.GetInterpolatedValue(e,t,s)}}Getter(e,t){return this._audioSource?this._audioSource.GetVolume():0}Setter(e,t,s,i){this._audioSource&&this._audioSource.SetVolume(this.Getter()+t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}AbsoluteSetter(e,t,s){this._audioSource&&this._audioSource.SetVolume(t),this._actions&&this._audioSource&&this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume())}DoesRounding(){return!0}_SaveToJson(){return{audioPlaybackStarted:this._audioPlaybackStarted,audioTag:this._audioTag,pauseTime:this._pauseTime,pauseVolume:this._pauseVolume,volume:this._volume}}_LoadFromJson(e){e&&(this._audioPlaybackStarted=e.audioPlaybackStarted,this._audioTag=e.audioTag,this._pauseTime=e.pauseTime,this._pauseVolume=e.pauseVolume,this._volume=e.volume,this._Initialize())}}e.PropertyTrackState.AudioSourceAdapter=o}{const e=self.C3;e.PropertyTrackState.PropertyInterpolationAdapter=class{constructor(e){this._sourceAdapter=e,this._propertyTrack=e.GetPropertyTrack(),this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo(),this._property=this._propertyTrack.GetPropertyName(),this._firstAbsoluteUpdate=!1,this._saveState=null,this._target=null}Release(){this._sourceAdapter=null,this._propertyTrack=null,this._worldInfo=null,this._saveState=null,this._target=null}MayNeedBeforeAndAfterInterpolate(){return!1}TimelineRemoved(){}CleanCaches(){this._worldInfo=null,this._saveState=null,this._target=null}GetSourceAdapter(){return this._sourceAdapter}GetPropertyTrack(){return this._propertyTrack}GetWorldInfo(){return this._worldInfo||(this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo()),this._worldInfo}SetFirstAbsoluteUpdate(e){this._firstAbsoluteUpdate=!!e}GetFirstAbsoluteUpdate(){return this._firstAbsoluteUpdate}SetResetState(){}SetInitialState(){}SetResumeState(){}SetSaveState(){this._saveState=this.GetCurrentState()}ClearSaveState(){this._saveState=null}GetCurrentState(){}CompareInitialStateWithCurrent(){}CompareSaveStateWithCurrent(){}CanChange(e){return typeof this._Getter()===typeof e}BeforeChangeProperty(){}ChangeProperty(e,t,s,i,r,n,a){}AfterChangeProperty(){}_FirstKeyframeGetter(){return this._PickTimelinePlaybackMode((()=>{const e=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(e)}),(()=>{const e=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e)})).GetAbsoluteValue()}_CurrentKeyframeGetter(){const e=this._propertyTrack.GetTimeline().GetTime()-this._propertyTrack.GetTrack().GetStartOffset();return this._PickTimelinePlaybackMode((()=>{const t=this._propertyTrack.GetPropertyTrackDataItem();return this._propertyTrack.GetPropertyTrackData().GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,t)}),(()=>{const t=this._propertyTrack.GetPropertyTrackDataItem(),s=this._propertyTrack.GetPropertyTrackData(),i=s.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,t);return i||s.GetLastPropertyKeyframeDataItem(t)})).GetAbsoluteValue()}_PickTimelinePlaybackMode(e,t){return this._propertyTrack.GetTimeline().IsForwardPlayBack()?e():t()}_PickResultMode(e,t){return"relative"===this._propertyTrack.GetResultMode()?e():t()}_PickFirstAbsoluteUpdate(e,t){return this.GetFirstAbsoluteUpdate()?(this.SetFirstAbsoluteUpdate(!1),e()):t()}_GetAbsoluteInitialValue(e){}_GetIndex(){return this._sourceAdapter.GetIndex()}_GetTarget(){return this._target||(this._target=this._sourceAdapter.GetTarget()),this._target}_PickSource(e,t,s,i,r,n){switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":return e();case"effect":return t();case"instance-variable":return s();case"plugin":return i();case"world-instance":return r();case"audio":return n()}}_SaveToJson(){return{firstAbsoluteUpdate:this._firstAbsoluteUpdate,saveState:this._saveState}}_LoadFromJson(e){e&&(this._firstAbsoluteUpdate=e.firstAbsoluteUpdate,this._saveState=e.saveState)}_GetPropertyKeyframeStubs(e,t=!1){const s=[];for(const i of e){const e=i.GetTrack().GetStartOffset();for(const r of i.GetPropertyKeyframeDataItems())t&&0===r.GetTime()?s.push({time:e+r.GetTime(),value:r.GetAbsoluteValue()}):t||s.push({time:e+r.GetTime(),value:r.GetAbsoluteValue()})}return s.sort(((e,t)=>e.time-t.time))}_GetLastPropertyKeyframeStub(e,t,s){return this._GetPropertyKeyframeStubLowerThanPlayhead(t,s)}_GetPropertyKeyframeStubLowerThanPlayhead(e,t){for(let s=t.length-1;s>=0;s--){if(t[s].time<=e)return t[s]}return null}}}{const e=self.C3,t=new Map,s=[0,0,0];class i extends e.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return this._ToColorArray(t.GetPropertyValueByIndex(s));case"effect":return this._ToColorArray(t[s]);case"plugin":return this._ToColorArray(t.GetPropertyValueByIndex(s));case"world-instance":return this._ToColorArray(this._Getter())}}CompareInitialStateWithCurrent(){const e=this._FirstKeyframeGetter();return!this._CompareColors(e,this._Getter())}CompareSaveStateWithCurrent(){return!e.IsNullOrUndefined(this._saveState)&&!this._CompareColors(this._saveState,this._Getter())}_CompareColors(e,t){return e=this._GetColorFromArray(e),t=this._GetColorFromArray(t),e.equalsIgnoringAlpha(t)}_FirstKeyframeGetter(){const e=super._FirstKeyframeGetter();return this._GetColorFromArray(e)}_CurrentKeyframeGetter(){const e=super._CurrentKeyframeGetter();return this._GetColorFromArray(e)}_GetAbsoluteInitialValue(e){}_ToColorArray(t){return e.IsInstanceOf(t,e.Color)?t.toArray().slice(0,3):t.slice(0,3)}_GetColorFromArray(t){return e.IsInstanceOf(t,e.Color)?t:new e.Color(t[0],t[1],t[2],1)}CanChange(e){return!0}MayNeedBeforeAndAfterInterpolate(){return!0}BeforeChangeProperty(){const s=this._propertyTrack.GetTimeline(),i=this._propertyTrack.GetInstance(),r=this._propertyTrack.GetSourceAdapter(),n=s.GetSimilarPropertyTracks(i,r,this._property);if(n&&n.length>1){t.has(i)||t.set(i,new Map);const s=t.get(i),r=this._propertyTrack.GetSourceAdapterId();s.has(r)||s.set(r,new Map);const n=s.get(r);n.has(this._property)||n.set(this._property,{used:!1,color:new e.Color(0,0,0,1)})}}_GetTmpColor(e,s,i){const r=t.get(e).get(s).get(i);return r.used=!0,r.color}ChangeProperty(t,s,i,r,n){const a=this._propertyTrack.GetTimeline(),o=this._propertyTrack.GetTrack(),h=this._propertyTrack.GetInstance(),l=this._propertyTrack.GetSourceAdapter(),c=this._propertyTrack.GetSourceAdapterId(),u=this._property,_=a.GetSimilarPropertyTracks(h,l,u);if(_&&_.length>1){const t=this._GetPropertyKeyframeStubs(_,!0),i=this._GetLastPropertyKeyframeStub(a,a.GetTime(),t);if(i){const t=o.GetStartOffset(),r=i.time-t;if(0===r)this._GetTmpColor(h,c,this._property).addRgb(s[0],s[1],s[2]);else{if(r<0)return;const t=s[0],i=s[1],n=s[2],a=this._propertyTrack.Interpolate(r,!1,!0),o=e.Color.DiffChannel(t,a[0]),l=e.Color.DiffChannel(i,a[1]),u=e.Color.DiffChannel(n,a[2]);this._GetTmpColor(h,c,this._property).addRgb(o,l,u)}}}else this._Setter(s[0],s[1],s[2])}AfterChangeProperty(){const e=this._propertyTrack.GetInstance();if(!t.has(e))return;const s=t.get(e),i=this._propertyTrack.GetSourceAdapterId();if(!s.has(i))return;const r=s.get(i);if(!r.has(this._property))return;const n=r.get(this._property),a=n.used,o=n.color;a&&this._Setter(o.getR(),o.getG(),o.getB()),0===r.size&&s.delete(i),0===s.size&&t.delete(e)}_Getter(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return this._GetColorFromArray(t.GetPropertyValueByIndex(s));case"effect":return t[s].clone();case"plugin":return this._GetColorFromArray(t.GetPropertyValueByIndex(s));case"world-instance":return this.GetWorldInfo().GetUnpremultipliedColor().clone()}}_Setter(e,t,i){const r=this._propertyTrack.GetSourceAdapterId(),n=this._GetTarget(),a=this._GetIndex();switch(r){case"behavior":s[0]=e,s[1]=t,s[2]=i,n.SetPropertyValueByIndex(a,s);break;case"effect":n[a].setRgb(e,t,i);break;case"plugin":s[0]=e,s[1]=t,s[2]=i,n.SetPropertyValueByIndex(a,s);break;case"world-instance":this.GetWorldInfo().SetUnpremultipliedColorRGB(e,t,i);break}}_SaveToJson(){}_LoadFromJson(e){}}e.PropertyTrackState.PropertyInterpolationAdapter.ColorInterpolationAdapter=i}{const e=self.C3,t=e.PropertyTrackState;class s extends e.PropertyTrackState.PropertyInterpolationAdapter{constructor(e){super(e)}SetResetState(){}SetInitialState(){}SetResumeState(){}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!e.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}MayNeedBeforeAndAfterInterpolate(){return!1}ChangeProperty(e,s,i,r,n){const a=this._propertyTrack,o=a.GetTrack(),h=a.GetSourceAdapterId(),l=a.GetTimeline(),c=o.GetInstance(),u=a.GetSourceAdapter(),_=this._property,d=l.GetSimilarPropertyTracks(c,u,_);if(d&&d.length>1){const t=this._GetPropertyKeyframeStubs(d),i=e+o.GetStartOffset(),r=this._GetLastPropertyKeyframeStub(l,i,t);r&&(s=r.value)}switch(a.GetPropertyKeyframeType()){case"numeric":if(!t.NumericTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,h))return;break;case"angle":if(!t.AngleTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,h))return;break;case"boolean":if(!t.BooleanTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,h))return;break;case"color":if(!t.ColorTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,h))return;break;case"text":if(!t.TextTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),s,h))return;break}this._Setter(s)}_Getter(){const e=this._propertyTrack.GetSourceAdapterId(),t=this._GetTarget(),s=this._GetIndex();switch(e){case"behavior":return t.GetPropertyValueByIndex(s);case"effect":return t[s];case"instance-variable":return t.GetInstanceVariableValue(s);case"plugin":return t.GetPropertyValueByIndex(s)}}_Setter(e){const t=this._propertyTrack.GetSourceAdapterId(),s=this._GetTarget(),i=this._GetIndex();switch(t){case"behavior":s.SetPropertyValueByIndex(i,e);break;case"effect":s[i]=e;break;case"instance-variable":s.SetInstanceVariableValue(i,e);break;case"plugin":s.SetPropertyValueByIndex(i,e);break}}}e.PropertyTrackState.PropertyInterpolationAdapter.NoInterpolationAdapter=s}{const e=self.C3,t=e.PropertyTrackState.PropertyInterpolationAdapter,s=new Map,i=(e,t,i,r,n,a=!1,o=null,h=null)=>{s.set(e,{setter:t,absolute_setter:i,getter:r,round:n,fRound:a,init:o,reset:h})};i("offsetX",((e,t,s,i)=>{"relative"===i._propertyTrack.GetResultMode()?e.OffsetX(t,s.GetTimeline().GetTransformWithSceneGraph()):e.OffsetX(t)}),((e,t)=>e.SetX(t)),(e=>e.GetX()),!0),i("offsetY",((e,t,s,i)=>{"relative"===i._propertyTrack.GetResultMode()?e.OffsetY(t,s.GetTimeline().GetTransformWithSceneGraph()):e.OffsetY(t)}),((e,t)=>e.SetY(t)),(e=>e.GetY()),!0),i("offsetWidth",((e,t,s,i,r)=>{if(0===t)return;const n="relative"===i._propertyTrack.GetResultMode(),a=1===i._typeAdapter.GetType();if((n||a)&&e.HasParent()&&e.GetTransformWithParentWidth()){if(isNaN(i._absoluteToFactor)){const t=[];let r=e.GetParent();for(;r;)t.push(r),r=r.GetParent();t.reverse();const n=(e,t)=>t.GetTimeline().GetTrackFromInstance(e.GetInstance()),a=(e,t)=>{const s=n(e,t);if(s)return s.GetOriginalWidth();const i=e.GetInstance().GetSdkInstance();return i.IsOriginalSizeKnown()?i.GetOriginalWidth():e._GetSceneGraphInfo()._GetStartWidth()},o=(e,t,s)=>{const i=n(e,t);if(!i)return 0;const r=i.GetPropertyTrack(s);if(!r)return 0;const a=r.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!a)return 0;const o=a.GetLastPropertyKeyframeDataItem();return o?o.GetValue():0};let h=t[0];let l=h._GetSceneGraphInfo()._GetStartWidth()*h._GetSceneGraphInfo().GetStartScaleX();l+=o(h,s,"offsetWidth"),l+=a(h,s)*o(h,s,"offsetScaleX");for(let e=1;e<t.length;e++)h=t[e],l*=h._GetSceneGraphInfo().GetStartScaleX(),l+=o(h,s,"offsetWidth"),l+=a(h,s)*o(h,s,"offsetScaleX");i._absoluteToFactor=0===l?Number.EPSILON:l}if(r)return;e.OffsetWidth(t/i._absoluteToFactor,!0)}else e.OffsetWidth(t)}),((e,t)=>e.SetWidth(t)),(e=>e.GetWidth()),!0),i("offsetHeight",((e,t,s,i,r)=>{if(0===t)return;const n="relative"===i._propertyTrack.GetResultMode(),a=1===i._typeAdapter.GetType();if((n||a)&&e.HasParent()&&e.GetTransformWithParentHeight()){if(isNaN(i._absoluteToFactor)){const t=[];let r=e.GetParent();for(;r;)t.push(r),r=r.GetParent();t.reverse();const n=(e,t)=>t.GetTimeline().GetTrackFromInstance(e.GetInstance()),a=(e,t)=>{const s=n(e,t);if(s)return s.GetOriginalHeight();const i=e.GetInstance().GetSdkInstance();return i.IsOriginalSizeKnown()?i.GetOriginalHeight():e._GetSceneGraphInfo()._GetStartHeight()},o=(e,t,s)=>{const i=t.GetTimeline().GetTrackFromInstance(e.GetInstance());if(!i)return 0;const r=i.GetPropertyTrack(s);if(!r)return 0;const n=r.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!n)return 0;const a=n.GetLastPropertyKeyframeDataItem();return a?a.GetValue():0};let h=t[0];let l=h._GetSceneGraphInfo()._GetStartHeight()*h._GetSceneGraphInfo().GetStartScaleY();l+=o(h,s,"offsetHeight"),l+=a(h,s)*o(h,s,"offsetScaleY");for(let e=1;e<t.length;e++)h=t[e],l*=h._GetSceneGraphInfo().GetStartScaleY(),l+=o(h,s),l+=a(h,s)*o(h,s,"offsetScaleY");i._absoluteToFactor=0===l?Number.EPSILON:l}if(r)return;e.OffsetHeight(t/i._absoluteToFactor,!0)}else e.OffsetHeight(t)}),((e,t)=>e.SetHeight(t)),(e=>e.GetHeight()),!0),i("offsetAngle",((e,t)=>e.OffsetAngle(t)),((e,t)=>e.SetAngle(t)),(e=>e.GetAngle()),!1),i("offsetOpacity",((e,t,s,i,r)=>{t/=i._opacityFactor?i._opacityFactor:1;const n=e.GetOpacity()+t;if(0===i._clampAccumulator)n>1?i._clampAccumulator+=n-1:n<0&&(i._clampAccumulator+=n),e.OffsetOpacity(t);else{const s=e.GetOpacity()+t;t>0&&i._clampAccumulator>0?s>1&&(i._clampAccumulator+=s-1):t>0&&i._clampAccumulator<0?(i._clampAccumulator+=t,i._clampAccumulator>0&&(i._clampAccumulator=0)):t<0&&i._clampAccumulator>0?(i._clampAccumulator+=t,i._clampAccumulator<0&&(i._clampAccumulator=0)):t<0&&i._clampAccumulator<0&&s<0&&(i._clampAccumulator+=s)}}),((e,t)=>{e.SetOpacity(t)}),(e=>e.GetOpacity()),!1,!0,((t,s,i)=>{switch(t._clampAccumulator=0,t._propertyTrack.GetResultMode()){case"relative":{t._propertyTrack.GetPropertyTrackData();const s=t._propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();let i=t.GetWorldInfo().GetOpacity(),r=i;for(const n of s){const s=n.GetTime();r=i+t._propertyTrack.GetInterpolatedValue(s),r=e.clamp(r,0,1)}t._totalForewardOpacityDelta=i-r,t._totalForewardOpacityDelta=Math.round(100*(t._totalForewardOpacityDelta+Number.EPSILON))/100,r=i;for(let i=s.length-1;i>=0;i--){const n=s[i].GetTime();r-=t._propertyTrack.GetInterpolatedValue(n),r=e.clamp(r,0,1)}t._totalBackwardOpacityDelta=r,t._totalBackwardOpacityDelta=Math.round(100*(t._totalBackwardOpacityDelta+Number.EPSILON))/100;break}case"absolute":break}const r="relative"===t._propertyTrack.GetResultMode(),n=1===t._typeAdapter.GetType();if((r||n)&&s.HasParent()&&s.GetTransformWithParentOpacity()){const e=[];let r=s.GetParent();for(;r;)e.push(r),r=r.GetParent();e.reverse();const n=(e,t,s)=>{const i=t.GetTimeline().GetTrackFromInstance(e.GetInstance());if(!i)return 0;const r=i.GetPropertyTrack(s);if(!r)return 0;const n=r.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!n)return 0;const a=n.GetLastPropertyKeyframeDataItem();return a?a.GetValue():0};let a=e[0]._GetSceneGraphInfo().GetStartOpacity();a+=n(e[0],i,"offsetOpacity");for(let t=1;t<e.length;t++)a+=n(e[t],i,"offsetOpacity");t._opacityFactor=0===a?1:a}}),(e=>{switch(e._propertyTrack.GetResultMode()){case"relative":{e._clampAccumulator=0;const t=e.GetWorldInfo();let s=t.GetOpacity();s=Math.round(100*(s+Number.EPSILON))/100,e._propertyTrack.GetTimeline().IsForwardPlayBack()?(t.SetOpacity(s+e._totalForewardOpacityDelta),e._lastValue=0):(t.SetOpacity(s-e._totalBackwardOpacityDelta),e._lastValue=e.GetSourceAdapter().GetValueAtTime());break}case"absolute":break}})),i("offsetOriginX",((e,t)=>e.OffsetOriginX(t)),((e,t)=>e.SetOriginX(t)),(e=>e.GetOriginX()),!1),i("offsetOriginY",((e,t)=>e.OffsetOriginY(t)),((e,t)=>e.SetOriginY(t)),(e=>e.GetOriginY()),!1),i("offsetZElevation",((e,t)=>e.OffsetZElevation(t)),((e,t)=>e.SetZElevation(t)),(e=>e.GetZElevation()),!0),i("offsetScaleX",((e,t,i,r)=>{if(0===t)return;const n=e.GetWidth()<0?-1:1;if("relative"===r._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentWidth()){const a=i.GetOriginalWidth()*n*t;isNaN(r._absoluteToFactor)&&s.get("offsetWidth").setter(e,1,i,r,!0),e.OffsetWidth(a/r._absoluteToFactor,!0)}else e.OffsetWidth(i.GetOriginalWidth()*n*t)}),((e,t,s)=>{e.SetWidth(s.GetOriginalWidth()*t)}),((e,t)=>{const s=e.GetWidth()<0?-1:1;if(e.GetTransformWithParentWidth()){const i=e.GetParent(),r=t.GetTimeline().GetTrackFromInstance(i.GetInstance());let n=NaN;if(r)n=i.GetWidth()/r.GetOriginalWidth();else{const e=i.GetInstance().GetSdkInstance();n=e.IsOriginalSizeKnown()?i.GetWidth()/e.GetOriginalWidth():1}return e.GetWidth()*s/(t.GetOriginalWidth()*n)}return e.GetWidth()*s/t.GetOriginalWidth()}),!1),i("offsetScaleY",((e,t,i,r)=>{if(0===t)return;const n=e.GetHeight()<0?-1:1;if("relative"===r._propertyTrack.GetResultMode()&&e.HasParent()&&e.GetTransformWithParentHeight()){const a=i.GetOriginalHeight()*n*t;isNaN(r._absoluteToFactor)&&s.get("offsetHeight").setter(e,1,i,r,!0),e.OffsetHeight(a/r._absoluteToFactor,!0)}else e.OffsetHeight(i.GetOriginalHeight()*n*t)}),((e,t,s)=>{e.SetHeight(s.GetOriginalHeight()*t)}),((e,t)=>{const s=e.GetHeight()<0?-1:1;if(e.GetTransformWithParentHeight()){const i=e.GetParent(),r=t.GetTimeline().GetTrackFromInstance(i.GetInstance());let n=NaN;if(r)n=i.GetHeight()/r.GetOriginalHeight();else{const e=i.GetInstance().GetSdkInstance();n=e.IsOriginalSizeKnown()?i.GetHeight()/e.GetOriginalHeight():1}return e.GetHeight()*s/(t.GetOriginalHeight()*n)}return e.GetHeight()*s/t.GetOriginalHeight()}),!1);class r extends e.PropertyTrackState.PropertyInterpolationAdapter{constructor(t){super(t),this._lastValue=0,this._clampAccumulator=0,this._totalForewardOpacityDelta=0,this._totalBackwardOpacityDelta=0,this._opacityFactor=NaN,this._absoluteToFactor=NaN,this._instance_getter=null,this._instance_setter=null,this._instance_absolute_setter=null,this._reset_action=null,this._init_action=null,this._source_adapter_getter=null,this._source_adapter_setter=null,this._source_adapter_absolute_setter=null,this._round=!1,this._fRound=!1,e.IsInstanceOf(this._propertyTrack.GetTimeline(),e.TweenState)?this._typeAdapter=new e.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween(this):this._typeAdapter=new e.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline(this);const i=this._propertyTrack.GetPropertyName();switch(this._propertyTrack.GetSourceAdapterId()){case"world-instance":{const e=s.get(i);this._instance_getter=e.getter,this._instance_setter=e.setter,this._instance_absolute_setter=e.absolute_setter,this._round=e.round,this._fRound=e.fRound,this._init_action=e.init,this._reset_action=e.reset;break}case"audio":this._source_adapter_getter=t.Getter,this._source_adapter_setter=t.Setter,this._source_adapter_absolute_setter=t.AbsoluteSetter,this._round=!!t.DoesRounding(),this._fRound=!1;break}}Release(){this._typeAdapter=null,this._instance_getter=null,this._instance_setter=null,this._instance_absolute_setter=null,this._absoluteToFactor=NaN,super.Release()}MayNeedBeforeAndAfterInterpolate(){return this._typeAdapter.MayNeedBeforeAndAfterInterpolate()}GetLastValue(){return this._lastValue}SetLastValue(e){this._lastValue=e}SetResetState(){this._reset_action&&this._reset_action(this)}SetInitialState(){const e=this._typeAdapter.SetInitialState();if("number"==typeof e&&(this._lastValue=e),this._init_action){const e=this.GetWorldInfo(),t=this._propertyTrack.GetTrack();this._init_action(this,e,t)}}SetResumeState(){const e=this._typeAdapter.SetResumeState();"number"==typeof e&&(this._lastValue=e)}GetCurrentState(){return this._Getter()}CompareInitialStateWithCurrent(){return this._FirstKeyframeGetter()!==this.GetCurrentState()}CompareSaveStateWithCurrent(){return!e.IsNullOrUndefined(this._saveState)&&this._saveState!==this.GetCurrentState()}BeforeChangeProperty(){this._typeAdapter.BeforeChangeProperty()}ChangeProperty(e,t,s,i,r,n,a){return this._typeAdapter.ChangeProperty(e,t,s,i,r,n,a)}AfterChangeProperty(){this._typeAdapter.AfterChangeProperty()}_Getter(){const e=this._GetTarget(),t=this._GetIndex(),s=this.GetWorldInfo(),i=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":return e.GetPropertyValueByIndex(t);case"effect":return e[t];case"instance-variable":return e.GetInstanceVariableValue(t);case"plugin":return e.GetPropertyValueByIndex(t);case"world-instance":return this._instance_getter(s,i);case"audio":return this._source_adapter_getter.call(this.GetSourceAdapter(),s,i)}}_Setter(e,t,s){const i=this._GetTarget(),r=this._GetIndex(),n=this.GetWorldInfo(),a=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":i.OffsetPropertyValueByIndex(r,e);break;case"effect":i[r]+=e;break;case"instance-variable":i.SetInstanceVariableOffset(r,e);break;case"plugin":i.OffsetPropertyValueByIndex(r,e);break;case"world-instance":this._instance_setter(n,e,a,this);break;case"audio":this._source_adapter_setter.call(this.GetSourceAdapter(),n,e,a,this);break}}_SetterAbsolute(e,t,s){const i=this._GetTarget(),r=this._GetIndex(),n=this.GetWorldInfo(),a=this._propertyTrack.GetTrack();switch(this._propertyTrack.GetSourceAdapterId()){case"behavior":i.SetPropertyValueByIndex(r,e);break;case"effect":i[r]=e;break;case"instance-variable":i.SetInstanceVariableValue(r,e);break;case"plugin":i.SetPropertyValueByIndex(r,e);break;case"world-instance":this._instance_absolute_setter(n,e,a);break;case"audio":this._source_adapter_absolute_setter.call(this.GetSourceAdapter(),n,e,a);break}}_MaybeEnsureValue(e,t,s,i,r,n,a,o){this._typeAdapter._MaybeEnsureValue(e,t,s,i,r,n,a,o)}_AddDelta(t,s,i,r,n){const a=(t.toString().split(".")[1]||"").length,o=this._Getter();let h;h=0===a?this._round?Math.round(o):this._fRound?Math.round(100*(o+Number.EPSILON))/100:r?this._GetForceValue(s,i,n):o:this._round?Number(e.toFixed(o,a)):r?this._GetForceValue(s,i,n):o,this._Setter(h-o,s,i)}_GetForceValue(e,t,s){const i=this.GetPropertyTrack().GetTimeline(),r=i.IsForwardPlayBack(),n=i.GetLoop(),a=i.GetPingPong();return n||a?r?e.GetAbsoluteValue():t.GetAbsoluteValue():s?r?t.GetAbsoluteValue():e.GetAbsoluteValue():r?e.GetAbsoluteValue():t.GetAbsoluteValue()}_SaveToJson(){return Object.assign(super._SaveToJson(),{v:this._lastValue,a:this._clampAccumulator,fod:this._totalForewardOpacityDelta,bod:this._totalBackwardOpacityDelta})}_LoadFromJson(t){t&&(super._LoadFromJson(t),this._lastValue=t.v,this._clampAccumulator=t.a,this._totalForewardOpacityDelta=e.IsFiniteNumber(t.fod)?t.fod:0,this._totalBackwardOpacityDelta=e.IsFiniteNumber(t.bod)?t.bod:0)}}e.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapter=r}{const e=self.C3;class t{constructor(e){this._used=!1,this._value=0,this._propertyTracks=e;for(let e=0,t=this._propertyTracks.length;e<t;e++)this._propertyTracks[e].SetAbsoluteValueObject(this)}GetPropertyTracks(){return this._propertyTracks}SetUsed(){this._used=!0}GetUsed(){return this._used}SetValue(e){this._value=e}GetValue(){return this._value}Reset(){this._used=!1,this._value=0}}class s{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}GetType(){return 0}SetInitialState(){const e=this._numericInterpolationAdapter;this._numericInterpolationAdapter.GetPropertyTrack();return e._PickResultMode((()=>e._PickTimelinePlaybackMode((()=>0),(()=>e.GetSourceAdapter().GetValueAtTime()))),(()=>{}))}SetResumeState(){}MayNeedBeforeAndAfterInterpolate(){this._numericInterpolationAdapter;switch(this._numericInterpolationAdapter.GetPropertyTrack().GetResultMode()){case"relative":return!1;case"absolute":return!0}}BeforeChangeProperty(){this._numericInterpolationAdapter;const e=this._numericInterpolationAdapter.GetPropertyTrack(),s=e.GetPropertyName();switch(e.GetResultMode()){case"relative":break;case"absolute":if(e.HasAbsoluteValueObject()){e.GetAbsoluteValueObject().Reset()}else{const i=e.GetTimeline(),r=e.GetInstance(),n=e.GetSourceAdapter(),a=i.GetSimilarPropertyTracks(r,n,s);a&&a.length>1&&new t(a)}break}}ChangeProperty(e,t,s,i,r,n,a){const o=this._numericInterpolationAdapter,h=this._numericInterpolationAdapter.GetPropertyTrack();switch(h.GetResultMode()){case"relative":{const a=o.GetLastValue();o._Setter(t-a,s,i),n&&this._MaybeEnsureValue(e,s,i,r,a,t),o.SetLastValue(t);break}case"absolute":{const e=h.GetTimeline(),s=h.GetTrack();h.GetInstance(),h.GetSourceAdapter();if(h.HasAbsoluteValueObject()){const i=h.GetAbsoluteValueObject(),r=i.GetPropertyTracks(),n=o._GetPropertyKeyframeStubs(r,!0),a=o._GetLastPropertyKeyframeStub(e,e.GetTime(),n);if(a){const e=s.GetStartOffset(),r=a.time-e;if(0===r)i.SetUsed(),i.SetValue(i.GetValue()+t);else{if(r<0)return;const e=h.GetInterpolatedValue(r);i.SetUsed(),i.SetValue(i.GetValue()+(t-e))}}}else o._SetterAbsolute(t);break}}}AfterChangeProperty(){const e=this._numericInterpolationAdapter,t=this._numericInterpolationAdapter.GetPropertyTrack();switch(t.GetResultMode()){case"relative":break;case"absolute":if(t.HasAbsoluteValueObject()){const s=t.GetAbsoluteValueObject();s.GetUsed()&&e._SetterAbsolute(s.GetValue())}break}}_MaybeEnsureValue(e,t,s,i,r,n){const a=this._numericInterpolationAdapter;i||(t&&e===t.GetTime()?a._AddDelta(t.GetValueWithResultMode(),t,s):s&&e===s.GetTime()?a._AddDelta(s.GetValueWithResultMode(),t,s):n-r==0&&a._AddDelta(t.GetValueWithResultMode(),t,s))}}e.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline=s}{const e=self.C3;class t{constructor(e){this._numericInterpolationAdapter=e}Release(){this._numericInterpolationAdapter=null}GetType(){return 1}SetInitialState(){const e=this._numericInterpolationAdapter;return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._FirstKeyframeGetter())}SetResumeState(){const e=this._numericInterpolationAdapter;if(e._FirstKeyframeGetter()!==e._CurrentKeyframeGetter())return e.SetFirstAbsoluteUpdate(!0),this._GetAbsoluteInitialValue(e._CurrentKeyframeGetter())}MayNeedBeforeAndAfterInterpolate(){return!1}BeforeChangeProperty(){}ChangeProperty(e,t,s,i,r,n,a){const o=this._numericInterpolationAdapter,h=o.GetLastValue();switch(o.GetPropertyTrack().GetResultMode()){case"relative":o._Setter(t-h,s,i),n&&this._MaybeEnsureValue(e,s,i,r,h,t,!1,a);break;case"absolute":o.GetFirstAbsoluteUpdate()?(o.SetFirstAbsoluteUpdate(!1),o._Setter(h,s,i)):(o._Setter(t-h,s,i),n&&this._MaybeEnsureValue(e,s,i,r,h,t,this._ForceEndValue(),a));break}o.SetLastValue(t)}AfterChangeProperty(){}_GetAbsoluteInitialValue(e){return e-this._numericInterpolationAdapter.GetCurrentState()}_ForceEndValue(){const e=this._numericInterpolationAdapter,t=e.GetWorldInfo().GetInstance(),s=e.GetPropertyTrack().GetRuntime().GetTimelineManager();let i=0;for(const e of s.GetPlayingTimelines())0===e.GetType()?e.HasTrackInstance(t)&&i++:1===e.GetType()&&e.GetInstance()===t&&i++;return i<=1}_MaybeEnsureValue(e,t,s,i,r,n,a,o){const h=this._numericInterpolationAdapter;i?t&&e===t.GetTime()?h._AddDelta(t.GetValueWithResultMode(),t,s,a,o):s&&e===s.GetTime()?h._AddDelta(s.GetValueWithResultMode(),t,s,a,o):s||h._AddDelta(t.GetValueWithResultMode(),t,s,a,o):t&&e===t.GetTime()?h._AddDelta(t.GetValueWithResultMode(),t,s,a,o):s&&e===s.GetTime()?h._AddDelta(s.GetValueWithResultMode(),t,s,a,o):n-r==0&&h._AddDelta(t.GetValueWithResultMode(),t,s,a,o)}}e.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween=t}{const e=self.C3,t=self.Ease;e.PropertyTrackState.NumericTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e);break}return r!==s}static Interpolate(s,i,r,n){if(!r){let e=n.GetPropertyTrackDataItem();return e=n.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e),e.GetValueWithResultMode()}let a=n.GetInterpolationMode();if("default"===a&&(a="continuous"),"combo"===n.GetPropertyType()&&(a="discrete"),"discrete"===a)return i.GetValueWithResultMode();if("continuous"===a||"step"===a){if("step"===a){const e=n.GetTimeline().GetStep();if(0!==e){const t=1/e;s=Math.floor(s*t)/t}}const o=i.GetValueWithResultMode(),h=r.GetValueWithResultMode(),l=i.GetAddOn("cubic-bezier"),c=r.GetAddOn("cubic-bezier"),u=l&&l.GetStartEnable()&&c&&c.GetEndEnable();if(!u&&o===h)return o;const _=i.GetTime(),d=r.GetTime(),p=e.normalize(s,_,d),f=i.GetEase();let m;if(u){const e=d-_;m=t.GetRuntimeEase(f)(e*p,0,1,e),m=t.GetRuntimeEase("cubicbezier")(m,o,o+l.GetStartAnchor(),h+c.GetEndAnchor(),h)}else m=t.GetRuntimeEase(f)((d-_)*p,o,h-o,d-_);return"integer"===n.GetPropertyType()?Math.floor(m):m}}}}{const e=self.C3;e.PropertyTrackState.AngleTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e);break}return r!==s}static Interpolate(t,s,i,r){if(!i){let e=r.GetPropertyTrackDataItem();return e=r.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e),e.GetValueWithResultMode()}let n=r.GetInterpolationMode();if("default"===n&&(n="continuous"),"combo"===r.GetPropertyType()&&(n="discrete"),"discrete"===n)return s.GetValueWithResultMode();if("continuous"===n||"step"===n){if("step"===n){const e=r.GetTimeline().GetStep();if(0!==e){const s=1/e;t=Math.floor(t*s)/s}}const a=s.GetTime(),o=i.GetTime(),h=s.GetValueWithResultMode(),l=i.GetValueWithResultMode(),c=s.GetAddOn("angle");if(!c){if(h===l)return h;const i=e.normalize(t,a,o),r=self.Ease.GetRuntimeEase(s.GetEase());return e.angleLerp(h,l,r(i,0,1,1))}{const i=c.GetRevolutions();if(h===l&&0===i)return h;const r=e.normalize(t,a,o),n=self.Ease.GetRuntimeEase(s.GetEase())(r,0,1,1);switch(c.GetDirection()){case"closest":return e.angleLerp(h,l,n,i);case"clockwise":return e.angleLerpClockwise(h,l,n,i);case"anti-clockwise":return e.angleLerpAntiClockwise(h,l,n,i)}}}}}}{const e=self.C3;e.PropertyTrackState.BooleanTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e);break}return!!r!=!!s}static Interpolate(e,t,s,i){if(!s){let e=i.GetPropertyTrackDataItem();return e=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e),e.GetValueWithResultMode()?1:0}return t.GetValueWithResultMode()?1:0}}}{const e=self.C3,t=[0,0,0],s=[0,0,0],i=[0,0,0];e.PropertyTrackState.ColorTypeAdapter=class{constructor(){}static WillChange(e,r,n,a){let o;switch(a){case"behavior":o=r.GetPropertyValueByIndex(e);break;case"effect":o=r[e];break;case"instance-variable":o=r.GetInstanceVariableValue(e);break;case"plugin":o=r.GetPropertyValueByIndex(e);break}return Array.isArray(n)?(t[0]=n[0],t[1]=n[1],t[2]=n[2]):(i.parseCommaSeparatedRgb(n),t[0]=Math.floor(255*i.getR()),t[1]=Math.floor(255*i.getG()),t[2]=Math.floor(255*i.getB())),Array.isArray(o)?(s[0]=o[0],s[1]=o[1],s[2]=o[2]):(i.parseCommaSeparatedRgb(o),s[0]=Math.floor(255*i.getR()),s[1]=Math.floor(255*i.getG()),s[2]=Math.floor(255*i.getB())),t[0]!==s[0]||(t[1]!==s[1]||t[2]!==s[2])}static Interpolate(s,i,r,n){if(!r){let e=n.GetPropertyTrackDataItem();e=n.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e);const s=e.GetValueWithResultMode();return t[0]=s[0],t[1]=s[1],t[2]=s[2],t}let a=n.GetInterpolationMode();if("default"===a&&(a="continuous"),"discrete"===a){const e=i.GetValueWithResultMode();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}if("continuous"===a||"step"===a){if("step"===a){const e=n.GetTimeline().GetStep();if(0!==e){const t=1/e;s=Math.floor(s*t)/t}}const o=i.GetTime(),h=r.GetTime(),l=i.GetValueWithResultMode(),c=r.GetValueWithResultMode(),u=e.normalize(s,o,h),_=i.GetEase(),d=l[0],p=l[1],f=l[2],m=c[0],g=c[1],S=c[2],y=self.Ease.GetRuntimeEase(_),G=h-o,I=G*u;return t[0]=d===m?d:y(I,d,m-d,G),t[1]=p===g?p:y(I,p,g-p,G),t[2]=f===S?f:y(I,f,S-f,G),t}}}}{const e=self.C3;e.PropertyTrackState.TextTypeAdapter=class{constructor(){}static WillChange(e,t,s,i){let r;switch(i){case"behavior":r=t.GetPropertyValueByIndex(e);break;case"effect":r=t[e];break;case"instance-variable":r=t.GetInstanceVariableValue(e);break;case"plugin":r=t.GetPropertyValueByIndex(e);break}return r!==s}static Interpolate(e,t,s,i){if(!s){let e=i.GetPropertyTrackDataItem();return e=i.GetPropertyTrackData().GetLastPropertyKeyframeDataItem(e),e.GetValueWithResultMode()}return t.GetValueWithResultMode()}}}{const e=self.C3;e.TimelineDataManager=class{constructor(){this._timelineDataItems=new Map}Release(){for(const e of this._timelineDataItems.values())e.Release();this._timelineDataItems.clear(),this._timelineDataItems=null}Add(t){const s=new e.TimelineDataItem(t),i=s.GetName();this._timelineDataItems.set(i,s)}Get(e){return this._timelineDataItems.get(e)}GetNameId(){return 0}static _CreateDataItems(t,s,i,r){if(s)for(const n of s)e.TimelineDataManager._CreateDataItem("create",n,t,i,r)}static _CreateDataItemsIncludingDisabled(t,s,i,r){if(s)for(const n of s)e.TimelineDataManager._CreateDataItem("create-including-disabled",n,t,i,r)}static _LoadDataItemsFromJson(t,s,i,r){t.length?s.forEach(((e,s)=>{t[s]._LoadFromJson(e)})):s.forEach((s=>{e.TimelineDataManager._CreateDataItem("load",s,t,i,r)}))}static _CreateDataItem(e,t,s,i,r){let n;if("function"==typeof i)switch(e){case"load":n=new i(null,r);break;case"create":n=new i(t,r);break;case"create-including-disabled":n=new i(t,r);break}else if("object"==typeof i){const s=t[i.prop],a=i.map.get(s);switch(e){case"load":n=new a(null,r);break;case"create":n=new a(t,r);break;case"create-including-disabled":n=new a(t,r);break}}switch(e){case"load":n._LoadFromJson(t),s.push(n);break;case"create":if("function"==typeof n.GetEnable&&!n.GetEnable())return n.Release();s.push(n);break;case"create-including-disabled":s.push(n);break}}}}{const e=self.C3,t=0,s=1,i=2,r=3,n=4,a=5,o=6,h=7,l=8,c=9,u=10,_=11;e.TimelineDataItem=class{constructor(d){this._name="",this._totalTime=NaN,this._step=0,this._interpolationMode="default",this._resultMode="default",this._loop=!1,this._pingPong=!1,this._repeatCount=1,this._trackData=null,this._startOnLayout="",this._transformWithSceneGraph=!1,this._useSystemTimescale=!0,d&&(this._name=d[t],this._totalTime=d[s],this._step=d[i],this._interpolationMode=d[r],this._resultMode=d[n],this._loop=!!d[o],this._pingPong=!!d[h],this._repeatCount=d[l],this._startOnLayout=d[c],this._transformWithSceneGraph=!!d[u],this._useSystemTimescale=!!d[_],this._trackData=new e.TrackData(d[a],this))}Release(){this._trackData.Release(),this._trackData=null}GetTrackData(){return this._trackData||(this._trackData=new e.TrackData(null,this)),this._trackData}GetName(){return this._name}SetName(e){this._name=e}GetTotalTime(){return this._totalTime}SetTotalTime(e){this._totalTime=e}GetStep(){return this._step}SetStep(e){this._step=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetLoop(){return this._loop}SetLoop(e){this._loop=e}GetPingPong(){return this._pingPong}SetPingPong(e){this._pingPong=e}GetRepeatCount(){return this._repeatCount}SetRepeatCount(e){this._repeatCount=e}GetStartOnLayout(){return this._startOnLayout}GetTransformWithSceneGraph(){return this._transformWithSceneGraph}GetUseSystemTimescale(){return this._useSystemTimescale}_SaveToJson(){return{trackDataJson:this._trackData._SaveToJson(),name:this._name,totalTime:this._totalTime,step:this._step,interpolationMode:this._interpolationMode,resultMode:this._resultMode,loop:this._loop,pingPong:this._pingPong,repeatCount:this._repeatCount,startOnLayout:this._startOnLayout,transformWithSceneGraph:!!this._transformWithSceneGraph,useSystemTimescale:this._useSystemTimescale}}_LoadFromJson(e){e&&(this.GetTrackData()._LoadFromJson(e.trackDataJson),this._name=e.name,this._totalTime=e.totalTime,this._step=e.step,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._loop=e.loop,this._pingPong=e.pingPong,this._repeatCount=e.repeatCount,this._startOnLayout=e.startOnLayout,this._transformWithSceneGraph=!!e.transformWithSceneGraph,this._useSystemTimescale=!!e.useSystemTimescale)}}}{const e=self.C3,t=0,s=1,i=2,r=1,n=2,a=3,o=4,h=5,l=6,c=7,u=0,_=1,d=8,p=0,f=1,m=9,g=10;class S{constructor(p,f){this._trackData=f,this._instanceData=null,this._additionalInstanceData=null,this._instanceUid=NaN,this._objectClassIndex=NaN,this._interpolationMode="default",this._resultMode="default",this._enabled=!1,this._keyframeData=null,this._propertyTrackData=null,this._id="",this._nestedData=null,this._startOffset=0,this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),this._type=0,this._name="",p&&(p[t]&&(this._instanceData=p[t],this._instanceUid=p[t][i],this._objectClassIndex=p[t][s]),this._interpolationMode=p[r],this._resultMode=p[n],this._enabled=!!p[a],p[l]&&(this._id=p[l]),p[c]&&(this._nestedData=p[c],this._startOffset=p[c][u],this._localTotalTime=p[c][_]),p[d]&&(this._additionalInstanceData=p[d]),p[d]&&(this._additionalInstanceData=p[d]),p[m]&&(this._type=p[m]),p[g]&&(this._name=p[g]),this._keyframeData=new e.KeyframeData(p[o],this),this._propertyTrackData=new e.PropertyTrackData(p[h],this))}Release(){this._instanceData=null,this._trackData=null,this._keyframeData&&(this._keyframeData.Release(),this._keyframeData=null),this._propertyTrackData&&(this._propertyTrackData.Release(),this._propertyTrackData=null),this._nestedData=null}GetTrackData(){return this._trackData}GetKeyframeData(){return this._keyframeData||(this._keyframeData=new e.KeyframeData(null,this)),this._keyframeData}GetPropertyTrackData(){return this._propertyTrackData||(this._propertyTrackData=new e.PropertyTrackData(null,this)),this._propertyTrackData}GetInstanceData(){return this._instanceData}GetObjectClassIndex(){return this._objectClassIndex}SetObjectClassIndex(e){this._objectClassIndex=e}GetInstanceUID(){return this._instanceUid}SetInstanceUID(e){this._instanceUid=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}GetId(){return this._id}GetStartOffset(){return this._startOffset}GetLocalTotalTime(){return this._localTotalTime}SetLocalTotalTime(e){this._localTotalTime=e}GetOriginalWidth(){return this._additionalInstanceData[p]}SetOriginalWidth(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[p]=e}GetOriginalHeight(){return this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[f]}SetOriginalHeight(e){this._additionalInstanceData||(this._additionalInstanceData=[]),this._additionalInstanceData[f]=e}GetType(){return this._type}GetName(){return this._name}_SaveToJson(){return{keyframeDataJson:this._keyframeData._SaveToJson(),propertyTrackDataJson:this._propertyTrackData._SaveToJson(),instanceData:this._instanceData,additionalInstanceData:this._additionalInstanceData,instanceUid:this._instanceUid,objectClassIndex:this._objectClassIndex,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,id:this._id,nestedData:this._nestedData,type:this._type,name:this._name}}_LoadFromJson(e){e&&(this._instanceData=e.instanceData,this._instanceUid=e.instanceUid,this._objectClassIndex=e.objectClassIndex,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._id=e.id,this._type=e.type?e.type:0,this._name=e.name?e.name:"",this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime(),e.nestedData&&(this._nestedData=e.nestedData,this._startOffset=this._nestedData[u],this._localTotalTime=this._nestedData[_]),e.additionalInstanceData&&(this._additionalInstanceData=e.additionalInstanceData),this.GetKeyframeData()._LoadFromJson(e.keyframeDataJson),this.GetPropertyTrackData()._LoadFromJson(e.propertyTrackDataJson))}}e.TrackData=class{constructor(t,s){this._timelineDataItem=s,this._trackDataItems=[],e.TimelineDataManager._CreateDataItems(this._trackDataItems,t,S,this)}Release(){this._timelineDataItem=null;for(const e of this._trackDataItems)e.Release();e.clearArray(this._trackDataItems),this._trackDataItems=null}GetTimelineDataItem(){return this._timelineDataItem}AddEmptyTrackDataItem(){const e=new S(null,this);return this._trackDataItems.push(e),e}GetFirstKeyframeDataItem(e){return e.GetKeyframeData().GetKeyframeDataItemArray()[0]}GetLastKeyframeDataItem(e){return e.GetKeyframeData().GetKeyframeDataItemArray().at(-1)}GetKeyFrameDataItemAtTime(e,t){const s=t.GetKeyframeData().GetKeyframeDataItemArray(),i=s.length;for(let t=0;t<i;t++){const i=s[t];if(i.GetTime()===e)return i}}GetFirstKeyFrameDataItemHigherThan(e,t){const s=t.GetKeyframeData().GetKeyframeDataItemArray(),i=s.length;for(let t=0;t<i;t++){const i=s[t];if(i.GetTime()>e)return i}}GetFirstKeyFrameDataItemHigherOrEqualThan(e,t){const s=t.GetKeyframeData().GetKeyframeDataItemArray(),i=s.length;for(let t=0;t<i;t++){const i=s[t];if(i.GetTime()>=e)return i}}GetFirstKeyFrameDataItemLowerOrEqualThan(e,t){const s=t.GetKeyframeData().GetKeyframeDataItemArray();for(let t=s.length-1;t>=0;t--){const i=s[t];if(i.GetTime()<=e)return i}}*trackDataItems(){for(const e of this._trackDataItems)yield e}_SaveToJson(){return{trackDataItemsJson:this._trackDataItems.map((e=>e._SaveToJson()))}}_LoadFromJson(t){t&&e.TimelineDataManager._LoadDataItemsFromJson(this._trackDataItems,t.trackDataItemsJson,S,this)}}}{const e=self.C3,t=0,s=0,i=1,r=2,n=3,a=4,o=5,h=6,l=7,c=8,u=9;class _{constructor(_,d){this._propertyTrackData=d,this._sourceAdapterId="",this._sourceAdapterArguments=null,this._property=null,this._type=null,this._min=NaN,this._max=NaN,this._interpolationMode="default",this._resultMode="default",this._enabled=!1,this._propertyKeyframeData=null,this._canHavePropertyKeyframes=!0,_&&(this._sourceAdapterId=_[t][s],this._sourceAdapterArguments=_[t].slice(1),this._property=_[i],this._type=_[r],this._min=_[n],this._max=_[a],this._interpolationMode=_[o],this._resultMode=_[h],this._enabled=!!_[l],this._propertyKeyframeData=new e.PropertyKeyframeData(_[c],this),this._canHavePropertyKeyframes=_[u])}Release(){this._propertyKeyframeData.Release(),this._propertyKeyframeData=null,this._propertyTrackData=null,this._sourceAdapterArguments=null}GetPropertyTrackData(){return this._propertyTrackData}GetPropertyKeyframeData(){return this._propertyKeyframeData||(this._propertyKeyframeData=new e.PropertyKeyframeData(null,this)),this._propertyKeyframeData}GetSourceAdapterId(){return this._sourceAdapterId}SetSourceAdapterId(e){this._sourceAdapterId=e}GetSourceAdapterArguments(){return this._sourceAdapterArguments}SetSourceAdapterArguments(e){this._sourceAdapterArguments=e}GetProperty(){return this._property}SetProperty(e){this._property=e}GetType(){return this._type}SetType(e){this._type=e}GetMin(){return this._min}SetMin(e){this._min=e}GetMax(){return this._max}SetMax(e){this._max=e}GetInterpolationMode(){return this._interpolationMode}SetInterpolationMode(e){this._interpolationMode=e}GetResultMode(){return this._resultMode}SetResultMode(e){this._resultMode=e}GetEnable(){return this._enabled}SetEnable(e){this._enabled=!!e}CanHavePropertyKeyframes(){return!!this._canHavePropertyKeyframes}_SaveToJson(){return{propertyKeyframeDataJson:this._propertyKeyframeData._SaveToJson(),sourceAdapterId:this._sourceAdapterId,sourceAdapterArguments:this._sourceAdapterArguments,property:this._property,type:this._type,min:this._min,max:this._max,interpolationMode:this._interpolationMode,resultMode:this._resultMode,enabled:this._enabled,canHavePropertyKeyframes:this._canHavePropertyKeyframes}}_LoadFromJson(e){e&&(this._sourceAdapterId=e.sourceAdapterId,this._sourceAdapterArguments=e.sourceAdapterArguments,this._property=e.property,this._type=e.type,this._min=e.min,this._max=e.max,this._interpolationMode=e.interpolationMode,this._resultMode=e.resultMode,this._enabled=e.enabled,this._canHavePropertyKeyframes=e.canHavePropertyKeyframes,this.GetPropertyKeyframeData()._LoadFromJson(e.propertyKeyframeDataJson))}}e.PropertyTrackData=class{constructor(t,s){this._trackDataItem=s,this._propertyTrackDataItems=[],e.TimelineDataManager._CreateDataItems(this._propertyTrackDataItems,t,_,this)}Release(){this._trackDataItem=null;for(const e of this._propertyTrackDataItems)e.Release();e.clearArray(this._propertyTrackDataItems),this._propertyTrackDataItems=null}GetTrackDataItem(){return this._trackDataItem}AddEmptyPropertyTrackDataItem(){const e=new _(null,this);return this._propertyTrackDataItems.push(e),e}GetFirstPropertyKeyframeDataItem(e){return e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray()[0]}GetLastPropertyKeyframeDataItem(e){return e.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray().at(-1)}GetPropertyKeyFrameDataItemAtTime(e,t){const s=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),i=s.length;for(let t=0;t<i;t++){const i=s[t];if(i.GetTime()===e)return i}}GetFirstPropertyKeyFrameDataItemHigherThan(e,t){const s=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),i=s.length;for(let t=0;t<i;t++){const i=s[t];if(i.GetTime()>e)return i}}GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(e,t){const s=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray(),i=s.length;for(let t=0;t<i;t++){const i=s[t];if(i.GetTime()>=e)return i}}GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,t){const s=t.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();for(let t=s.length-1;t>=0;t--){const i=s[t];if(i.GetTime()<=e)return i}}*propertyTrackDataItems(){for(const e of this._propertyTrackDataItems)yield e}_SaveToJson(){return{propertyTrackDataItemsJson:this._propertyTrackDataItems.map((e=>e._SaveToJson()))}}_LoadFromJson(t){t&&e.TimelineDataManager._LoadDataItemsFromJson(this._propertyTrackDataItems,t.propertyTrackDataItemsJson,_,this)}}}{const e=self.C3,t=0,s=1,i=2,r=3;class n{constructor(e,n){if(this._keyframeData=n,this._time=-1,this._ease="noease",this._enable=!1,this._tags=null,this._lowerTags=null,!e)return;this._time=e[t],this._ease=e[s],this._enable=!!e[i];const a=e[r];this._tags=a?a.split(" "):[],this._lowerTags=new Set(this._tags.map((e=>e.toLowerCase()))),this._next=null}Release(){this._keyframeData=null,e.clearArray(this._tags),this._tags=null,this._lowerTags.clear(),this._lowerTags=null,this._next=null}GetKeyframeData(){return this._keyframeData}GetNext(){return this._next}SetNext(e){this._next=e}GetTime(){return this._time}SetTime(e){this._time=e,this._keyframeData._LinkKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetTags(){return this._tags}SetTags(e){this._tags=e?e.split(" "):[],this._lowerTags=new Set(this._tags.map((e=>e.toLowerCase())))}GetLowerTags(){return this._lowerTags}HasTag(e){return this._lowerTags.has(e.toLowerCase())}_SaveToJson(){return{time:this._time,ease:this._ease,enable:this._enable,tags:this._tags}}_LoadFromJson(e){e&&(this._time=e.time,this._ease=e.ease,this._enable=e.enable,this._tags=e.tags,this._lowerTags=new Set(this._tags.map((e=>e.toLowerCase()))))}}e.KeyframeData=class{constructor(t,s){this._trackDataItem=s,this._keyframeDataItems=[],e.TimelineDataManager._CreateDataItems(this._keyframeDataItems,t,n,this),this._LinkKeyframeDataItems()}Release(){this._trackDataItem=null;for(const e of this._keyframeDataItems)e.Release();e.clearArray(this._keyframeDataItems),this._keyframeDataItems=null}_LinkKeyframeDataItems(){this._keyframeDataItems.sort(((e,t)=>e.GetTime()-t.GetTime()));for(let e=0;e<this._keyframeDataItems.length;e++){this._keyframeDataItems[e].SetNext(this._keyframeDataItems[e+1])}}GetTrackDataItem(){return this._trackDataItem}GetKeyframeDataItemCount(){return this._keyframeDataItems.length}GetKeyframeDataItemArray(){return this._keyframeDataItems}AddEmptyKeyframeDataItem(){const e=new n(null,this);return this._keyframeDataItems.push(e),this._LinkKeyframeDataItems(),e}DeleteKeyframeDataItems(e){for(const t of this._keyframeDataItems){if(!e(t))continue;const s=this._keyframeDataItems.indexOf(t);-1!==s&&(t.Release(),this._keyframeDataItems.splice(s,1))}this.SortKeyframeDataItems(),this._LinkKeyframeDataItems()}SortKeyframeDataItems(){this._keyframeDataItems.sort(((e,t)=>e.GetTime()-t.GetTime()))}GetKeyframeDataItemIndex(e){return this._keyframeDataItems.indexOf(e)}GetKeyframeDataItemFromIndex(e){return this._keyframeDataItems[e]}*keyframeDataItems(){for(const e of this._keyframeDataItems)yield e}*keyframeDataItemsReverse(){for(let e=this._keyframeDataItems.length-1;e>=0;e--)yield this._keyframeDataItems[e]}_SaveToJson(){return{keyframeDataItemsJson:this._keyframeDataItems.map((e=>e._SaveToJson()))}}_LoadFromJson(t){t&&(e.TimelineDataManager._LoadDataItemsFromJson(this._keyframeDataItems,t.keyframeDataItemsJson,n,this),this._LinkKeyframeDataItems())}}}{const e=self.C3,t=0,s=0,i=1,r=2,n=1,a=2,o=3,h=4,l=5;class c{constructor(c,u){this._propertyKeyframeData=u,this._value=null,this._aValue=null,this._type="",this._time=NaN,this._ease="noease",this._enable=!1,this._addonData=null,this._addonInstance=void 0,this._pathMode="line",c&&(this._value=c[t][s],this._aValue=c[t][i],this._type=c[t][r],this._time=c[n],this._ease=c[a],this._enable=!!c[o],this._pathMode=c[l],this._addonData=null,c[h]&&(this._addonData=new e.AddonData(c[h],this)),this._next=null,this._prev=null)}Release(){this._propertyKeyframeData=null,this._addonData&&(this._addonData.Release(),this._addonData=null),this._next=null,this._prev=null}GetAddonData(){return this._addonData}SetNext(e){this._next=e}GetNext(){return this._next}SetPrevious(e){this._prev=e}GetPrevious(){return this._prev}GetValue(){return this._value}SetValue(t){"color"===this._type&&e.IsFiniteNumber(t)?(this._value[0]=e.GetRValue(t),this._value[1]=e.GetGValue(t),this._value[2]=e.GetBValue(t)):this._value=t}GetAbsoluteValue(){return this._aValue}SetAbsoluteValue(t){"color"===this._type&&e.IsFiniteNumber(t)?(this._aValue[0]=e.GetRValue(t),this._aValue[1]=e.GetGValue(t),this._aValue[2]=e.GetBValue(t)):this._aValue=t}GetValueWithResultMode(){const e=this._propertyKeyframeData.GetPropertyTrackDataItem().GetResultMode();return"relative"===e?this.GetValue():"absolute"===e?this.GetAbsoluteValue():void 0}GetType(){return this._type}SetType(e){this._type=e}GetTime(){return this._time}SetTime(e){this._time=e,this._propertyKeyframeData._LinkPropertyKeyframeDataItems()}GetEase(){return this._ease}SetEase(e){this._ease=e}GetEnable(){return this._enable}SetEnable(e){this._enable=!!e}GetPathMode(){return this._pathMode}GetAddOn(e){if(!this._addonData)return;if(this._addonInstance||null===this._addonInstance)return this._addonInstance;const t=this._addonData.GetAddDataItemArray();if(!t)return this._addonInstance=null,this._addonInstance;const s=t.length;for(let i=0;i<s;i++){const s=t[i];if(s.GetId()===e)return this._addonInstance=s,this._addonInstance}return this._addonInstance=null,this._addonInstance}_SaveToJson(){const e=this._addonData;return{addonDataJson:e?e._SaveToJson():e,value:this._value,aValue:this._aValue,type:this._type,time:this._time,ease:this._ease,enable:this._enable}}_LoadFromJson(e){e&&(e.addonDataJson&&this._addonData._SetFromJson(e.addonDataJson),this._value=e.value,this._aValue=e.aValue,this._type=e.type,this._time=e.time,this._ease=e.ease,this._enable=e.enable)}}e.PropertyKeyframeData=class{constructor(t,s){this._propertyTrackDataItem=s,this._propertyKeyframeDataItems=[],this._propertyKeyframeDataItemsIncludingDisabled=[],e.TimelineDataManager._CreateDataItems(this._propertyKeyframeDataItems,t,c,this),e.TimelineDataManager._CreateDataItemsIncludingDisabled(this._propertyKeyframeDataItemsIncludingDisabled,t,c,this),this._LinkPropertyKeyframeDataItems()}Release(){this._propertyTrackDataItem=null;for(const e of this._propertyKeyframeDataItems)e.Release();e.clearArray(this._propertyKeyframeDataItems),this._propertyKeyframeDataItems=null;for(const e of this._propertyKeyframeDataItemsIncludingDisabled)e.Release();e.clearArray(this._propertyKeyframeDataItemsIncludingDisabled),this._propertyKeyframeDataItemsIncludingDisabled=null}_LinkPropertyKeyframeDataItems(){let e=this._propertyKeyframeDataItems;e.sort(((e,t)=>e.GetTime()-t.GetTime()));for(let t=0;t<e.length;t++){const s=e[t];t+1<e.length&&s.SetNext(e[t+1]),t-1>=0&&s.SetPrevious(e[t-1])}e=this._propertyKeyframeDataItemsIncludingDisabled,e.sort(((e,t)=>e.GetTime()-t.GetTime()));for(let t=0;t<e.length;t++){const s=e[t];t+1<e.length&&s.SetNext(e[t+1]),t-1>=0&&s.SetPrevious(e[t-1])}}AddEmptyPropertyKeyframeDataItem(){const e=new c(null,this);return this._propertyKeyframeDataItems.push(e),this._LinkPropertyKeyframeDataItems(),e}DeletePropertyKeyframeDataItems(e){for(const t of this._propertyKeyframeDataItems){if(!e(t))continue;const s=this._propertyKeyframeDataItems.indexOf(t);-1!==s&&(t.Release(),this._propertyKeyframeDataItems.splice(s,1))}this.SortPropertyKeyFrameDataItems(),this._LinkPropertyKeyframeDataItems()}SortPropertyKeyFrameDataItems(){this._propertyKeyframeDataItems.sort(((e,t)=>e.GetTime()-t.GetTime()))}GetPropertyTrackDataItem(){return this._propertyTrackDataItem}GetPropertyKeyframeDataItemCount(){return this._propertyKeyframeDataItems.length}GetLastPropertyKeyframeDataItem(){return this._propertyKeyframeDataItems[this._propertyKeyframeDataItems.length-1]}GetPropertyKeyframeDataItemArray(){return this._propertyKeyframeDataItems}GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyKeyframeDataItemsIncludingDisabled}*propertyKeyframeDataItems(){for(const e of this._propertyKeyframeDataItems)yield e}*propertyKeyframeDataItemsReverse(){for(let e=this._propertyKeyframeDataItems.length-1;e>=0;e--)yield this._propertyKeyframeDataItems[e]}_SaveToJson(){const e=this._propertyKeyframeDataItems,t=this._propertyKeyframeDataItemsIncludingDisabled;return{propertyKeyframeDataItemsJson:e.map((e=>e._SaveToJson())),propertyKeyframeDataItemsIncludingDisabledJson:t.map((e=>e._SaveToJson()))}}_LoadFromJson(t){t&&(e.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItems,t.propertyKeyframeDataItemsJson,c,this),e.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItemsIncludingDisabled,t.propertyKeyframeDataItemsIncludingDisabledJson,c,this),this._LinkPropertyKeyframeDataItems())}}}{const e=self.C3,t=0,s=1;class i{constructor(e,i){this._addonData=i,this._id=e[t],this._data=e[s]}Release(){this._addonData=null,this._data=null}GetAddonData(){return this._addonData}GetId(){return this._id}_SaveToJson(){return{id:this._id,data:this._data}}_LoadFromJson(e){e&&(this._id=e.id,this._data=e.data)}}const r=0,n=1,a=2,o=3;class h extends i{constructor(e,t){super(e,t),this._startAnchor=this._data[r],this._startEnable=!!this._data[n],this._endAnchor=this._data[a],this._endEnable=!!this._data[o]}Release(){super.Release()}GetStartAnchor(){return this._startAnchor}GetStartEnable(){return this._startEnable}GetEndAnchor(){return this._endAnchor}GetEndEnable(){return this._endEnable}_SaveToJson(){return Object.assign(super._SaveToJson(),{startAnchor:this._startAnchor,startEnable:!!this._startEnable,endAnchor:this._endAnchor,endEnable:!!this._endEnable})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._startAnchor=e.startAnchor,this._startEnable=!!e.startEnable,this._endAnchor=e.endAnchor,this._endEnable=!!e.endEnable)}}const l=0,c=1;class u extends i{constructor(e,t){super(e,t),this._direction=this._data[l],this._revolutions=this._data[c]}Release(){super.Release()}GetDirection(){return this._direction}GetRevolutions(){return this._revolutions}_SaveToJson(){return Object.assign(super._SaveToJson(),{direction:this._direction,revolutions:this._revolutions})}_LoadFromJson(e){e&&(super._LoadFromJson(e),this._direction=e.direction,this._revolutions=e.revolutions)}}e.AddonData=class{constructor(t,s){this._propertyKeyframeDataItem=s,this._addonDataItems=[],e.TimelineDataManager._CreateDataItems(this._addonDataItems,t,{prop:0,map:new Map([["cubic-bezier",h],["angle",u]])},this)}Release(){this._propertyKeyframeDataItem=null;for(const e of this._addonDataItems)e.Release();e.clearArray(this._addonDataItems),this._addonDataItems=null}GetPropertyKeyframeDataItem(){return this._propertyKeyframeDataItem}GetAddDataItemArray(){return this._addonDataItems}*addonDataItems(){for(const e of this._addonDataItems)yield e}_SaveToJson(){return{addonDataItemsJson:this._addonDataItems.map((e=>e._SaveToJson()))}}_LoadFromJson(t){t&&e.TimelineDataManager._LoadDataItemsFromJson(this._addonDataItems,t.addonDataItemsJson,{prop:"id",map:new Map([["cubic-bezier",h],["angle",u]])},this)}}}{const e=self.C3,t="start-value",s="current-state",i=0,r=1;let n=0;e.TweenState=class extends e.TimelineState{constructor(e,s){super("tween-"+n++,e,s),this._id="",this._destroyInstanceOnComplete=!1,this._initialValueMode=t,this._instance=null,this._on_completed_callbacks=null,this._on_started_callbacks=null,this._track=null,this._iTweenState=null}FireReleaseEvent(t){const s=e.New(e.Event,"tweenstatereleased");s.tweenState=this,t.dispatchEvent(s)}GetType(){return 1}CreateTrackStates(){for(const t of this._timelineDataItem.GetTrackData().trackDataItems())this._tracks.push(e.TweenTrackState.Create(this,t));this._track=this._tracks[0]}AddTrack(){const t=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem(),s=e.TweenTrackState.Create(this,t);return this._tracks.push(s),this._track=this._tracks[0],s}GetPropertyTrack(e){return this._track.GetPropertyTracks()[0]}SetPropertyType(e){this._propertyType=e}GetInstance(){const e=this.GetTracks();if(!e||!e.length)return;const t=e[0];if(this._track=t,!t)return;const s=t.GetInstance();return t.IsInstanceValid()?s:void 0}AddStartedCallback(e){this._on_started_callbacks||(this._on_started_callbacks=[]),this._on_started_callbacks.push(e)}AddCompletedCallback(e){this._on_completed_callbacks||(this._on_completed_callbacks=[]),this._on_completed_callbacks.push(e)}RemoveStartedCallback(e){if(!this._on_started_callbacks)return;const t=this._on_started_callbacks.indexOf(e);-1!==t&&this._on_started_callbacks.splice(t,1)}RemoveCompletedCallback(e){if(!this._on_completed_callbacks)return;const t=this._on_completed_callbacks.indexOf(e);-1!==t&&this._on_completed_callbacks.splice(t,1)}SetStartValue(e,t){for(const s of this._tracks)for(const i of s._propertyTracks){if(i.GetPropertyName()!==t)continue;const s=i.GetPropertyTrackData(),r=i.GetPropertyTrackDataItem(),n=s.GetFirstPropertyKeyframeDataItem(r);n.SetValue(e),n.SetAbsoluteValue(e)}}_GetPropertyTrackState(e){for(const t of this._tracks)for(const s of t._propertyTracks)if(s.GetPropertyName()===e)return s}BeforeSetEndValues(e){for(const t of e){const e=this._GetPropertyTrackState(t);this.SetStartValue(e.GetCurrentState(),t)}if(this.IsForwardPlayBack()){const e=this.GetTotalTime()-this.GetTime();this.SetTotalTime(e);for(const t of this._tracks)t.SetLocalTotalTime(e);this._SetTime(0)}else{const e=this.GetTime();this.SetTotalTime(e);for(const t of this._tracks)t.SetLocalTotalTime(e);this._SetTime(e)}this.SetInitialStateFromSetTime()}SetEndValue(e,t){const s=this._GetPropertyTrackState(t),i=s.GetPropertyTrackData(),r=s.GetPropertyTrackDataItem(),n=i.GetLastPropertyKeyframeDataItem(r);n.SetTime(this.GetTotalTime()),n.SetValue(e),n.SetAbsoluteValue(e)}SetId(e){this._id=e}GetId(){return this._id}SetInitialValueMode(e){this._initialValueMode=e}GetInitialValueMode(){return this._initialValueMode}SetDestroyInstanceOnComplete(e){this._destroyInstanceOnComplete=e}GetDestroyInstanceOnComplete(){return this._destroyInstanceOnComplete}OnStarted(){if(this._on_started_callbacks)for(const e of this._on_started_callbacks)e(this);if(!this.IsComplete())for(const e of this._tracks)e.CompareSaveStateWithCurrent()}OnCompleted(){this._completedTick=this._runtime.GetTickCount()}FinishTriggers(){if(!this._finishedTriggers&&(this._finishedTriggers=!0,this._on_completed_callbacks))for(const e of this._on_completed_callbacks)e(this)}SetTime(e){this._DeleteIntermediateKeyframes(),super.SetTime(e)}_SetTimeAndReset(t){e.IsFiniteNumber(t)||(t=this.GetTotalTime()),t<0?this._playheadTime=0:t>=this.GetTotalTime()?this._playheadTime=this.GetTotalTime():this._playheadTime=t,this._track.SetResetState()}SetInitialState(e){if(!this.InitialStateSet()&&this.GetInitialValueMode()===s)for(const e of this._tracks)e.CompareInitialStateWithCurrent();super.SetInitialState(e)}Stop(e=!1){if(super.Stop(e),!this.IsComplete())for(const e of this._tracks)e.SaveState()}Reset(e=!0,t=!1){this._DeleteIntermediateKeyframes(),super.Reset(e,t)}_DeleteIntermediateKeyframes(){for(const e of this._tracks){const t=e=>{const t=e.GetTime(),s=this.GetTotalTime();return 0!==t&&t!==s};e.DeleteKeyframes(t),e.DeletePropertyKeyframes(t)}}_OnBeforeChangeLayout(){if(this.IsReleased())return!0;const e=this.GetInstance();return(!e||!e.GetObjectClass().IsGlobal())&&(this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this),this.ResetBeforeChangeLayout(),!0)}Tick(t,s,n){if(this._instance||(this._instance=this.GetInstance()),!this._instance||this._instance.IsDestroyed())return this.Stop(!0),void this.OnCompleted();const a=this._instance.GetTimeScale();if(-1!==a&&(t=n*a),0===t&&0===this._lastDelta)return;this._lastDelta=t;const o=this._playheadTime+t*this._playbackRate,h=this._timelineDataItem._totalTime;this._playheadTime=o<0?0:o>=h?h:o;let l=!1,c=!1;const u=this.GetLoop(),_=this.GetPingPong();if(u||_?u&&!_?this._playbackRate>0?this._playheadTime>=h&&(this._SetTimeAndReset(0),c=!0):this._playheadTime<=0&&(this._SetTimeAndReset(h),c=!0):!u&&_?this._playbackRate>0?this._playheadTime>=h&&(this._SetTime(h),this.SetPlaybackRate(-1*this.GetPlaybackRate()),c=!0,this._pingPongState===r?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=i):l=!0:this._pingPongState===i&&(this._pingPongState=r)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),c=!0,this._pingPongState===r?this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._pingPongState=i):l=!0:this._pingPongState===i&&(this._pingPongState=r)):u&&_&&(this._playbackRate>0?this._playheadTime>=h&&(this._SetTime(h),this.SetPlaybackRate(-1*this.GetPlaybackRate()),c=!0,this._pingPongState++,e.wrap(this._pingPongState,0,2)):this._playheadTime<=0&&(this._SetTime(0),this.SetPlaybackRate(-1*this.GetPlaybackRate()),c=!0,this._pingPongState++,e.wrap(this._pingPongState,0,2))):this._playbackRate>0?this._playheadTime>=h&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(0),c=!0):(this._SetTime(h),l=!0)):this._playheadTime<=0&&(this._currentRepeatCount<this.GetRepeatCount()?(this._currentRepeatCount++,this._SetTimeAndReset(h),c=!0):(this._SetTime(0),l=!0)),l)return this._track.SetEndState(),this.Stop(!0),void this.OnCompleted();this._track.Interpolate(this._playheadTime,!0,!1,c,this._firstTick,!1),this._firstTick&&(this._firstTick=!1)}_SaveToJson(){const e=super._SaveToJson(),t=this.GetTimelineDataItem();return Object.assign(e,{tweenDataItemJson:t._SaveToJson(),id:this._id,destroyInstanceOnComplete:this._destroyInstanceOnComplete,initialValueMode:this._initialValueMode})}_LoadFromJson(e){if(!e)return;this.GetTimelineDataItem()._LoadFromJson(e.tweenDataItemJson),super._LoadFromJson(e),this._id=e.id,this._destroyInstanceOnComplete=e.destroyInstanceOnComplete,this._initialValueMode=e.initialValueMode}static IsPlaying(e){return e.IsPlaying()}static IsPaused(e){return e.IsPaused()}static Build(t){const s=t.runtime.GetTimelineManager(),i=new e.TimelineDataItem;if(t.json){i._LoadFromJson(t.json.tweenDataItemJson);const r=new e.TweenState(i,s);return r._LoadFromJson(t.json),r}{const r=new e.TweenState(i,s);e.IsArray(t.propertyTracksConfig)||(t.propertyTracksConfig=[t.propertyTracksConfig]),r.SetId(t.id),r.SetTags(t.tags),r.SetInitialValueMode(t.initialValueMode),r.SetDestroyInstanceOnComplete(t.releaseOnComplete),r.SetLoop(t.loop),r.SetPingPong(t.pingPong),r.SetTotalTime(t.time),r.SetStep(0),r.SetInterpolationMode("default"),r.SetResultMode(t.propertyTracksConfig[0].resultMode),r.SetRepeatCount(t.repeatCount);const n=r.AddTrack();n.SetInstanceUID(t.instance.GetUID()),n.SetInterpolationMode("default"),n.SetResultMode(t.propertyTracksConfig[0].resultMode),n.SetEnable(!0),n.SetObjectClassIndex(t.instance.GetObjectClass().GetIndex());const a=t.instance.GetSdkInstance(),o=a.IsOriginalSizeKnown()?a.GetOriginalWidth():t.instance.GetWorldInfo().GetWidth(),h=a.IsOriginalSizeKnown()?a.GetOriginalHeight():t.instance.GetWorldInfo().GetHeight();n.SetOriginalWidth(o),n.SetOriginalHeight(h);const l=n.AddKeyframe();l.SetTime(0),l.SetEase("noease"),l.SetEnable(!0),l.SetTags("");const c=n.AddKeyframe();c.SetTime(t.time),c.SetEase("noease"),c.SetEnable(!0),c.SetTags("");for(const e of t.propertyTracksConfig){const s=n.AddPropertyTrack();s.SetSourceAdapterId(e.sourceId),s.SetSourceAdapterArgs(e.sourceArgs),s.SetPropertyName(e.property),s.SetPropertyType(e.type),s.SetMin(NaN),s.SetMax(NaN),s.SetInterpolationMode("default"),s.SetResultMode(e.resultMode),s.SetEnable(!0);const i=s.AddPropertyKeyframe();i.SetType(e.valueType),i.SetTime(0),i.SetEase(e.ease),i.SetEnable(!0),i.SetValue(e.startValue),i.SetAbsoluteValue(e.startValue);const r=s.AddPropertyKeyframe();r.SetType(e.valueType),r.SetTime(t.time),r.SetEase(e.ease),r.SetEnable(!0),r.SetValue(e.endValue),r.SetAbsoluteValue(e.endValue),s.GetSourceAdapter()}return r}}GetITweenState(t,s){return this._iTweenState||(this._iTweenState=e.New(self.ITweenState,this,t,s)),this._iTweenState}}}{const e=self.C3;e.TweenTrackState=class extends e.TrackState{constructor(e,t){super(e,t),this._firstPropertyTrack=null,this._secondPropertyTrack=null}static Create(t,s){return e.New(e.TweenTrackState,t,s)}_CachePropertyTracks(){1===this._propertyTracks.length?this._firstPropertyTrack=this._propertyTracks[0]:(this._firstPropertyTrack=this._propertyTracks[0],this._secondPropertyTrack=this._propertyTracks[1])}CreatePropertyTrackStates(){for(const t of this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems())this._propertyTracks.push(e.TweenPropertyTrackState.Create(this,t));this._CachePropertyTracks()}AddPropertyTrack(){const t=this._trackDataItem.GetPropertyTrackData().AddEmptyPropertyTrackDataItem(),s=e.TweenPropertyTrackState.Create(this,t);return this._propertyTracks.push(s),this._CachePropertyTracks(),s}SetInitialState(){if(this.MaybeGetInstance(),!this.IsInstanceValid()&&this.IsInstanceTrack())return;const e=this.GetTimeline().IsForwardPlayBack()?0:this.GetLocalTotalTime();for(const t of this._propertyTracks)t.SetInitialState(e),0===this._worldInfoChange&&1===t.GetWorldInfoChange()&&(this._worldInfoChange=1),0===this._renderChange&&1===t.GetRenderChange()&&(this._renderChange=1);this._needsBeforeAndAfter=0;this._propertyTracks.some((e=>e.GetNeedsBeforeAndAfter()))&&(this._needsBeforeAndAfter=1),this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(e),this._initialStateOfNestedSet=!1,this._endStateOfNestedSet=!1,this.Interpolate(e)}BeforeInterpolate(){}Interpolate(e,t=!1,s=!1,i=!1,r=!1,n=!1,a=!1){if(this._instance||this.GetInstance(),!this._instance)return;return!this._instance.IsDestroyed()&&((!n||!this.GetObjectClass().IsGlobal())&&(this._secondPropertyTrack?(this._firstPropertyTrack.Interpolate(e,s,i,a),this._secondPropertyTrack.Interpolate(e,s,i,a)):this._firstPropertyTrack.Interpolate(e,s,i,a),void(0!==this._firstPropertyTrack.GetWorldInfoChange()&&(this._worldInfo||(this._worldInfo=this._instance.GetWorldInfo()),this._worldInfo&&this._worldInfo.SetBboxChanged()))))}AfterInterpolate(){}_LoadFromJson(e){super._LoadFromJson(e),this._CachePropertyTracks()}}}{const e=self.C3;e.TweenPropertyTrackState=class extends e.PropertyTrackState{constructor(e,t){super(e,t),this._basic=!1}static Create(t,s){return e.New(e.TweenPropertyTrackState,t,s)}Interpolate(e,t=!1,s=!1,i=!1){let r,n;if(this._basic)r=this._propertyKeyframeDataItems[0],n=this._propertyKeyframeDataItems[1];else if(t)r=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem),n=r.GetNext();else{if(this._lastPropertyKeyframeDataItem){const t=this.GetTimeline(),s=this._lastPropertyKeyframeDataItem.GetNext(),i=this._lastPropertyKeyframeDataItem.GetTime(),r=s?s.GetTime():t.GetTotalTime();(e<=i||e>=r)&&(this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem))}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(e,this._propertyTrackDataItem);r=this._lastPropertyKeyframeDataItem,n=r.GetNext()}this._sourceAdapter.Interpolate(e,r,n,t,s,i)}AddPropertyKeyframe(){const e=this._propertyTrackDataItem.GetPropertyKeyframeData().AddEmptyPropertyKeyframeDataItem();return this._lastPropertyKeyframeDataItem=null,this._basic=this.GetPropertyKeyframeDataItems().length<=2,e}DeletePropertyKeyframes(e){this._lastPropertyKeyframeDataItem=null;this._propertyTrackDataItem.GetPropertyKeyframeData().DeletePropertyKeyframeDataItems(e),this._basic=this.GetPropertyKeyframeDataItems().length<=2}_SaveToJson(){return{sourceAdapterJson:this.GetSourceAdapter()._SaveToJson(),basic:this._basic}}_LoadFromJson(e){e&&(this.GetSourceAdapter()._LoadFromJson(e.sourceAdapterJson),this._basic=e.basic)}}}{const e=self.C3,t=self.Ease,s=0,i=1;e.Transition=class extends e.DefendedBase{constructor(r,n=!0){super(),this._name=r[s],this._linear=!1,this._transitionKeyframes=[];for(const t of r[i]){const s=e.TransitionKeyframe.Create(this,t);this._transitionKeyframes.push(s)}for(let e=0;e<this._transitionKeyframes.length;e++){this._transitionKeyframes[e].SetNext(this._transitionKeyframes[e+1])}this._precalculatedSamples=new Map,this._transitionKeyframeCache=new Map,this._PreCalcSamples(),n&&t.AddCustomEase(this._name,((e,t,s,i)=>this.Interpolate(e,t,s,i)))}static Create(t){return e.New(e.Transition,t)}Release(){for(const e of this._transitionKeyframes)e.Release();e.clearArray(this._transitionKeyframes),this._transitionKeyframes=null,this._precalculatedSamples.clear(),this._precalculatedSamples=null,this._transitionKeyframeCache.clear(),this._transitionKeyframeCache=null}MakeLinear(e){this._linear=!!e}GetTransitionKeyFrameAt(e){const t=this._transitionKeyframeCache.get(e);if(t)return t;for(const t of this._transitionKeyframes)if(t.GetValueX()===e)return this._transitionKeyframeCache.set(e,t),t}GetFirstTransitionKeyFrameHigherThan(e){for(const t of this._transitionKeyframes)if(t.GetValueX()>e)return t}GetFirstTransitionKeyFrameHigherOrEqualThan(e){for(const t of this._transitionKeyframes)if(t.GetValueX()>=e)return t}GetFirstTransitionKeyFrameLowerThan(e){for(let t=this._transitionKeyframes.length-1;t>=0;t--){const s=this._transitionKeyframes[t];if(s.GetValueX()<e)return s}}GetFirstTransitionKeyFrameLowerOrEqualThan(e){for(let t=this._transitionKeyframes.length-1;t>=0;t--){const s=this._transitionKeyframes[t];if(s.GetValueX()<=e)return s}}Interpolate(s,i,r,n){if(this._linear)return t.NoEase(s,i,r,n);const a=s/n;let o=this.GetFirstTransitionKeyFrameLowerOrEqualThan(a),h=o.GetNext();h||(o=this.GetFirstTransitionKeyFrameLowerThan(a),h=o.GetNext());const l=h.GetValueX()-o.GetValueX(),c=e.mapToRange(a,o.GetValueX(),h.GetValueX(),0,l),u=o.GetValueX(),_=o.GetValueY(),d=o.GetValueX()+o.GetStartAnchorX(),p=o.GetValueY()+o.GetStartAnchorY(),f=h.GetValueX()+h.GetEndAnchorX(),m=h.GetValueY()+h.GetEndAnchorY(),g=h.GetValueX(),S=h.GetValueY();let y=t.GetRuntimeEase("spline")(c,u,_,d,p,f,m,g,S,this._precalculatedSamples.get(o));return y+=o.GetValueY(),(1-y)*i+y*(i+r)}_PreCalcSamples(){this._precalculatedSamples.clear();for(let e=0;e<this._transitionKeyframes.length-1;e++){const s=this._transitionKeyframes[e];if(!s.GetStartEnable())continue;const i=s,r=this._transitionKeyframes[e+1],n=i.GetValueX(),a=i.GetValueX()+i.GetStartAnchorX(),o=r.GetValueX()+r.GetEndAnchorX(),h=r.GetValueX();this._precalculatedSamples.set(i,t.GetBezierSamples(n,a,o,h))}}}}{const e=self.C3,t=0,s=1,i=2,r=3,n=4,a=5,o=6,h=7;e.TransitionKeyframe=class extends e.DefendedBase{constructor(e,l){super(),this._transition=e,this._valueX=l[t],this._valueY=l[s],this._startAnchorX=l[i],this._startAnchorY=l[r],this._endAnchorX=l[n],this._endAnchorY=l[a],this._startEnable=l[o],this._endEnable=l[h],this._next=null}Release(){this._transition=null}static Create(t,s){return e.New(e.TransitionKeyframe,t,s)}SetNext(e){this._next=e}GetNext(){return this._next}GetValueX(){return this._valueX}GetValueY(){return this._valueY}GetStartAnchorX(){return this._startAnchorX}GetStartAnchorY(){return this._startAnchorY}GetEndAnchorX(){return this._endAnchorX}GetEndAnchorY(){return this._endAnchorY}GetStartEnable(){return this._startEnable}GetEndEnable(){return this._endEnable}}}{const e=self.C3;e.TransitionManager=class extends e.DefendedBase{constructor(e){super(),this._runtime=e,this._transitions=[]}Release(){for(const e of this._transitions)e.Release();e.clearArray(this._transitions),this._transitions=null}Create(t){this._transitions.push(e.Transition.Create(t))}}}{const e=self.C3;e.TemplateManager=class extends e.DefendedBase{constructor(e){super(),this._runtime=e,this._templateDataMap=null,this._instanceToTemplateNameMap=null,this._instanceDestroy=e=>this._OnInstanceDestroy(e.instance)}Release(){if(this.RemoveRuntimeListeners(),this._templateDataMap){for(const e of this._templateDataMap.values())e.clear();this._templateDataMap.clear()}this._templateDataMap=null,this._runtime=null}Create(e){if(this._templateDataMap||(this._templateDataMap=new Map),!e)return;const t=e[0][16][0],s=e[1];this._templateDataMap.has(s)||this._templateDataMap.set(s,new Map);this._templateDataMap.get(s).set(t,e)}AddRuntimeListeners(){const e=this._runtime.Dispatcher();e&&e.addEventListener("instancedestroy",this._instanceDestroy)}RemoveRuntimeListeners(){const e=this._runtime.Dispatcher();e&&e.removeEventListener("instancedestroy",this._instanceDestroy)}HasTemplates(){return!!this._templateDataMap&&0!==this._templateDataMap.size}GetTemplateData(t,s){let i=0;if(i=t instanceof e.ObjectClass?t.GetIndex():t,!this._templateDataMap.has(i))return;const r=this._templateDataMap.get(i).get(s);return r?JSON.parse(JSON.stringify(r)):void 0}MapInstanceToTemplateName(e,t){this._instanceToTemplateNameMap||(this._instanceToTemplateNameMap=new WeakMap),this._instanceToTemplateNameMap.has(e)||this._instanceToTemplateNameMap.set(e,t)}GetInstanceTemplateName(e){if(!this._instanceToTemplateNameMap)return"";const t=this._instanceToTemplateNameMap.get(e);return t||""}_OnInstanceDestroy(e){this._instanceToTemplateNameMap&&this._instanceToTemplateNameMap.has(e)&&this._instanceToTemplateNameMap.delete(e)}}}{const e=self.C3;e.SolStack=class extends e.DefendedBase{constructor(t){super(),this._objectClass=t,this._stack=[],this._stack.push(e.New(e.Sol,this)),this._index=0,this._current=this._stack[0]}Release(){for(const e of this._stack)e.Release();e.clearArray(this._stack),this._current=null,this._objectClass=null}GetObjectClass(){return this._objectClass}GetCurrentSol(){return this._current}Clear(){this.GetCurrentSol().Clear()}PushClean(){const t=this._stack,s=++this._index;if(s===t.length){const s=e.New(e.Sol,this);t.push(s),this._current=s}else{const e=t[s];e.Reset(),this._current=e}}PushCopy(){const t=this._stack,s=++this._index;s===t.length&&t.push(e.New(e.Sol,this));const i=t[s];i.Copy(t[s-1]),this._current=i}Pop(){this._current=this._stack[--this._index]}RemoveInstances(e){const t=this._stack;for(let s=0,i=t.length;s<i;++s)t[s].RemoveInstances(e)}}}{const e=self.C3;e.Sol=class extends e.DefendedBase{constructor(e){super(),this._stack=e,this._objectClass=this._stack.GetObjectClass(),this._eventStack=this._objectClass.GetRuntime().GetEventStack(),this._selectAll=!0,this._instances=[],this._elseInstances=[]}Release(){this.ClearArrays(),this._stack=null,this._objectClass=null,this._eventStack=null}ClearArrays(){e.clearArray(this._instances),e.clearArray(this._elseInstances)}GetObjectClass(){return this._objectClass}IsSelectAll(){return this._selectAll}HasAnyInstances(){return this._selectAll?!!this._objectClass.GetInstanceCount():!!this._instances.length}GetInstances(){return this._selectAll?this._objectClass.GetInstances():this._instances}HasAnyElseInstances(){return!!this._elseInstances.length}GetElseInstances(){return this._elseInstances}GetExpressionInstances(){const e=this.GetInstances();return e.length?e:this._elseInstances}Reset(){this._selectAll=!0,e.clearArray(this._elseInstances)}Clear(){this._selectAll=!0}Copy(t){t.IsSelectAll()?this.Reset():(this._selectAll=!1,e.shallowAssignArray(this._instances,t._instances),e.clearArray(this._elseInstances))}_PushInstance(e){this._instances.push(e)}_PushElseInstance(e){this._elseInstances.push(e)}_SetSelectAll(e){this._selectAll=!!e}_GetOwnInstances(){return this._instances}_GetOwnElseInstances(){return this._elseInstances}SetSinglePicked(t){this._selectAll=!1,e.clearArray(this._instances),this._instances.push(t)}SetArrayPicked(t){this._selectAll=!1,e.shallowAssignArray(this._instances,t)}SetSetPicked(t){this._selectAll=!1,e.clearArray(this._instances);for(const e of t)this._instances.push(e)}AddElseInstances(e,t){for(const s of t)e.has(s)||this._elseInstances.push(s)}TransferElseInstancesToOwn(t){for(const e of t)this._instances.push(e);e.arrayRemoveAllInSet(this._elseInstances,t)}PickOne(t){if(t)if(this._eventStack.GetCurrentStackFrame().GetCurrentEvent().IsOrBlock()){this.IsSelectAll()&&(e.clearArray(this._instances),e.shallowAssignArray(this._elseInstances,t.GetObjectClass().GetInstances()),this._selectAll=!1);const s=this._elseInstances.indexOf(t);-1!==s&&(this._instances.push(this._elseInstances[s]),this._elseInstances.splice(s,1))}else this.SetSinglePicked(t)}RemoveInstances(t){e.arrayRemoveAllInSet(this._instances,t),e.arrayRemoveAllInSet(this._elseInstances,t)}}}{const e=self.C3;e.EventStack=class extends e.DefendedBase{constructor(t){super(),this._eventSheetManager=t,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._stack.push(e.New(e.EventStackFrame,this,null)),this._index=0,this._expFuncStack=[]}Release(){for(const e of this._stack)e.Release();e.clearArray(this._stack),e.clearArray(this._expFuncStack),this._eventSheetManager=null,this._runtime=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrentStackFrame(){return this._stack[this._index]}GetAllStackFrames(){return this._stack}GetCurrentStackFrameIndex(){return this._index}Push(t){const s=this._stack,i=++this._index;if(i===s.length){const i=e.New(e.EventStackFrame,this,t);return s.push(i),i}{const e=s[i];return e.Reset(t),e}}Pop(){--this._index}PushExpFunc(e){this._expFuncStack.push(e)}PopExpFunc(){this._expFuncStack.pop()}GetCurrentExpFuncStackFrame(){const e=this._expFuncStack;return 0===e.length?null:e.at(-1)}}}{const e=self.C3;e.EventStackFrame=class extends e.DefendedBase{constructor(e,t){super(),this._stack=e,this._runtime=this._stack.GetRuntime(),this._currentEvent=t,this._cndIndex=0,this._actIndex=0,this._lastEventTrue=!1,this._elseBranchRan=!1,this._expressionObjectClass=null,this._functionReturnType=0,this._functionReturnValue=0,this._dynamicSolModifiers=null}Release(){this.Reset(null),this._stack=null,this._runtime=null}Reset(e){this._currentEvent=e,this._cndIndex=0,this._actIndex=0,this._lastEventTrue=!1,this._elseBranchRan=!1,this._dynamicSolModifiers=null}_Restore(e,t){this._currentEvent=e,this._cndIndex=0,this._actIndex=t}ResetQuick(){this._cndIndex=0,this._actIndex=0}GetCurrentEvent(){return this._currentEvent}SetCurrentEvent(e){this._currentEvent=e}GetConditionIndex(){return this._cndIndex}SetConditionIndex(e){this._cndIndex=e}GetActionIndex(){return this._actIndex}SetActionIndex(e){this._actIndex=e}SetLastEventTrue(e){this._lastEventTrue=!!e}GetLastEventTrue(){return this._lastEventTrue}SetElseBranchRan(e){this._elseBranchRan=!!e}GetElseBranchRan(){return this._elseBranchRan}SetExpressionObjectClass(e){this._expressionObjectClass=e}GetExpressionObjectClass(){return this._expressionObjectClass}InitCallFunctionExpression(e,t){this._functionReturnType=e,this._functionReturnValue=t}GetFunctionReturnType(){return this._functionReturnType}SetFunctionReturnValue(e){this._functionReturnValue=e}GetFunctionReturnValue(){return this._functionReturnValue}IsSolModifierAfterCnds(){const e=this._currentEvent;return!!e.IsSolWriterAfterCnds()||this._cndIndex<e.GetConditionCount()-1&&!!e.GetSolModifiers().length}SetDynamicSolModifiers(e){this._dynamicSolModifiers=e}GetDynamicSolModifiers(){return this._dynamicSolModifiers}}}{const e=self.C3;e.LocalVarStack=class extends e.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1,this._current=null,this._initialValues=[]}Release(){e.clearArray(this._stack),this._eventSheetManager=null,this._runtime=null}_SetInitialValues(e){this._initialValues=e;const t=this._initialValues.slice(0);this._stack.push(t),this._index=0,this._current=t}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetCurrent(){return this._current}Push(){const t=++this._index,s=this._stack;t===s.length?s.push(this._initialValues.slice(0)):e.shallowAssignArray(s[t],this._initialValues),this._current=s[t]}Pop(){this._current=this._stack[--this._index]}}}{const e=self.C3;e.LoopStack=class extends e.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._runtime=this._eventSheetManager.GetRuntime(),this._stack=[],this._index=-1}Release(){e.clearArray(this._stack),this._eventSheetManager=null,this._runtime=null}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}IsInLoop(){return this._index>=0}GetCurrent(){return this._stack[this._index]}Push(){if(++this._index,this._index===this._stack.length){const t=e.New(e.Loop,this);return this._stack.push(t),t}{const e=this._stack[this._index];return e.Reset(),e}}Pop(){--this._index}FindByName(e){const t=this._stack;for(let s=this._index;s>=0;--s){const i=t[s];if(i.GetName()===e)return i}return null}_GetStack(){return this._stack.slice(0,this._index+1)}}}{const e=self.C3;e.Loop=class extends e.DefendedBase{constructor(e){super(),this._loopStack=e,this._name="",this._index=0,this._isStopped=!1,this._end=NaN}Reset(){this._name="",this._index=0,this._isStopped=!1,this._end=NaN}SetName(e){this._name=e}GetName(){return this._name}SetIndex(e){this._index=e}GetIndex(){return this._index}Stop(){this._isStopped=!0}IsStopped(){return this._isStopped}SetEnd(e){this._end=e}GetEnd(){return this._end}}}{const e=self.C3;e.ArrayStack=class extends e.DefendedBase{constructor(){super(),this._stack=[],this._index=-1}Release(){e.clearArray(this._stack)}GetCurrent(){return this._stack[this._index]}Push(){if(++this._index,this._index===this._stack.length){const e=[];return this._stack.push(e),e}return this._stack[this._index]}Pop(){--this._index}}}{const e=self.C3,t=self.assert;function SortSolArray(e,t){return e.GetIndex()-t.GetIndex()}function IsSolArrayIdentical(e,t){for(let s=0,i=e.length;s<i;++s)if(e[s]!==t[s])return!1;return!0}e.EventSheetManager=class extends e.DefendedBase{constructor(t){super(),this._runtime=t,this._allSheets=[],this._sheetsByName=new Map,this._allGroups=[],this._groupsByName=new Map,this._blocksBySid=new Map,this._cndsBySid=new Map,this._actsBySid=new Map,this._allUniqueSolModifiers=new Map,this._eventVarsBySid=new Map,this._nextLocalVarIndex=0,this._allGlobalVars=[],this._allLocalVars=[],this._localVarInitialValues=[],this._functionBlocksByName=new Map,this._customActionBlocksMap=new Map,this._eventStack=e.New(e.EventStack,this),this._localVarStack=e.New(e.LocalVarStack,this),this._loopStack=e.New(e.LoopStack,this),this._triggersToPostInit=[],this._queuedTriggers=[],this._queuedDebugTriggers=[],this._runningEventsDepth=0,this._executingTriggerDepth=0,this._blockFlushingDepth=0,this._scheduledWaits=[],this._asyncActionPromises=[],self.c3_callFunction=(e,t)=>this._InvokeFunctionFromJS(e,t)}Release(){this.ClearAllScheduledWaits(),this._eventStack.Release(),this._eventStack=null,this._localVarStack.Release(),this._localVarStack=null,e.clearArray(this._queuedTriggers),e.clearArray(this._queuedDebugTriggers),this._runtime=null,e.clearArray(this._allSheets),this._sheetsByName.clear()}Create(t){const s=e.New(e.EventSheet,this,t);this._allSheets.push(s),this._sheetsByName.set(s.GetName().toLowerCase(),s)}_AddTriggerToPostInit(e){this._triggersToPostInit.push(e)}_PostInit(){for(const e of this._customActionBlocksMap.values())e._CheckOverrideState();for(const e of this._functionBlocksByName.values())e._PostInit();for(const e of this._customActionBlocksMap.values())e._PostInit();for(const e of this._allSheets)e._PostInit();for(const e of this._allSheets)e._UpdateDeepIncludes();for(const e of this._triggersToPostInit)e._PostInit(!1);e.clearArray(this._triggersToPostInit),this._localVarStack._SetInitialValues(this._localVarInitialValues)}GetRuntime(){return this._runtime}GetEventSheetByName(e){return this._sheetsByName.get(e.toLowerCase())||null}_RegisterGroup(e){this._allGroups.push(e),this._groupsByName.set(e.GetGroupName(),e)}_RegisterEventBlock(e){this._blocksBySid.set(e.GetSID(),e)}_RegisterCondition(e){this._cndsBySid.set(e.GetSID(),e)}_RegisterAction(e){this._actsBySid.set(e.GetSID(),e)}_RegisterFunctionBlock(e){switch(e.GetFunctionType()){case 0:this._functionBlocksByName.set(e.GetFunctionName().toLowerCase(),e);break;case 1:this._customActionBlocksMap.set(e.GetFunctionName().toLowerCase(),e);break;default:}}_RegisterEventVariable(e){this._eventVarsBySid.set(e.GetSID(),e),e.IsGlobal()?this._allGlobalVars.push(e):this._allLocalVars.push(e)}_DeduplicateSolModifierList(e){e.length>=2&&e.sort(SortSolArray);let t=this._allUniqueSolModifiers.get(e.length);t||(t=[],this._allUniqueSolModifiers.set(e.length,t));for(let s=0,i=t.length;s<i;++s){const i=t[s];if(IsSolArrayIdentical(e,i))return i}return t.push(e),e}_GetNextLocalVarIndex(e){return this._localVarInitialValues.push(e.GetInitialValue()),this._nextLocalVarIndex++}GetEventStack(){return this._eventStack}GetCurrentEventStackFrame(){return this.GetEventStack().GetCurrentStackFrame()}GetCurrentEvent(){return this.GetCurrentEventStackFrame().GetCurrentEvent()}GetCurrentCondition(){const e=this.GetCurrentEventStackFrame();return e.GetCurrentEvent().GetConditionAt(e.GetConditionIndex())}GetCurrentAction(){const e=this.GetCurrentEventStackFrame();return e.GetCurrentEvent().GetActionAt(e.GetActionIndex())}GetLocalVarStack(){return this._localVarStack}GetLoopStack(){return this._loopStack}GetAllLocalVariablesInScope(t){const s=[];for(t=t.GetScopeParent();t;)e.appendArray(s,t._GetAllLocalVariablesInScope()),t=t.GetScopeParent();return s}_GetLocalVariablesScriptInterface(e){const t={};for(const s of this.GetAllLocalVariablesInScope(e))t[s.GetJsPropName()]=s._GetScriptInterfaceDescriptor();return Object.create(Object.prototype,t)}GetEventVariableBySID(e){return this._eventVarsBySid.get(e)||null}GetEventBlockBySID(e){return this._blocksBySid.get(e)||null}GetConditionBySID(e){return this._cndsBySid.get(e)||null}GetActionBySID(e){return this._actsBySid.get(e)||null}GetFunctionBlockByName(e){return this._functionBlocksByName.get(e.toLowerCase())||null}GetCustomActionBlockByName(e,t){let s=this._customActionBlocksMap.get((e.GetName()+"."+t).toLowerCase());if(s)return s;if(!e.IsFamily())for(const i of e.GetFamilies())if(s=this._customActionBlocksMap.get((i.GetName()+"."+t).toLowerCase()),s)return s;return null}GetAllGlobalVariables(){return this._allGlobalVars}GetAllLocalVariables(){return this._allLocalVars}ResetAllGlobalsToInitialValue(){for(const e of this._allGlobalVars)e.ResetToInitialValue()}GetEventGroupByName(e){return this._groupsByName.get(e.toLowerCase())||null}GetEventGroupBySID(e){const t=this._blocksBySid.get(e);return t&&t.IsGroup()?t:null}GetAllGroups(){return this._allGroups}ResetAllGroupsInitialActivation(){for(const e of this._allGroups)e.ResetInitialActivation()}_ResetAllHasRunFlags(){for(const e of this._allSheets)e._ResetHasRunFlag()}RunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(const t of e.runningLayouts()){const e=t.GetEventSheet();e&&(this._runtime.PushCurrentLayout(t),e.Run(),this._runtime.PopCurrentLayout())}this._runningEventsDepth--}async DebugRunEvents(e){this._ResetAllHasRunFlags(),this._runningEventsDepth++;for(const t of this._DebugRunEventsGen(e))await this._runtime.DebugBreak(t);this._runningEventsDepth--}*_DebugRunEventsGen(e){for(const t of e.runningLayouts()){const e=t.GetEventSheet();e&&(this._runtime.PushCurrentLayout(t),yield*e.DebugRun(),this._runtime.PopCurrentLayout())}}_Trigger(e,t,s,i){let r=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,s,i);this._executingTriggerDepth++;for(const n of e.runningLayouts()){const e=n.GetEventSheet();if(!e)continue;this._runtime.PushCurrentLayout(n);for(const n of e.deepIncludes()){const e=n._Trigger(t,s,i);r=r||e}const a=e._Trigger(t,s,i);r=r||a,this._runtime.PopCurrentLayout()}return this._executingTriggerDepth--,r}*_DebugTrigger(e,t,s,i){let r=!1;if(!e.GetMainRunningLayout())return this.QueueTrigger(t,s,i);this._executingTriggerDepth++;for(const n of e.runningLayouts()){const e=n.GetEventSheet();if(!e)continue;this._runtime.PushCurrentLayout(n);for(const n of e.deepIncludes()){const e=yield*n._DebugTrigger(t,s,i);r=r||e}const a=yield*e._DebugTrigger(t,s,i);r=r||a,this._runtime.PopCurrentLayout()}return this._executingTriggerDepth--,r}QueueTrigger(e,t,s){return this._queuedTriggers.push([e,t,s]),!1}QueueDebugTrigger(e,t,s){let i=null;const r=new Promise((e=>i=e));return this._queuedDebugTriggers.push([e,t,s,i]),r}*_RunQueuedDebugTriggersGen(){if(this._runtime.HitBreakpoint())throw new Error("should not be in breakpoint");const e=this._runtime.GetLayoutManager();for(;this._queuedDebugTriggers.length;){const[t,s,i,r]=this._queuedDebugTriggers.shift();r(yield*this._DebugTrigger(e,t,s,i))}}async RunQueuedDebugTriggersAsync(){for(const e of this._RunQueuedDebugTriggersGen())await this._runtime.DebugBreak(e)}_FastTrigger(e,t,s,i){let r=!1;const n=e.GetMainRunningLayout(),a=n.GetEventSheet();if(!a)return;this._executingTriggerDepth++,this._runtime.PushCurrentLayout(n);const o=a.deepIncludes();for(let e=0,n=o.length;e<n;++e){const n=o[e]._FastTrigger(t,s,i);r=r||n}const h=a._FastTrigger(t,s,i);return r=r||h,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,r}*_DebugFastTrigger(e,t,s,i){let r=!1;const n=e.GetMainRunningLayout(),a=n.GetEventSheet();if(!a)return;this._executingTriggerDepth++,this._runtime.PushCurrentLayout(n);const o=a.deepIncludes();for(let e=0,n=o.length;e<n;++e){const n=yield*o[e]._DebugFastTrigger(t,s,i);r=r||n}const h=yield*a._DebugFastTrigger(t,s,i);return r=r||h,this._runtime.PopCurrentLayout(),this._executingTriggerDepth--,r}GetTriggerDepth(){return this._executingTriggerDepth}IsInTrigger(){return this.GetTriggerDepth()>0}_IncTriggerDepth(){return++this._executingTriggerDepth}_DecTriggerDepth(){--this._executingTriggerDepth}IsRunningEvents(){return this._runningEventsDepth>0}IsInEventEngine(){return this.IsRunningEvents()||this.IsInTrigger()}_RunQueuedTriggers(t){for(const[e,s,i]of this._queuedTriggers)this._Trigger(t,e,s,i);e.clearArray(this._queuedTriggers)}BlockFlushingInstances(e){e?this._blockFlushingDepth++:this._blockFlushingDepth--}IsFlushingBlocked(){return this._blockFlushingDepth>0}ClearSol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().Clear()}PushCleanSol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().PushClean()}PushCopySol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().PushCopy()}PopSol(e){for(let t=0,s=e.length;t<s;++t)e[t].GetSolStack().Pop()}GetDynamicSolModifiersSet(e){const t=new Set,s=this._eventStack.GetAllStackFrames(),i=this._eventStack.GetCurrentStackFrameIndex();for(let r=0;r<=i;++r){const i=s[r].GetDynamicSolModifiers();if(i)for(const s of i)e&&e.has(s)||t.add(s)}return t}PushCleanSolDynamic(e){const t=new Set([...e]),s=this.GetDynamicSolModifiersSet(t);if(s.size>0){for(const e of s)e.GetSolStack().PushClean();return[...s]}return null}AddScheduledWait(){const t=e.New(e.ScheduledWait,this);return this._scheduledWaits.push(t),t}scheduledWaits(){return this._scheduledWaits}RunScheduledWaits(){if(!this._scheduledWaits.length)return;const e=this.GetCurrentEventStackFrame();let t=!1;this._runningEventsDepth++;for(let s=0,i=this._scheduledWaits.length;s<i;++s){const i=this._scheduledWaits[s];i._ShouldRun()&&i._Run(e),i.ShouldRelease()&&(t=!0)}t&&(this._FilterScheduledWaitsToRelease(),e.Reset(null)),this._runningEventsDepth--}async DebugRunScheduledWaits(){if(!this._scheduledWaits.length)return;const e=this.GetCurrentEventStackFrame();let t=!1;this._runningEventsDepth++;for(let s=0,i=this._scheduledWaits.length;s<i;++s){const i=this._scheduledWaits[s];i._ShouldRun()&&await i._DebugRun(e),i.ShouldRelease()&&(t=!0)}t&&(this._FilterScheduledWaitsToRelease(),e.Reset(null)),this._runningEventsDepth--}_FilterScheduledWaitsToRelease(){const t=e.arrayFilterOut(this._scheduledWaits,(e=>e.ShouldRelease()));for(const e of t)e.Release()}ClearAllScheduledWaits(){for(const e of this._scheduledWaits)e.Release();e.clearArray(this._scheduledWaits)}RemoveInstancesFromScheduledWaits(e){for(const t of this._scheduledWaits)t.RemoveInstances(e)}AddAsyncActionPromise(e){this._asyncActionPromises.push(e)}ClearAsyncActionPromises(){e.clearArray(this._asyncActionPromises)}GetPromiseForAllAsyncActions(){const e=Promise.all(this._asyncActionPromises);return this._asyncActionPromises=[],e}_SaveToJson(){return{groups:this._SaveGroupsToJson(),cnds:this._SaveCndsToJson(),acts:this._SaveActsToJson(),vars:this._SaveVarsToJson(),waits:this._SaveScheduledWaitsToJson()}}_LoadFromJson(e){this._LoadGroupsFromJson(e.groups),this._LoadCndsFromJson(e.cnds),this._LoadActsFromJson(e.acts),this._LoadVarsFromJson(e.vars),this._LoadScheduledWaitsFromJson(e.waits)}_SaveGroupsToJson(){const e={};for(const t of this.GetAllGroups())e[t.GetSID().toString()]=t.IsGroupActive();return e}_LoadGroupsFromJson(e){for(const[t,s]of Object.entries(e)){const e=parseInt(t,10),i=this.GetEventGroupBySID(e);i&&i.SetGroupActive(s)}}_SaveCndsToJson(){const e={};for(const[t,s]of this._cndsBySid){const i=s._SaveToJson();i&&(e[t.toString()]=i)}return e}_LoadCndsFromJson(e){const t=new Map;for(const[s,i]of Object.entries(e))t.set(parseInt(s,10),i);for(const[e,s]of this._cndsBySid)s._LoadFromJson(t.get(e)||null)}_SaveActsToJson(){const e={};for(const[t,s]of this._actsBySid){const i=s._SaveToJson();i&&(e[t.toString()]=i)}return e}_LoadActsFromJson(e){const t=new Map;for(const[s,i]of Object.entries(e))t.set(parseInt(s,10),i);for(const[e,s]of this._actsBySid)s._LoadFromJson(t.get(e)||null)}_SaveVarsToJson(){const e={};for(const[t,s]of this._eventVarsBySid)s.IsConstant()||!s.IsGlobal()&&!s.IsStatic()||(e[t.toString()]=s.GetValue());return e}_LoadVarsFromJson(e){for(const[t,s]of Object.entries(e)){const e=parseInt(t,10),i=this.GetEventVariableBySID(e);i&&i.SetValue(s)}}_SaveScheduledWaitsToJson(){return this._scheduledWaits.filter((e=>!e.IsPromise())).map((e=>e._SaveToJson()))}_LoadScheduledWaitsFromJson(t){this.ClearAllScheduledWaits();for(const s of t){const t=e.ScheduledWait._CreateFromJson(this,s);t&&this._scheduledWaits.push(t)}}_GetPerfRecords(){return[...this._runtime.GetLayoutManager().runningLayouts()].map((e=>e.GetEventSheet())).filter((e=>e)).map((e=>e._GetPerfRecord()))}FindFirstFunctionBlockParent(t){for(;t;){const s=t.GetScopeParent();if(s instanceof e.FunctionBlock)return s;t=s}return null}_InvokeFunctionFromJS(e,t){Array.isArray(t)||(t=[]);const s=this.GetFunctionBlockByName(e.toLowerCase());if(!s)return null;if(!s.IsEnabled())return s.GetDefaultReturnValue();const i=s.GetFunctionParameters();if(t.length<i.length){t=t.slice(0);do{t.push(i[t.length].GetInitialValue())}while(t.length<i.length)}const r=s.GetEventBlock();return r.RunAsExpressionFunctionCall(r.GetSolModifiersIncludingParents(),!1,s.GetReturnType(),s.GetDefaultReturnValue(),...t)}}}{const e=self.C3;e.EventSheet=class extends e.DefendedBase{constructor(e,t){super(),this._eventSheetManager=e,this._runtime=e.GetRuntime(),this._name=t[0],this._events=[],this._triggers=new Map,this._fastTriggers=new Map,this._eventsByDisplayNumber=new Map,this._hasRun=!1,this._shallowIncludes=[],this._deepIncludes=[],this._alreadyIncludedSheets=new Set;for(const e of t[1])this._CreateEvent(e,null,this._events);this._perfRecord=this._runtime.IsDebug()?{type:"sheet",name:this._name,totalTimeCounter:0,children:[]}:null}Release(){this._eventSheetManager=null,this._runtime=null}_CreateEvent(e,t,s){switch(e[0]){case 0:case 3:this._CreateEventBlock(e,t,s);break;case 1:this._CreateEventVariable(e,t,s);break;case 2:this._CreateInclude(e,t,s);break;case 4:this._CreateFunctionBlock(e,t);break;case 5:this._CreateScriptBlock(e,t,s);break;case 6:this._CreateCustomACEBlock(e,t);break;default:throw new Error("invalid event type")}}_CreateEventBlock(t,s,i){const r=e.EventBlock.Create(this,s,t);if(r.IsOrBlock()){i.push(r);const e=r.GetConditions();for(let t=0,s=e.length;t<s;++t)e[t].IsTrigger()&&this._InitTrigger(r,t)}else r.IsTrigger()?this._InitTrigger(r,0):i.push(r)}_CreateFunctionBlock(t,s){const i=e.FunctionBlock.CreateFunctionBlock(this,s,t);this._eventSheetManager._RegisterFunctionBlock(i)}_CreateCustomACEBlock(t,s){const i=e.FunctionBlock.CreateCustomACEBlock(this,s,t);this._eventSheetManager._RegisterFunctionBlock(i)}_CreateEventVariable(t,s,i){const r=e.EventVariable.Create(this,s,t);i.push(r)}_CreateInclude(t,s,i){const r=e.EventInclude.Create(this,s,t);i.push(r)}_CreateScriptBlock(t,s,i){const r=e.EventScript.Create(this,s,t);i.push(r)}_InitTrigger(e,t){e.IsOrBlock()||this._eventSheetManager._AddTriggerToPostInit(e);const s=e.GetConditionAt(t),i=s._GetFunc(),r=s.GetObjectClass();if(s.IsFastTrigger()){let n=this._fastTriggers.get(r);n||(n=new Map,this._fastTriggers.set(r,n));const a=s.GetFastTriggerValue().toLowerCase();let o=n.get(i);o||(o=new Map,n.set(i,o));let h=o.get(a);h||(h=[],o.set(a,h)),h.push([e,t])}else{let n=this._triggers.get(r);n||(n={methodMap:new Map,behaviors:new Map},this._triggers.set(r,n));const a=s.GetBehaviorType();let o;a?(o=n.behaviors.get(a),o||(o=new Map,n.behaviors.set(a,o))):o=n.methodMap;let h=o.get(i);h||(h=[],o.set(i,h)),h.push([e,t])}}_PostInit(){const t=this._events;for(let s=0,i=t.length;s<i;++s){const r=s<i-1&&t[s+1]instanceof e.EventBlock&&t[s+1].IsElseBlock();t[s]._PostInit(r)}}_AddShallowInclude(e){this._shallowIncludes.push(e)}_UpdateDeepIncludes(){e.clearArray(this._deepIncludes),this._AddDeepIncludes(this),this._alreadyIncludedSheets.clear()}_AddDeepIncludes(e){const t=e._deepIncludes,s=e._alreadyIncludedSheets;for(const i of this._shallowIncludes){const r=i.GetIncludeSheet();i.IsActive()&&e!==r&&!s.has(r)&&(s.add(r),r._AddDeepIncludes(e),t.push(r))}}deepIncludes(){return this._deepIncludes}GetEventSheetManager(){return this._eventSheetManager}GetRuntime(){return this._runtime}GetName(){return this._name}_RegisterEventByDisplayNumber(e,t){this._eventsByDisplayNumber.set(t,e)}_GetEventByDisplayNumber(e){return this._eventsByDisplayNumber.get(e)||null}_ResetHasRunFlag(){this._hasRun=!1}Run(){if(this._hasRun)return;const e=this._runtime,t=e.IsCPUProfiling(),s=t?performance.now():0;this._hasRun=!0;const i=this.GetEventSheetManager(),r=i.GetCurrentEventStackFrame();for(const t of this._events)t.Run(r),i.ClearSol(t.GetSolModifiers()),i.ClearAsyncActionPromises(),e.FlushPendingInstances();r.Reset(null),t&&(this._perfRecord.totalTimeCounter+=performance.now()-s)}*DebugRun(){if(this._hasRun)return;this._hasRun=!0;const e=this._runtime,t=this.GetEventSheetManager(),s=t.GetCurrentEventStackFrame();for(const i of this._events)yield*i.DebugRun(s),t.ClearSol(i.GetSolModifiers()),t.ClearAsyncActionPromises(),e.FlushPendingInstances();s.Reset(null)}_Trigger(e,t,s){if(!t)return this._TriggerForClass(e,t,null,null);{const i=t.GetObjectClass();let r=!1,n=this._TriggerForClass(e,t,i,s);r=r||n;for(const a of i.GetFamilies())n=this._TriggerForClass(e,t,a,s),r=r||n}}_TriggerForClass(e,t,s,i){const r=this._triggers.get(s);if(!r)return!1;const n=i?r.behaviors.get(i):r.methodMap;if(!n)return!1;const a=n.get(e);if(!a)return!1;let o=!1;for(const[e,s]of a){const i=this._ExecuteTrigger(t,e,s);o=o||i}return o}*_DebugTrigger(e,t,s){if(!t)return yield*this._DebugTriggerForClass(e,t,null,null);{const i=t.GetObjectClass();let r=!1,n=yield*this._DebugTriggerForClass(e,t,i,s);r=r||n;for(const a of i.GetFamilies())n=yield*this._DebugTriggerForClass(e,t,a,s),r=r||n}}*_DebugTriggerForClass(e,t,s,i){const r=this._triggers.get(s);if(!r)return!1;const n=i?r.behaviors.get(i):r.methodMap;if(!n)return!1;const a=n.get(e);if(!a)return!1;let o=!1;for(const[e,s]of a){let i;i=e.DebugCanRunFast()?this._ExecuteTrigger(t,e,s):yield*this._DebugExecuteTrigger(t,e,s),o=o||i}return o}_FastTrigger(e,t,s){const i=t.GetObjectClass(),r=this._fastTriggers.get(i);if(!r)return!1;const n=r.get(e);if(!n)return!1;const a=n.get(s);if(!a)return!1;let o=!1;for(let e=0,t=a.length;e<t;++e){const t=a[e],s=this._ExecuteTrigger(null,t[0],t[1]);o=o||s}return o}*_DebugFastTrigger(e,t,s){const i=t.GetObjectClass(),r=this._fastTriggers.get(i);if(!r)return!1;const n=r.get(e);if(!n)return!1;const a=n.get(s);if(!a)return!1;let o=!1;for(let e=0,t=a.length;e<t;++e){const t=a[e],s=t[0],i=t[1];let r;r=s.DebugCanRunFast()?this._ExecuteTrigger(null,s,i):yield*this._DebugExecuteTrigger(null,s,i),o=o||r}return o}_ExecuteTrigger(e,t,s){const i=this._runtime,r=this._eventSheetManager,n=r.GetCurrentEvent(),a=r.GetEventStack(),o=r.GetTriggerDepth();let h=!1;n&&r.PushCleanSol(n.GetSolModifiersIncludingParents()),r.PushCleanSol(t.GetSolModifiersIncludingParents());const l=o>1;l&&r.GetLocalVarStack().Push();const c=a.Push(t);if(e){t.GetConditions()[s].GetObjectClass().GetCurrentSol().SetSinglePicked(e),e.IsInContainer()&&e.SetSiblingsSinglePicked()}let u=!0;if(t.GetParent()){const e=t.GetTriggerParents();for(let t=0,s=e.length;t<s;++t)if(!e[t].RunPreTrigger(c)){u=!1;break}}return u&&(t.IsOrBlock()?t.RunOrBlockTrigger(c,s):t.Run(c),h=c.GetLastEventTrue()),a.Pop(),l&&r.GetLocalVarStack().Pop(),r.PopSol(t.GetSolModifiersIncludingParents()),n&&r.PopSol(n.GetSolModifiersIncludingParents()),n||1!==o||(r.ClearAsyncActionPromises(),r.IsFlushingBlocked()||i.FlushPendingInstances()),h}*_DebugExecuteTrigger(e,t,s){const i=this._runtime,r=this._eventSheetManager,n=r.GetCurrentEvent(),a=r.GetEventStack(),o=r.GetTriggerDepth();let h=!1;n&&r.PushCleanSol(n.GetSolModifiersIncludingParents()),r.PushCleanSol(t.GetSolModifiersIncludingParents());const l=o>1;l&&r.GetLocalVarStack().Push();const c=a.Push(t);if(e){t.GetConditions()[s].GetObjectClass().GetCurrentSol().SetSinglePicked(e),e.IsInContainer()&&e.SetSiblingsSinglePicked()}let u=!0;if(t.GetParent()){const e=t.GetTriggerParents();for(let t=0,s=e.length;t<s;++t)if(!(yield*e[t].DebugRunPreTrigger(c))){u=!1;break}}return u&&(t.IsOrBlock()?yield*t.DebugRunOrBlockTrigger(c,s):yield*t.DebugRun(c),h=c.GetLastEventTrue()),a.Pop(),l&&r.GetLocalVarStack().Pop(),r.PopSol(t.GetSolModifiersIncludingParents()),n&&r.PopSol(n.GetSolModifiersIncludingParents()),n||1!==o||(r.ClearAsyncActionPromises(),r.IsFlushingBlocked()||i.FlushPendingInstances()),h}_GetPerfRecord(){return this._perfRecord}}}{const e=self.C3,t=[];function NoActions(e,t){return!0}function*DebugNoActions(e,t){return!0}e.EventBlock=class extends e.DefendedBase{constructor(s,i,r){super(),this._eventSheet=s,this._runtime=s.GetRuntime(),this._parent=i,this._scopeParent=null,this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._solModifiers=[],this._solModifiersIncludingParents=[],this._hasGotSolModifiersIncludingParents=!1,this._isSolWriterAfterCnds=!1,this._isTopLevelGroup=!1,this._hasElseBlock=!1,this._isOrBlock=!!r[2],this._isElseBlock=!1,this._triggerParents=null,this._conditions=[],this._actions=[],this._subEvents=[],this._RunActions=NoActions,this._DebugRunActions=DebugNoActions,this._isGroup=!1,this._isInitiallyActive=!1,this._groupName="",this._isGroupActive=!1,this._containedIncludes=null,this._perfRecord=null,this._sid=r[4],this._displayNumber=r[5],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=this._runtime.IsDebug()?{isBreakpoint:r[3][0],isBreakable:r[3][1],canRunAllConditionsFast:!1,canRunAllActionsFast:!1,canRunAllSubEventsFast:!1,canRunSelfFast:!1}:null,this.GetEventSheetManager()._RegisterEventBlock(this),3===r[0]&&this._InitGroup(r[1]);let n=0;for(const t of r[6]){const s=e.Condition.Create(this,t,n++);this._conditions.push(s),this._AddSolModifier(s.GetObjectClass())}n=0;for(const t of r[7]){const s=e.Action.Create(this,t,n++);this._actions.push(s)}if(9===r.length){const e=r[8];for(const t of e)this._eventSheet._CreateEvent(t,this,this._subEvents)}this._conditions.length&&(this._isElseBlock=null===this._conditions[0].GetObjectClass()&&this._conditions[0]._GetFunc()===e.Plugins.System.Cnds.Else),0===this._conditions.length&&(this._conditions=t),0===this._actions.length&&(this._actions=t),0===this._subEvents.length&&(this._subEvents=t)}static Create(t,s,i){return e.New(e.EventBlock,t,s,i)}_InitGroup(e){this._isGroup=!0,this._isInitiallyActive=!!e[0],this._isGroupActive=this._isInitiallyActive,this._groupName=e[1].toLowerCase(),this._containedIncludes=[],this.GetEventSheetManager()._RegisterGroup(this),this._runtime.IsDebug()&&(this._perfRecord={type:"group",name:e[1],totalTimeCounter:0,children:[]})}_AddContainedInclude(e){this._containedIncludes.push(e)}_AddContainerSolModifierToList(e,t){for(const s of e.GetContainer().objectTypes())t.includes(s)||t.push(s)}_AddSolModifierToList(e,t){if(e)if(t.includes(e)||t.push(e),e.IsFamily())for(const s of e.GetFamilyMembers())s.IsInContainer()&&this._AddContainerSolModifierToList(s,t);else e.IsInContainer()&&this._AddContainerSolModifierToList(e,t)}_AddSolModifier(e){this._AddSolModifierToList(e,this._solModifiers)}_AddParentSolModifier(e){this._AddSolModifierToList(e,this._solModifiersIncludingParents)}SetAllSolModifiers(){this._solModifiers=this._runtime.GetAllObjectClasses()}_PostInit(t){this._hasElseBlock=!!t,this._IdentifyTopLevelGroup(),this._IdentifyTriggerParents();for(const e of this._conditions)e._PostInit();if(this._actions.length>0){let e=!1;for(const t of this._actions)t._PostInit(),t.HasReturnType()&&(e=!0);e?(this._RunActions=this._RunActions_ReturnValue,this._DebugRunActions=this._DebugRunActions_ReturnValue):(this._RunActions=this._RunActions_Fast,this._DebugRunActions=this._DebugRunActions_Fast)}const s=this._subEvents;for(let t=0,i=s.length;t<i;++t){const r=t<i-1&&s[t+1]instanceof e.EventBlock&&s[t+1].IsElseBlock();s[t]._PostInit(r)}this._debugData&&this._UpdateCanRunFast(),this._perfRecord&&this._GetPerfRecordParent()._GetPerfRecord().children.push(this._perfRecord)}_GetPerfRecord(){return this._perfRecord}_GetPerfRecordParent(){let e=this.GetParent();for(;e;){if(e.IsGroup())return e;e=e.GetParent()}return this._eventSheet}_UpdateCanRunFast(){const e=this._debugData;e.canRunAllConditionsFast=this._conditions.every((e=>e.DebugCanRunFast())),e.canRunAllActionsFast=this._actions.every((e=>e.DebugCanRunFast())),e.canRunAllSubEventsFast=this._subEvents.every((e=>e.DebugCanRunFast())),e.canRunSelfFast=e.canRunAllConditionsFast&&e.canRunAllActionsFast&&e.canRunAllSubEventsFast}_UpdateCanRunFastRecursive(){let e=this;do{e._UpdateCanRunFast(),e=e.GetParent()}while(e)}_IdentifyTopLevelGroup(){if(!this.IsGroup())return;let e=this.GetParent();for(this._isTopLevelGroup=!0;e;){if(!e.IsGroup()){this._isTopLevelGroup=!1;break}e=e.GetParent()}}_IdentifySolModifiersIncludingParents(){const t=this._runtime.GetAllObjectClasses();if(this._solModifiers===t)this._solModifiersIncludingParents=t;else{this._solModifiersIncludingParents=e.cloneArray(this._solModifiers);let t=this.GetParent();for(;t;){for(const e of t._solModifiers)this._AddParentSolModifier(e);t=t.GetParent()}const s=this.GetEventSheetManager();this._solModifiers=s._DeduplicateSolModifierList(this._solModifiers),this._solModifiersIncludingParents=s._DeduplicateSolModifierList(this._solModifiersIncludingParents)}}_IdentifyTriggerParents(){if(!this.HasAnyTriggeredCondition())return;this._triggerParents=[];let e=this.GetParent();for(;e;)this._triggerParents.push(e),e=e.GetParent();this._triggerParents.reverse()}SetSolWriterAfterCnds(){this._isSolWriterAfterCnds=!0,this._parent&&this._parent.SetSolWriterAfterCnds()}IsSolWriterAfterCnds(){return this._isSolWriterAfterCnds}GetSolModifiers(){return this._solModifiers}GetSolModifiersIncludingParents(){return this._hasGotSolModifiersIncludingParents||(this._hasGotSolModifiersIncludingParents=!0,this._IdentifySolModifiersIncludingParents()),this._solModifiersIncludingParents}HasSolModifier(e){return this._solModifiers.includes(e)}GetTriggerParents(){return this._triggerParents}GetEventSheet(){return this._eventSheet}GetEventSheetManager(){return this._eventSheet.GetEventSheetManager()}GetRuntime(){return this._runtime}GetParent(){return this._parent}_SetScopeParent(e){this._scopeParent=e}GetScopeParent(){return this._scopeParent||this._parent}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e,this._UpdateCanRunFastRecursive()}IsGroup(){return this._isGroup}IsTopLevelGroup(){return this._isTopLevelGroup}IsElseBlock(){return this._isElseBlock}HasElseBlock(){return this._hasElseBlock}GetGroupName(){return this._groupName}IsGroupActive(){return this._isGroupActive}ResetInitialActivation(){this.SetGroupActive(this._isInitiallyActive)}SetGroupActive(e){if(e=!!e,!this._isGroup)throw new Error("not a group");if(this._isGroupActive!==e){this._isGroupActive=e;for(const e of this._containedIncludes)e.UpdateActive();if(this._containedIncludes.length){const e=this._runtime.GetCurrentLayout().GetEventSheet();e&&e._UpdateDeepIncludes()}}}GetSID(){return this._sid}IsOrBlock(){return this._isOrBlock}IsTrigger(){return this._conditions.length&&this._conditions[0].IsTrigger()}IsForFunctionBlock(){return this._scopeParent&&this._scopeParent instanceof e.FunctionBlock}HasAnyTriggeredCondition(){return this.IsForFunctionBlock()||this._conditions.some((e=>e.IsTrigger()))}GetConditions(){return this._conditions}GetConditionCount(){return this._conditions.length}GetConditionAt(e){if((e=Math.floor(e))<0||e>=this._conditions.length)throw new RangeError("invalid condition index");return this._conditions[e]}GetConditionByDebugIndex(e){return this.GetConditionAt(e)}IsFirstConditionOfType(e){let t=e.GetIndex();if(0===t)return!0;for(--t;t>=0;--t)if(this._conditions[t].GetObjectClass()===e.GetObjectClass())return!1;return!0}GetActions(){return this._actions}GetActionCount(){return this._actions.length}GetActionAt(e){if((e=Math.floor(e))<0||e>=this._actions.length)throw new RangeError("invalid action index");return this._actions[e]}GetActionByDebugIndex(e){e=Math.floor(e);const t=this._actions.find((t=>t.GetDebugIndex()===e));if(!t)throw new RangeError("invalid action debug index");return t}_HasActionIndex(e){return(e=Math.floor(e))>=0&&e<this._actions.length}GetSubEvents(){return this._subEvents}_GetAllLocalVariablesInScope(){return this._subEvents.filter((t=>t instanceof e.EventVariable))}RunPreTrigger(e){e.SetCurrentEvent(this);let t=!1;const s=this._conditions;for(let i=0,r=s.length;i<r;++i){const r=s[i];if(e.SetConditionIndex(i),r.IsLooping())throw new Error("trigger cannot be used as sub-event to a loop");if(r.Run())t=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||t}RunOrBlockTrigger(e,t){e.SetCurrentEvent(this),this._conditions[t].Run()&&(this._RunActions(e,0)&&this._RunSubEvents(e),e.SetLastEventTrue(!0))}*DebugRunPreTrigger(e){e.SetCurrentEvent(this);let t=!1;const s=this._conditions;for(let i=0,r=s.length;i<r;++i){const r=s[i];if(e.SetConditionIndex(i),r.IsLooping())throw new Error("trigger cannot be used as sub-event to a loop");let n;if(n=r.DebugCanRunFast()?r.Run():yield*r.DebugRun(),n)t=!0;else if(!this._isOrBlock)return!1}return!this._isOrBlock||t}*DebugRunOrBlockTrigger(e,t){e.SetCurrentEvent(this);const s=this._conditions[t];let i;if(i=s.DebugCanRunFast()?s.Run():yield*s.DebugRun(),i){let t;t=this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0),t&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),e.SetLastEventTrue(!0)}}Run(e){e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?this._RunOrBlock(e):this._RunAndBlock(e)}*DebugRun(e){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),e.SetCurrentEvent(this),this._isElseBlock||e.SetElseBranchRan(!1),this._isOrBlock?yield*this._DebugRunOrBlock(e):yield*this._DebugRunAndBlock(e)}_RunOrBlock(e){const t=this._conditions;let s=0===t.length;for(let i=0,r=t.length;i<r;++i){const r=t[i];if(r.IsTrigger())continue;e.SetConditionIndex(i);const n=r.Run();s=s||n}e.SetLastEventTrue(s),s&&(this._RunActions(e,0)&&this._RunSubEvents(e),this._hasElseBlock&&e.SetElseBranchRan(!0))}*_DebugRunOrBlock(e){const t=this._conditions;let s=0===t.length;for(let i=0,r=t.length;i<r;++i){const r=t[i];if(r.IsTrigger())continue;let n;e.SetConditionIndex(i),n=r.DebugCanRunFast()?r.Run():yield*r.DebugRun(),s=s||n}if(e.SetLastEventTrue(s),s){let t;t=this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0),t&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),this._hasElseBlock&&e.SetElseBranchRan(!0)}}_RunAndBlock(e){const t=this._conditions;for(let s=0,i=t.length;s<i;++s){const i=t[s];e.SetConditionIndex(s);if(!i.Run())return void e.SetLastEventTrue(!1)}e.SetLastEventTrue(!0),this._RunActions(e,0)&&this._RunSubEvents(e),e.GetLastEventTrue()&&this._hasElseBlock&&e.SetElseBranchRan(!0)}*_DebugRunAndBlock(e){const t=this._conditions;for(let s=0,i=t.length;s<i;++s){const i=t[s];let r;if(e.SetConditionIndex(s),r=i.DebugCanRunFast()?i.Run():yield*i.DebugRun(),!r)return void e.SetLastEventTrue(!1)}let s;e.SetLastEventTrue(!0),s=this.DebugCanRunActionsFast()?this._RunActions(e,0):yield*this._DebugRunActions(e,0),s&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),e.GetLastEventTrue()&&this._hasElseBlock&&e.SetElseBranchRan(!0)}_RunActions_Fast(e,t){const s=this._actions;for(let i=t,r=s.length;i<r;++i){const t=s[i];e.SetActionIndex(i),t.Run()}return!0}*_DebugRunActions_Fast(e,t){const s=this._actions;for(let i=t,r=s.length;i<r;++i){const t=s[i];e.SetActionIndex(i),t.DebugCanRunFast()?t.Run():yield*t.DebugRun()}return!0}_RunActions_ReturnValue(e,t){const s=this.GetEventSheetManager(),i=this._actions;for(let r=t,n=i.length;r<n;++r){const t=i[r];e.SetActionIndex(r);const n=t.Run();if(t.CanBailOut()&&!0===n)return!1;t.IsAsync()&&n instanceof Promise&&s.AddAsyncActionPromise(n)}return!0}*_DebugRunActions_ReturnValue(e,t){const s=this.GetEventSheetManager(),i=this._actions;for(let r=t,n=i.length;r<n;++r){const t=i[r];let n;if(e.SetActionIndex(r),n=t.DebugCanRunFast()?t.Run():yield*t.DebugRun(),t.CanBailOut()&&!0===n)return!1;t.IsAsync()&&n instanceof Promise&&s.AddAsyncActionPromise(n)}return!0}_ResumeActionsAndSubEvents(e){this._RunActions(e,e.GetActionIndex())&&this._RunSubEvents()}*_DebugResumeActionsAndSubEvents(e){(yield*this._DebugRunActions(e,e.GetActionIndex()))&&(yield*this._DebugRunSubEvents())}_RunSubEvents(){if(!this._subEvents.length)return;const e=this.IsGroup()&&this._runtime.IsCPUProfiling(),t=e?performance.now():0,s=this._eventStack,i=s.Push(this);this._isSolWriterAfterCnds?this._RunSubEvents_SolWriterAfterCnds(i):this._RunSubEvents_Fast(i),s.Pop(),e&&(this._perfRecord.totalTimeCounter+=performance.now()-t)}_RunSubEvents_SolWriterAfterCnds(e){const t=this._isGroup,s=this._isTopLevelGroup,i=this.GetEventSheetManager(),r=this._subEvents;for(let n=0,a=r.length,o=a-1;n<a;++n){const a=r[n],h=a.GetSolModifiers(),l=!s||!t&&n<o;l&&i.PushCopySol(h),a.Run(e),l?i.PopSol(h):i.ClearSol(h)}}_RunSubEvents_Fast(e){const t=this._subEvents;for(let s=0,i=t.length;s<i;++s)t[s].Run(e)}*_DebugRunSubEvents(){if(!this._subEvents.length)return;const e=this._eventStack,t=e.Push(this);this._isSolWriterAfterCnds?yield*this._DebugRunSubEvents_SolWriterAfterCnds(t):yield*this._DebugRunSubEvents_Fast(t),e.Pop()}*_DebugRunSubEvents_SolWriterAfterCnds(e){const t=this._isGroup,s=this._isTopLevelGroup,i=this.GetEventSheetManager(),r=this._subEvents;for(let n=0,a=r.length,o=a-1;n<a;++n){const a=r[n],h=a.GetSolModifiers(),l=!s||!t&&n<o;l&&i.PushCopySol(h),yield*a.DebugRun(e),l?i.PopSol(h):i.ClearSol(h)}}*_DebugRunSubEvents_Fast(e){const t=this._subEvents;for(let s=0,i=t.length;s<i;++s)yield*t[s].DebugRun(e)}Retrigger(e,t){t.ResetQuick();const s=this._conditions;if(!this.IsOrBlock())for(let i=e.GetConditionIndex()+1,r=s.length;i<r;++i){const e=s[i];t.SetConditionIndex(i);if(!e.Run())return!1}return this._RunActions(t,0)&&this._RunSubEvents(t),!0}*DebugRetrigger(e,t){t.ResetQuick();const s=this._conditions;if(!this.IsOrBlock())for(let i=e.GetConditionIndex()+1,r=s.length;i<r;++i){const e=s[i];let r;if(t.SetConditionIndex(i),r=e.DebugCanRunFast()?e.Run():yield*e.DebugRun(),!r)return!1}let i;return i=this.DebugCanRunActionsFast()?this._RunActions(t,0):yield*this._DebugRunActions(t,0),i&&(this.DebugCanRunSubEventsFast()?this._RunSubEvents():yield*this._DebugRunSubEvents()),!0}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()&&this._debugData.canRunSelfFast}DebugCanRunActionsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllActionsFast}DebugCanRunSubEventsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllSubEventsFast}_CheckParentsOKToRun(e){if(this.GetParent()){const t=this.GetTriggerParents();for(let s=0,i=t.length;s<i;++s)if(!t[s].RunPreTrigger(e))return!1}return!0}*_DebugCheckParentsOKToRun(e){if(this.GetParent()){const t=this.GetTriggerParents();for(let s=0,i=t.length;s<i;++s)if(!(yield*t[s].DebugRunPreTrigger(e)))return!1}return!0}_EvaluateFunctionCallParameters(e,t,s){if(t.length>0)if(s){const s=t.map((e=>e.Get(0)));e.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(s)}else this._scopeParent.EvaluateFunctionParameters(t);else s&&e.GetLocalVarStack().Push()}RunAsFunctionCall(e,t,s,i){let r,n;const a=e.length>0;let o=null;const h=this._runtime,l=this._eventStack,c=h.GetEventSheetManager(),u=c._IncTriggerDepth()>1;this._EvaluateFunctionCallParameters(c,t,u),a&&(s?c.PushCopySol(e):c.PushCleanSol(e)),null!==i&&(i.toFamily?i.toFamily.GetCurrentSol().Copy(i.fromObjectType.GetCurrentSol()):i.pickObjectClass?i.pickObjectClass.GetCurrentSol().SetArrayPicked(i.pickInstances):i.pushCleanSolDynamic&&(o=c.PushCleanSolDynamic(e)));const _=l.Push(this);if(s&&_.SetDynamicSolModifiers(e),this._CheckParentsOKToRun(_)){_.SetCurrentEvent(this);const e=this._scopeParent.IsAsync();e&&([n,r]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(_),e&&this._scopeParent.MaybeFinishAsyncFunctionCall(n)}return l.Pop(),u&&c.GetLocalVarStack().Pop(),null!==o&&c.PopSol(o),a&&c.PopSol(e),c._DecTriggerDepth(),r}*DebugRunAsFunctionCall(e,t,s,i){let r,n;(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this);const a=e.length>0;let o=null;const h=this._runtime,l=this._eventStack,c=h.GetEventSheetManager(),u=c._IncTriggerDepth()>1;this._EvaluateFunctionCallParameters(c,t,u),a&&(s?c.PushCopySol(e):c.PushCleanSol(e)),null!==i&&(i.toFamily?i.toFamily.GetCurrentSol().Copy(i.fromObjectType.GetCurrentSol()):i.pickObjectClass?i.pickObjectClass.GetCurrentSol().SetArrayPicked(i.pickInstances):i.pushCleanSolDynamic&&(o=c.PushCleanSolDynamic(e)));const _=l.Push(this);if(s&&_.SetDynamicSolModifiers(e),yield*this._DebugCheckParentsOKToRun(_)){_.SetCurrentEvent(this);const e=this._scopeParent.IsAsync();e&&([n,r]=this._scopeParent.StartAsyncFunctionCall()),yield*this._DebugRunAndBlock(_),e&&this._scopeParent.MaybeFinishAsyncFunctionCall(n)}return l.Pop(),u&&c.GetLocalVarStack().Pop(),null!==o&&c.PopSol(o),a&&c.PopSol(e),c._DecTriggerDepth(),r}RunAsMappedFunctionCall(e,t){const s=this.GetSolModifiersIncludingParents(),i=s.length>0,r=this._runtime,n=this._eventStack,a=r.GetEventSheetManager(),o=a._IncTriggerDepth()>1;o&&a.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),i&&(t?a.PushCopySol(s):a.PushCleanSol(s));const h=n.Push(this);this._CheckParentsOKToRun(h)&&(h.SetCurrentEvent(this),this._RunAndBlock(h)),n.Pop(),o&&a.GetLocalVarStack().Pop(),i&&a.PopSol(s),a._DecTriggerDepth()}*DebugRunAsMappedFunctionCall(e,t){(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this);const s=this.GetSolModifiersIncludingParents(),i=s.length>0,r=this._runtime,n=this._eventStack,a=r.GetEventSheetManager(),o=a._IncTriggerDepth()>1;o&&a.GetLocalVarStack().Push(),this._scopeParent.SetFunctionParameters(e),i&&(t?a.PushCopySol(s):a.PushCleanSol(s));const h=n.Push(this);(yield*this._DebugCheckParentsOKToRun(h))&&(h.SetCurrentEvent(this),yield*this._DebugRunAndBlock(h)),n.Pop(),o&&a.GetLocalVarStack().Pop(),i&&a.PopSol(s),a._DecTriggerDepth()}RunAsExpressionFunctionCall(e,t,s,i,...r){let n,a;const o=e.length>0,h=this._runtime,l=this._eventStack,c=h.GetEventSheetManager(),u=c._IncTriggerDepth()>1;u&&c.GetLocalVarStack().Push(),r.length>0&&this._scopeParent.SetFunctionParameters(r),o&&(t?c.PushCopySol(e):c.PushCleanSol(e));const _=l.Push(this);if(_.InitCallFunctionExpression(s,i),l.PushExpFunc(_),h.SetDebuggingEnabled(!1),this._CheckParentsOKToRun(_)){_.SetCurrentEvent(this);const e=this._scopeParent.IsAsync();e&&([a,n]=this._scopeParent.StartAsyncFunctionCall()),this._RunAndBlock(_),e&&this._scopeParent.MaybeFinishAsyncFunctionCall(a)}return h.SetDebuggingEnabled(!0),l.Pop(),l.PopExpFunc(),u&&c.GetLocalVarStack().Pop(),o&&c.PopSol(e),c._DecTriggerDepth(),n||_.GetFunctionReturnValue()}}}{const e=self.C3,t=[];let s=!1;e.EventScript=class extends e.DefendedBase{constructor(e,t,s){super();const i=e.GetRuntime(),r=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=r,this._runtime=e.GetRuntime(),this._parent=t;const n=i.GetObjectReference(s[1]);this._func=n,this._displayNumber=s[2],this._eventSheet._RegisterEventByDisplayNumber(this,this._displayNumber),this._debugData=i.IsDebug()?{isBreakpoint:s[3][0],isBreakable:s[3][1]}:null}static Create(t,s,i){return e.New(e.EventScript,t,s,i)}_PostInit(){const e=this._func,t=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this);this._func=e.bind(null,this._runtime.GetIRuntime(),t)}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetEventSheet(){return this._eventSheet}GetDisplayNumber(){return this._displayNumber}IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable}IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint}_SetDebugBreakpoint(e){this._debugData.isBreakpoint=!!e}IsElseBlock(){return!1}GetSolModifiers(){return t}GetSolModifiersIncludingParents(){return this._parent?this._parent.GetSolModifiersIncludingParents():t}Run(e){e.SetCurrentEvent(this),this._eventSheetManager.AddAsyncActionPromise(this._RunUserScript())}async _RunUserScript(){try{await this._func()}catch(e){self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),s||(s=!0)}}*DebugRun(e){e.SetCurrentEvent(this),(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.Run(e)}DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()}static HadUserScriptException(){return s}static SetHadUserScriptException(){s=!0}}}{const e=self.C3,t=self.assert;e.FunctionBlock=class extends e.DefendedBase{constructor(t,s,i){super(),this._eventSheet=t,this._runtime=t.GetRuntime(),this._parent=s,this._functionType=0,this._functionName="",this._returnType=0,this._functionParameters=[],this._isEnabled=!0,this._aceName="",this._objectClass=null,this._hasOverrides=!1,this._innerLocalVariables=[],this._isCopyPicked=!1,this._isAsync=!1,this._nextAsyncId=0,this._currentAsyncId=-1,this._asyncMap=new Map,this._eventBlock=e.EventBlock.Create(t,s,i),this._eventBlock._SetScopeParent(this)}InitFunctionBlock(t){this._functionType=0,this._functionName=t[0],this._returnType=t[1],this._functionParameters=t[2].map((t=>e.EventVariable.Create(this._eventSheet,this,t))),this._isEnabled=t[3],this._isAsync=t[4],this._isCopyPicked=t[5]}InitCustomACEBlock(t){this._functionType=1,this._aceName=t[1],this._objectClass=this._runtime.GetObjectClassByIndex(t[2]),this._eventBlock._AddSolModifier(this._objectClass),this._functionName=this._objectClass.GetName()+"."+this._aceName,this._returnType=t[3],this._functionParameters=t[4].map((t=>e.EventVariable.Create(this._eventSheet,this,t))),this._isEnabled=t[5],this._isAsync=t[6],this._isCopyPicked=!0,this._objectClass.AddCustomAction(this)}static CreateFunctionBlock(t,s,i){const r=e.New(e.FunctionBlock,t,s,i),n=i[1];return r.InitFunctionBlock(n),r}static CreateCustomACEBlock(t,s,i){const r=e.New(e.FunctionBlock,t,s,i),n=i[1];return r.InitCustomACEBlock(n),r}_CheckOverrideState(){if(this._objectClass&&this._objectClass.IsFamily())for(const e of this._objectClass.GetFamilyMembers())if(e.HasOwnCustomActionByName(this._aceName)){this._hasOverrides=!0;break}}_PostInit(){for(const e of this._functionParameters)e._PostInit();this._eventBlock._PostInit(!1)}GetFunctionType(){return this._functionType}_GetAllLocalVariablesInScope(){return this._functionParameters}GetFunctionParameters(){return this._functionParameters}GetFunctionParameterCount(){return this._functionParameters.length}_RegisterLocalVariable(e){this._innerLocalVariables.push(e)}_GetAllInnerLocalVariables(){return this._innerLocalVariables}EvaluateFunctionParameters(e){const t=this._functionParameters;for(let s=0,i=t.length;s<i;++s)t[s].SetValue(e[s].Get(0))}SetFunctionParameters(e){const t=this._functionParameters;for(let s=0,i=t.length;s<i;++s)t[s].SetValue(e[s])}CaptureFunctionParameters(){return this._functionParameters.map((e=>e.GetValue()))}GetParent(){return this._parent}GetScopeParent(){return this._parent}GetFunctionName(){return this._functionName}GetACEName(){return this._aceName}HasCustomACEOverrides(){return this._hasOverrides}GetReturnType(){return this._returnType}GetObjectClass(){return this._objectClass}IsEnabled(){return this._isEnabled}GetDefaultReturnValue(){switch(this._returnType){case 0:return null;case 2:return"";default:return 0}}GetEventBlock(){return this._eventBlock}IsCopyPicked(){return this._isCopyPicked}IsAsync(){return this._isAsync}StartAsyncFunctionCall(){const e=this._nextAsyncId++;let t;this._currentAsyncId=e;const s=new Promise((e=>t=e));return this._asyncMap.set(e,{resolve:t,pauseCount:0}),[e,s]}MaybeFinishAsyncFunctionCall(e){const t=this._asyncMap.get(e);0===t.pauseCount&&(t.resolve(),this._asyncMap.delete(e)),this._currentAsyncId=-1}PauseCurrentAsyncFunction(){return this._asyncMap.get(this._currentAsyncId).pauseCount++,this._currentAsyncId}ResumeAsyncFunction(e){this._currentAsyncId=e;this._asyncMap.get(e).pauseCount--}RunAsFamilyCustomActionWithOverrides(e,t){const s=new Map,i=[];for(const e of this._objectClass.GetCurrentSol().GetInstances()){const t=e.GetObjectClass();if(t.HasOwnCustomActionByName(this._aceName)){const i=s.get(t);Array.isArray(i)?i.push(e):s.set(t,[e])}else i.push(e)}if(i.length>0&&this._eventBlock.RunAsFunctionCall(e,t,!0,{pickObjectClass:this._objectClass,pickInstances:i}),s.size>0)for(const[i,r]of s){const s=i.GetOwnCustomActionByName(this._aceName).GetEventBlock(),n=[...new Set([...e,...s.GetSolModifiers()])];s.RunAsFunctionCall(n,t,!0,{pickObjectClass:i,pickInstances:r})}}*DebugRunAsFamilyCustomActionWithOverrides(e,t){const s=new Map,i=[];for(const e of this._objectClass.GetCurrentSol().GetInstances()){const t=e.GetObjectClass();if(t.HasOwnCustomActionByName(this._aceName)){const i=s.get(t);Array.isArray(i)?i.push(e):s.set(t,[e])}else i.push(e)}if(i.length>0&&(yield*this._eventBlock.DebugRunAsFunctionCall(e,t,!0,{pickObjectClass:this._objectClass,pickInstances:i})),s.size>0)for(const[i,r]of s){const s=i.GetOwnCustomActionByName(this._aceName).GetEventBlock(),n=[...new Set([...e,...s.GetSolModifiers()])];yield*s.DebugRunAsFunctionCall(n,t,!0,{pickObjectClass:i,pickInstances:r})}}}}{const e=self.C3,t=[];e.EventVariable=class extends e.DefendedBase{constructor(t,s,i){super();const r=t.GetEventSheetManager();this._eventSheet=t,this._eventSheetManager=r,this._runtime=t.GetRuntime(),this._parent=s,this._localVarStack=r.GetLocalVarStack(),this._name=i[1],this._type=i[2],this._initialValue=i[3],this._isStatic=!!i[4],this._isConstant=!!i[5],this._isFunctionParameter=s instanceof e.FunctionBlock,this._sid=i[6],this._jsPropName=this._runtime.GetJsPropName(i[8]),this._scriptSetter=e=>this.SetValue(e),this._scriptGetter=()=>this.GetValue(),this._hasSingleValue=!this._parent||this._isStatic||this._isConstant,this._value=this._initialValue,this._localIndex=-1,this.IsBoolean()&&(this._value=this._value?1:0),!this.IsLocal()||this.IsStatic()||this.IsConstant()||(this._localIndex=r._GetNextLocalVarIndex(this)),r._RegisterEventVariable(this)}static Create(t,s,i){return e.New(e.EventVariable,t,s,i)}_PostInit(){if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant()&&!this.IsFunctionParameter()){const e=this._eventSheetManager.FindFirstFunctionBlockParent(this);e&&e._RegisterLocalVariable(this)}}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetParent(){return this._parent}GetScopeParent(){return this.GetParent()}IsGlobal(){return!this.GetParent()}IsLocal(){return!this.IsGlobal()}IsFunctionParameter(){return this._isFunctionParameter}IsStatic(){return this._isStatic}IsConstant(){return this._isConstant}IsNumber(){return 0===this._type}IsString(){return 1===this._type}IsBoolean(){return 2===this._type}IsElseBlock(){return!1}GetSID(){return this._sid}GetInitialValue(){return this._initialValue}GetSolModifiers(){return t}Run(e){!this.IsLocal()||this.IsStatic()||this.IsConstant()||this.SetValue(this.GetInitialValue())}DebugCanRunFast(){return!0}*DebugRun(e){this.Run(e)}SetValue(e){this.IsNumber()?"number"!=typeof e&&(e=parseFloat(e)):this.IsString()?"string"!=typeof e&&(e=e.toString()):this.IsBoolean()&&(e=e?1:0),this._hasSingleValue?this._value=e:this._localVarStack.GetCurrent()[this._localIndex]=e}GetValue(){return this._hasSingleValue?this._value:this._localVarStack.GetCurrent()[this._localIndex]}GetTypedValue(){let e=this.GetValue();return this.IsBoolean()&&(e=!!e),e}ResetToInitialValue(){this._value=this._initialValue}_GetScriptInterfaceDescriptor(){return{configurable:!1,enumerable:!0,get:this._scriptGetter,set:this._scriptSetter}}}}{const e=self.C3,t=self.assert,s=[];e.EventInclude=class extends e.DefendedBase{constructor(e,t,s){super();const i=e.GetEventSheetManager();this._eventSheet=e,this._eventSheetManager=i,this._runtime=e.GetRuntime(),this._parent=t,this._includeSheet=null,this._includeSheetName=s[1],this._isActive=!0}static Create(t,s,i){return e.New(e.EventInclude,t,s,i)}_PostInit(){this._includeSheet=this._eventSheetManager.GetEventSheetByName(this._includeSheetName),this._eventSheet._AddShallowInclude(this);let t=this.GetParent();for(;t;)t instanceof e.EventBlock&&t.IsGroup()&&t._AddContainedInclude(this),t=t.GetParent();this.UpdateActive(),this._runtime.IsDebug()&&this._eventSheet._GetPerfRecord().children.push(this._includeSheet._GetPerfRecord())}GetParent(){return this._parent}GetSolModifiers(){return s}GetIncludeSheet(){return this._includeSheet}Run(e){const t=!!this.GetParent(),s=this._runtime.GetAllObjectClasses();t&&this._eventSheetManager.PushCleanSol(s),this._includeSheet.Run(),t&&this._eventSheetManager.PopSol(s)}*DebugRun(e){const t=!!this.GetParent(),s=this._runtime.GetAllObjectClasses();t&&this._eventSheetManager.PushCleanSol(s),yield*this._includeSheet.DebugRun(),t&&this._eventSheetManager.PopSol(s)}DebugCanRunFast(){return!1}IsActive(){return this._isActive}UpdateActive(){let t=this.GetParent();for(;t;){if(t instanceof e.EventBlock&&t.IsGroup()&&!t.IsGroupActive())return void(this._isActive=!1);t=t.GetParent()}this._isActive=!0}}}{const e=self.C3,t=self.assert;e.ExpNode=class extends e.DefendedBase{constructor(e){super(),this._owner=e,this._runtime=e.GetRuntime()}_PostInit(){}static CreateNode(t,h){const l=h[0],c=[a,r,n,o,s,i];return e.New(c[l],t,h)}};class s extends e.ExpNode{constructor(t,s){super(t),this._systemPlugin=this._runtime.GetSystemPlugin(),this._func=this._runtime.GetObjectReference(s[1]),this._func!==e.Plugins.System.Exps.random&&this._func!==e.Plugins.System.Exps.choose||this._owner.SetVariesPerInstance()}GetBoundMethod(){return this._systemPlugin._GetBoundACEMethod(this._func,this._systemPlugin)}}class i extends e.ExpNode{constructor(e,t){super(e),this._functionBlock=null,this._functionName=t[1],this._owner.SetVariesPerInstance()}_PostInit(){const e=this._runtime.GetEventSheetManager();this._functionBlock=e.GetFunctionBlockByName(this._functionName),this._functionName=null;const t=this._owner.GetEventBlock(),s=this._functionBlock.GetEventBlock();this._combinedSolModifiers=[...new Set([...t.GetSolModifiersIncludingParents(),...s.GetSolModifiersIncludingParents()])],this._combinedSolModifiers=e._DeduplicateSolModifierList(this._combinedSolModifiers)}GetBoundMethod(){const t=this._functionBlock;if(t.IsEnabled()){const s=t.GetEventBlock();return e.EventBlock.prototype.RunAsExpressionFunctionCall.bind(s,this._combinedSolModifiers,t.IsCopyPicked(),t.GetReturnType(),t.GetDefaultReturnValue())}{const e=t.GetDefaultReturnValue();return()=>e}}}function WrapIndex(e,t){return e>=t?e%t:e<0?(e<=-t&&(e%=t),e<0&&(e+=t),e):e}class r extends e.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._func=this._runtime.GetObjectReference(t[2]),this._returnsString=!!t[3],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}GetBoundMethod(){return this._objectClass.GetPlugin()._GetBoundACEMethod(this._func,this._objectClass.GetSingleGlobalInstance().GetSdkInstance())}ExpObject(...e){const t=this._objectClass,s=t.GetCurrentSol().GetExpressionInstances(),i=s.length;if(0===i)return this._returnsString?"":0;const r=WrapIndex(this._owner.GetSolIndex(),i);return this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t),this._func.apply(s[r].GetSdkInstance(),e)}ExpObject_InstExpr(e,...t){const s=this._objectClass,i=s.GetInstances(),r=i.length;if(0===r)return this._returnsString?"":0;const n=WrapIndex(e,r);return this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(s),this._func.apply(i[n].GetSdkInstance(),t)}}class n extends e.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._varIndex=t[3],this._returnsString=!!t[2],this._owner._MaybeVaryFor(this._objectClass)}ExpInstVar(){const e=this._objectClass.GetCurrentSol().GetExpressionInstances(),t=e.length;if(0===t)return this._returnsString?"":0;return e[WrapIndex(this._owner.GetSolIndex(),t)]._GetInstanceVariableValueUnchecked(this._varIndex)}ExpInstVar_Family(){const e=this._objectClass,t=e.GetCurrentSol().GetExpressionInstances(),s=t.length;if(0===s)return this._returnsString?"":0;const i=t[WrapIndex(this._owner.GetSolIndex(),s)],r=i.GetObjectClass().GetFamilyInstanceVariableOffset(e.GetFamilyIndex());return i._GetInstanceVariableValueUnchecked(this._varIndex+r)}ExpInstVar_InstExpr(e){const t=this._objectClass,s=t.GetInstances(),i=s.length;if(0===i)return this._returnsString?"":0;const r=s[WrapIndex(e,i)];let n=0;return t.IsFamily()&&(n=r.GetObjectClass().GetFamilyInstanceVariableOffset(t.GetFamilyIndex())),r._GetInstanceVariableValueUnchecked(this._varIndex+n)}}class a extends e.ExpNode{constructor(e,t){super(e),this._objectClass=this._runtime.GetObjectClassByIndex(t[1]),this._behaviorType=this._objectClass.GetBehaviorTypeByName(t[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(t[2]),this._func=this._runtime.GetObjectReference(t[3]),this._returnsString=!!t[4],this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._owner._MaybeVaryFor(this._objectClass)}ExpBehavior(...e){const t=this._objectClass,s=t.GetCurrentSol().GetExpressionInstances(),i=s.length;if(0===i)return this._returnsString?"":0;const r=WrapIndex(this._owner.GetSolIndex(),i);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(t);const n=s[r];let a=0;return t.IsFamily()&&(a=n.GetObjectClass().GetFamilyBehaviorOffset(t.GetFamilyIndex())),this._func.apply(n.GetBehaviorInstances()[this._behaviorIndex+a].GetSdkInstance(),e)}ExpBehavior_InstExpr(e,...t){const s=this._objectClass,i=s.GetInstances(),r=i.length;if(0===r)return this._returnsString?"":0;const n=WrapIndex(e,r);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(s);const a=i[n];let o=0;return s.IsFamily()&&(o=a.GetObjectClass().GetFamilyBehaviorOffset(s.GetFamilyIndex())),this._func.apply(a.GetBehaviorInstances()[this._behaviorIndex+o].GetSdkInstance(),t)}}class o extends e.ExpNode{constructor(e,t){super(e),this._eventVar=null,this._eventVarSid=t[1]}_PostInit(){this._eventVar=this._runtime.GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetVar(){return this._eventVar}}}{const e=self.C3,t=self.assert;function GetExpressionFunc(e){const t=self.C3_ExpressionFuncs[e];if(!t)throw new Error("invalid expression number");return t}e.Parameter=class extends e.DefendedBase{constructor(e,t,s){super(),this._owner=e,this._index=s,this._type=t,this.Get=null,this._variesPerInstance=!1,this._isConstant=!1}static Create(t,S,y){const G=S[0],I=[s,i,c,n,o,r,h,s,n,n,u,_,c,p,i,l,a,d,f,m,g];return e.New(I[G],t,G,y,S)}_PostInit(){}SetVariesPerInstance(){this._variesPerInstance=!0}_MaybeVaryFor(e){this._variesPerInstance||e&&(e.GetPlugin().IsSingleGlobal()||(this._variesPerInstance=!0))}VariesPerInstance(){return this._variesPerInstance}GetIndex(){return this._index}GetRuntime(){return this._owner.GetRuntime()}GetEventBlock(){return this._owner.GetEventBlock()}IsConstant(){return this._isConstant}};class s extends e.Parameter{constructor(t,s,i,r){super(t,s,i),this._solIndex=0;const n=r[1];this._expressionNumber=n[0],this._numberedNodes=[],this._expressionFunc=null;for(let t=1,s=n.length;t<s;++t)this._numberedNodes.push(e.ExpNode.CreateNode(this,n[t]));this._numberedNodes.length?this.Get=this.GetExpression:(this.Get=GetExpressionFunc(this._expressionNumber),this._isConstant=!0)}_GetNode(e){if(e<0||e>=this._numberedNodes.length)throw new RangeError("invalid numbered node");return this._numberedNodes[e]}_PostInit(){for(const e of this._numberedNodes)e._PostInit();const e=GetExpressionFunc(this._expressionNumber);this._numberedNodes.length?this._expressionFunc=e(this):this._expressionFunc=e}GetSolIndex(){return this._solIndex}GetExpression(e){return this._solIndex=e,this._expressionFunc()}}class i extends s{constructor(t,s,i,r){super(t,s,i,r),this.Get=this.GetStringExpression,14===s&&(this.GetEventBlock().SetAllSolModifiers(),this._owner instanceof e.Action&&this.GetEventBlock().SetSolWriterAfterCnds())}GetStringExpression(e){this._solIndex=e;const t=this._expressionFunc();return"string"==typeof t?t:""}_GetFastTriggerValue(){return GetExpressionFunc(this._expressionNumber)()}}class r extends s{constructor(e,t,s,i){super(e,t,s,i),this.Get=this.GetLayer,this._isConstant=!1}GetLayer(e){this._solIndex=e;const t=this._expressionFunc();return this.GetRuntime().GetCurrentLayout().GetLayer(t)}}class n extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._combo=i[1],this.Get=this.GetCombo,this._isConstant=!0}GetCombo(){return this._combo}}class a extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._bool=i[1],this.Get=this.GetBoolean,this._isConstant=!0}GetBoolean(){return this._bool}}class o extends e.Parameter{constructor(t,s,i,r){super(t,s,i),this._objectClass=this.GetRuntime().GetObjectClassByIndex(r[1]),this.Get=this.GetObjectClass;const n=this.GetEventBlock();n._AddSolModifier(this._objectClass),this._owner instanceof e.Action?n.SetSolWriterAfterCnds():n.GetParent()&&n.GetParent().SetSolWriterAfterCnds(),this._isConstant=!0}GetObjectClass(){return this._objectClass}}class h extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._layout=this.GetRuntime().GetLayoutManager().GetLayoutByName(i[1]),this.Get=this.GetLayout,this._isConstant=!0}GetLayout(){return this._layout}}class l extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._timeline=this.GetRuntime().GetTimelineManager().GetTimelineByName(i[1]),this.Get=this.GetTimeline,this._isConstant=!0}GetTimeline(){return this._timeline}}class c extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._fileInfo=i[1],this.Get=this.GetFile,this._isConstant=!0}GetFile(){return this._fileInfo}}class u extends e.Parameter{constructor(t,s,i,r){super(t,s,i),this._instVarIndex=r[1];const n=this._owner.GetObjectClass();this._owner instanceof e.Condition&&this._owner.IsStatic()?(this.Get=this.GetInstanceVariable,this._isConstant=!0):n&&n.IsFamily()?(this.Get=this.GetFamilyInstanceVariable,this.SetVariesPerInstance()):(this.Get=this.GetInstanceVariable,this._isConstant=!0)}GetInstanceVariable(){return this._instVarIndex}GetFamilyInstanceVariable(e){e=e||0;const t=this._owner.GetObjectClass(),s=t.GetCurrentSol(),i=s.GetInstances();let r=null;if(i.length)r=i[e%i.length].GetObjectClass();else if(s.HasAnyElseInstances()){const t=s.GetElseInstances();r=t[e%t.length].GetObjectClass()}else{if(!(t.GetInstanceCount()>0))return 0;{const s=t.GetInstances();r=s[e%s.length].GetObjectClass()}}return this._instVarIndex+r.GetFamilyInstanceVariableOffset(t.GetFamilyIndex())}}class _ extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._eventVarSid=i[1],this._eventVar=null,this.Get=this.GetEventVariable,this._isConstant=!0}_PostInit(){this._eventVar=this.GetRuntime().GetEventSheetManager().GetEventVariableBySID(this._eventVarSid)}GetEventVariable(){return this._eventVar}}class d extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._functionBlockName=i[1],this._functionBlock=null,this.Get=this.GetFunction,this._isConstant=!0}_PostInit(){this._functionBlock=this.GetRuntime().GetEventSheetManager().GetFunctionBlockByName(this._functionBlockName),this._functionBlockName=null}GetFunction(){return this._functionBlock}}class p extends e.Parameter{constructor(t,s,i,r){super(t,s,i),this._subParams=[],this._variadicRet=[],this._isConstant=!0;for(let t=1,s=r.length;t<s;++t){const s=e.Parameter.Create(this._owner,r[t],0);this._subParams.push(s),this._variadicRet.push(0),s.IsConstant()||(this._isConstant=!1)}this.Get=this.GetVariadic}_PostInit(){for(const e of this._subParams)e._PostInit()}GetVariadic(){const e=this._subParams,t=this._variadicRet;for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(0);return t}}class f extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._easeIndex=i[1],this.Get=this.GetEase,this._isConstant=!0}GetEase(){return this._easeIndex}}class m extends e.Parameter{constructor(e,t,s,i){super(e,t,s),this._brushIndex=i[1],this.Get=this.GetTilemapBrush,this._isConstant=!0}GetTilemapBrush(){return this._brushIndex}}class g extends s{constructor(e,t,s,i){super(e,t,s,i),this.Get=this.GetTemplateName,this._isConstant=!1}GetTemplateName(){return this._expressionFunc()}}}{const e=self.C3,t=self.assert;function EvalParams(e,t){for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(0)}const s=[],i=function(){};e.Condition=class extends e.DefendedBase{constructor(t,r,n){if(super(),this._eventBlock=t,this._runtime=t.GetRuntime(),this._index=n,this._func=this._runtime.GetObjectReference(r[1]),this._isTrigger=r[3]>0,this._isFastTrigger=2===r[3],this._isLooping=!!r[4],this._isInverted=!!r[5],this._isStatic=!!r[6],this._sid=r[7],this._isInOrBlock=this._eventBlock.IsOrBlock(),this._objectClass=null,this._behaviorType=null,this._behaviorIndex=-1,this._systemPlugin=null,this.Run=i,this.DebugRun=i,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._savedData=null,this._unsavedData=null,this._debugData=this._runtime.IsDebug()?{isBreakpoint:r[8][0],canDebug:r[8][1]}:null,-1===r[0]?this._systemPlugin=this._runtime.GetSystemPlugin():(this._objectClass=this._runtime.GetObjectClassByIndex(r[0]),r[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(r[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(r[2])),this._eventBlock.GetParent()&&this._eventBlock.GetParent().SetSolWriterAfterCnds()),10===r.length){let t=r[9];for(let s of t)this._parameters.push(e.Parameter.Create(this,s,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._parameters=s,this._results=s),this._eventBlock.GetEventSheetManager()._RegisterCondition(this)}static Create(t,s,i){return e.New(e.Condition,t,s,i)}_PostInit(){for(const e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);this._isFastTrigger?(this.Run=this._RunFastTrigger,this.DebugRun=this._DebugRunFastTrigger):this._systemPlugin?(this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this._isStatic?(this.Run=this._RunStatic,this.DebugRun=this._DebugRunStatic):(this.Run=this._RunObject,this.DebugRun=this._DebugRunObject)}_SetSystemRunMethod(){const e=this._systemPlugin,t=this._systemPlugin;this._SetRunMethodForBoundFunc(e,t,this._RunSystem)}_SetSingleGlobalRunMethod(){const e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetRunMethodForBoundFunc(t,s,i){const r=this._func,n=this._isInverted,a=this._parameters;if(0===a.length){const i=t._GetBoundACEMethod(r,s);this.Run=n?function(){return e.xor(i(),n)}:i}else if(1===a.length){const i=a[0];if(!n&&i.IsConstant())this.Run=t._GetBoundACEMethod_1param(r,s,i.Get(0));else{const a=t._GetBoundACEMethod(r,s);this.Run=function(){return e.xor(a(i.Get(0)),n)}}}else if(2===a.length){const i=a[0],o=a[1];if(!n&&i.IsConstant()&&o.IsConstant())this.Run=t._GetBoundACEMethod_2params(r,s,i.Get(0),o.Get(0));else{const a=t._GetBoundACEMethod(r,s);this.Run=function(){return e.xor(a(i.Get(0),o.Get(0)),n)}}}else if(3===a.length){const i=a[0],o=a[1],h=a[2];if(!n&&i.IsConstant()&&o.IsConstant()&&h.IsConstant())this.Run=t._GetBoundACEMethod_3params(r,s,i.Get(0),o.Get(0),h.Get(0));else{const a=t._GetBoundACEMethod(r,s);this.Run=function(){return e.xor(a(i.Get(0),o.Get(0),h.Get(0)),n)}}}else this.Run=i}GetSID(){return this._sid}_GetFunc(){return this._func}GetObjectClass(){return this._objectClass}GetBehaviorType(){return this._behaviorType}GetEventBlock(){return this._eventBlock}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this.GetIndex()}IsTrigger(){return this._isTrigger}IsFastTrigger(){return this._isFastTrigger}IsInverted(){return this._isInverted}IsLooping(){return this._isLooping}IsStatic(){return this._isStatic}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){const t=this._results;return EvalParams(this._parameters,t),e.xor(this._func.apply(this._systemPlugin,t),this._isInverted)}*_DebugRunSystem(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const t=this._results;EvalParams(this._parameters,t);let s=this._func.apply(this._systemPlugin,t);return e.IsIterator(s)&&(s=yield*s),e.xor(s,this._isInverted)}return this.Run()}_RunSingleGlobal(){const t=this._results;EvalParams(this._parameters,t);const s=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();return e.xor(this._func.apply(s,t),this._isInverted)}*_DebugRunSingleGlobal(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const t=this._results;EvalParams(this._parameters,t);const s=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();let i=this._func.apply(s,t);return e.IsIterator(i)&&(i=yield*i),e.xor(i,this._isInverted)}return this.Run()}_RunFastTrigger(){return!0}*_DebugRunFastTrigger(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),!0}_RunStatic(){const e=this._results;EvalParams(this._parameters,e);const t=this._func.apply(this._behaviorType||this._objectClass,e);return this._objectClass.ApplySolToContainer(),t}*_DebugRunStatic(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const t=this._results;EvalParams(this._parameters,t);let s=this._func.apply(this._behaviorType||this._objectClass,t);return e.IsIterator(s)&&(s=yield*s),this._objectClass.ApplySolToContainer(),s}return this.Run()}_RunObject(){const e=this._parameters,t=this._results,s=this._objectClass.GetCurrentSol();for(let s=0,i=e.length;s<i;++s){const i=e[s];i.VariesPerInstance()||(t[s]=i.Get(0))}return s.IsSelectAll()?this._RunObject_FirstFilter(s):this._RunObject_NextFilter(s)}*_DebugRunObject(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._RunObject()}_EvaluateVaryingParameters(e){const t=this._parameters,s=this._results;for(let i=0,r=t.length;i<r;++i){const r=t[i];r.VariesPerInstance()&&(s[i]=r.Get(e))}}_RunObject_FirstFilter(t){const s=this._objectClass,i=s.IsFamily(),r=s.GetFamilyIndex(),n=this._behaviorIndex,a=n>=0,o=s.GetInstances(),h=this._anyParamVariesPerInstance,l=this._results,c=this._func,u=this._isInverted,_=this._isInOrBlock&&!this._isTrigger;t.ClearArrays();for(let s=0,d=o.length;s<d;++s){const d=o[s];let p;if(h&&this._EvaluateVaryingParameters(s),a){const e=i?d.GetObjectClass().GetFamilyBehaviorOffset(r):0;p=c.apply(d.GetBehaviorInstances()[n+e].GetSdkInstance(),l)}else p=c.apply(d.GetSdkInstance(),l);e.xor(p,u)?t._PushInstance(d):_&&t._PushElseInstance(d)}return s.FinishCondition(!0),t._SetSelectAll(!1),s.ApplySolToContainer(),t.HasAnyInstances()}_RunObject_NextFilter(t){const s=this._objectClass,i=s.IsFamily(),r=s.GetFamilyIndex(),n=s.IsInContainer(),a=this._behaviorIndex,o=a>=0,h=this._anyParamVariesPerInstance,l=this._results,c=this._func,u=this._isInverted,_=this._isInOrBlock&&!this._isTrigger,d=t._GetOwnInstances(),p=t._GetOwnElseInstances(),f=_&&!this._eventBlock.IsFirstConditionOfType(this),m=f?p:d;let g=0,S=!1;for(let t=0,s=m.length;t<s;++t){const s=m[t];let y;if(h&&this._EvaluateVaryingParameters(t),o){const e=i?s.GetObjectClass().GetFamilyBehaviorOffset(r):0;y=c.apply(s.GetBehaviorInstances()[a+e].GetSdkInstance(),l)}else y=c.apply(s.GetSdkInstance(),l);e.xor(y,u)?(S=!0,f?(d.push(s),n&&s._PushSiblingsToSolInstances()):(m[g]=s,n&&s._SetSiblingsToSolInstancesIndex(g),++g)):f?(m[g]=s,n&&s._SetSiblingsToSolElseInstancesIndex(g),++g):_&&(p.push(s),n&&s._PushSiblingsToSolElseInstances())}e.truncateArray(m,g),n&&s._TruncateContainerSols(f,g);const y=S;return f&&!S&&(S=this._OrBlockCheckInstances(d)),s.FinishCondition(y||_),_?S:t.HasAnyInstances()}_OrBlockCheckInstances(t){const s=this._objectClass,i=s.IsFamily(),r=s.GetFamilyIndex(),n=this._anyParamVariesPerInstance,a=this._behaviorIndex,o=a>=0,h=this._results,l=this._func,c=this._isInverted;for(let s=0,u=t.length;s<u;++s){const u=t[s];let _;if(n&&this._EvaluateVaryingParameters(s),o){const e=i?u.GetObjectClass().GetFamilyBehaviorOffset(r):0;_=l.apply(u.GetBehaviorInstances()[a+e].GetSdkInstance(),h)}else _=l.apply(u.GetSdkInstance(),h);if(e.xor(_,c))return!0}return!1}ReevaluateParameter(e,t){return this._parameters[e].Get(t)}GetFastTriggerValue(){const e=this._parameters;if(!e.length)throw new Error("no parameters");return e[0]._GetFastTriggerValue()}_SaveToJson(){if(!this._savedData||!this._savedData.size)return null;const e={};for(const[t,s]of this._savedData.entries()){let i=s;"collmemory"===t&&(i=[...s.entries()].map((e=>[e[0].GetUID(),e[1].GetUID(),e[2]]))),e[t]=i}return{ex:e}}_LoadFromJson(t){if(this._savedData&&(this._savedData.clear(),this._savedData=null),!t)return;const s=this._runtime,i=t.ex;if(i){const t=this.GetSavedDataMap();t.clear();for(const[r,n]of Object.entries(i)){let i=n;"collmemory"===r&&(i=e.New(e.PairMap,n.map((e=>[s.GetInstanceByUID(e[0]),s.GetInstanceByUID(e[1]),e[2]])).filter((e=>e[0]&&e[1])))),t.set(r,i)}}}}}{const e=self.C3,t=self.assert;function EvalParams(e,t){for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(0)}const s=[],i=function(){},r=function*(){},n=1,a=2,o=4;e.Action=class extends e.DefendedBase{constructor(t,r,n){super(),this._eventBlock=t;const a=t.GetRuntime();this._runtime=a,this._index=n,this._sid=r.length>=4?r[3]:-1,this._actionType=r.length>=5?255&r[4]:0,this._flags=r.length>=5?r[4]>>8:0,this._func=null,this._objectClass=null,this._behaviorType=null,this._behaviorIndex=-1,this._systemPlugin=null,this._callFunctionName="",this._callCustomAceObjectClass=null,this._callEventBlock=null,this.Run=i,this.DebugRun=i,this._parameters=[],this._results=[],this._anyParamVariesPerInstance=!1,this._savedData=null,this._unsavedData=null;const h=-3===r[0],l=h?r[2]:r[5];if(this._debugData=a.IsDebug()||h?{isBreakpoint:l[0],canDebug:l[1],index:l[2]}:null,-1===r[0])this._systemPlugin=a.GetSystemPlugin(),this._func=a.GetObjectReference(r[1]);else if(-2===r[0])this._callFunctionName=r[1];else if(h){const e=a.GetObjectReference(r[1]);this._func=e,this.Run=this.RunUserScript,this.DebugRun=this.DebugRunUserScript,this._actionType=1}else this._objectClass=a.GetObjectClassByIndex(r[0]),this._flags&o?(this._callFunctionName=r[1],this._callCustomAceObjectClass=a.GetObjectClassByIndex(r[2])):(r[2]&&(this._behaviorType=this._objectClass.GetBehaviorTypeByName(r[2]),this._behaviorIndex=this._objectClass.GetBehaviorIndexByName(r[2])),this._func=a.GetObjectReference(r[1]));if(7===r.length){const t=r[6];for(const s of t)this._parameters.push(e.Parameter.Create(this,s,this._parameters.length)),this._results.push(0)}0===this._parameters.length&&(this._parameters=s,this._results=s),this.CanPickAnyObjectClass()&&(this._eventBlock.SetAllSolModifiers(),this._eventBlock.SetSolWriterAfterCnds()),this._eventBlock.GetEventSheetManager()._RegisterAction(this)}static Create(t,s,i){return e.New(e.Action,t,s,i)}_PostInit(){for(const e of this._parameters)e._PostInit(),e.VariesPerInstance()&&(this._anyParamVariesPerInstance=!0);if(this._systemPlugin)this._SetSystemRunMethod(),this.DebugRun=this._DebugRunSystem;else if(this._callFunctionName)this._flags&o?this._SetCallCustomActionRunMethod():this._SetCallFunctionRunMethod(),this._callFunctionName="",this._callCustomAceObjectClass=null;else if(this.Run===this.RunUserScript){const e=this._func,t=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this._eventBlock);this._func=e.bind(null,this._runtime.GetIRuntime(),t)}else this._behaviorType?this.IsAsync()?(this.Run=this._RunBehavior_Async,this.DebugRun=this._DebugRunBehavior_Async):(this.Run=this._RunBehavior,this.DebugRun=this._DebugRunBehavior):this._objectClass.GetPlugin().IsSingleGlobal()?(this._SetSingleGlobalRunMethod(),this.DebugRun=this._DebugRunSingleGlobal):this.IsAsync()?(this.Run=this._RunObject_Async,this.DebugRun=this._DebugRunObject_Async):this.CallBeforeAfterHooks()?(this.Run=this._RunObject_BeforeAfterHooks,this.DebugRun=this._DebugRunObject_BeforeAfterHooks):this._parameters.length?this._parameters.every((e=>e.VariesPerInstance()))?(this.Run=this._RunObject_AllParamsVary,this.DebugRun=this._DebugRunObject_AllParamsVary):this._anyParamVariesPerInstance?(this.Run=this._RunObject_SomeParamsVary,this.DebugRun=this._DebugRunObject_SomeParamsVary):this._parameters.every((e=>e.IsConstant()))?(EvalParams(this._parameters,this._results),this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst):(this.Run=this._RunObject_ParamsDontVary,this.DebugRun=this._DebugRunObject_ParamsDontVary):(this.Run=this._RunObject_ParamsConst,this.DebugRun=this._DebugRunObject_ParamsConst)}_SetSystemRunMethod(){const e=this._systemPlugin,t=this._systemPlugin;this._SetRunMethodForBoundFunc(e,t,this._RunSystem)}_SetSingleGlobalRunMethod(){const e=this._objectClass.GetPlugin(),t=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(e,t,this._RunSingleGlobal)}_SetCallFunctionRunMethod(){const t=this._eventBlock.GetEventSheetManager(),s=t.GetFunctionBlockByName(this._callFunctionName);if(s.IsEnabled()){const i=0!=(this._flags&a);this._callEventBlock=s.GetEventBlock();let n=[...new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents()])];n=t._DeduplicateSolModifierList(n);const o=!s.IsCopyPicked()&&this._HasCopyPickedParent()?{pushCleanSolDynamic:!0}:null;if(this.Run=e.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,n,this._parameters,i,o),this._runtime.IsDebug()){const e=this;this.DebugRun=function*(){(e.IsBreakpoint()||e._runtime.DebugBreakNext())&&(yield e);return yield*e._callEventBlock.DebugRunAsFunctionCall(n,e._parameters,i,o)}}else this.DebugRun=r}else this.Run=i,this.DebugRun=r}_SetCallCustomActionRunMethod(){const t=this._eventBlock.GetEventSheetManager(),s=t.GetCustomActionBlockByName(this._callCustomAceObjectClass,this._callFunctionName);if(s.IsEnabled()){this._callEventBlock=s.GetEventBlock();let i=[...new Set([...this._eventBlock.GetSolModifiersIncludingParents(),...this._callEventBlock.GetSolModifiersIncludingParents(),this._objectClass,s.GetObjectClass()])];i=t._DeduplicateSolModifierList(i);const n=!this._objectClass.IsFamily()&&!s.GetObjectClass().IsFamily(),a=!this._objectClass.IsFamily()&&s.GetObjectClass().IsFamily(),o=this._objectClass.IsFamily();if(n||o&&!s.HasCustomACEOverrides()?this.Run=e.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,i,this._parameters,!0,null):a?this.Run=e.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,i,this._parameters,!0,{fromObjectType:this._objectClass,toFamily:s.GetObjectClass()}):o&&(this.Run=e.FunctionBlock.prototype.RunAsFamilyCustomActionWithOverrides.bind(s,i,this._parameters)),this._runtime.IsDebug()){const e=this;n||o&&!s.HasCustomACEOverrides()?this.DebugRun=function*(){(e.IsBreakpoint()||e._runtime.DebugBreakNext())&&(yield e);return yield*e._callEventBlock.DebugRunAsFunctionCall(i,e._parameters,!0,null)}:a?this.DebugRun=function*(){(e.IsBreakpoint()||e._runtime.DebugBreakNext())&&(yield e);return yield*e._callEventBlock.DebugRunAsFunctionCall(i,e._parameters,!0,{fromObjectType:e._objectClass,toFamily:s.GetObjectClass()})}:o&&(this.DebugRun=function*(){(e.IsBreakpoint()||e._runtime.DebugBreakNext())&&(yield e);return yield*s.DebugRunAsFamilyCustomActionWithOverrides(i,e._parameters)})}else this.DebugRun=r}else this.Run=i,this.DebugRun=r}_SetRunMethodForBoundFunc(e,t,s){const i=this._func,r=this._parameters;if(0===r.length)this.Run=e._GetBoundACEMethod(i,t);else if(1===r.length){const s=r[0];if(s.IsConstant())this.Run=e._GetBoundACEMethod_1param(i,t,s.Get(0));else{const r=e._GetBoundACEMethod(i,t);this.Run=function(){return r(s.Get(0))}}}else if(2===r.length){const s=r[0],n=r[1];if(s.IsConstant()&&n.IsConstant())this.Run=e._GetBoundACEMethod_2params(i,t,s.Get(0),n.Get(0));else{const r=e._GetBoundACEMethod(i,t);this.Run=function(){return r(s.Get(0),n.Get(0))}}}else if(3===r.length){const s=r[0],n=r[1],a=r[2];if(s.IsConstant()&&n.IsConstant()&&a.IsConstant())this.Run=e._GetBoundACEMethod_3params(i,t,s.Get(0),n.Get(0),a.Get(0));else{const r=e._GetBoundACEMethod(i,t);this.Run=function(){return r(s.Get(0),n.Get(0),a.Get(0))}}}else this.Run=s}GetSID(){return this._sid}IsAsync(){return 1===this._actionType}CanBailOut(){return 2===this._actionType}CallBeforeAfterHooks(){return 3===this._actionType}CanPickAnyObjectClass(){return 0!=(this._flags&n)}HasReturnType(){return this.IsAsync()||this.CanBailOut()}GetObjectClass(){return this._objectClass}GetEventBlock(){return this._eventBlock}_HasCopyPickedParent(){let t=this._eventBlock;do{if(t instanceof e.FunctionBlock&&t.IsCopyPicked())return!0;t=t.GetScopeParent()}while(t);return!1}GetRuntime(){return this._runtime}GetIndex(){return this._index}GetDebugIndex(){return this._debugData.index}IsBreakpoint(){return this._debugData.isBreakpoint}_SetBreakpoint(e){this._debugData.isBreakpoint=!!e,this._eventBlock._UpdateCanRunFastRecursive()}_DebugReturnsGenerator(){return this._debugData.canDebug}DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator()}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}_RunSystem(){const e=this._results;return EvalParams(this._parameters,e),this._func.apply(this._systemPlugin,e)}*_DebugRunSystem(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results;EvalParams(this._parameters,e);return yield*this._func.apply(this._systemPlugin,e)}return this.Run()}_RunSingleGlobal(){const e=this._results;return EvalParams(this._parameters,e),this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e)}*_DebugRunSingleGlobal(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results;EvalParams(this._parameters,e);return yield*this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),e)}return this.Run()}_RunObject_ParamsConst(){const e=this._results,t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)this._func.apply(t[s].GetSdkInstance(),e)}*_DebugRunObject_ParamsConst(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results,t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)yield*this._func.apply(t[s].GetSdkInstance(),e)}else this._RunObject_ParamsConst()}_RunObject_ParamsDontVary(){const e=this._results;EvalParams(this._parameters,e);const t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)this._func.apply(t[s].GetSdkInstance(),e)}*_DebugRunObject_ParamsDontVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._results;EvalParams(this._parameters,e);const t=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=t.length;s<i;++s)yield*this._func.apply(t[s].GetSdkInstance(),e)}else this._RunObject_ParamsDontVary()}_RunObject_AllParamsVary(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let r=0,n=i.length;r<n;++r){const n=i[r];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(r);s.apply(n.GetSdkInstance(),t)}}*_DebugRunObject_AllParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let r=0,n=i.length;r<n;++r){const n=i[r];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(r);yield*s.apply(n.GetSdkInstance(),t)}}else this._RunObject_AllParamsVary()}_RunObject_SomeParamsVary(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=e.length;s<i;++s){const i=e[s];i.VariesPerInstance()||(t[s]=i.Get(0))}for(let r=0,n=i.length;r<n;++r){const n=i[r];for(let s=0,i=e.length;s<i;++s){const i=e[s];i.VariesPerInstance()&&(t[s]=i.Get(r))}s.apply(n.GetSdkInstance(),t)}}*_DebugRunObject_SomeParamsVary(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances();for(let s=0,i=e.length;s<i;++s){const i=e[s];i.VariesPerInstance()||(t[s]=i.Get(0))}for(let r=0,n=i.length;r<n;++r){const n=i[r];for(let s=0,i=e.length;s<i;++s){const i=e[s];i.VariesPerInstance()&&(t[s]=i.Get(r))}yield*s.apply(n.GetSdkInstance(),t)}}else this._RunObject_SomeParamsVary()}_RunObject_BeforeAfterHooks(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass,r=i.GetSdkType(),n=i.GetCurrentSol().GetInstances();r.BeforeRunAction(s);for(let i=0,r=n.length;i<r;++i){const r=n[i];for(let s=0,r=e.length;s<r;++s)t[s]=e[s].Get(i);s.apply(r.GetSdkInstance(),t)}r.AfterRunAction(s)}*_DebugRunObject_BeforeAfterHooks(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass,r=i.GetSdkType(),n=i.GetCurrentSol().GetInstances();r.BeforeRunAction(s);for(let i=0,r=n.length;i<r;++i){const r=n[i];for(let s=0,r=e.length;s<r;++s)t[s]=e[s].Get(i);yield*s.apply(r.GetSdkInstance(),t)}r.AfterRunAction(s)}else this._RunObject_BeforeAfterHooks()}_RunBehavior(){const e=this._objectClass,t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._anyParamVariesPerInstance,n=this._results,a=this._func,o=this._behaviorIndex,h=e.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e){const t=i[e];t.VariesPerInstance()||(n[e]=t.Get(0))}for(let e=0,l=h.length;e<l;++e){const l=h[e];if(r)for(let t=0,s=i.length;t<s;++t){const s=i[t];s.VariesPerInstance()&&(n[t]=s.Get(e))}const c=t?l.GetObjectClass().GetFamilyBehaviorOffset(s):0;a.apply(l.GetBehaviorInstances()[o+c].GetSdkInstance(),n)}}*_DebugRunBehavior(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._objectClass,t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._anyParamVariesPerInstance,n=this._results,a=this._func,o=this._behaviorIndex,h=e.GetCurrentSol().GetInstances();for(let e=0,t=i.length;e<t;++e){const t=i[e];t.VariesPerInstance()||(n[e]=t.Get(0))}for(let e=0,l=h.length;e<l;++e){const l=h[e];if(r)for(let t=0,s=i.length;t<s;++t){const s=i[t];s.VariesPerInstance()&&(n[t]=s.Get(e))}const c=t?l.GetObjectClass().GetFamilyBehaviorOffset(s):0;yield*a.apply(l.GetBehaviorInstances()[o+c].GetSdkInstance(),n)}}else this._RunBehavior()}_RunObject_Async(){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances(),r=[];for(let n=0,a=i.length;n<a;++n){const a=i[n];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(n);r.push(s.apply(a.GetSdkInstance(),t))}return Promise.all(r)}*_DebugRunObject_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._parameters,t=this._results,s=this._func,i=this._objectClass.GetCurrentSol().GetInstances(),r=[];for(let n=0,a=i.length;n<a;++n){const a=i[n];for(let s=0,i=e.length;s<i;++s)t[s]=e[s].Get(n);r.push(yield*s.apply(a.GetSdkInstance(),t))}return Promise.all(r)}return this._RunObject_Async()}_RunBehavior_Async(){const e=this._objectClass,t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._results,n=this._func,a=this._behaviorIndex,o=e.GetCurrentSol().GetInstances(),h=[];for(let e=0,l=o.length;e<l;++e){const l=o[e];for(let t=0,s=i.length;t<s;++t)r[t]=i[t].Get(e);const c=t?l.GetObjectClass().GetFamilyBehaviorOffset(s):0;h.push(n.apply(l.GetBehaviorInstances()[a+c].GetSdkInstance(),r))}return Promise.all(h)}*_DebugRunBehavior_Async(){if((this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this._DebugReturnsGenerator()){const e=this._objectClass,t=e.IsFamily(),s=e.GetFamilyIndex(),i=this._parameters,r=this._results,n=this._func,a=this._behaviorIndex,o=e.GetCurrentSol().GetInstances(),h=[];for(let e=0,l=o.length;e<l;++e){const l=o[e];for(let t=0,s=i.length;t<s;++t)r[t]=i[t].Get(e);const c=t?l.GetObjectClass().GetFamilyBehaviorOffset(s):0;h.push(yield*n.apply(l.GetBehaviorInstances()[a+c].GetSdkInstance(),r))}return Promise.all(h)}return this._RunBehavior_Async()}async RunUserScript(){try{await this._func()}catch(t){self.C3Debugger&&self.C3Debugger._SetLastErrorScript(this),e.EventScript.HadUserScriptException()||e.EventScript.SetHadUserScriptException()}}*DebugRunUserScript(){return(this.IsBreakpoint()||this._runtime.DebugBreakNext())&&(yield this),this.RunUserScript()}_SaveToJson(){return this._savedData&&this._savedData.size?{ex:e.ToSuperJSON(this._savedData)}:null}_LoadFromJson(t){if(this._savedData&&(this._savedData.clear(),this._savedData=null),!t)return;const s=t.ex;s&&(this._savedData=e.FromSuperJSON(s))}}}{const e=self.C3,t=new e.Color;function CompareX(t,s){return e.compare(this.GetWorldInfo().GetX(),t,s)}function CompareY(t,s){return e.compare(this.GetWorldInfo().GetY(),t,s)}function IsOnScreen(){return this.GetWorldInfo().IsInViewport2()}function IsOutsideLayout(){const e=this.GetWorldInfo(),t=e.GetLayout(),s=e.GetBoundingBox();return s.getRight()<0||s.getBottom()<0||s.getLeft()>t.GetWidth()||s.getTop()>t.GetHeight()}function PickDistance(t,s,i){const r=this.GetCurrentSol(),n=r.GetInstances();if(!n.length)return!1;let a=n[0],o=a.GetWorldInfo(),h=a,l=e.distanceSquared(o.GetX(),o.GetY(),s,i);for(let r=1,c=n.length;r<c;++r){a=n[r],o=a.GetWorldInfo();const c=e.distanceSquared(o.GetX(),o.GetY(),s,i);(0===t&&c<l||1===t&&c>l)&&(l=c,h=a)}return r.PickOne(h),!0}function SetX(e){const t=this.GetWorldInfo();t.GetX()!==e&&(t.SetX(e),t.SetBboxChanged())}function SetY(e){const t=this.GetWorldInfo();t.GetY()!==e&&(t.SetY(e),t.SetBboxChanged())}function SetPos(e,t){const s=this.GetWorldInfo();s.EqualsXY(e,t)||(s.SetXY(e,t),s.SetBboxChanged())}function SetPosToObject(e,t){if(!e)return;const s=e.GetPairedInstance(this._inst);if(!s)return;const[i,r]=s.GetImagePoint(t),n=this.GetWorldInfo();n.GetX()===i&&n.GetY()===r||(n.SetXY(i,r),n.SetBboxChanged())}function MoveForward(e){if(0===e)return;const t=this.GetWorldInfo();t.OffsetXY(t.GetCosAngle()*e,t.GetSinAngle()*e),t.SetBboxChanged()}function MoveAtAngle(t,s){if(0===s)return;const i=this.GetWorldInfo();t=e.toRadians(t),i.OffsetXY(Math.cos(t)*s,Math.sin(t)*s),i.SetBboxChanged()}function GetX(){return this.GetWorldInfo().GetX()}function GetY(){return this.GetWorldInfo().GetY()}function GetDt(){return this._runtime.GetDt(this._inst)}function CompareWidth(t,s){return e.compare(this.GetWorldInfo().GetWidth(),t,s)}function CompareHeight(t,s){return e.compare(this.GetWorldInfo().GetHeight(),t,s)}function SetWidth(e){const t=this.GetWorldInfo();t.GetWidth()!==e&&(t.SetWidth(e),t.SetBboxChanged())}function SetHeight(e){const t=this.GetWorldInfo();t.GetHeight()!==e&&(t.SetHeight(e),t.SetBboxChanged())}function SetSize(e,t){const s=this.GetWorldInfo();s.GetWidth()===e&&s.GetHeight()===t||(s.SetSize(e,t),s.SetBboxChanged())}function GetWidth(){return this.GetWorldInfo().GetWidth()}function GetHeight(){return this.GetWorldInfo().GetHeight()}function GetBboxLeft(){return this.GetWorldInfo().GetBoundingBox().getLeft()}function GetBboxTop(){return this.GetWorldInfo().GetBoundingBox().getTop()}function GetBboxRight(){return this.GetWorldInfo().GetBoundingBox().getRight()}function GetBboxBottom(){return this.GetWorldInfo().GetBoundingBox().getBottom()}function GetBboxMidX(){const e=this.GetWorldInfo().GetBoundingBox();return(e.getLeft()+e.getRight())/2}function GetBboxMidY(){const e=this.GetWorldInfo().GetBoundingBox();return(e.getTop()+e.getBottom())/2}function IsAngleWithin(t,s){return e.angleDiff(this.GetWorldInfo().GetAngle(),e.toRadians(s))<=e.toRadians(t)}function IsAngleClockwiseFrom(t){return e.angleClockwise(this.GetWorldInfo().GetAngle(),e.toRadians(t))}function IsBetweenAngles(t,s){const i=e.toRadians(t),r=e.toRadians(s),n=this.GetWorldInfo().GetAngle();return!e.angleClockwise(r,i)?!(!e.angleClockwise(n,i)&&e.angleClockwise(n,r)):e.angleClockwise(n,i)&&!e.angleClockwise(n,r)}function SetAngle(t){const s=this.GetWorldInfo(),i=e.clampAngle(e.toRadians(t));isNaN(i)||s.GetAngle()===i||(s.SetAngle(i),s.SetBboxChanged())}function RotateClockwise(t){if(isNaN(t)||0===t)return;const s=this.GetWorldInfo();s.SetAngle(s.GetAngle()+e.toRadians(t)),s.SetBboxChanged()}function RotateCounterclockwise(t){if(isNaN(t)||0===t)return;const s=this.GetWorldInfo();s.SetAngle(s.GetAngle()-e.toRadians(t)),s.SetBboxChanged()}function RotateTowardAngle(t,s){const i=this.GetWorldInfo(),r=i.GetAngle(),n=e.angleRotate(r,e.toRadians(s),e.toRadians(t));isNaN(n)||r===n||(i.SetAngle(n),i.SetBboxChanged())}function RotateTowardPosition(t,s,i){const r=this.GetWorldInfo(),n=r.GetAngle(),a=s-r.GetX(),o=i-r.GetY(),h=Math.atan2(o,a),l=e.angleRotate(n,h,e.toRadians(t));isNaN(l)||n===l||(r.SetAngle(l),r.SetBboxChanged())}function SetTowardPosition(e,t){const s=this.GetWorldInfo(),i=s.GetAngle(),r=e-s.GetX(),n=t-s.GetY(),a=Math.atan2(n,r);isNaN(a)||i===a||(s.SetAngle(a),s.SetBboxChanged())}function GetAngle(){return e.toDegrees(this.GetWorldInfo().GetAngle())}function CompareOpacity(t,s){return e.compare(e.round6dp(100*this.GetWorldInfo().GetOpacity()),t,s)}function IsVisible(){return this.GetWorldInfo().IsVisible()}function SetVisible(e){const t=this.GetWorldInfo();e=2===e?!t.IsVisible():0!==e,t.IsVisible()!==e&&(t.SetVisible(e),this._runtime.UpdateRender())}function SetOpacity(t){const s=e.clamp(t/100,0,1),i=this.GetWorldInfo();if(i.GetTransformWithParentOpacity()){if(i._GetSceneGraphInfo().GetOwnOpacity()===s)return}else if(i.GetOpacity()===s)return;i.SetOpacity(s),this._runtime.UpdateRender()}function SetDefaultColor(e){t.setFromRgbValue(e);const s=this.GetWorldInfo();s.GetUnpremultipliedColor().equalsIgnoringAlpha(t)||(s.SetUnpremultipliedColor(t),this._runtime.UpdateRender())}function GetColor(){const t=this.GetWorldInfo().GetUnpremultipliedColor();return e.PackRGBAEx(t.getR(),t.getG(),t.getB(),t.getA())}function GetOpacity(){return e.round6dp(100*this.GetWorldInfo().GetOpacity())}function IsOnLayer(e){return!!e&&this.GetWorldInfo().GetLayer()===e}function PickTopBottom(e){const t=this.GetCurrentSol(),s=t.GetInstances();if(!s.length)return!1;let i=s[0];for(let t=1,r=s.length;t<r;++t){const r=s[t],n=r.GetWorldInfo(),a=i.GetWorldInfo(),o=n.GetLayer().GetIndex(),h=a.GetLayer().GetIndex();0===e?(o>h||o===h&&n.GetZIndex()>a.GetZIndex())&&(i=r):(o<h||o===h&&n.GetZIndex()<a.GetZIndex())&&(i=r)}return t.PickOne(i),!0}function CompareZElevation(t,s,i){const r=this.GetWorldInfo(),n=0===t?r.GetZElevation():r.GetTotalZElevation();return e.compare(n,s,i)}function MoveToTop(){this.GetWorldInfo().ZOrderMoveToTop()}function MoveToBottom(){this.GetWorldInfo().ZOrderMoveToBottom()}function MoveToLayer(e){e&&this.GetWorldInfo().ZOrderMoveToLayer(e)}function ZMoveToObject(e,t){const s=0===e;if(!t)return;const i=t.GetFirstPicked(this.GetInstance());i&&this.GetWorldInfo().ZOrderMoveAdjacentToInstance(i,s)}function SetZElevation(e){const t=this.GetWorldInfo();t.GetZElevation()!==e&&(t.SetZElevation(e),this._runtime.UpdateRender())}function LayerNumber(){return this.GetWorldInfo().GetLayer().GetIndex()}function LayerName(){return this.GetWorldInfo().GetLayer().GetName()}function ZIndex(){return this.GetWorldInfo().GetZIndex()}function ZElevation(){return this.GetWorldInfo().GetZElevation()}function TotalZElevation(){return this.GetWorldInfo().GetTotalZElevation()}function IsEffectEnabled(e){const t=this.GetObjectClass().GetEffectList().GetEffectTypeByName(e);if(!t)return;const s=t.GetIndex();return this.GetWorldInfo().GetInstanceEffectList().IsEffectIndexActive(s)}function SetEffectEnabled(e,t){const s=this.GetObjectClass().GetEffectList().GetEffectTypeByName(t);if(!s)return;const i=s.GetIndex(),r=1===e,n=this.GetWorldInfo().GetInstanceEffectList();n.IsEffectIndexActive(i)!==r&&(n.SetEffectIndexActive(i,r),n.UpdateActiveEffects(),this._runtime.UpdateRender())}function SetEffectParam(e,s,i){const r=this.GetObjectClass().GetEffectList().GetEffectTypeByName(e);if(!r)return;s=Math.floor(s);const n=r.GetShaderProgram().GetParameterType(s);if(!n)return;"color"===n?(t.setFromRgbValue(i),i=t):"percent"===n&&(i/=100);const a=r.GetIndex(),o=this.GetWorldInfo().GetInstanceEffectList();o.SetEffectParameter(a,s,i)&&o.IsEffectIndexActive(a)&&this._runtime.UpdateRender()}const s=e.New(e.Rect),i=[],r=[];let n=!1,a=null,o=!1;const h=new Set;function CollMemory_Add(e,t,s,i){t.GetUID()<s.GetUID()?e.Set(t,s,i):e.Set(s,t,i)}function CollMemory_Remove(e,t,s){t.GetUID()<s.GetUID()?e.Delete(t,s):e.Delete(s,t)}function CollMemory_RemoveInstance(e,t){e.DeleteEither(t)}function CollMemory_Get(e,t,s){return t.GetUID()<s.GetUID()?e.Get(t,s):e.Get(s,t)}function DoOverlapCondition(t,i,l,c){if(!i)return!1;const u=t.GetInstance(),_=0!==l||0!==c,d=u.GetWorldInfo(),p=u.GetRuntime(),f=p.GetCollisionEngine(),m=p.GetCurrentCondition(),g=m.GetEventBlock().IsOrBlock(),S=m.GetObjectClass(),y=m.IsInverted(),G=i.GetCurrentSol(),I=S!==i;let T;a=i,n=I&&!y,o=!1;let b=0,C=0,P=!1;G.IsSelectAll()?(s.copy(d.GetBoundingBox()),s.offset(l,c),f.GetCollisionCandidates(d.GetLayer(),i,s,r),T=r):g?p.IsCurrentConditionFirst()&&!G._GetOwnElseInstances().length&&G._GetOwnInstances().length?T=G._GetOwnInstances():(T=G._GetOwnElseInstances(),o=!0):T=G._GetOwnInstances(),_&&(b=d.GetX(),C=d.GetY(),d.OffsetXY(l,c),d.SetBboxChanged());for(const e of T)if(f.TestOverlap(u,e)){if(P=!0,y)break;I&&h.add(e)}return _&&(d.SetXY(b,C),d.SetBboxChanged()),e.clearArray(r),P}function FinishCollisionConditionPicking(t){const s=t.GetRuntime().GetCurrentEvent().IsOrBlock(),i=a.GetCurrentSol(),r=i._GetOwnInstances(),n=i._GetOwnElseInstances();i.IsSelectAll()?(i.SetSetPicked(h),s&&(e.clearArray(n),i.AddElseInstances(h,a.GetInstances()))):s?o?i.TransferElseInstancesToOwn(h):(i.AddElseInstances(h,r),i.SetSetPicked(h)):i.SetSetPicked(h),a.ApplySolToContainer()}function FinishCollisionCondition(e,t){n&&(t&&FinishCollisionConditionPicking(e),h.clear(),a=null,n=!1)}function OnCollision(t){if(this._runtime.IsDebugging())return DebugOnCollision.call(this,t);if(!t)return!1;const s=this._runtime,r=s.GetCollisionEngine(),n=s.GetEventSheetManager(),a=n.GetEventStack(),o=n.GetCurrentCondition(),h=o.GetObjectClass(),l=o.GetSavedDataMap(),c=o.GetUnsavedDataMap(),u=a.GetCurrentStackFrame(),_=s.GetTickCount(),d=_-1,p=u.GetCurrentEvent(),f=a.Push(p);let m=l.get("collmemory");m||(m=e.New(e.PairMap),l.set("collmemory",m)),c.get("collisionCreatedDestroyCallback")||(c.set("collisionCreatedDestroyCallback",!0),s.Dispatcher().addEventListener("instancedestroy",(e=>CollMemory_RemoveInstance(m,e.instance))));const g=h.GetCurrentSol(),S=t.GetCurrentSol(),y=g.GetInstances();let G=null;for(let s=0;s<y.length;++s){const a=y[s];S.IsSelectAll()?(r.GetCollisionCandidates(a.GetWorldInfo().GetLayer(),t,a.GetWorldInfo().GetBoundingBox(),i),G=i,r.AddRegisteredCollisionCandidates(a,t,G)):G=S.GetInstances();for(let s=0;s<G.length;++s){const i=G[s];if(r.TestOverlap(a,i)||r.CheckRegisteredCollision(a,i)){const s=CollMemory_Get(m,a,i);let r=!1,o=-2;"number"==typeof s&&(r=!0,o=s);const l=!r||o<d;if(CollMemory_Add(m,a,i,_),l){const s=p.GetSolModifiers();n.PushCopySol(s);const r=h.GetCurrentSol(),o=t.GetCurrentSol();if(r._SetSelectAll(!1),o._SetSelectAll(!1),h===t){const t=r._GetOwnInstances();e.clearArray(t),t.push(a),t.push(i),h.ApplySolToContainer()}else{const s=r._GetOwnInstances(),n=o._GetOwnInstances();e.clearArray(s),e.clearArray(n),s.push(a),n.push(i),h.ApplySolToContainer(),t.ApplySolToContainer()}p.Retrigger(u,f),n.PopSol(s)}}else CollMemory_Remove(m,a,i)}e.clearArray(i)}return a.Pop(),!1}function*DebugOnCollision(t){if(!t)return!1;const s=this._runtime,r=s.GetCollisionEngine(),n=s.GetEventSheetManager(),a=n.GetEventStack(),o=n.GetCurrentCondition(),h=o.GetObjectClass(),l=o.GetSavedDataMap(),c=o.GetUnsavedDataMap(),u=a.GetCurrentStackFrame(),_=s.GetTickCount(),d=_-1,p=u.GetCurrentEvent(),f=a.Push(p);let m=l.get("collmemory");m||(m=e.New(e.PairMap),l.set("collmemory",m)),c.get("collisionCreatedDestroyCallback")||(c.set("collisionCreatedDestroyCallback",!0),s.Dispatcher().addEventListener("instancedestroy",(e=>CollMemory_RemoveInstance(m,e.instance))));const g=h.GetCurrentSol(),S=t.GetCurrentSol(),y=g.GetInstances();let G=null;for(let s=0;s<y.length;++s){const a=y[s];S.IsSelectAll()?(r.GetCollisionCandidates(a.GetWorldInfo().GetLayer(),t,a.GetWorldInfo().GetBoundingBox(),i),G=i,r.AddRegisteredCollisionCandidates(a,t,G)):G=S.GetInstances();for(let s=0;s<G.length;++s){const i=G[s];if(r.TestOverlap(a,i)||r.CheckRegisteredCollision(a,i)){const s=CollMemory_Get(m,a,i);let r=!1,o=-2;"number"==typeof s&&(r=!0,o=s);const l=!r||o<d;if(CollMemory_Add(m,a,i,_),l){const s=p.GetSolModifiers();n.PushCopySol(s);const r=h.GetCurrentSol(),o=t.GetCurrentSol();if(r._SetSelectAll(!1),o._SetSelectAll(!1),h===t){const t=r._GetOwnInstances();e.clearArray(t),t.push(a),t.push(i),h.ApplySolToContainer()}else{const s=r._GetOwnInstances(),n=o._GetOwnInstances();e.clearArray(s),e.clearArray(n),s.push(a),n.push(i),h.ApplySolToContainer(),t.ApplySolToContainer()}yield*p.DebugRetrigger(u,f),n.PopSol(s)}}else CollMemory_Remove(m,a,i)}e.clearArray(i)}return a.Pop(),!1}function IsOverlapping(e){return DoOverlapCondition(this,e,0,0)}function IsOverlappingOffset(e,t,s){return DoOverlapCondition(this,e,t,s)}function HasParent(){return this.GetWorldInfo().HasParent()}function HasChildren(){return this.GetWorldInfo().HasChildren()}function PickParent(e,t){const s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;const i=e.GetCurrentSol(),r=i.GetInstances();if(0===r.length)return!1;const n=new Set(r),a=new Set;for(let i=0,r=s.length;i<r;++i){const r=s[i];if(1===t)for(const t of r.parents())t.BelongsToObjectClass(e)&&n.has(t)&&a.add(t);else{let s;if(0===t){if(s=r.GetParent(),null===s)continue}else s=r.GetTopParent();s.BelongsToObjectClass(e)&&n.has(s)&&a.add(s)}}return 0!==a.size&&(i.SetSetPicked(a),e.ApplySolToContainer(),!0)}function PickChildren(e,t){const s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;const i=e.GetCurrentSol();let r=i.GetInstances();if(i.IsSelectAll()){const t=[...this._runtime.instancesPendingCreateForObjectClass(e)];t.length>0&&(r=r.concat(t))}if(0===r.length)return!1;const n=new Set(r),a=new Set;for(let i=0,r=s.length;i<r;++i){const r=s[i];2===t&&!r.HasChildren()&&r.BelongsToObjectClass(e)&&n.has(r)&&a.add(r);for(const s of 0===t?r.children():r.allChildren())2===t&&s.HasChildren()||s.BelongsToObjectClass(e)&&n.has(s)&&a.add(s)}return 0!==a.size&&(i.SetSetPicked(a),e.ApplySolToContainer(),!0)}function PickNthChild(e,t){const s=this.GetCurrentSol().GetInstances();if(0===s.length)return!1;const i=e.GetCurrentSol();let r=i.GetInstances();if(i.IsSelectAll()){const t=[...this._runtime.instancesPendingCreateForObjectClass(e)];t.length>0&&(r=r.concat(t))}if(0===r.length)return!1;const n=new Set(r),a=[];for(let i=0,r=s.length;i<r;++i){const r=s[i].GetChildAt(t);null!==r&&r.BelongsToObjectClass(e)&&n.has(r)&&a.push(r)}return 0!==a.length&&(i.SetArrayPicked(a),e.ApplySolToContainer(),!0)}function CompareChildCount(t,s,i){switch(t){case 0:default:return e.compare(this._inst.GetChildCount(),s,i);case 1:return e.compare(this._inst.GetAllChildCount(),s,i)}}function AddChild(e,t,s,i,r,n,a,o,h,l){const c=this._inst,u=this._runtime.GetCurrentAction().GetObjectClass();for(const _ of e.allCorrespondingInstances(c,u)){if(!_.GetPlugin().SupportsSceneGraph())return;c.AddChild(_,{transformX:t,transformY:s,transformWidth:i,transformHeight:r,transformAngle:n,tranformOpacity:a,transformZElevation:o,transformVisibility:h,destroyWithParent:l})}}function RemoveChild(e){const t=this._inst,s=this._runtime.GetCurrentAction().GetObjectClass();for(const i of e.allCorrespondingInstances(t,s))t.RemoveChild(i)}function RemoveFromParent(){if(!this._inst.HasParent())return;this._inst.GetParent().RemoveChild(this._inst)}function ChildCount(){return this._inst.GetChildCount()}function AllChildCount(){return this._inst.GetAllChildCount()}function SetMeshSize(e,t){e=Math.floor(e),t=Math.floor(t);const s=this.GetWorldInfo();e<2||t<2||!isFinite(e)||!isFinite(t)?(s.ReleaseMesh(),s.SetBboxChanged()):s.CreateMesh(e,t)}function SetMeshPoint(e,t,s,i,r,n,a,o){const h=this.GetWorldInfo();h.SetMeshPoint(e,t,{mode:0===s?"absolute":"relative",x:i,y:r,zElevation:n,u:a,v:o})&&h.SetBboxChanged()}function MeshColumns(){const e=this.GetWorldInfo();return e.HasMesh()?e.GetSourceMesh().GetHSize():0}function MeshRows(){const e=this.GetWorldInfo();return e.HasMesh()?e.GetSourceMesh().GetVSize():0}function SetElementVisible(e){const t=this.GetWorldInfo();e=2===e?!t.IsVisible():0!==e,t.IsVisible()!==e&&t.SetVisible(e)}function SetElementCSSStyle(e,t){this.SetElementCSSStyle(e,t)}function SetElementAttribute(e,t){this.SetElementAttribute(e,""+t)}function RemoveElementAttribute(e){this.RemoveElementAttribute(e)}function SetElementFocus(){this.FocusElement()}function SetElementBlur(){this.BlurElement()}function IsElementFocused(){return this.IsElementFocused()}function SetElementEnabled(e){this._SetEnabled(0!==e)}function IsElementEnabled(){return this._IsEnabled()}function CompareInstanceVar(t,s,i){return e.compare(this.GetInstance().GetInstanceVariableValue(t),s,i)}function IsBoolInstanceVarSet(e){return!!this.GetInstance().GetInstanceVariableValue(e)}function TemplateName(){const e=this._runtime.GetTemplateManager();return e?e.GetInstanceTemplateName(this.GetInstance()):""}function PickInstVarHiLow(e,t){const s=this.GetCurrentSol(),i=s.GetInstances();if(!i.length)return!1;const r=this.IsFamily();let n=null,a=0;for(let s=0,o=i.length;s<o;++s){const o=i[s],h=r?o.GetObjectClass().GetFamilyInstanceVariableOffset(this.GetFamilyIndex()):0,l=o.GetInstanceVariableValue(h+t);(null===n||0===e&&l<a||1===e&&l>a)&&(a=l,n=o)}return s.PickOne(n),!0}function PickByUID(e){return this._runtime.GetCurrentCondition().IsInverted()?PickByUID_Inverted(this,e):PickByUID_Normal(this,e)}function PickByUID_Normal(e,t){const s=e.GetRuntime().GetInstanceByUID(t);if(!s)return!1;const i=e.GetCurrentSol();if(!i.IsSelectAll()&&!i._GetOwnInstances().includes(s))return!1;if(e.IsFamily()){if(s.GetObjectClass().BelongsToFamily(e))return i.PickOne(s),e.ApplySolToContainer(),!0}else if(s.GetObjectClass()===e)return i.PickOne(s),e.ApplySolToContainer(),!0;return!1}function PickByUID_Inverted(t,s){const i=t.GetCurrentSol();if(i.IsSelectAll()){i._SetSelectAll(!1),i.ClearArrays();const e=t.GetInstances();for(let t=0,r=e.length;t<r;++t){const r=e[t];r.GetUID()===s?i._PushElseInstance(r):i._PushInstance(r)}return t.ApplySolToContainer(),!!i._GetOwnInstances().length}{const r=i._GetOwnInstances();let n=0;for(let e=0,t=r.length;e<t;++e){const t=r[e];r[n]=t,t.GetUID()===s?i._PushElseInstance(t):++n}return e.truncateArray(r,n),t.ApplySolToContainer(),!!r.length}}function Destroy(){this._runtime.DestroyInstance(this._inst)}function OnCreated(){return!0}function OnDestroyed(){return!0}function SetInstanceVar(e,t){this.GetInstance().SetInstanceVariableValue(e,t)}function AddInstanceVar(e,t){const s=this.GetInstance(),i=s.GetInstanceVariableValue(e);"number"==typeof i&&"number"!=typeof t?t=parseFloat(t):"string"==typeof i&&"string"!=typeof t&&(t=t.toString()),s.SetInstanceVariableValue(e,i+t)}function SubInstanceVar(e,t){const s=this.GetInstance(),i=s.GetInstanceVariableValue(e);"number"==typeof i&&("number"!=typeof t&&(t=parseFloat(t)),s.SetInstanceVariableValue(e,i-t))}function SetBoolInstanceVar(e,t){this.GetInstance().SetInstanceVariableValue(e,t?1:0)}function ToggleBoolInstanceVar(e){const t=this.GetInstance();t.SetInstanceVariableValue(e,0===t.GetInstanceVariableValue(e)?1:0)}function LoadFromJsonString(t){let s;try{s=JSON.parse(t)}catch(e){return}const i=this.GetInstance(),r="state";i._OnBeforeLoad(r),i.LoadFromJson(s,r);const n=e.New(e.Event,"afterloadinstance");n.instance=i,this._runtime.Dispatcher().dispatchEvent(n)}function AsJSON(){return JSON.stringify(this.GetInstance().SaveToJson("state"))}function ObjectTypeName(){return this.GetInstance().GetObjectClass().GetName()}function Count(){const e=this._runtime.GetCurrentEventStackFrame().GetExpressionObjectClass();let t=e.GetInstanceCount();for(const s of this._runtime.instancesPendingCreateForObjectClass(e))++t;return t}function PickedCount(){return this._runtime.GetCurrentEventStackFrame().GetExpressionObjectClass().GetCurrentSol().GetInstances().length}function GetIID(){return this._inst.GetIID()}function GetUID(){return this._inst.GetUID()}e.AddCommonACEs=function(e,t){const s=e[1],i=e[3],r=e[4],n=e[5],a=e[6],o=e[7],h=e[8],l=e[10],c=e[11],u=e[12],_=e[13],d=e[14],p=e[15],f=e[16],m=t.Cnds,g=t.Acts,S=t.Exps;i&&(m.CompareX=CompareX,m.CompareY=CompareY,m.IsOnScreen=IsOnScreen,m.IsOutsideLayout=IsOutsideLayout,m.PickDistance=PickDistance,g.SetX=SetX,g.SetY=SetY,g.SetPos=SetPos,g.SetPosToObject=SetPosToObject,g.MoveForward=MoveForward,g.MoveAtAngle=MoveAtAngle,S.X=GetX,S.Y=GetY,S.dt=GetDt),r&&(m.CompareWidth=CompareWidth,m.CompareHeight=CompareHeight,g.SetWidth=SetWidth,g.SetHeight=SetHeight,g.SetSize=SetSize,S.Width=GetWidth,S.Height=GetHeight,S.BBoxLeft=GetBboxLeft,S.BBoxTop=GetBboxTop,S.BBoxRight=GetBboxRight,S.BBoxBottom=GetBboxBottom,S.BBoxMidX=GetBboxMidX,S.BBoxMidY=GetBboxMidY),n&&(m.AngleWithin=IsAngleWithin,m.IsClockwiseFrom=IsAngleClockwiseFrom,m.IsBetweenAngles=IsBetweenAngles,g.SetAngle=SetAngle,g.RotateClockwise=RotateClockwise,g.RotateCounterclockwise=RotateCounterclockwise,g.RotateTowardAngle=RotateTowardAngle,g.RotateTowardPosition=RotateTowardPosition,g.SetTowardPosition=SetTowardPosition,S.Angle=GetAngle),a&&(m.IsVisible=IsVisible,m.CompareOpacity=CompareOpacity,g.SetVisible=SetVisible,g.SetOpacity=SetOpacity,g.SetDefaultColor=SetDefaultColor,S.Opacity=GetOpacity,S.ColorValue=GetColor),o&&(m.IsOnLayer=IsOnLayer,m.PickTopBottom=PickTopBottom,m.CompareZElevation=CompareZElevation,g.MoveToTop=MoveToTop,g.MoveToBottom=MoveToBottom,g.MoveToLayer=MoveToLayer,g.ZMoveToObject=ZMoveToObject,g.SetZElevation=SetZElevation,S.LayerNumber=LayerNumber,S.LayerName=LayerName,S.ZIndex=ZIndex,S.ZElevation=ZElevation,S.TotalZElevation=TotalZElevation),h&&(m.IsEffectEnabled=IsEffectEnabled,g.SetEffectEnabled=SetEffectEnabled,g.SetEffectParam=SetEffectParam),_&&(m.HasParent=HasParent,m.HasChildren=HasChildren,m.PickParent=PickParent,m.PickChildren=PickChildren,m.PickNthChild=PickNthChild,m.CompareChildCount=CompareChildCount,g.AddChild=AddChild,g.RemoveChild=RemoveChild,g.RemoveFromParent=RemoveFromParent,S.ChildCount=ChildCount,S.AllChildCount=AllChildCount),d&&(g.SetMeshSize=SetMeshSize,g.SetMeshPoint=SetMeshPoint,S.MeshColumns=MeshColumns,S.MeshRows=MeshRows),l&&(m.IsVisible=IsVisible,g.SetVisible=SetElementVisible,g.SetCSSStyle=SetElementCSSStyle,g.SetElemAttribute=SetElementAttribute,g.RemoveElemAttribute=RemoveElementAttribute),c&&(m.IsFocused=IsElementFocused,g.SetFocus=SetElementFocus,g.SetBlur=SetElementBlur),u&&(m.IsEnabled=IsElementEnabled,g.SetEnabled=SetElementEnabled),p&&(m.OnCollision=OnCollision,m.IsOverlapping=IsOverlapping,m.IsOverlappingOffset=IsOverlappingOffset,t.FinishCollisionCondition=FinishCollisionCondition),s||(m.CompareInstanceVar=CompareInstanceVar,m.IsBoolInstanceVarSet=IsBoolInstanceVarSet,m.PickInstVarHiLow=PickInstVarHiLow,m.PickByUID=PickByUID,g.SetInstanceVar=SetInstanceVar,g.AddInstanceVar=AddInstanceVar,g.SubInstanceVar=SubInstanceVar,g.SetBoolInstanceVar=SetBoolInstanceVar,g.ToggleBoolInstanceVar=ToggleBoolInstanceVar,m.OnCreated=OnCreated,m.OnDestroyed=OnDestroyed,g.Destroy=Destroy,g.LoadFromJsonString||(g.LoadFromJsonString=LoadFromJsonString),S.AsJSON||(S.AsJSON=AsJSON),S.Count=Count,S.PickedCount=PickedCount,S.IID=GetIID,S.UID=GetUID,S.ObjectTypeName=ObjectTypeName),f&&(S.TemplateName=TemplateName)}}{const e=self.C3;e.ScheduledWait=class extends e.DefendedBase{constructor(e){super(),this._eventSheetManager=e,this._type="",this._time=-1,this._signalTag="",this._isSignalled=!1,this._event=null,this._actIndex=0,this._solModifiers=[],this._dynamicSolModifiers=null,this._sols=new Map,this._callingFunctionBlock=null,this._asyncId=-1,this._functionParameters=null,this._functionInnerLocalVars=null,this._shouldRelease=!1}Release(){this._type="",this._time=-1,this._signalTag="",this._event=null,this._callingFunctionBlock=null,this._functionParameters=null,this._functionInnerLocalVars=null,this._asyncId=-1,e.clearArray(this._solModifiers),this._dynamicSolModifiers&&(this._dynamicSolModifiers.clear(),this._dynamicSolModifiers=null);for(const e of this._sols.values())e.Release();this._sols.clear()}_Init(){const t=this._eventSheetManager,s=t.GetRuntime().GetAllObjectClasses(),i=t.GetCurrentEventStackFrame();this._event=i.GetCurrentEvent(),this._actIndex=i.GetActionIndex()+1;const r=t.FindFirstFunctionBlockParent(this._event);r&&(this._callingFunctionBlock=r,this._functionParameters=r.CaptureFunctionParameters(),this._functionInnerLocalVars=r._GetAllInnerLocalVariables().map((e=>e.GetValue())),r.IsAsync()&&(this._asyncId=r.PauseCurrentAsyncFunction()));for(const t of s){const s=t.GetCurrentSol();s.IsSelectAll()&&!this._event.HasSolModifier(t)||(this._solModifiers.push(t),this._sols.set(t,e.New(e.SolState,s)))}const n=t.GetDynamicSolModifiersSet();this._dynamicSolModifiers=n.size>0?n:null}InitTimer(e){this._type="timer",this._Init(),this._time=this._eventSheetManager.GetRuntime().GetGameTime()+e}InitSignal(e){this._type="signal",this._Init(),this._signalTag=e.toLowerCase()}InitPromise(e){this._type="promise",this._Init(),e.then((()=>this.SetSignalled())).catch((e=>{this.SetSignalled()}))}IsTimer(){return"timer"===this._type}IsSignal(){return"signal"===this._type}IsPromise(){return"promise"===this._type}GetSignalTag(){return this._signalTag}IsSignalled(){return this._isSignalled}SetSignalled(){this._isSignalled=!0}_ShouldRun(){return this.IsTimer()?this._time<=this._eventSheetManager.GetRuntime().GetGameTime():this.IsSignalled()}_RestoreState(e){e._Restore(this._event,this._actIndex);for(const[e,t]of this._sols.entries()){const s=e.GetCurrentSol();t._Restore(s)}this._dynamicSolModifiers&&e.SetDynamicSolModifiers([...this._dynamicSolModifiers]);const t=this._callingFunctionBlock;t&&(t.SetFunctionParameters(this._functionParameters),t._GetAllInnerLocalVariables().map(((e,t)=>e.SetValue(this._functionInnerLocalVars[t]))),t.IsAsync()&&t.ResumeAsyncFunction(this._asyncId))}_Run(e){this._RestoreState(e),this._event._ResumeActionsAndSubEvents(e),this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}async _DebugRun(e){this._RestoreState(e);for(const t of this._event._DebugResumeActionsAndSubEvents(e))await this._eventSheetManager.GetRuntime().DebugBreak(t);this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync()&&this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId),this._eventSheetManager.ClearSol(this._solModifiers),this._shouldRelease=!0}ShouldRelease(){return this._shouldRelease}RemoveInstances(e){for(const t of this._sols.values())t.RemoveInstances(e)}_SaveToJson(){const e={},t={t:this._time,st:this._signalTag,s:this._isSignalled,ev:this._event.GetSID(),sm:this._solModifiers.map((e=>e.GetSID())),dsm:this._dynamicSolModifiers?[...this._dynamicSolModifiers].map((e=>e.GetSID())):null,sols:e};this._event._HasActionIndex(this._actIndex)&&(t.act=this._event.GetActionAt(this._actIndex).GetSID());for(const[t,s]of this._sols)e[t.GetSID().toString()]=s._SaveToJson();return t}static _CreateFromJson(t,s){const i=t.GetRuntime(),r=t.GetEventBlockBySID(s.ev);if(!r)return null;let n=0;if(s.hasOwnProperty("act")){const e=t.GetActionBySID(s.act);if(!e)return null;n=e.GetIndex()}const a=e.New(e.ScheduledWait,t);a._time=s.t,a._type=-1===a._time?"signal":"timer",a._signalTag=s.st,a._isSignalled=s.s,a._event=r,a._actIndex=n;for(const e of s.sm){const t=i.GetObjectClassBySID(e);t&&a._solModifiers.push(t)}if(Array.isArray(s.dsm))for(const e of s.dsm){const t=i.GetObjectClassBySID(e);t&&(a._dynamicSolModifiers||(a._dynamicSolModifiers=new Set),a._dynamicSolModifiers.add(t))}for(const[r,n]of Object.entries(s.sols)){const s=parseInt(r,10),o=i.GetObjectClassBySID(s);if(!o)continue;const h=e.New(e.SolState,null);h._LoadFromJson(t,n),a._sols.set(o,h)}return a}}}{const e=self.C3;e.SolState=class extends e.DefendedBase{constructor(t){super(),this._objectClass=null,this._isSelectAll=!0,this._instances=[],t&&(this._objectClass=t.GetObjectClass(),this._isSelectAll=t.IsSelectAll(),e.shallowAssignArray(this._instances,t._GetOwnInstances()))}Release(){this._objectClass=null,e.clearArray(this._instances)}_Restore(t){t._SetSelectAll(this._isSelectAll),e.shallowAssignArray(t._GetOwnInstances(),this._instances)}RemoveInstances(t){e.arrayRemoveAllInSet(this._instances,t)}_SaveToJson(){return{sa:this._isSelectAll,insts:this._instances.map((e=>e.GetUID()))}}_LoadFromJson(t,s){const i=t.GetRuntime();this._isSelectAll=!!s.sa,e.clearArray(this._instances);for(const e of s.insts){const t=i.GetInstanceByUID(e);t&&this._instances.push(t)}}}}{const e=self.C3;function GetNextParamMap(e,t){let s=e.get(t);return s||(s=new Map,e.set(t,s)),s}e.SDKPluginBase=class extends e.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._isSingleGlobal=!!e.isSingleGlobal,this._isWorldType=!!e.isWorld,this._isRotatable=!!e.isRotatable,this._mustPredraw=!!e.mustPredraw,this._hasEffects=!!e.hasEffects,this._supportsSceneGraph=!!e.supportsSceneGraph,this._supportsMesh=!!e.supportsMesh,this._singleGlobalObjectClass=null,this._boundACEMethodCache=new Map,this._boundACEMethodCache_1param=new Map,this._boundACEMethodCache_2params=new Map,this._boundACEMethodCache_3params=new Map}Release(){this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}IsSingleGlobal(){return this._isSingleGlobal}IsWorldType(){return this._isWorldType}IsRotatable(){return this._isRotatable}MustPreDraw(){return this._mustPredraw}HasEffects(){return this._hasEffects}SupportsSceneGraph(){return this._supportsSceneGraph}SupportsMesh(){return this._supportsMesh}_GetBoundACEMethod(e,t){if(!t)throw new Error("missing 'this' binding");let s=this._boundACEMethodCache.get(e);return s||(s=e.bind(t),this._boundACEMethodCache.set(e,s),s)}_GetBoundACEMethod_1param(e,t,s){if(!t)throw new Error("missing 'this' binding");const i=GetNextParamMap(this._boundACEMethodCache_1param,e);let r=i.get(s);return r||(r=e.bind(t,s),i.set(s,r),r)}_GetBoundACEMethod_2params(e,t,s,i){if(!t)throw new Error("missing 'this' binding");const r=GetNextParamMap(this._boundACEMethodCache_2params,e),n=GetNextParamMap(r,s);let a=n.get(i);return a||(a=e.bind(t,s,i),n.set(i,a),a)}_GetBoundACEMethod_3params(e,t,s,i,r){if(!t)throw new Error("missing 'this' binding");const n=GetNextParamMap(this._boundACEMethodCache_3params,e),a=GetNextParamMap(n,s),o=GetNextParamMap(a,i);let h=o.get(r);return h||(h=e.bind(t,s,i,r),o.set(r,h),h)}_SetSingleGlobalObjectClass(e){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");this._singleGlobalObjectClass=e}GetSingleGlobalObjectClass(){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");return this._singleGlobalObjectClass}GetSingleGlobalInstance(){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");return this._singleGlobalObjectClass.GetSingleGlobalInstance()}}}{const e=self.C3;e.SDKDOMPluginBase=class extends e.SDKPluginBase{constructor(e,t){super(e),this._domComponentId=t,this._nextElementId=0,this._instMap=new Map,this.AddElementMessageHandler("elem-focused",(e=>e._OnElemFocused())),this.AddElementMessageHandler("elem-blurred",(e=>{e&&e._OnElemBlurred()}))}Release(){super.Release()}_AddElement(e){const t=this._nextElementId++;return this._instMap.set(t,e),t}_RemoveElement(e){this._instMap.delete(e)}AddElementMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,(e=>{const s=this._instMap.get(e.elementId);t(s,e)}))}}}{const e=self.C3;e.SDKTypeBase=class extends e.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}Release(){this._objectClass=null,this._runtime=null,this._plugin=null}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetImageInfo(){return this._objectClass.GetImageInfo()}OnCreate(){}FinishCondition(e){}BeforeRunAction(e){}AfterRunAction(e){}LoadTextures(e){}ReleaseTextures(){}OnDynamicTextureLoadComplete(){}PreloadTexturesWithInstances(e){}LoadTilemapData(){}GetScriptInterfaceClass(){return null}DispatchScriptEvent(t,s,i){const r=e.New(e.Event,t,s);r.objectClass=this,i&&Object.assign(r,i),this.GetObjectClass().DispatchUserScriptEvent(r)}}}{const e=self.C3;e.SDKInstanceBase=class extends e.DefendedBase{constructor(e,t){super(),this._inst=e,this._domComponentId=t,this._runtime=e.GetRuntime(),this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._tickFunc=null,this._tick2Func=null,this._isTicking=!1,this._isTicking2=!1,this._disposables=null,this._wasReleased=!1}Release(){this._wasReleased=!0,this._StopTicking(),this._StopTicking2(),this._tickFunc=null,this._tick2Func=null,this._disposables&&(this._disposables.Release(),this._disposables=null),this._inst=null,this._runtime=null,this._objectClass=null,this._sdkType=null}WasReleased(){return this._wasReleased}GetInstance(){return this._inst}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetPlugin(){return this._sdkType.GetPlugin()}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._inst.GetInterfaceClass()}Trigger(e){return this._runtime.Trigger(e,this._inst,null)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,null)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,null)}FastTrigger(e,t){return this._runtime.FastTrigger(e,this._inst,t)}DebugFastTrigger(e,t){return this._runtime.DebugFastTrigger(e,this._inst,t)}ScheduleTriggers(e){return this._runtime.ScheduleTriggers(e)}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}AddDOMMessageHandlers(e){for(const[t,s]of e)this.AddDOMMessageHandler(t,s)}PostToDOM(e,t){this._runtime.PostComponentMessageToDOM(this._domComponentId,e,t)}PostToDOMAsync(e,t){return this._runtime.PostComponentMessageToDOMAsync(this._domComponentId,e,t)}_PostToDOMMaybeSync(e,t){if(!this._runtime.IsInWorker())return window.c3_runtimeInterface._OnMessageFromRuntime({type:"event",component:this._domComponentId,handler:e,data:t,responseId:null});this.PostToDOM(e,t)}Tick(){}Tick2(){}_StartTicking(){this._isTicking||(this._tickFunc||(this._tickFunc=()=>this.Tick()),this._runtime.Dispatcher().addEventListener("tick",this._tickFunc),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime.Dispatcher().removeEventListener("tick",this._tickFunc),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._tick2Func||(this._tick2Func=()=>this.Tick2()),this._runtime.Dispatcher().addEventListener("tick2",this._tick2Func),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime.Dispatcher().removeEventListener("tick2",this._tick2Func),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}GetDebuggerProperties(){return[]}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t){if(0===t)return;const s=this.GetPropertyValueByIndex(e);if("number"!=typeof s)throw new Error("expected number");this.SetPropertyValueByIndex(e,s+t)}SetPropertyColorOffsetValueByIndex(e,t,s,i){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(t,s,i){if(!this._inst.HasScriptInterface())return;const r=this.GetScriptInterface(),n=e.New(e.Event,t,s);n.instance=r,i&&Object.assign(n,i),r.dispatchEvent(n)}}}{const e=self.C3;e.SDKWorldInstanceBase=class extends e.SDKInstanceBase{constructor(e,t){super(e,t),this._worldInfo=e.GetWorldInfo(),this._renderercontextlost_handler=null,this._renderercontextrestored_handler=null}Release(){if(this._renderercontextlost_handler){const e=this._runtime.Dispatcher();e.removeEventListener("renderercontextlost",this._renderercontextlost_handler),e.removeEventListener("renderercontextrestored",this._renderercontextrestored_handler),this._renderercontextlost_handler=null,this._renderercontextrestored_handler=null}this._worldInfo=null,super.Release()}HandleWebGLContextLoss(){this.HandleRendererContextLoss()}OnWebGLContextLost(){}OnWebGLContextRestored(){}HandleRendererContextLoss(){if(this._renderercontextlost_handler)return;this._renderercontextlost_handler=()=>this.OnRendererContextLost(),this._renderercontextrestored_handler=()=>this.OnRendererContextRestored();const e=this._runtime.Dispatcher();e.addEventListener("rendererontextlost",this._renderercontextlost_handler),e.addEventListener("renderercontextrestored",this._renderercontextrestored_handler)}OnRendererContextLost(){this.OnWebGLContextLost()}OnRendererContextRestored(){this.OnWebGLContextRestored()}GetWorldInfo(){return this._worldInfo}IsOriginalSizeKnown(){return!1}GetOriginalWidth(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");const e=this.GetCurrentImageInfo();if(e)return e.GetWidth()}GetOriginalHeight(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");const e=this.GetCurrentImageInfo();if(e)return e.GetHeight()}GetCurrentImageInfo(){return null}GetCurrentSurfaceSize(){const e=this.GetCurrentImageInfo();if(e){const t=e.GetTexture();if(t)return[t.GetWidth(),t.GetHeight()]}return[100,100]}GetCurrentTexRect(){const e=this.GetCurrentImageInfo();return e?e.GetTexRect():null}GetCurrentTexQuad(){const e=this.GetCurrentImageInfo();return e?e.GetTexQuad():null}IsCurrentTexRotated(){const e=this.GetCurrentImageInfo();return!!e&&e.IsRotated()}GetImagePoint(e){const t=this._inst.GetWorldInfo();return[t.GetX(),t.GetY()]}LoadTilemapData(e,t,s){}TestPointOverlapTile(e,t){}RendersToOwnZPlane(){return!0}}}{const e=self.C3,t=e.New(e.Rect);e.SDKDOMInstanceBase=class extends e.SDKWorldInstanceBase{constructor(t,s){super(t,s),this._elementId=this.GetPlugin()._AddElement(this),this._isElementShowing=!0,this._elemHasFocus=!1,this._autoFontSize=!1,this._autoFontSizeOffset=-.2,this._lastRect=e.New(e.Rect,0,0,-1,-1);const i=this._runtime.GetCanvasManager();this._lastWindowWidth=i.GetLastWidth(),this._lastWindowHeight=i.GetLastHeight(),this._isPendingUpdateState=!1,this._StartTicking()}Release(){this.GetPlugin()._RemoveElement(this._elementId),this.PostToDOMElement("destroy"),this._elementId=-1,super.Release()}_GetElementInDOMMode(){if(this._runtime.IsInWorker())throw new Error("not valid in worker mode");return this._PostToDOMElementMaybeSync("get-element")}PostToDOMElement(e,t){t||(t={}),t.elementId=this._elementId,this.PostToDOM(e,t)}_PostToDOMElementMaybeSync(e,t){return t||(t={}),t.elementId=this._elementId,this._PostToDOMMaybeSync(e,t)}PostToDOMElementAsync(e,t){return t||(t={}),t.elementId=this._elementId,this.PostToDOMAsync(e,t)}CreateElement(e){e||(e={});const t=this.GetWorldInfo().IsVisible();e.elementId=this._elementId,e.isVisible=t,Object.assign(e,this.GetElementState()),this._isElementShowing=!!e.isVisible,this._PostToDOMMaybeSync("create",e),this._UpdatePosition(!0)}SetElementVisible(e){e=!!e,this._isElementShowing!==e&&(this._isElementShowing=e,this.PostToDOMElement("set-visible",{isVisible:e}))}Tick(){this._UpdatePosition(!1)}_ShouldPreserveElement(){const t=this._runtime.GetCanvasManager().GetFullscreenMode();return"Android"===e.Platform.OS&&("scale-inner"===t||"scale-outer"===t||"crop"===t)}_UpdatePosition(e){const s=this.GetWorldInfo(),i=s.GetLayer(),r=s.GetBoundingBox();let[n,a]=i.LayerToCanvasCss(r.getLeft(),r.getTop()),[o,h]=i.LayerToCanvasCss(r.getRight(),r.getBottom());const l=this._runtime.GetCanvasManager(),c=l.GetCssWidth(),u=l.GetCssHeight();if(!s.IsVisible()||!i.IsVisible())return void this.SetElementVisible(!1);if(!this._ShouldPreserveElement()){if(o<=0||h<=0||n>=c||a>=u)return void this.SetElementVisible(!1);n<1&&(n=1),a<1&&(a=1),o>=c&&(o=c-1),h>=u&&(h=u-1)}t.set(n,a,o,h);const _=l.GetLastWidth(),d=l.GetLastHeight();if(!e&&t.equals(this._lastRect)&&this._lastWindowWidth===_&&this._lastWindowHeight===d)return void this.SetElementVisible(!0);this._lastRect.copy(t),this._lastWindowWidth=_,this._lastWindowHeight=d,this.SetElementVisible(!0);let p=null;this._autoFontSize&&(p=i.GetDisplayScale()+this._autoFontSizeOffset),this.PostToDOMElement("update-position",{left:Math.round(this._lastRect.getLeft())+l.GetCanvasClientX(),top:Math.round(this._lastRect.getTop())+l.GetCanvasClientY(),width:Math.round(this._lastRect.width()),height:Math.round(this._lastRect.height()),fontSize:p})}FocusElement(){this._PostToDOMElementMaybeSync("focus",{focus:!0})}BlurElement(){this._PostToDOMElementMaybeSync("focus",{focus:!1})}_OnElemFocused(){this._elemHasFocus=!0}_OnElemBlurred(){this._elemHasFocus=!1}IsElementFocused(){return this._elemHasFocus}SetElementCSSStyle(t,s){this.PostToDOMElement("set-css-style",{prop:e.CSSToCamelCase(t),val:s})}SetElementAttribute(e,t){this.PostToDOMElement("set-attribute",{name:e,val:t})}RemoveElementAttribute(e){this.PostToDOMElement("remove-attribute",{name:e})}UpdateElementState(){this._isPendingUpdateState||(this._isPendingUpdateState=!0,Promise.resolve().then((()=>{this._isPendingUpdateState=!1,this.PostToDOMElement("update-state",this.GetElementState())})))}GetElementState(){}GetElementId(){return this._elementId}}}{const e=self.C3,t=self.IBehavior;e.SDKBehaviorBase=class extends e.DefendedBase{constructor(t){super(),this._runtime=t.runtime,this._myObjectClasses=e.New(e.ArraySet),this._myInstances=e.New(e.ArraySet),this._iBehavior=null,this._scriptInterfaceClass=t.scriptInterfaceClass||null}Release(){this._myInstances.Release(),this._myObjectClasses.Release(),this._runtime=null}GetRuntime(){return this._runtime}OnCreate(){}_AddObjectClass(e){this._myObjectClasses.Add(e)}GetObjectClasses(){return this._myObjectClasses.GetArray()}_AddInstance(e){this._myInstances.Add(e)}_RemoveInstance(e){this._myInstances.Delete(e)}GetInstances(){return this._myInstances.GetArray()}GetIBehavior(){if(null===this._iBehavior){const e=this._scriptInterfaceClass;if(e){if(this._iBehavior=new e(this),!(this._iBehavior instanceof t))throw new TypeError("script interface class must derive from IBehavior")}else this._iBehavior=new t(this)}return this._iBehavior}}}{const e=self.C3;e.SDKBehaviorTypeBase=class extends e.DefendedBase{constructor(e){super(),this._runtime=e.GetRuntime(),this._behaviorType=e,this._objectClass=e.GetObjectClass(),this._behavior=e.GetBehavior(),this._behavior._AddObjectClass(this._objectClass)}Release(){this._runtime=null,this._behaviorType=null,this._objectClass=null,this._behavior=null}OnCreate(){}GetBehaviorType(){return this._behaviorType}GetObjectClass(){return this._objectClass}GetRuntime(){return this._runtime}GetBehavior(){return this._behavior}}}{const e=self.C3;e.SDKBehaviorInstanceBase=class extends e.DefendedBase{constructor(e,t){super(),this._behInst=e,this._domComponentId=t,this._inst=e.GetObjectInstance(),this._runtime=e.GetRuntime(),this._behaviorType=e.GetBehaviorType(),this._sdkType=this._behaviorType.GetSdkType(),this._isTicking=!1,this._isTicking2=!1,this._isPostTicking=!1,this._disposables=null}Release(){this._StopTicking(),this._StopTicking2(),this._StopPostTicking(),this._disposables&&(this._disposables.Release(),this._disposables=null),this._behInst=null,this._inst=null,this._runtime=null,this._behaviorType=null,this._sdkType=null}GetBehavior(){return this._behaviorType.GetBehavior()}GetBehaviorInstance(){return this._behInst}GetObjectInstance(){return this._inst}GetObjectClass(){return this._inst.GetObjectClass()}GetWorldInfo(){return this._inst.GetWorldInfo()}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetSdkType(){return this._sdkType}GetScriptInterface(){return this._behInst.GetScriptInterface()}Trigger(e){return this._runtime.Trigger(e,this._inst,this._behaviorType)}DebugTrigger(e){return this._runtime.DebugTrigger(e,this._inst,this._behaviorType)}TriggerAsync(e){return this._runtime.TriggerAsync(e,this._inst,this._behaviorType)}PostCreate(){}Tick(){}Tick2(){}PostTick(){}_StartTicking(){this._isTicking||(this._runtime._AddBehInstToTick(this),this._isTicking=!0)}_StopTicking(){this._isTicking&&(this._runtime._RemoveBehInstToTick(this),this._isTicking=!1)}IsTicking(){return this._isTicking}_StartTicking2(){this._isTicking2||(this._runtime._AddBehInstToTick2(this),this._isTicking2=!0)}_StopTicking2(){this._isTicking2&&(this._runtime._RemoveBehInstToTick2(this),this._isTicking2=!1)}IsTicking2(){return this._isTicking2}_StartPostTicking(){this._isPostTicking||(this._runtime._AddBehInstToPostTick(this),this._isPostTicking=!0)}_StopPostTicking(){this._isPostTicking&&(this._runtime._RemoveBehInstToPostTick(this),this._isPostTicking=!1)}IsPostTicking(){return this._isPostTicking}GetDebuggerProperties(){return[]}AddDOMMessageHandler(e,t){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,e,t)}OnSpriteFrameChanged(e,t){}SaveToJson(){return null}LoadFromJson(e){}GetPropertyValueByIndex(e){}SetPropertyValueByIndex(e,t){}OffsetPropertyValueByIndex(e,t){if(0===t)return;const s=this.GetPropertyValueByIndex(e);if("number"!=typeof s)throw new Error("expected number");this.SetPropertyValueByIndex(e,s+t)}SetPropertyColorOffsetValueByIndex(e,t,s,i){}CallAction(e,...t){e.call(this,...t)}CallExpression(e,...t){return e.call(this,...t)}GetScriptInterfaceClass(){return null}DispatchScriptEvent(t,s,i){if(!this._behInst.HasScriptInterface())return;const r=this.GetScriptInterface(),n=e.New(e.Event,t,s);n.behaviorInstance=r,n.instance=r.instance,i&&Object.assign(n,i),r.dispatchEvent(n)}}}{const e=self.C3;e.Plugins={},e.Behaviors={},e.PluginManager=class extends e.DefendedBase{constructor(e){super(),this._runtime=e,this._allPlugins=[],this._pluginsByCtor=new Map,this._systemPlugin=null,this._allBehaviors=[],this._behaviorsByCtor=new Map,this._solidBehavior=null,this._jumpthruBehavior=null}CreatePlugin(t){const s=this._runtime.GetObjectReference(t[0]);if(!s)throw new Error("missing plugin");e.AddCommonACEs(t,s);const i=e.New(s,{runtime:this._runtime,isSingleGlobal:t[1],isWorld:t[2],isRotatable:t[5],hasEffects:t[8],mustPredraw:t[9],supportsSceneGraph:t[13],supportsMesh:t[14]});i.OnCreate(),this._allPlugins.push(i),this._pluginsByCtor.set(s,i)}CreateSystemPlugin(){this._systemPlugin=e.New(e.Plugins.System,{runtime:this._runtime,isSingleGlobal:!0}),this._systemPlugin.OnCreate()}CreateBehavior(t){const s=this._runtime.GetObjectReference(t[1]);if(!s)throw new Error("missing behavior");const i=e.New(s,{runtime:this._runtime});i.OnCreate(),this._allBehaviors.push(i),this._behaviorsByCtor.set(s,i),!this._solidBehavior&&e.Behaviors.solid&&i instanceof e.Behaviors.solid?this._solidBehavior=i:!this._jumpthruBehavior&&e.Behaviors.jumpthru&&i instanceof e.Behaviors.jumpthru&&(this._jumpthruBehavior=i)}GetPluginByConstructorFunction(e){return this._pluginsByCtor.get(e)||null}HasBehaviorByConstructorFunction(e){return this._behaviorsByCtor.has(e)}GetBehaviorByConstructorFunction(e){return this._behaviorsByCtor.get(e)||null}GetSystemPlugin(){return this._systemPlugin}GetSolidBehavior(){return this._solidBehavior}GetJumpthruBehavior(){return this._jumpthruBehavior}}}{const e=self.C3,t=new Set;e.ImageInfo=class extends e.DefendedBase{constructor(){super(),this._generation=0,this._url="",this._size=0,this._offsetX=0,this._offsetY=0,this._width=0,this._height=0,this._isRotated=!1,this._hasMetaData=!1,this._imageAsset=null,this._textureState="",this._rcTex=e.New(e.Rect),this._quadTex=e.New(e.Quad),this._blobUrl="",this._iImageInfo=new self.IImageInfo(this),t.add(this)}Release(){this.ReleaseTexture(),this._imageAsset=null,t.delete(this),this.ReleaseBlobURL()}static OnRendererContextLost(){for(const e of t)e._textureState="",e._rcTex.set(0,0,0,0),e._quadTex.setFromRect(e._rcTex)}LoadData(e){this._url=e[0],this._size=e[1],this._offsetX=e[2],this._offsetY=e[3],this._width=e[4],this._height=e[5],this._isRotated=e[6],this._hasMetaData=!0}LoadDynamicAsset(t,s){if(this._imageAsset)throw new Error("already loaded asset");this._url=s;const i={};return e.IsAbsoluteURL(s)&&(i.loadPolicy="remote"),this.LoadAsset(t,i),this._imageAsset.Load()}ReplaceWith(e){if(e===this)throw new Error("cannot replace with self");this._generation++,this.ReleaseTexture(),this._url=e._url,this._size=e._size,this._offsetX=e._offsetX,this._offsetY=e._offsetY,this._width=e._width,this._height=e._height,this._isRotated=e._isRotated,this._hasMetaData=e._hasMetaData,this._imageAsset=e._imageAsset,this._textureState=e._textureState,this._rcTex=e._rcTex,this._quadTex=e._quadTex,this.ReleaseBlobURL()}GetURL(){return this._url}GetSize(){return this._size}GetOffsetX(){return this._offsetX}GetOffsetY(){return this._offsetY}IsRotated(){return this._isRotated}GetWidth(){return this._width}GetHeight(){return this._height}GetSheetWidth(){return this._imageAsset.GetWidth()}GetSheetHeight(){return this._imageAsset.GetHeight()}LoadAsset(e,t){if(this._imageAsset)throw new Error("already got asset");t=Object.assign({},t,{url:this.GetURL(),size:this.GetSize()}),this._imageAsset=e.LoadImage(t)}IsLoaded(){return this._imageAsset&&this._imageAsset.IsLoaded()}async LoadStaticTexture(e,t){if(!this._imageAsset)throw new Error("no asset");if(this._textureState)throw new Error("already loaded texture");const s=this._generation;this._textureState="loading";const i=await this._imageAsset.LoadStaticTexture(e,t);if(this._generation!==s)return null;if(!i)return this._textureState="",null;this._textureState="loaded",this._hasMetaData||(this._width=i.GetWidth(),this._height=i.GetHeight(),this._hasMetaData=!0);const r=this._isRotated?this._height:this._width,n=this._isRotated?this._width:this._height;return this._rcTex.set(this._offsetX,this._offsetY,this._offsetX+r,this._offsetY+n),this._rcTex.divide(i.GetWidth(),i.GetHeight()),this._quadTex.setFromRect(this._rcTex),this._isRotated&&this._quadTex.rotatePointsAnticlockwise(),i}ReleaseTexture(){this._textureState&&(this._imageAsset&&this._imageAsset.ReleaseTexture(),this._textureState="",this._rcTex.set(0,0,0,0),this._quadTex.setFromRect(this._rcTex))}GetTexture(){return this._imageAsset?this._imageAsset.GetTexture():null}GetTexRect(){return this._rcTex}GetTexQuad(){return this._quadTex}GetIImageInfo(){return this._iImageInfo}async ExtractImageToCanvas(){const t=await this._imageAsset.LoadToDrawable(),s=e.CreateCanvas(this._width,this._height),i=s.getContext("2d");return this._isRotated?(i.rotate(Math.PI/-2),i.translate(-this._height,0),i.drawImage(t,this._offsetX,this._offsetY,this._height,this._width,0,0,this._height,this._width)):i.drawImage(t,this._offsetX,this._offsetY,this._width,this._height,0,0,this._width,this._height),s}async ExtractImageToBlobURL(){if(this._blobUrl)return this._blobUrl;const t=await this.ExtractImageToCanvas(),s=await e.CanvasToBlob(t);return this._blobUrl=URL.createObjectURL(s),this._blobUrl}ReleaseBlobURL(){this._blobUrl&&(URL.revokeObjectURL(this._blobUrl),this._blobUrl="")}}}{const e=self.C3;e.AnimationInfo=class extends e.DefendedBase{constructor(t){super(),this._name=t[0],this._speed=t[1],this._isLooping=!!t[2],this._repeatCount=t[3],this._repeatTo=t[4],this._isPingPong=!!t[5],this._sid=t[6],this._frames=t[7].map((t=>e.New(e.AnimationFrameInfo,t))),this._iAnimation=new self.IAnimation(this)}Release(){for(const e of this._frames)e.Release();e.clearArray(this._frames)}LoadAllAssets(e){for(const t of this._frames)t.GetImageInfo().LoadAsset(e)}LoadAllTextures(e,t){return Promise.all(this._frames.map((s=>s.GetImageInfo().LoadStaticTexture(e,t))))}ReleaseAllTextures(){for(const e of this._frames)e.GetImageInfo().ReleaseTexture()}GetName(){return this._name}GetSID(){return this._sid}GetFrameCount(){return this._frames.length}GetFrames(){return this._frames}GetFrameAt(e){if((e=Math.floor(e))<0||e>=this._frames.length)throw new RangeError("invalid frame");return this._frames[e]}GetSpeed(){return this._speed}IsLooping(){return this._isLooping}GetRepeatCount(){return this._repeatCount}GetRepeatTo(){return this._repeatTo}IsPingPong(){return this._isPingPong}GetIAnimation(){return this._iAnimation}}}{const e=self.C3;e.AnimationFrameInfo=class extends e.DefendedBase{constructor(t){super(),this._imageInfo=e.New(e.ImageInfo),this._imageInfo.LoadData(t),this._duration=t[7],this._origin=e.New(e.Vector2,t[8],t[9]),this._imagePoints=t[10].map((t=>e.New(e.ImagePoint,this,t))),this._imagePointsByName=new Map;for(const e of this._imagePoints)this._imagePointsByName.set(e.GetName().toLowerCase(),e);this._collisionPoly=null;const s=t[11];s.length>=6&&(this._collisionPoly=e.New(e.CollisionPoly,s)),this._iAnimationFrame=new self.IAnimationFrame(this)}Release(){this._collisionPoly&&(this._collisionPoly.Release(),this._collisionPoly=null),this._imageInfo.Release(),this._imageInfo=null}GetImageInfo(){return this._imageInfo}GetDuration(){return this._duration}GetOriginX(){return this._origin.getX()}GetOriginY(){return this._origin.getY()}GetCollisionPoly(){return this._collisionPoly}GetImagePointByName(e){return this._imagePointsByName.get(e.toLowerCase())||null}GetImagePointByIndex(e){return(e=Math.floor(e))<0||e>=this._imagePoints.length?null:this._imagePoints[e]}GetImagePointCount(){return this._imagePoints.length}GetIAnimationFrame(){return this._iAnimationFrame}}}{const e=self.C3;e.ImagePoint=class extends e.DefendedBase{constructor(t,s){super(),this._afi=t,this._name=s[0],this._pos=e.New(e.Vector2,s[1],s[2])}Release(){}GetName(){return this._name}GetX(){return this._pos.getX()}GetY(){return this._pos.getY()}GetVec2(){return this._pos}}}{const e=self.C3,t=self.C3Debugger,s=self.IObjectClass,i=self.assert;e.ObjectClass=class extends e.DefendedBase{constructor(t,i,r){super();const n=t.GetObjectReference(r[1]);if(this._runtime=t,this._plugin=t.GetPluginManager().GetPluginByConstructorFunction(n),this._sdkType=null,this._instSdkCtor=n.Instance,this._index=i,this._sid=r[11],this._name=r[0],this._jsPropName=this._runtime.GetJsPropName(r[14]),this._isGlobal=!!r[9],this._isFamily=!!r[2],this._isOnLoaderLayout=!!r[10],this._instVars=r[3].map((e=>({sid:e[0],type:e[1],name:e[2],jsPropName:t.GetJsPropName(e[3])}))),this._behaviorsCount=r[4],this._effectsCount=r[5],this._isWorldType=this._plugin.IsWorldType(),this._effectList=null,this._collisionGrid=e.New(e.SparseGrid,t.GetOriginalViewportWidth(),t.GetOriginalViewportHeight()),this._anyCollisionCellChanged=!0,this._anyInstanceParallaxed=!1,this._familyMembers=null,this._familyMembersSet=null,this._familyIndex=-1,this._families=null,this._familiesSet=null,this._familyInstVarMap=null,this._familyBehaviorMap=null,this._familyEffectMap=null,this._isInContainer=!1,this._container=null,this._behaviorTypes=r[8].map((t=>e.BehaviorType.Create(this,t))),this._behaviorTypesIncludingInherited=[],this._behaviorsByName=new Map,this._behaviorNameToIndex=new Map,this._usedBehaviorCtors=new Set,this._customActionMap=new Map,this._solStack=e.New(e.SolStack,this),this._defaultInstanceData=null,this._defaultLayerIndex=0,this._isContained=!1,this._container=null,this._imageInfo=null,this._animations=null,this._animationsByName=null,this._animationsBySid=null,this._textureRefCount=0,this._savedData=new Map,this._unsavedData=new Map,this._instances=[],this._iidsStale=!0,this._plugin.HasEffects()&&(this._effectList=e.New(e.EffectList,this,r[12])),r[6]&&(this._imageInfo=e.New(e.ImageInfo),this._imageInfo.LoadData(r[6])),r[7]){this._animations=r[7].map((t=>e.New(e.AnimationInfo,t))),this._animationsByName=new Map,this._animationsBySid=new Map;for(const e of this._animations)this._animationsByName.set(e.GetName().toLowerCase(),e),this._animationsBySid.set(e.GetSID(),e)}this._isFamily?(this._familyMembers=[],this._familyMembersSet=new Set,this._familyIndex=this._runtime._GetNextFamilyIndex()):(this._families=[],this._familiesSet=new Set,this._familyInstVarMap=[],this._familyBehaviorMap=[],this._familyEffectMap=[]),this._sdkType=e.New(n.Type,this,r[15]),this._iObjectClass=null,this._instanceUserScriptClass=null,this._userScriptDispatcher=e.New(e.Event.Dispatcher);const a=this._sdkType.GetScriptInterfaceClass();if(a){if(this._iObjectClass=new a(this),!(this._iObjectClass instanceof s))throw new TypeError("script interface class must derive from IObjectClass")}else this._iObjectClass=new s(this);if(r[13]){const e=r[13];if(e){const t=e[0],s=e[1],i=e[2];this._sdkType.LoadTilemapData(t,s,i)}}this._runtime.UsesLoaderLayout()&&!this._isFamily&&!this._isOnLoaderLayout&&this._isWorldType||this.OnCreate(),this._plugin.IsSingleGlobal()&&(this._plugin._SetSingleGlobalObjectClass(this),this._CreateSingleGlobalInstance(r)),this._loadInstancesJson=null}static Create(t,s,i){return e.New(e.ObjectClass,t,s,i)}Release(){if(this._imageInfo&&(this._imageInfo.Release(),this._imageInfo=null),this._animations){for(const e of this._animations)e.Release();e.clearArray(this._animations),this._animationsByName.clear(),this._animationsBySid.clear()}this._loadInstancesJson=null,this._solStack.Release(),this._solStack=null,this._savedData.clear(),this._unsavedData.clear(),this._container=null,this._runtime=null}_LoadFamily(e){for(let t=1,s=e.length;t<s;++t){const s=this._runtime.GetObjectClassByIndex(e[t]);this._familyMembers.push(s),this._familyMembersSet.add(s),s._families.push(this),s._familiesSet.add(this)}}_SetContainer(e){this._isInContainer=!0,this._container=e}IsInContainer(){return this._isInContainer}GetContainer(){return this._container}_OnAfterCreate(){let t=0;if(!this._isFamily)for(const e of this._families)for(const s of e.GetBehaviorTypes()){const e=s.GetName().toLowerCase();this._behaviorsByName.set(e,s),this._behaviorNameToIndex.set(e,t),this._behaviorTypesIncludingInherited.push(s),++t}for(const e of this.GetBehaviorTypes()){const s=e.GetName().toLowerCase();this._behaviorsByName.set(s,e),this._behaviorNameToIndex.set(s,t),this._behaviorTypesIncludingInherited.push(e),++t}for(const e of this._behaviorTypesIncludingInherited)this._usedBehaviorCtors.add(e.GetBehavior().constructor);if(!this._isFamily&&this._families.length){const t=this._runtime.GetFamilyCount();e.extendArray(this._familyInstVarMap,t,0),e.extendArray(this._familyBehaviorMap,t,0),e.extendArray(this._familyEffectMap,t,0);const s=[];let i=0,r=0,n=0;for(const e of this._families){const t=e.GetFamilyIndex();this._familyInstVarMap[t]=i,i+=e.GetInstanceVariablesCount(),this._familyBehaviorMap[t]=r,r+=e.GetBehaviorTypesCount(),this._familyEffectMap[t]=n,n+=e.GetEffectTypesCount();const a=e.GetEffectList();if(a&&this._effectList)for(const e of a.GetAllEffectTypes())s.push(e.Clone(this._effectList))}this._effectList&&this._effectList.PrependEffectTypes(s)}}_CreateSingleGlobalInstance(t){const s=this._runtime._GetNewUID(),i=e.New(e.Instance,{runtime:this._runtime,objectType:this,uid:s});i._CreateSdkInstance(t[16],[]),this._runtime._MapInstanceByUID(s,i),this._instances.push(i)}GetSdkType(){return this._sdkType}IsOnLoaderLayout(){return this._isOnLoaderLayout}OnCreate(){this._isFamily||this._sdkType.OnCreate()}HasLoadedTextures(){return this._textureRefCount>0}LoadTextures(e){return this._isFamily?Promise.resolve():(this._textureRefCount++,1===this._textureRefCount&&this._sdkType.LoadTextures(e)||Promise.resolve())}ReleaseTextures(){if(!this._isFamily){if(this._textureRefCount--,this._textureRefCount<0)throw new Error("released textures too many times");0===this._textureRefCount&&this._sdkType.ReleaseTextures()}}OnDynamicTextureLoadComplete(){if(this._isFamily)throw new Error("not applicable to family");this._sdkType.OnDynamicTextureLoadComplete()}PreloadTexturesWithInstances(e){return this._isFamily?Promise.resolve():this._sdkType.PreloadTexturesWithInstances(e)}GetRuntime(){return this._runtime}GetPlugin(){return this._plugin}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetJsPropName(){return this._jsPropName}GetIndex(){return this._index}GetSID(){return this._sid}IsFamily(){return this._isFamily}IsGlobal(){return this._isGlobal}IsWorldType(){return this._isWorldType}GetFamilyIndex(){return this._familyIndex}GetBehaviorTypes(){return this._behaviorTypes}GetBehaviorTypesCount(){return this._behaviorsCount}UsesBehaviorByCtor(e){return e&&this._usedBehaviorCtors.has(e)}GetInstanceVariablesCount(){return this._instVars.length}GetInstanceVariableSIDs(){return this._instVars.map((e=>e.sid))}GetInstanceVariableIndexBySID(e){return this._instVars.findIndex((t=>t.sid===e))}GetInstanceVariableIndexByName(e){return this._instVars.findIndex((t=>t.name===e))}_GetAllInstanceVariableNames(){return this._instVars.map((e=>e.name))}_GetAllInstanceVariableJsPropNames(){return this._instVars.map((e=>e.jsPropName))}GetInstanceVariableType(e){if((e=Math.floor(e))<0||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].type}GetInstanceVariableName(e){if((e=Math.floor(e))<0||e>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[e].name}GetEffectTypesCount(){return this._effectsCount}GetBehaviorTypesIncludingInherited(){return this._behaviorTypesIncludingInherited}GetBehaviorTypeByName(e){return this._behaviorsByName.get(e.toLowerCase())||null}GetBehaviorIndexByName(e){const t=this._behaviorNameToIndex.get(e.toLowerCase());return void 0===t?-1:t}GetEffectList(){return this._effectList}HasEffects(){return this._plugin.HasEffects()}UsesEffects(){return this._effectList&&this._effectList.HasAnyEffectType()}GetSolStack(){return this._solStack}GetCurrentSol(){return this._solStack.GetCurrentSol()}GetImageInfo(){return this._imageInfo}SetDefaultInstanceData(e){this._defaultInstanceData=e}GetDefaultInstanceData(){return this._defaultInstanceData}_SetDefaultLayerIndex(e){this._defaultLayerIndex=e}GetDefaultLayerIndex(){return this._defaultLayerIndex}GetAnimations(){return this._animations}GetAnimationCount(){return this._animations.length}GetFamilies(){return this._families}BelongsToFamily(e){return this._familiesSet.has(e)}GetFamilyMembers(){return this._familyMembers}FamilyHasMember(e){return this._familyMembersSet.has(e)}GetFamilyBehaviorOffset(e){return this._familyBehaviorMap[e]}GetFamilyInstanceVariableOffset(e){return this._familyInstVarMap[e]}AddCustomAction(e){this._customActionMap.set(e.GetACEName().toLowerCase(),e)}HasOwnCustomActionByName(e){return this._customActionMap.has(e.toLowerCase())}GetOwnCustomActionByName(e){return this._customActionMap.get(e.toLowerCase())}GetAnimationByName(e){if(!this._animations)throw new Error("no animations");return this._animationsByName.get(e.toLowerCase())||null}GetAnimationBySID(e){if(!this._animations)throw new Error("no animations");return this._animationsBySid.get(e)||null}GetFirstAnimationFrame(){if(!this._animations)throw new Error("no animations");return this._animations[0].GetFrameAt(0)}GetDefaultInstanceSize(){if(this._animations){const e=this.GetFirstAnimationFrame().GetImageInfo();return[e.GetWidth(),e.GetHeight()]}return this._imageInfo?[this._imageInfo.GetWidth(),this._imageInfo.GetHeight()]:[100,100]}GetSingleGlobalInstance(){if(!this._plugin.IsSingleGlobal())throw new Error("not a single-global plugin");return this._instances[0]}GetInstances(){return this._instances}*instances(){yield*this._instances}*instancesIncludingPendingCreate(){yield*this._instances,yield*this._runtime.instancesPendingCreateForObjectClass(this)}GetInstanceCount(){return this._instances.length}_AddInstance(e){this._instances.push(e)}_SetIIDsStale(){this._iidsStale=!0}_UpdateIIDs(){if(!this._iidsStale||this._isFamily)return;const e=this._instances;let t=0;for(let s=e.length;t<s;++t)e[t]._SetIID(t);const s=this._runtime._GetInstancesPendingCreate();for(const e of s)e.GetObjectClass()===this&&e._SetIID(t++);this._iidsStale=!1}GetInstanceByIID(e){const t=this._instances;if(e<t.length)return t[e];e-=t.length;const s=this._runtime._GetInstancesPendingCreate();for(const t of s)if(t.GetObjectClass()===this){if(0===e)return t;--e}return null}GetFirstPicked(e){if(e&&e.IsInContainer()&&e.GetObjectClass()!==this)for(const t of e.siblings())if(t.GetObjectClass()===this)return t;const t=this.GetCurrentSol().GetInstances();return t.length?t[0]:null}GetPairedInstance(e){const t=this.GetCurrentSol().GetInstances();return t.length>0?t[e.GetIID()%t.length]:null}*allCorrespondingInstances(e,t){const s=this.GetCurrentSol().GetInstances(),i=s.length,r=t.GetCurrentSol(),n=t.GetCurrentSol().GetInstances(),a=n.length;let o=e.GetIID();!t.IsFamily()&&r.IsSelectAll()||(o=n.indexOf(e));const h=Math.ceil(i/a),l=i%a;let c=0,u=0;0===l||o<l?(c=o*h,u=h):(c=l*h+(o-l)*(h-1),u=h-1);for(let e=c,t=c+u;e<t;++e)yield s[e]}FinishCondition(e){this._sdkType.FinishCondition(e)}ApplySolToContainer(){if(!this._isInContainer||this._isFamily)return;this._UpdateIIDs();const t=this.GetCurrentSol(),s=t._GetOwnInstances(),i=t.IsSelectAll(),r=this._runtime.GetCurrentEventStackFrame(),n=r&&r.GetCurrentEvent()&&r.GetCurrentEvent().IsOrBlock();for(const r of this._container.objectTypes()){if(r===this)continue;r._UpdateIIDs();const a=r.GetCurrentSol();if(a._SetSelectAll(i),!i){const i=a._GetOwnInstances();e.clearArray(i);for(const e of s)i.push(r.GetInstanceByIID(e.GetIID()));if(n){const s=t._GetOwnElseInstances(),i=a._GetOwnElseInstances();e.clearArray(i);for(const e of s)i.push(r.GetInstanceByIID(e.GetIID()))}}}}_TruncateContainerSols(t,s){for(const i of this.GetContainer().objectTypes()){const r=i.GetCurrentSol();t?e.truncateArray(r._GetOwnElseInstances(),s):e.truncateArray(r._GetOwnInstances(),s)}}_GetCollisionCellGrid(){return this._collisionGrid}_SetAnyCollisionCellChanged(e){this._anyCollisionCellChanged=!!e}_SetAnyInstanceParallaxed(e){this._anyInstanceParallaxed=!!e}IsAnyInstanceParallaxed(){return this._anyInstanceParallaxed}_UpdateAllCollisionCells(){if(this._anyCollisionCellChanged&&this._isWorldType){for(const e of this._instances)e.GetWorldInfo()._UpdateCollisionCell();for(const e of this._runtime._GetInstancesPendingCreate())e.GetObjectClass()===this&&e.GetWorldInfo()._UpdateCollisionCell();this._anyCollisionCellChanged=!1}}GetSavedDataMap(){return this._savedData||(this._savedData=new Map),this._savedData}GetUnsavedDataMap(){return this._unsavedData||(this._unsavedData=new Map),this._unsavedData}HasSolidBehavior(){return this.UsesBehaviorByCtor(e.Behaviors.solid)}HasJumpthruBehavior(){return this.UsesBehaviorByCtor(e.Behaviors.jumpthru)}HasNoSaveBehavior(){return this.UsesBehaviorByCtor(e.Behaviors.NoSave)}HasPersistBehavior(){return this.UsesBehaviorByCtor(e.Behaviors.Persist)}_SaveToJson(){const t={instances:this._instances.map((e=>e.SaveToJson()))};return this._savedData&&this._savedData.size&&(t.ex=e.ToSuperJSON(this._savedData)),t}_LoadFromJson(t){this._savedData&&(this._savedData.clear(),this._savedData=null);const s=t.ex;s&&(this._savedData=e.FromSuperJSON(s));const i=this._instances,r=t.instances;for(let e=0,t=Math.min(i.length,r.length);e<t;++e)i[e].LoadFromJson(r[e]);for(let e=r.length,t=i.length;e<t;++e)this._runtime.DestroyInstance(i[e]);for(let e=i.length,t=r.length;e<t;++e){const t=r[e];let s=null;if(this.IsWorldType()&&(s=this._runtime.GetMainRunningLayout().GetLayerBySID(t.w.l),!s))continue;this._runtime.CreateInstanceFromData(this._defaultInstanceData||this,s,!1,0,0,!0).LoadFromJson(t)}this._loadInstancesJson=r,this._SetIIDsStale()}_GetLoadInstancesJson(){return this._loadInstancesJson}_ClearLoadInstancesJson(){this._loadInstancesJson=null}_SetupSceneGraphConnectionsOnChangeOfLayout(){for(let e=0,t=this._instances;e<t;++e)this._instances[e]._SetupSceneGraphConnectionsOnChangeOfLayout()}GetIObjectClass(){return this._iObjectClass}UserScriptDispatcher(){return this._userScriptDispatcher}_GetUserScriptInstanceClass(){return this._instanceUserScriptClass}_SetUserScriptInstanceClass(e){this._instanceUserScriptClass=e}DispatchUserScriptEvent(e){const s=this._runtime,i=s.IsDebug()&&!s.GetEventSheetManager().IsInEventEngine();i&&t.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),i&&t.AddScriptTime()}}}{const e=self.C3;e.Container=class extends e.DefendedBase{constructor(e,t){super(),this._runtime=e,this._objectTypes=t;for(const e of this._objectTypes)e._SetContainer(this)}Release(){this._runtime=null}GetRuntime(){return this._runtime}GetObjectTypes(){return this._objectTypes}objectTypes(){return this._objectTypes}HasAnyWorldType(){return this._objectTypes.some((e=>e.IsWorldType()))}}}{const e=self.C3,t=self.C3Debugger,s=self.IInstance,i=[];let r=0;const n=new WeakMap,a=new WeakMap,o=1,h=2,l=4,c=8,u=16,_=32,d=64;e.Instance=class extends e.DefendedBase{constructor(t){super(),this._runtime=t.runtime,this._objectType=t.objectType,this._worldInfo=null,this._sdkInst=null,this._iScriptInterface=null,this._iid=0,this._uid=t.uid,this._puid=r++,this._flags=0,this._instVarValues=i,this._behaviorInstances=i;const s=this._objectType.GetBehaviorTypesIncludingInherited();s.length>0&&(this._behaviorInstances=s.map(((t,s)=>e.New(e.BehaviorInstance,{runtime:this._runtime,behaviorType:t,instance:this,index:s})))),this._siblings=this._objectType.IsInContainer()?[]:null,this._timeScale=-1,this._dispatcher=null;const n=this.GetPlugin();if(n.MustPreDraw()&&(this._flags|=l),n.IsWorldType())if(this._worldInfo=e.New(e.WorldInfo,this,t.layer),t.worldData)this._worldInfo.Init(t.worldData);else{this._worldInfo.InitNoData();const[e,t]=this._objectType.GetDefaultInstanceSize();this._worldInfo.SetSize(e,t),this.GetObjectClass().UsesEffects()&&this._worldInfo.GetInstanceEffectList().LoadDefaultEffectParameters()}t.instVarData?this._LoadInstanceVariableData(t.instVarData):this._LoadDefaultInstanceVariables()}Release(){if(this._iScriptInterface&&(this._iScriptInterface._Release(),this._iScriptInterface=null),this._behaviorInstances.length>0){for(const e of this._behaviorInstances)e.Release();e.clearArray(this._behaviorInstances)}this._sdkInst.Release(),this._sdkInst=null;const t=n.get(this);t&&(t.clear(),n.delete(this));const s=a.get(this);s&&(s.clear(),a.delete(this)),this._siblings&&e.clearArray(this._siblings),this._dispatcher&&(this._dispatcher.Release(),this._dispatcher=null),this._runtime=null,this._objectType=null,this._instVarValues.length>0&&e.clearArray(this._instVarValues),this._worldInfo&&(this._worldInfo.Release(),this._worldInfo=null)}_LoadInstanceVariableData(t){t.length>0&&(this._instVarValues=[],e.shallowAssignArray(this._instVarValues,t))}_LoadDefaultInstanceVariables(){const e=this._objectType.GetInstanceVariablesCount();if(0===e)return;this._instVarValues=[];const t=[0,0,""];for(let s=0;s<e;++s)this._instVarValues.push(t[this._objectType.GetInstanceVariableType(s)])}_CreateSdkInstance(t,s){if(this._sdkInst)throw new Error("already got sdk instance");for(let e=0,t=this._behaviorInstances.length;e<t;++e){this._behaviorInstances[e]._CreateSdkInstance(s?s[e]:null)}if(this._sdkInst=e.New(this._objectType.GetInstanceSdkCtor(),this,t),!(this._sdkInst instanceof e.SDKInstanceBase))throw new Error("sdk type must derive from SDKInstanceBase");for(let e=0,t=this._behaviorInstances.length;e<t;++e)this._behaviorInstances[e].PostCreate();this._objectType._GetUserScriptInstanceClass()&&this._InitUserScriptInterface()}GetSdkInstance(){return this._sdkInst}GetWorldInfo(){return this._worldInfo}GetRuntime(){return this._runtime}GetTimeScale(){return this._timeScale}GetActiveTimeScale(){const e=this._timeScale;return-1===e?this.GetRuntime().GetTimeScale():e}SetTimeScale(e){((e=+e)<0||!isFinite(e))&&(e=0),this._timeScale=e,this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!0)}RestoreTimeScale(){this._timeScale=-1,this.GetObjectClass().UsesEffects()&&this._runtime._SetTrackingInstanceTime(this,!1)}GetInstanceGameTime(){return this._runtime._GetInstanceGameTime(this)}Dispatcher(){return this._dispatcher||(this._dispatcher=e.New(e.Event.Dispatcher)),this._dispatcher}Draw(e){this._sdkInst.Draw(e)}OnCreate(e){this._sdkInst.OnCreate(e)}_SetHasTilemap(){this._flags|=h}HasTilemap(){return 0!=(this._flags&h)}_MarkDestroyed(){this._flags|=o}IsDestroyed(){return 0!=(this._flags&o)}MustPreDraw(){return 0!=(this._flags&l)}SetMustMitigateZFighting(){this._flags|=_}MustMitigateZFighting(){return 0!=(this._flags&_)}_IsSolidEnabled(){return 0!=(this._flags&c)}_SetSolidEnabled(e){e?this._flags|=c:this._flags&=~c}_IsJumpthruEnabled(){return 0!=(this._flags&u)}_SetJumpthruEnabled(e){e?this._flags|=u:this._flags&=~u}_IsDrawingWithEffects(){return 0!=(this._flags&d)}_SetIsDrawingWithEffects(e){e?this._flags|=d:this._flags&=~d}SetFlag(e,t){e<<=16,t?this._flags|=e:this._flags&=~e}GetFlag(e){return 0!=(this._flags&e<<16)}GetCurrentImageInfo(){return this._sdkInst.GetCurrentImageInfo()}GetCurrentSurfaceSize(){return this._sdkInst.GetCurrentSurfaceSize()}GetCurrentTexRect(){return this._sdkInst.GetCurrentTexRect()}GetCurrentTexQuad(){return this._sdkInst.GetCurrentTexQuad()}IsCurrentTexRotated(){return this._sdkInst.IsCurrentTexRotated()}GetImagePoint(e){return this._sdkInst.GetImagePoint(e)}GetObjectClass(){return this._objectType}RendersToOwnZPlane(){return this._sdkInst.RendersToOwnZPlane()}BelongsToObjectClass(e){return e.IsFamily()?e.FamilyHasMember(this.GetObjectClass()):this.GetObjectClass()===e}CollectInstancesToPick(e,t,s){const i=(t,s)=>{const i=s||t.GetObjectClass(),r=e.get(i);r?r.add(t):e.set(i,new Set([t]))};if(i(this,t),this.IsInContainer())for(const e of this.siblings())i(e);if(s)for(const e of this.allChildren())i(e)}VerifySupportsSceneGraph(){if(!this.GetPlugin().SupportsSceneGraph())throw new Error("object does not support scene graph")}HasParent(){return null!==this.GetParent()}GetParent(){const e=this.GetWorldInfo();if(!e)return null;const t=e.GetParent();return t?t.GetInstance():null}GetTopParent(){const e=this.GetWorldInfo();if(!e)return null;const t=e.GetTopParent();return t?t.GetInstance():null}*parents(){const e=this.GetWorldInfo();if(e)for(const t of e.parents())yield t.GetInstance()}HasChild(e){if(!e)return!1;for(const t of this.children())if(t===e)return!0;return!1}HasChildren(){const e=this.GetWorldInfo();return!!e&&e.HasChildren()}GetChildrenOfObjectClass(e){const t=this.GetWorldInfo();if(!t)return[];const s=e.GetName();return t.GetChildren().map((e=>e.GetInstance())).filter((e=>e.GetObjectClass().GetName()===s))}GetChildren(){const e=this.GetWorldInfo();return e?e.GetChildren().map((e=>e.GetInstance())):[]}*children(){const e=this.GetWorldInfo();if(e)for(const t of e.children())yield t.GetInstance()}*allChildren(){const e=this.GetWorldInfo();if(e)for(const t of e.allChildren())yield t.GetInstance()}GetChildCount(){const e=this.GetWorldInfo();return e?e.GetChildCount():0}GetParentCount(){return[...this.parents()].length}GetAllChildCount(){const e=this.GetWorldInfo();return e?e.GetAllChildCount():0}GetChildAt(e){const t=this.GetWorldInfo();if(!t)return null;const s=t.GetChildAt(e);return s?s.GetInstance():null}AddChild(e,t){this.VerifySupportsSceneGraph(),e.VerifySupportsSceneGraph(),this.GetWorldInfo().AddChild(e.GetWorldInfo(),t||{})}RemoveChild(e){const t=this.GetWorldInfo();t&&t.RemoveChild(e.GetWorldInfo())}GetDestroyWithParent(){const e=this.GetWorldInfo();return!!e&&e.GetDestroyWithParent()}SetupInitialSceneGraphConnections(){const e=this.GetWorldInfo();if(!e)return;const t=e.GetSceneGraphChildrenExportData();if(t)for(const e of t){const t=this._runtime.GetInstanceByUID(e[2]);if(t){const s=e[3];this.AddChild(t,{transformX:!!(s>>0&1),transformY:!!(s>>1&1),transformWidth:!!(s>>2&1),transformHeight:!!(s>>3&1),transformAngle:!!(s>>4&1),destroyWithParent:!!(s>>5&1),transformZElevation:!!(s>>6&1),transformOpacity:!!(s>>7&1),transformVisibility:!!(s>>8&1)})}}}SetupPersistedSceneGraphConnections(e,t){const s=e.get(this);if(s)for(const e of s.sceneGraphJson.children){const s=t.get(e.index);if(!s)continue;const i=e.flags;this.AddChild(s,{transformX:!!(i>>0&1),transformY:!!(i>>1&1),transformWidth:!!(i>>2&1),transformHeight:!!(i>>3&1),transformAngle:!!(i>>4&1),destroyWithParent:!!(i>>5&1),transformZElevation:!!(i>>6&1),transformOpacity:!!(i>>7&1),transformVisibility:!!(i>>8&1)})}}IsInContainer(){return null!==this._siblings}_AddSibling(e){this._siblings.push(e)}GetSiblings(){return this._siblings}HasSibling(e){return!!this.GetSibling(e)}GetSibling(e){const t=this.siblings();if(null===t||0===t.length)return!1;for(const s of t)if(s.GetObjectClass()===e)return s;return null}siblings(){return this._siblings}SetSiblingsSinglePicked(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol().SetSinglePicked(e)}_PushSiblingsToSolInstances(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushInstance(e)}_SetSiblingsToSolInstancesIndex(e){for(const t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnInstances()[e]=t}_PushSiblingsToSolElseInstances(){for(const e of this.siblings())e.GetObjectClass().GetCurrentSol()._PushElseInstance(e)}_SetSiblingsToSolElseInstancesIndex(e){for(const t of this.siblings())t.GetObjectClass().GetCurrentSol()._GetOwnElseInstances()[e]=t}GetPlugin(){return this._objectType.GetPlugin()}_SetIID(e){this._iid=e}GetIID(){return this._objectType._UpdateIIDs(),this._iid}GetUID(){return this._uid}GetPUID(){return this._puid}GetBehaviorInstances(){return this._behaviorInstances}GetBehaviorInstanceFromCtor(e){if(!e)return null;for(const t of this._behaviorInstances)if(t.GetBehavior()instanceof e)return t;return null}GetBehaviorSdkInstanceFromCtor(e){if(!e)return null;const t=this.GetBehaviorInstanceFromCtor(e);return t?t.GetSdkInstance():null}GetBehaviorIndexBySID(e){const t=this._behaviorInstances;for(let s=0,i=t.length;s<i;++s)if(t[s].GetBehaviorType().GetSID()===e)return s;return-1}GetAllInstanceVariableValues(){return this._instVarValues}_GetAllInstanceVariableNames(){return this._objectType._GetAllInstanceVariableNames()}GetInstanceVariableCount(){return this._instVarValues.length}GetInstanceVariableValue(e){e|=0;const t=this._instVarValues;if(e<0||e>=t.length)throw new RangeError("invalid instance variable");return t[e]}_GetInstanceVariableValueUnchecked(e){return this._instVarValues[e]}_GetInstanceVariableTypedValue(e){const t=this._instVarValues[e];return 0===this._objectType.GetInstanceVariableType(e)?!!t:t}SetInstanceVariableValue(e,t){e|=0;const s=this._instVarValues;if(e<0||e>=s.length)throw new RangeError("invalid instance variable");switch(this._objectType.GetInstanceVariableType(e)){case 0:s[e]=t?1:0;break;case 1:s[e]="number"==typeof t?t:parseFloat(t);break;case 2:s[e]="string"==typeof t?t:t.toString();break;default:throw new Error("unknown instance variable type")}}SetInstanceVariableOffset(e,t){if(0===t)return;e|=0;const s=this._instVarValues;if(e<0||e>=s.length)throw new RangeError("invalid instance variable");const i=s[e];if("number"!=typeof i)throw"boolean"==typeof i?new Error("can not set offset of boolean variable"):"string"==typeof i?new Error("can not set offset of string variable"):new Error("unknown instance variable type");s[e]+="number"==typeof t?t:parseFloat(t)}GetSavedDataMap(){let e=n.get(this);return e||(e=new Map,n.set(this,e),e)}GetUnsavedDataMap(){let e=a.get(this);return e||(e=new Map,a.set(this,e),e)}_HasAnyCreateDestroyHandler(e){const t=this.GetObjectClass();if(t.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;for(const s of t.GetFamilies())if(s.UserScriptDispatcher().HasAnyHandlerFor(e))return!0;return!!this._runtime.UserScriptDispatcher().HasAnyHandlerFor(e)}_TriggerOnCreatedOnSelfAndRelated(){const e=new Set;e.add(this);const t=this.GetWorldInfo();if(t&&t.HasChildren())for(const t of this.allChildren())if(e.add(t),t.IsInContainer())for(const s of t.siblings())e.add(s);if(this.IsInContainer())for(const t of this.siblings())e.add(t);for(const t of e.values())t._TriggerOnCreated()}_TriggerOnCreated(){if(this._HasAnyCreateDestroyHandler("instancecreate")){const t=this.GetObjectClass(),s=new e.Event("instancecreate");s.instance=this.GetInterfaceClass(),t.DispatchUserScriptEvent(s);for(const e of t.GetFamilies())e.DispatchUserScriptEvent(s);this._runtime.DispatchUserScriptEvent(s)}this._runtime.Trigger(this.GetPlugin().constructor.Cnds.OnCreated,this,null)}_TriggerOnDestroyed(){this._runtime.Trigger(this.GetPlugin().constructor.Cnds.OnDestroyed,this,null)}_FireDestroyedScriptEvents(t){if(this._iScriptInterface){const s=new e.Event("destroy");s.isEndingLayout=t,this.DispatchUserScriptEvent(s)}if(!this._HasAnyCreateDestroyHandler("instancedestroy"))return;const s=this.GetObjectClass(),i=new e.Event("instancedestroy");i.instance=this.GetInterfaceClass(),i.isEndingLayout=t,s.DispatchUserScriptEvent(i);for(const e of s.GetFamilies())e.DispatchUserScriptEvent(i);this._runtime.DispatchUserScriptEvent(i)}_GetDebuggerProperties(){return this._sdkInst.GetDebuggerProperties()}SaveToJson(t="full"){const s={};if("full"===t?s.uid=this.GetUID():s.c3=!0,"visual-state"!==t){const t=n.get(this);if(t&&t.size&&(s.ex=e.ToSuperJSON(t)),-1!==this.GetTimeScale()&&(s.mts=this.GetTimeScale()),this._objectType.GetInstanceVariablesCount()>0){const e={},t=this._objectType.GetInstanceVariableSIDs();for(let s=0,i=this._instVarValues.length;s<i;++s)e[t[s].toString()]=this._instVarValues[s];s.ivs=e}if(this._behaviorInstances.length){const e={};for(const t of this._behaviorInstances){const s=t.SaveToJson();s&&(e[t.GetBehaviorType().GetSID().toString()]=s)}s.behs=e}}this._worldInfo&&(s.w=this._worldInfo._SaveToJson(t));const i=this._sdkInst.SaveToJson();return i&&(s.data=i),s}_OnBeforeLoad(e="full"){this._worldInfo&&this._worldInfo._OnBeforeLoad(e)}_SetupSceneGraphConnectionsOnChangeOfLayout(){this.GetPlugin().IsWorldType()&&this._worldInfo._SetupSceneGraphConnectionsOnChangeOfLayout()}LoadFromJson(t,s="full"){if("full"===s)this._uid=t.uid;else if(!t.c3)return;if("visual-state"!==s){let s=n.get(this);s&&(s.clear(),n.delete(this));const i=t.ex;i&&(s=e.FromSuperJSON(i),n.set(this,s)),this._timeScale=t.hasOwnProperty("mts")?t.mts:-1;const r=t.ivs;if(r)for(const[e,t]of Object.entries(r)){const s=parseInt(e,10),i=this._objectType.GetInstanceVariableIndexBySID(s);if(i<0||i>=this._instVarValues.length)continue;let r=t;null===r&&(r=NaN),this._instVarValues[i]=r}}if(this.GetPlugin().IsWorldType()){const e=t.w,i=e.l;if(this._worldInfo.GetLayer().GetSID()!==i){const e=this._worldInfo.GetLayer(),t=e.GetLayout().GetLayerBySID(i);t?(this._worldInfo._SetLayer(t),e._RemoveInstance(this,!0),t._AddInstance(this,!0),t.SetZIndicesChanged(),this._worldInfo.SetBboxChanged()):"full"===s&&this._runtime.DestroyInstance(this)}this._worldInfo._LoadFromJson(e,s)}if("visual-state"!==s){const e=t.behs;if(e)for(const[t,s]of Object.entries(e)){const e=parseInt(t,10),i=this.GetBehaviorIndexBySID(e);i<0||i>=this._behaviorInstances.length||this._behaviorInstances[i].LoadFromJson(s)}}const i=t.data;i&&this._sdkInst.LoadFromJson(i,s)}GetInterfaceClass(){return this._iScriptInterface||this._InitUserScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}_InitUserScriptInterface(){const e=this._worldInfo?self.IWorldInstance:s,t=this._sdkInst.GetScriptInterfaceClass(),i=this._objectType._GetUserScriptInstanceClass(),r=i||t||e;if(s._Init(this),this._iScriptInterface=new r,s._Init(null),t&&!(this._iScriptInterface instanceof e))throw new TypeError(`script interface class '${t.name}' does not extend the right base class '${e.name}'`);if(i){const s=t||e;if(!(this._iScriptInterface instanceof s))throw new TypeError(`setInstanceClass(): class '${i.name}' does not extend the right base class '${s.name}'`)}return this._iScriptInterface}_GetInstVarsScriptDescriptor(t){if(0===this._instVarValues.length)return;const s={},i=this._objectType._GetAllInstanceVariableJsPropNames();for(let t=0,r=i.length;t<r;++t)s[i[t]]={configurable:!1,enumerable:!0,get:e.Instance.prototype._GetInstanceVariableTypedValue.bind(this,t),set:e.Instance.prototype.SetInstanceVariableValue.bind(this,t)};const r=Object.create(Object.prototype,s);t.instVars={value:r,writable:!1}}_GetBehaviorsScriptDescriptor(e){const t=this._behaviorInstances;if(0===t.length)return;const s={};for(const e of t)s[e.GetBehaviorType().GetJsPropName()]={value:e.GetScriptInterface(),writable:!1};const i=Object.create(Object.prototype,s);e.behaviors={value:i,writable:!1}}DispatchUserScriptEvent(e){if(!this.HasScriptInterface())return;const s=this.GetInterfaceClass();e.instance=s;const i=this._runtime,r=i.IsDebug()&&!i.GetEventSheetManager().IsInEventEngine();r&&t.StartMeasuringScriptTime(),s.dispatchEvent(e),r&&t.AddScriptTime()}}}{const e=self.C3;e.SceneGraphInfo=class extends e.DefendedBase{constructor(e){super(),this._owner=e,this._parent=null,this._children=[],this._startWidth=e.GetWidth(),this._startHeight=e.GetHeight(),this._startScaleX=1,this._startScaleY=1,this._parentStartAngle=0,this._ownOpacity=1,this._startOpacity=e.GetOpacity(),this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null}Release(){this._parent=null,this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null,e.clearArray(this._children)}SetParent(e){this._ownOpacity=this._owner.GetOpacity(),this._startOpacity=this._ownOpacity,this._parent=e,this._parentStartAngle=e?e.GetAngle():0}GetParent(){return this._parent}HasChildren(){return this._children.length>0}GetChildren(){return this._children}_MaybeSortChildren(){this.HasChildren()&&this._tmpSceneGraphChildrenIndexes&&1!==this._children.length&&this._children.sort(((t,s)=>{const i=this._tmpSceneGraphChildrenIndexes.get(t.GetInstance()),r=this._tmpSceneGraphChildrenIndexes.get(s.GetInstance());return e.IsFiniteNumber(i)&&e.IsFiniteNumber(r)?i-r:0}))}GetStartScaleX(){return this._startScaleX}SetStartScaleX(e){this._startScaleX=e}GetStartScaleY(){return this._startScaleY}SetStartScaleY(e){this._startScaleY=e}GetStartOpacity(){return this._startOpacity}GetOwnOpacity(){return this._ownOpacity}SetOwnOpacity(e){this._ownOpacity=e}_GetStartWidth(){return 0===this._startWidth?Number.EPSILON:this._startWidth}_GetStartHeight(){return 0===this._startHeight?Number.EPSILON:this._startHeight}GetParentScaleX(){if(this._owner.GetTransformWithParentWidth()){const e=this._parent;let t=e.GetWidth(),s=e._GetSceneGraphInfo()._GetStartWidth();if(0===t&&(t=Number.EPSILON),s===Number.EPSILON&&t===Number.EPSILON)return 1;if(s===Number.EPSILON&&t!==Number.EPSILON){const s=e.GetInstance().GetSdkInstance();if(s.IsOriginalSizeKnown())return 1+t/s.GetOriginalWidth()}return t/s}return 1}GetParentScaleY(){if(this._owner.GetTransformWithParentHeight()){const e=this._parent;let t=e.GetHeight(),s=e._GetSceneGraphInfo()._GetStartHeight();if(0===t&&(t=Number.EPSILON),s===Number.EPSILON&&t===Number.EPSILON)return 1;if(s===Number.EPSILON&&t!==Number.EPSILON){const s=e.GetInstance().GetSdkInstance();if(s.IsOriginalSizeKnown())return 1+t/s.GetOriginalHeight()}return t/s}return 1}GetParentStartAngle(){return this._parentStartAngle}_SaveToJson(e){return{sw:this._startWidth,sh:this._startHeight,sx:this._startScaleX,sy:this._startScaleY,psa:this._parentStartAngle,oo:this._ownOpacity,so:this._startOpacity,p:this._GetParentJson(e),c:this._GetChildrenJson(e)}}_GetFlagsString(e){let t="";return e.GetTransformWithParentX()&&(t+="x"),e.GetTransformWithParentY()&&(t+="y"),e.GetTransformWithParentWidth()&&(t+="w"),e.GetTransformWithParentHeight()&&(t+="h"),e.GetTransformWithParentAngle()&&(t+="a"),e.GetTransformWithParentZElevation()&&(t+="z"),e.GetDestroyWithParent()&&(t+="d"),e.GetTransformWithParentOpacity()&&(t+="o"),e.GetTransformWithParentVisibility()&&(t+="v"),t}_GetParentJson(e){return this._parent?!this._parent.GetInstance()||this._parent.GetInstance().IsDestroyed()?null:this._GetInstanceJson(this._parent,this._owner,e):null}_GetChildrenJson(e){return this._children.map((t=>this._GetInstanceJson(t,t,e)))}_GetInstanceJson(t,s,i){const r=t.GetInstance(),n={};return n.uid=r.GetUID(),n.f=this._GetFlagsString(s),n.offsets=s._SaveSceneGraphPropertiesToJson(),n.data=e.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(r),n.oci=r.GetObjectClass().GetIndex(),"state"===i?(n.inst=r.SaveToJson(),n.instIndex=NaN):(n.instIndex=r.GetObjectClass().GetInstances().indexOf(r),n.inst=null),n}_LoadFromJson(e){this._startWidth=e.sw,this._startHeight=e.sh,this._startScaleX=e.sx,this._startScaleY=e.sy,this._parentStartAngle=e.psa,this._ownOpacity=e.oo,this._startOpacity=e.so}_SetTmpSceneGraphChildren(e,t){this._tmpSceneGraphChildren=e,this._tmpSceneGraphChildrenIndexes=t}_OnAfterLoad(t,s){const i=this._owner,r=i.GetRuntime(),n=new Set;if(t.p&&!this._parent){const a=t.p.uid,o=r.GetInstanceByUID(a);if(s&&s.ignoreMissingInstances,o){const e=o.GetWorldInfo();if(o.HasChild(this._owner.GetInstance()))this._parent=e;else{o.AddChild(this._owner.GetInstance(),this._GetFlagsObj(t.p.f)),n.has(this._owner)||this._owner._LoadSceneGraphPropertiesFromJson(t.p.offsets),n.add(this._owner);o.GetWorldInfo()._GetSceneGraphInfo()._MaybeSortChildren()}}else if(e.IsFiniteNumber(t.p.oci)){const e=r.GetObjectClassByIndex(t.p.oci),n=(r.GetSystemPlugin(),r.CreateInstance(e,i.GetLayer(),0,0,!0));if(s&&s.ignoreMissingInstances,n){const e=this._GetInstanceData(t.p,r);n.LoadFromJson(e);n.GetWorldInfo().GetLayer().SortAndAddInstancesByZIndex(n),n.AddChild(i.GetInstance(),this._GetFlagsObj(t.p.f));n.GetWorldInfo()._GetSceneGraphInfo()._MaybeSortChildren()}}}const a=[];for(const e of t.c){const t=e.uid,s=r.GetInstanceByUID(t);s&&a.push(s)}let o=0;for(const e of t.c){const h=e.uid,l=r.GetInstanceByUID(h);if(s&&s.ignoreMissingInstances,l){if(this._tmpSceneGraphChildren&&this._tmpSceneGraphChildren[o]){const e=this._tmpSceneGraphChildren[o];if(e.GetObjectClass()!==l.GetObjectClass()){o++;continue}if(e.IsDestroyed()){o++;continue}const s=t.c[o];this._AddAndSetChildInstance(e.GetWorldInfo(),s,n,!1),o++;continue}const r=l.GetObjectClass();if(this._GetInstancesOfObjectClassCount(a,r)===i.GetInstance().GetChildrenOfObjectClass(r).length){const t=i.GetInstance().GetChildAt(o).GetWorldInfo();t&&(n.has(t)||t._LoadSceneGraphPropertiesFromJson(e.offsets),n.add(t)),o++;continue}if(l.HasParent()){const t=this._CreateNewChildInstance(e,s);this._AddAndSetChildInstance(t,e,n),o++;continue}this._AddAndSetChildInstance(l.GetWorldInfo(),e,n)}else{const t=this._CreateNewChildInstance(e,s);this._AddAndSetChildInstance(t,e,n)}o++}}_GetFlagsObj(e){const t={};return t.transformX=e.includes("x"),t.transformY=e.includes("y"),t.transformWidth=e.includes("w"),t.transformHeight=e.includes("h"),t.transformAngle=e.includes("a"),t.transformZElevation=e.includes("z"),t.destroyWithParent=e.includes("d"),t.transformOpacity=e.includes("o"),t.transformVisibility=e.includes("v"),t}_CreateNewChildInstance(t,s){if(!e.IsFiniteNumber(t.oci))return;const i=this._owner,r=i.GetRuntime();let n;if(t.data)n=r.CreateInstanceFromData(t.data,i.GetLayer(),!1,0,0,!1,!0);else{const e=r.GetObjectClassByIndex(t.oci);n=r.CreateInstance(e,i.GetLayer(),0,0,!0)}if(s&&s.ignoreMissingInstances,!n)return;const a=this._GetInstanceData(t,r);n.LoadFromJson(a);const o=n.GetWorldInfo();return o.GetLayer().SortAndAddInstancesByZIndex(n,!0),o}_AddAndSetChildInstance(e,t,s,i=!0){this._owner.AddChild(e,this._GetFlagsObj(t.f)),i&&(s.has(e)||e._LoadSceneGraphPropertiesFromJson(t.offsets),s.add(e)),this._MaybeSortChildren()}_GetInstancesOfObjectClassCount(e,t){return e.filter((e=>e.GetObjectClass().GetName()===t.GetName())).length}_GetInstanceData(t,s){if(e.IsFiniteNumber(t.instIndex)){return s.GetObjectClassByIndex(t.oci)._GetLoadInstancesJson()[t.instIndex]}return e.IsString(t.inst)?JSON.parse(t.inst):t.inst?t.inst:void 0}static GetSceneGraphInstanceDataFromInstance(t){let s=t.GetWorldInfo().GetLayer().GetInitialInstanceData(t.GetUID());if(!s)return null;s=JSON.parse(JSON.stringify(s));const i=[];for(const s of[...t.GetChildren()]){const t=s.GetWorldInfo();i.push([t.GetLayout().GetSID(),t.GetLayer().GetIndex(),s.GetUID(),e.SceneGraphInfo._GetFlagsNumber(t),s.GetObjectClass().IsInContainer()?1:0,t.GetZIndex(),e.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(s)])}return e.IsArray(s[0][14])?s[0][14][1]=i:(s[0][14]=[],s[0][14][0]=e.SceneGraphInfo._GetDefaultFlagsNumber(),s[0][14][1]=i,s[0][14][2]=t.GetWorldInfo().GetZIndex()),s}static _GetFlagsNumber(e){let t=0;return t|=Number(e.GetTransformWithParentVisibility())<<8,t|=Number(e.GetTransformWithParentOpacity())<<7,t|=Number(e.GetTransformWithParentZElevation())<<6,t|=Number(e.GetDestroyWithParent())<<5,t|=Number(e.GetTransformWithParentAngle())<<4,t|=Number(e.GetTransformWithParentHeight())<<3,t|=Number(e.GetTransformWithParentWidth())<<2,t|=Number(e.GetTransformWithParentY())<<1,t|=Number(e.GetTransformWithParentX())<<0,t}static _GetDefaultFlagsNumber(e){let t=0;return t|=256,t|=128,t|=64,t|=32,t|=16,t|=8,t|=4,t|=2,t|=1,511}}}{const e=self.C3,t=self.glMatrix,s=t.vec3,i=t.vec4,r=e.New(e.Rect),n=e.New(e.Quad),a=e.New(e.Event,"bboxchange",!1),o=e.New(e.Color,0,0,0,0),h=e.New(e.CollisionPoly),l=e.New(e.Color,1,1,1,1),c=e.New(e.Rect,0,0,-1,-1),u=e.New(e.Rect,0,0,-1,-1),_=new Set(["absolute","relative"]),d=[];let p=!0;const f=1,m=2,g=4,S=8,y=16,G=32,I=64,T=128,b=256,C=512,P=1024,v=2048,x=4096,R=8192,w=16384,A=32768,M=1<<22,D=1<<23,E=C|P|v|x|R|w|A|M|D,k=65536,F=1<<17,O=1<<18,B=1<<19,L=1<<20,N=1<<21,W=26,V=31<<W,U=new WeakMap,j=new WeakMap,H=new WeakMap;e.WorldInfo=class extends e.DefendedBase{constructor(t,s){super(),this._inst=t,this._objectClass=t.GetObjectClass(),this._runtime=t.GetRuntime(),this._layer=s,this._zIndex=-1,this._flags=f|m|S|y|k|F,this._objectClass.GetPlugin().IsRotatable()&&(this._flags|=T),this._x=NaN,this._y=NaN,this._zElevation=NaN,this._w=NaN,this._h=NaN,this._depth=NaN,this._a=NaN,this._sinA=NaN,this._cosA=NaN,this._ox=NaN,this._oy=NaN,this._boundingBox=e.New(e.Rect),this._boundingQuad=e.New(e.Quad),this._collisionCells=u,this._renderCells=c,this._sourceCollisionPoly=null,this._transformedPolyInfo=null,this._solidFilterTags=null,this._color=l,this._colorPremultiplied=l,this._stateGroup=null,this._instanceEffectList=null,this._inst.GetObjectClass().UsesEffects()&&(this._instanceEffectList=e.New(e.InstanceEffectList,this._inst,this)),this._sceneGraphInfo=null,this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null,this._after_load=null,this._after_load_instance=null,this._meshInfo=null}_MarkDestroyed(){this._flags|=b}Release(){if(this._stateGroup&&(this._runtime.GetRenderer().ReleaseStateGroup(this._stateGroup),this._stateGroup=null),this._sourceCollisionPoly=null,this._transformedPolyInfo&&(this._transformedPolyInfo.poly.Release(),this._transformedPolyInfo=null),this._solidFilterTags&&(this._solidFilterTags.clear(),this._solidFilterTags=null),this.ReleaseMesh(),this._instanceEffectList&&this._instanceEffectList.Release(),this.HasParent()&&this.GetParent().RemoveChild(this),this.HasChildren()){const e=[...this.GetChildren()];for(const t of e)this.RemoveChild(t)}this._ReleaseSceneGraphInfo(),this._ReleaseTmpSceneGraphInfo(),U.delete(this),j.delete(this),this._after_load&&(this.GetRuntime().Dispatcher().removeEventListener("afterload",this._after_load),this._after_load=null),this._after_load_instance&&(this.GetRuntime().Dispatcher().removeEventListener("afterloadinstance",this._after_load_instance),this._after_load_instance=null),this._inst=null,this._objectClass=null,this._runtime=null,this._layer=null}Init(e){if(p=!1,this.SetXY(e[0],e[1]),this.SetZElevation(e[2]),this.SetSize(e[3],e[4]),this._depth=0,this.IsRotatable()?this.SetAngle(e[6]):this._a=0,o.setFromJSON(e[7]),this._SetColor(o),this.SetOriginX(e[8]),this.SetOriginY(e[9]),this.SetBlendMode(e[10]),this._instanceEffectList&&this._instanceEffectList._LoadEffectParameters(e[12]),e[14]&&U.set(this,{childrenData:e[14][1],zIndexData:e[14][2]}),e[15]){const t=e[15];this.CreateMesh(t[0],t[1]);const s=this.GetSourceMesh(),i=t[2];for(let e=0,t=i.length;e<t;++e){const t=i[e];for(let i=0,r=t.length;i<r;++i){const r=t[i],n=s.GetMeshPointAt(i,e);n.SetX(r[0]),n.SetY(r[1]),n.SetZElevation(r[2]),n.SetU(r[3]),n.SetV(r[4])}}}if(e[16]){const t=e[16][0],s=e[16][1],i=!!s,r=!i,n=this._runtime.GetTemplateManager();i&&n&&n.MapInstanceToTemplateName(this.GetInstance(),s),r&&n&&n.MapInstanceToTemplateName(this.GetInstance(),t)}p=!0,this._UpdateRendererStateGroup()}InitNoData(){this._x=0,this._y=0,this._zElevation=0,this._w=0,this._h=0,this._depth=0,this._a=0,this._sinA=0,this._cosA=1,this._ox=0,this._oy=0,this._UpdateRendererStateGroup()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetInstance(){return this._inst}_GetParentOffsetAngle(){return this.GetTransformWithParentAngle()?this.GetParent().GetAngle()-this._sceneGraphInfo.GetParentStartAngle():0}SetX(e){if(e=+e,this.GetTransformWithParentX()){const t=this._sceneGraphInfo,s=e-this.GetX(),i=-this._GetParentOffsetAngle();0===i?this._x+=s/t.GetParentScaleX():(this._x+=Math.cos(i)*s/t.GetParentScaleX(),this.GetTransformWithParentY()&&(this._y+=Math.sin(i)*s/t.GetParentScaleY()))}else this._x=e}OffsetX(e,t=!1){e=+e,t?this._x+=e:this.GetTransformWithParentX()?this.SetX(this.GetX()+e):this._x+=e}GetX(){if(this.GetTransformWithParentX()){let e=this._x;const t=this._sceneGraphInfo,s=this.GetParent(),i=this._GetParentOffsetAngle();return 0===i?e*=t.GetParentScaleX():(e=e*t.GetParentScaleX()*Math.cos(i),this.GetTransformWithParentY()&&(e-=this._y*t.GetParentScaleY()*Math.sin(i))),s.GetX()+e}return this._x}SetY(e){if(e=+e,this.GetTransformWithParentY()){const t=this._sceneGraphInfo,s=e-this.GetY(),i=-this._GetParentOffsetAngle();0===i?this._y+=s/t.GetParentScaleY():(this.GetTransformWithParentX()&&(this._x-=Math.sin(i)*s/t.GetParentScaleX()),this._y+=Math.cos(i)*s/t.GetParentScaleY())}else this._y=e}OffsetY(e,t=!1){e=+e,t?this._y+=e:this.GetTransformWithParentY()?this.SetY(this.GetY()+e):this._y+=e}GetY(){if(this.GetTransformWithParentY()){let e=this._y;const t=this._sceneGraphInfo,s=this.GetParent(),i=this._GetParentOffsetAngle();return 0===i?e*=t.GetParentScaleY():(e=e*t.GetParentScaleY()*Math.cos(i),this.GetTransformWithParentX()&&(e+=this._x*t.GetParentScaleX()*Math.sin(i))),s.GetY()+e}return this._y}SetXY(e,t){if(e=+e,t=+t,this.GetTransformWithParentXOrY()){const s=this.GetTransformWithParentX(),i=this.GetTransformWithParentY(),r=this._sceneGraphInfo,n=e-this.GetX(),a=t-this.GetY(),o=-this._GetParentOffsetAngle();if(0===o)s?this._x+=n/r.GetParentScaleX():this._x=e,i?this._y+=a/r.GetParentScaleY():this._y=t;else{const h=Math.sin(o),l=Math.cos(o);s?this._x+=i?(l*n-h*a)/r.GetParentScaleX():l*n/r.GetParentScaleX():this._x=e,i?this._y+=s?(h*n+l*a)/r.GetParentScaleY():l*a/r.GetParentScaleY():this._y=t}}else this._x=e,this._y=t}OffsetXY(e,t){e=+e,t=+t,this.GetTransformWithParentXOrY()?this.SetXY(this.GetX()+e,this.GetY()+t):(this._x+=e,this._y+=t)}EqualsXY(e,t){return this.GetX()===e&&this.GetY()===t}SetZElevation(e){if(e=+e,this.GetTransformWithParentZElevation()&&(e-=this.GetParent().GetZElevation()),this._zElevation===e)return;this._zElevation=e,this._UpdateZElevation();const t=this.GetLayer();0!==this._zElevation&&t._SetAnyInstanceZElevated(),t.SetZIndicesChanged()}_UpdateZElevation(){if(this._UpdateRendererStateGroup(),this.HasChildren()){const e=this.GetChildren();for(let t=0,s=e.length;t<s;t++){const s=e[t];s.GetTransformWithParentZElevation()&&s._UpdateZElevation()}}}OffsetZElevation(e){this.SetZElevation(this.GetZElevation()+e)}GetZElevation(){return this.GetTransformWithParentZElevation()?this.GetParent().GetZElevation()+this._zElevation:this._zElevation}GetTotalZElevation(){return this.GetLayer().GetZElevation()+this.GetZElevation()}SetWidth(e){if(e=+e,this.GetTransformWithParentWidth()){const t=this.GetWidth();0===t?this._w=Number.EPSILON:this._w*=e/t}else this._w=e}OffsetWidth(e,t){e=+e,t?this._w+=e:this.GetTransformWithParentWidth()?this.SetWidth(this.GetWidth()+e):this._w+=e}GetWidth(){if(this.GetTransformWithParentWidth()){const e=this.GetParent(),t=e.GetWidth();return e._GetSceneGraphInfo()._GetStartWidth()===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartWidth()+t)*this._w:t*this._w}return this._w}SetHeight(e){if(e=+e,this.GetTransformWithParentHeight()){const t=this.GetHeight();0===t?this._h=Number.EPSILON:this._h*=e/t}else this._h=e}OffsetHeight(e,t){e=+e,t?this._h+=e:this.GetTransformWithParentHeight()?this.SetHeight(this.GetHeight()+e):this._h+=e}GetHeight(){if(this.GetTransformWithParentHeight()){const e=this.GetParent(),t=e.GetHeight();return e._GetSceneGraphInfo()._GetStartHeight()===Number.EPSILON?(this._GetSceneGraphInfo()._GetStartHeight()+t)*this._h:t*this._h}return this._h}SetSize(e,t){if(e=+e,t=+t,this.GetTransformWithParentWidth()){const t=this.GetWidth();0===t?this._w=Number.EPSILON:this._w*=e/t}else this._w=e;if(this.GetTransformWithParentHeight()){const e=this.GetHeight();0===e?this._h=Number.EPSILON:this._h*=t/e}else this._h=t}GetDepth(){return this._depth}SetDepth(e){if(e<0)throw new RangeError("invalid depth");this._depth=e}GetSceneGraphScale(){if(this.HasParent()){const e=this._sceneGraphInfo;return Math.min(e.GetParentScaleX(),e.GetParentScaleY())}return 1}IsRotatable(){return 0!=(this._flags&T)}SetAngle(t){t=+t,this.IsRotatable()&&(this.GetTransformWithParentAngle()&&(t-=this.GetParent().GetAngle()),t=e.clampAngle(t),this._a!==t&&(this._a=t,this._MarkSinCosAngleChanged()))}OffsetAngle(t){0!==(t=+t)&&this.IsRotatable()&&(this._a=e.clampAngle(this._a+t),this._MarkSinCosAngleChanged())}_MarkSinCosAngleChanged(){if(this._flags|=O,this.HasChildren()){const e=this.GetChildren();for(let t=0,s=e.length;t<s;t++)e[t]._MarkSinCosAngleChanged()}}GetAngle(){return this.GetTransformWithParentAngle()?e.clampAngle(this.GetParent().GetAngle()+this._a):this._a}_MaybeUpdateSinCosAngle(){const e=this._flags;if(0==(e&O))return;const t=this.GetAngle();this._sinA=Math.sin(t),this._cosA=Math.cos(t),this._flags=e&~O}GetSinAngle(){return this._MaybeUpdateSinCosAngle(),this._sinA}GetCosAngle(){return this._MaybeUpdateSinCosAngle(),this._cosA}SetOriginX(e){this._ox=+e}OffsetOriginX(e){this._ox+=+e}GetOriginX(){return this._ox}SetOriginY(e){this._oy=+e}OffsetOriginY(e){this._oy+=+e}GetOriginY(){return this._oy}_SetColor(t){this._color.equals(t)||(this._color===l?(this._color=e.New(e.Color,t),this._colorPremultiplied=e.New(e.Color,t),this._colorPremultiplied.premultiply()):t.equalsRgba(1,1,1,1)?(this._color=l,this._colorPremultiplied=l):(this._color.set(t),this._colorPremultiplied.set(t),this._colorPremultiplied.premultiply()),this._UpdateRendererStateGroup())}SetOpacity(t){if(t=e.clamp(+t,0,1),this.GetTransformWithParentOpacity()){if(this._GetSceneGraphInfo().GetOwnOpacity()===t)return;this._GetSceneGraphInfo().SetOwnOpacity(t),t=this.GetOpacity()}else if(this._color.a===t)return;this._SetColorWithOpacity(t)}_SetOpacityOfChildren(){if(!this.HasChildren())return;const e=this.GetChildren();for(let t=0,s=e.length;t<s;t++){const s=e[t];s._SetColorWithOpacity(s.GetOpacity())}}_SetColorWithOpacity(e){o.copyRgb(this._color),o.a=e,this._SetColor(o),this._SetOpacityOfChildren()}OffsetOpacity(e){this.GetTransformWithParentOpacity()?this.SetOpacity(this._GetSceneGraphInfo().GetOwnOpacity()+e):this.SetOpacity(this.GetOpacity()+e)}GetOpacity(){return this.GetTransformWithParentOpacity()?this.GetParent().GetOpacity()*this._GetSceneGraphInfo().GetOwnOpacity():this._color.a}SetUnpremultipliedColor(e){this._color.equalsIgnoringAlpha(e)||(o.copyRgb(e),o.a=this.GetOpacity(),this._SetColor(o))}SetUnpremultipliedColorRGB(e,t,s){o.setRgb(e,t,s),this.SetUnpremultipliedColor(o)}OffsetUnpremultipliedColorRGB(e,t,s){0===e&&0===t&&0===s||(o.copyRgb(this._color),o.r+=e,o.g+=t,o.b+=s,this.SetUnpremultipliedColor(o))}GetUnpremultipliedColor(){return this._color}GetPremultipliedColor(){return this._colorPremultiplied}GetDestroyWithParent(){return 0!=(this._flags&C)}SetDestroyWithParent(e){this._SetFlag(C,e)}GetTransformWithParentX(){return 0!=(this._flags&P)}SetTransformWithParentX(e){this._SetFlag(P,e)}GetTransformWithParentY(){return 0!=(this._flags&v)}GetTransformWithParentXOrY(){return 0!=(this._flags&(P|v))}SetTransformWithParentY(e){this._SetFlag(v,e)}GetTransformWithParentWidth(){return 0!=(this._flags&x)}SetTransformWithParentWidth(e){this._SetFlag(x,e)}GetTransformWithParentHeight(){return 0!=(this._flags&R)}SetTransformWithParentHeight(e){this._SetFlag(R,e)}GetTransformWithParentAngle(){return 0!=(this._flags&w)}SetTransformWithParentAngle(e){this._SetFlag(w,e)}GetTransformWithParentZElevation(){return 0!=(this._flags&A)}SetTransformWithParentZElevation(e){this._SetFlag(A,e)}GetTransformWithParentOpacity(){return 0!=(this._flags&M)}SetTransformWithParentOpacity(e){this._SetFlag(M,e)}GetTransformWithParentVisibility(){return 0!=(this._flags&D)}SetTransformWithParentVisibility(e){this._SetFlag(D,e)}_ClearAllSceneGraphFlags(){this._flags&=~E}AddChild(e,t){if(e===this)return;if(e.HasParent())return;if(this._HasChildRecursive(e))return;if(this._HasAnyParent(e))return;const s=e.GetX(),i=e.GetY(),r=e.GetWidth(),n=e.GetHeight(),a=e.GetAngle(),o=e.GetZElevation(),h=e.GetOpacity();if(e._SetParent(this),e.SetTransformWithParentX(t.transformX),e.SetTransformWithParentY(t.transformY),e.SetTransformWithParentWidth(t.transformWidth),e.SetTransformWithParentHeight(t.transformHeight),e.SetTransformWithParentAngle(t.transformAngle),e.SetTransformWithParentZElevation(t.transformZElevation),e.SetTransformWithParentOpacity(t.transformOpacity),e.SetTransformWithParentVisibility(t.transformVisibility),e.SetDestroyWithParent(t.destroyWithParent),t.transformX&&(e._x=s-this.GetX(),t.transformWidth&&(e._x/=this.GetWidth()/this._sceneGraphInfo._GetStartWidth())),t.transformY&&(e._y=i-this.GetY(),t.transformHeight&&(e._y/=this.GetHeight()/this._sceneGraphInfo._GetStartHeight())),t.transformWidth){const t=this.GetWidth();0===t||t===Number.EPSILON?(e._w=1,e._sceneGraphInfo.SetStartScaleX(1)):(e._w=r/this.GetWidth(),e._sceneGraphInfo.SetStartScaleX(e._w))}if(t.transformHeight){const t=this.GetHeight();0===t||t===Number.EPSILON?(e._h=1,e._sceneGraphInfo.SetStartScaleY(1)):(e._h=n/this.GetHeight(),e._sceneGraphInfo.SetStartScaleY(e._h))}t.transformAngle&&(e._a=a-this.GetAngle()),t.transformZElevation&&(e._zElevation=o-this.GetZElevation()),t.transformOpacity&&e._sceneGraphInfo.SetOwnOpacity(h),t.transformVisibility&&e.SetVisible(this.IsVisible()),this._AddChildToSceneGraphInfo(e),this.SetBboxChanged(),this._SetOpacityOfChildren()}RemoveChild(e){if(e.GetParent()!==this)return;const t=e.GetX(),s=e.GetY(),i=e.GetWidth(),r=e.GetHeight(),n=e.GetAngle(),a=e.GetZElevation(),o=e.GetOpacity();e._SetParent(null),e._ClearAllSceneGraphFlags(),e.SetXY(t,s),e.SetSize(i,r),e.SetAngle(n),e.SetZElevation(a),e.SetOpacity(o),this._RemoveChildFromSceneGraphInfo(e),this.SetBboxChanged()}_ResetAllSceneGraphState(){this._BuildTmpSceneGraphChildren();const e=[...this.children()];for(const t of e)this.RemoveChild(t);const t=this.GetParent();t&&t.RemoveChild(this),this._ClearAllSceneGraphFlags()}_BuildTmpSceneGraphChildren(){if(!this._tmpSceneGraphChildren){const e=[...this.children()];e.length&&(this._tmpSceneGraphChildren=[],this._tmpSceneGraphChildrenIndexes=new WeakMap);let t=0;for(const s of e){const e=s.GetInstance();this._tmpSceneGraphChildren.push(e),this._tmpSceneGraphChildrenIndexes.set(e,t),t++}}const e=this.GetParent();e&&e._BuildTmpSceneGraphChildren()}_ReleaseTmpSceneGraphInfo(){this._tmpSceneGraphChildren&&(this._tmpSceneGraphChildren.length=0),this._tmpSceneGraphChildren=null,this._tmpSceneGraphChildrenIndexes=null,H.delete(this);const e=this.GetParent();e&&!H.has(e)&&e._ReleaseTmpSceneGraphInfo()}HasParent(){return null!==this.GetParent()}GetParent(){const e=this._sceneGraphInfo;return null!==e?e.GetParent():null}GetTopParent(){let e=this;for(;e.HasParent();)e=e.GetParent();return e}*parents(){let e=this.GetParent();for(;e;)yield e,e=e.GetParent()}HasChild(e){return this.GetChildren().includes(e)}HasChildren(){const e=this._sceneGraphInfo;return null!==e&&e.HasChildren()}GetChildren(){const e=this._sceneGraphInfo;return null!==e?e.GetChildren():d}children(){return this.GetChildren()}*allChildren(){for(const e of this.children())yield e,yield*e.allChildren()}GetChildCount(){return this.GetChildren().length}GetAllChildCount(){return[...this.allChildren()].length}GetChildAt(e){const t=this.GetChildren();return(e=Math.floor(+e))<0||e>=t.length?null:t[e]}_CreateSceneGraphInfo(t){this._sceneGraphInfo||(this._sceneGraphInfo=e.New(e.SceneGraphInfo,this)),t&&this._sceneGraphInfo.SetParent(t)}_GetSceneGraphInfo(){return this._sceneGraphInfo}_ReleaseSceneGraphInfo(){this._sceneGraphInfo&&(this._sceneGraphInfo.Release(),this._sceneGraphInfo=null)}_SetParent(e){e?(e._CreateSceneGraphInfo(null),this._CreateSceneGraphInfo(e)):(this._sceneGraphInfo&&this._sceneGraphInfo.SetParent(null),this.HasChildren()||this._ReleaseSceneGraphInfo())}_HasAnyParent(e){if(!this.HasParent())return!1;const t=this.GetParent();return t===e||t._HasAnyParent(e)}_HasChildRecursive(e){if(this.HasChild(e))return!0;for(const t of this.GetChildren())if(t._HasChildRecursive(e))return!0;return!1}_AddChildToSceneGraphInfo(e){this._sceneGraphInfo.GetChildren().push(e)}_RemoveChildFromSceneGraphInfo(e){const t=this._sceneGraphInfo.GetChildren(),s=t.indexOf(e);-1!==s&&t.splice(s,1),0!==t.length||this.HasParent()||this._ReleaseSceneGraphInfo(),e.HasChildren()||e._ReleaseSceneGraphInfo()}GetSceneGraphChildrenExportData(){const e=U.get(this);return e?e.childrenData:null}GetSceneGraphZIndexExportData(){const e=U.get(this);return e?e.zIndexData:NaN}GetSceneGraphZIndex(){const t=j.get(this);return e.IsFiniteNumber(t)?t:NaN}SetSceneGraphZIndex(e){j.set(this,e)}SetUsePointsShaderProgram(){this._SetFlag(B,!0),this._UpdateRendererStateGroup()}_UpdateRendererStateGroup(){if(!p)return;const e=this._runtime.GetRenderer();let t;this._stateGroup&&e.ReleaseStateGroup(this._stateGroup),t=0!=(this._flags&B)?e.GetPointsRenderingProgram()||"<point>":e.GetTextureFillShaderProgram()||"<default>",this._stateGroup=e.AcquireStateGroup(t,this.GetBlendMode(),this._colorPremultiplied,this.GetZElevation())}GetRendererStateGroup(){return this._stateGroup}HasDefaultColor(){return this._color===l}SetBlendMode(e){if((e|=0)<0||e>31)throw new RangeError("invalid blend mode");this.GetBlendMode()!==e&&(this._flags=this._flags&~V|e<<W,this._UpdateRendererStateGroup())}GetBlendMode(){return(this._flags&V)>>W}_SetLayer(e,t){const s=t&&this._layer!==e;s&&this._RemoveFromRenderCells(),this._layer=e,s&&this._UpdateRenderCell(),0!==this.GetZElevation()&&this._layer._SetAnyInstanceZElevated()}GetLayer(){return this._layer}GetLayout(){return this.GetLayer().GetLayout()}_SetZIndex(e){this._zIndex=0|e}GetZIndex(){return this._layer._UpdateZIndices(),this._zIndex}_GetLastCachedZIndex(){return this._zIndex}_SetFlag(e,t){t?this._flags|=e:this._flags&=~e}IsVisible(){return 0!=(this._flags&f)}SetVisible(e){if(this._SetFlag(f,e),this.HasChildren())for(const t of this.GetChildren())t.GetTransformWithParentVisibility()&&t.SetVisible(e)}IsCollisionEnabled(){return 0!=(this._flags&S)}SetCollisionEnabled(e){e=!!e,this.IsCollisionEnabled()!==e&&(this._SetFlag(S,e),e?this.SetBboxChanged():this._RemoveFromCollisionCells())}SetSolidCollisionFilter(e,t){if(this._SetFlag(G,e),this._solidFilterTags&&this._solidFilterTags.clear(),t.trim()){this._solidFilterTags||(this._solidFilterTags=new Set);for(const e of t.split(" "))e&&this._solidFilterTags.add(e.toLowerCase())}else this._solidFilterTags=null}IsSolidCollisionAllowed(e){const t=0!=(this._flags&G),s=this._solidFilterTags;if(!e||!s)return!t;for(const i of s)if(e.has(i))return t;return!t}SetBboxChanged(){if(this._flags|=m|y|k,this._objectClass._SetAnyCollisionCellChanged(!0),this._runtime.UpdateRender(),this._layer.UsesRenderCells()&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags&=~m,this._UpdateRenderCell()),0!=(this._flags&g)&&this._inst.Dispatcher().dispatchEvent(a),null!==this._sceneGraphInfo){const e=this._sceneGraphInfo.GetChildren();for(let t=0,s=e.length;t<s;++t)e[t].SetBboxChanged()}}CalculateBbox(e,t,s){const i=this.GetX(),r=this.GetY(),n=this.GetWidth(),a=this.GetHeight(),o=this.GetAngle();e.setWH(i-this._ox*n,r-this._oy*a,n,a),s&&this.HasMesh()&&this._ExpandBboxForMesh(e),0===o?t.setFromRect(e):(e.offset(-i,-r),t.setFromRotatedRectPrecalc(e,this.GetSinAngle(),this.GetCosAngle()),t.offset(i,r),t.getBoundingBox(e)),e.normalize()}_UpdateBbox(){const e=this._flags;0!=(e&m)&&(this.CalculateBbox(this._boundingBox,this._boundingQuad,!0),this._flags=e&~m)}GetBoundingBox(){return this._UpdateBbox(),this._boundingBox}GetBoundingQuad(){return this._UpdateBbox(),this._boundingQuad}PixelRoundQuad(e){const t=this.GetX(),s=this.GetY(),i=Math.round(t)-t,r=Math.round(s)-s;return 0===i&&0===r?e:(n.copy(e),n.offset(i,r),n)}OverwriteBoundingBox(e){this._boundingBox.copy(e),this._boundingQuad.setFromRect(this._boundingBox),this._flags&=~m,this._UpdateCollisionCell(),this._UpdateRenderCell()}SetBboxChangeEventEnabled(e){this._SetFlag(g,e)}IsBboxChangeEventEnabled(){return 0!=(this._flags&g)}IsInViewport(e,t,s){return t&&0!==this.GetDepth()?this.IsInViewport3D(this.GetLayer()._GetViewFrustum()):0===this.GetZElevation()||s?e.intersectsRect(this.GetBoundingBox()):this._IsInViewport_ZElevated()}_IsInViewport_ZElevated(){const e=this.GetLayer(),t=this.GetTotalZElevation();return!(t>=e.GetCameraZ())&&(e.GetViewportForZ(t,r),r.intersectsRect(this.GetBoundingBox()))}IsInViewport3D(e){const t=this.GetBoundingBox(),s=t.getLeft(),i=t.getRight(),r=t.getTop(),n=t.getBottom(),a=this.GetTotalZElevation(),o=a+this.GetDepth();return e.ContainsAABB(s,r,a,i,n,o)}IsInViewport2(){const e=this.GetLayer();if(e.Has3DCamera())return this.IsInViewport3D(e._GetViewFrustum());{const t=e.GetLayout();return this.IsInViewport(e.GetViewport(),t.HasVanishingPointOutsideViewport(),t.IsOrthographicProjection())}}_SetDrawBackFaceOnly(e){this._SetFlag(L,e)}_SetDrawNonBackFacesOnly(e){this._SetFlag(N,e)}IsDrawBackFaceOnly(){return 0!=(this._flags&L)}IsDrawNonBackFacesOnly(){return 0!=(this._flags&N)}SetSourceCollisionPoly(e){this._sourceCollisionPoly=e,this._DiscardTransformedCollisionPoly(),this.HasMesh()&&(this._meshInfo.meshPoly=null)}GetSourceCollisionPoly(){return this._sourceCollisionPoly}HasOwnCollisionPoly(){return null!==this._sourceCollisionPoly||this.HasMesh()}GetTransformedCollisionPoly(){return this._GetCustomTransformedCollisionPolyPrecalc(this.GetWidth(),this.GetHeight(),this.GetAngle(),this.GetSinAngle(),this.GetCosAngle())}GetCustomTransformedCollisionPoly(e,t,s){let i=0,r=1;return 0!==s&&(i=Math.sin(s),r=Math.cos(s)),this._GetCustomTransformedCollisionPolyPrecalc(e,t,s,i,r)}_GetCustomTransformedCollisionPolyPrecalc(t,s,i,r,n){let a=this._transformedPolyInfo;null===a&&(a={poly:e.New(e.CollisionPoly),width:NaN,height:NaN,angle:NaN},this._transformedPolyInfo=a);const o=a.poly;if(a.width===t&&a.height===s&&a.angle===i)return o;const l=this._sourceCollisionPoly;if(this.HasMesh()){const e=this.GetOriginX(),i=this.GetOriginY(),a=this.GetSourceMesh();let c=this._meshInfo.meshPoly;c||(l?(h.copy(l),h.offset(e,i)):h.setDefaultPoints(),c=a.InsertPolyMeshVertices(h),this._meshInfo.meshPoly=c),a.TransformCollisionPoly(c,o),o.offset(-e,-i),o.transformPrecalc(t,s,r,n)}else l?(o.copy(l),o.transformPrecalc(t,s,r,n)):o.setFromQuad(this.GetBoundingQuad(),-this.GetX(),-this.GetY());return a.width=t,a.height=s,a.angle=i,o}_DiscardTransformedCollisionPoly(){this.SetPhysicsBodyChanged(!0);const e=this._transformedPolyInfo;null!==e&&(e.width=NaN)}CreateMesh(t,s){if(t=Math.floor(t),s=Math.floor(s),!this.GetInstance().GetPlugin().SupportsMesh())throw new Error("object does not support mesh");this.ReleaseMesh(),this._meshInfo={sourceMesh:e.New(e.Gfx.Mesh,t,s),transformedMesh:e.New(e.Gfx.Mesh,t,s),meshPoly:null}}HasMesh(){return null!==this._meshInfo}GetSourceMesh(){if(!this.HasMesh())throw new Error("no mesh");return this._meshInfo.sourceMesh}GetTransformedMesh(){if(!this.HasMesh())throw new Error("no mesh");return this._meshInfo.transformedMesh}SetMeshChanged(e){this._SetFlag(k,e)}IsMeshChanged(){return 0!=(this._flags&k)}SetPhysicsBodyChanged(e){this._SetFlag(F,e)}IsPhysicsBodyChanged(){return 0!=(this._flags&F)}_ExpandBboxForMesh(e){const t=this._meshInfo.sourceMesh,s=Math.min(t.GetMinX(),0),i=Math.min(t.GetMinY(),0),r=Math.max(t.GetMaxX(),1),n=Math.max(t.GetMaxY(),1),a=e.width(),o=e.height();e.offsetLeft(s*a),e.offsetTop(i*o),e.offsetRight((r-1)*a),e.offsetBottom((n-1)*o),this._depth=t.GetMaxZ()}ReleaseMesh(){this._meshInfo&&(this._meshInfo.sourceMesh.Release(),this._meshInfo.transformedMesh.Release(),this._meshInfo=null,this._DiscardTransformedCollisionPoly())}SetMeshPoint(t,s,i){t=Math.floor(t),s=Math.floor(s);const r=i.mode||"absolute";if(!_.has(r))throw new Error("invalid mode");const n="relative"===r;let a=i.x,o=i.y;const h=i.zElevation;let l="number"==typeof i.u?i.u:n?0:-1,c="number"==typeof i.v?i.v:n?0:-1;if(!this.HasMesh())return!1;const u=this.GetSourceMesh(),d=u.GetMeshPointAt(t,s);if(null===d)return!1;let p=!1;return"number"==typeof h&&d.GetZElevation()!==h&&(d.SetZElevation(h),p=!0),n&&(a+=t/(u.GetHSize()-1),o+=s/(u.GetVSize()-1)),-1!==l||n?(n&&(l+=t/(u.GetHSize()-1)),l=e.clamp(l,0,1)):l=d.GetU(),-1!==c||n?(n&&(c+=s/(u.GetVSize()-1)),c=e.clamp(c,0,1)):c=d.GetV(),d.GetX()===a&&d.GetY()===o&&d.GetU()===l&&d.GetV()===c?p:(d.SetX(a),d.SetY(o),d.SetU(l),d.SetV(c),this._DiscardTransformedCollisionPoly(),!0)}HasTilemap(){return this._inst.HasTilemap()}ContainsPoint(e,t){return!!this.GetBoundingBox().containsPoint(e,t)&&(!!this.GetBoundingQuad().containsPoint(e,t)&&(this.HasTilemap()?this._inst.GetSdkInstance().TestPointOverlapTile(e,t):!this.HasOwnCollisionPoly()||this.GetTransformedCollisionPoly().containsPoint(e-this.GetX(),t-this.GetY())))}_IsCollisionCellChanged(){return 0!=(this._flags&y)}_UpdateCollisionCell(){if(!this._IsCollisionCellChanged()||!this.IsCollisionEnabled()||0!=(this._flags&b))return;const t=this.GetBoundingBox(),s=this._objectClass._GetCollisionCellGrid(),i=this._collisionCells;if(r.set(s.XToCell(t.getLeft()),s.YToCell(t.getTop()),s.XToCell(t.getRight()),s.YToCell(t.getBottom())),i.equals(r))return;const n=this._inst;i===u?(s.Update(n,null,r),this._collisionCells=e.New(e.Rect,r)):(s.Update(n,i,r),i.copy(r)),this._flags&=~y}_RemoveFromCollisionCells(){const e=this._collisionCells;e!==u&&(this._objectClass._GetCollisionCellGrid().Update(this._inst,e,null),this._collisionCells=u)}_UpdateRenderCell(){const t=this.GetLayer();if(!t.UsesRenderCells()||0!=(this._flags&b))return;const s=t.GetRenderGrid(),i=this.GetBoundingBox(),n=this._renderCells;if(r.set(s.XToCell(i.getLeft()),s.YToCell(i.getTop()),s.XToCell(i.getRight()),s.YToCell(i.getBottom())),n.equals(r))return;const a=this._inst;n===c?(s.Update(a,null,r),this._renderCells=e.New(e.Rect,r)):(s.Update(a,n,r),n.copy(r)),t.SetRenderListStale()}_RemoveFromRenderCells(){const e=this._renderCells;e!==c&&(this.GetLayer().GetRenderGrid().Update(this._inst,e,null),this._renderCells=c)}GetRenderCellRange(){return this._renderCells}ZOrderMoveToTop(){const e=this._inst,t=this._layer,s=t._GetInstances();s.length&&s.at(-1)===e||(t._RemoveInstance(e,!1),t._AddInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToBottom(){const e=this._inst,t=this._layer,s=t._GetInstances();s.length&&s[0]===e||(t._RemoveInstance(e,!1),t._PrependInstance(e,!1),this._runtime.UpdateRender())}ZOrderMoveToLayer(e){const t=this._inst,s=this._layer;if(s.GetLayout()!==e.GetLayout())throw new Error("layer from different layout");e!==s&&(s._RemoveInstance(t,!0),this._SetLayer(e),e._AddInstance(t,!0),this._runtime.UpdateRender())}ZOrderMoveAdjacentToInstance(e,t){const s=this._inst;let i=!1;const r=this._layer;if(e.GetUID()===s.GetUID())return;const n=e.GetWorldInfo();if(!n)throw new Error("expected world instance");const a=n.GetLayer();r.GetIndex()!==a.GetIndex()&&(r._RemoveInstance(s,!0),this._SetLayer(a),a._AddInstance(s,!0),i=!0);const o=a.MoveInstanceAdjacent(s,e,!!t);(i||o)&&this._runtime.UpdateRender()}GetInstanceEffectList(){return this._instanceEffectList}_SetHasAnyActiveEffect(e){this._SetFlag(I,e)}HasAnyActiveEffect(){return 0!=(this._flags&I)}_SaveToJson(e){const t={x:this.GetX(),y:this.GetY(),w:this.GetWidth(),h:this.GetHeight(),l:this.GetLayer().GetSID(),zi:this.GetZIndex()};0!==this.GetZElevation()&&(t.ze=this.GetZElevation()),0!==this.GetAngle()&&(t.a=this.GetAngle()),this.HasDefaultColor()||(t.c=this._color.toJSON()),.5!==this.GetOriginX()&&(t.oX=this.GetOriginX()),.5!==this.GetOriginY()&&(t.oY=this.GetOriginY()),0!==this.GetBlendMode()&&(t.bm=this.GetBlendMode()),this.IsVisible()||(t.v=this.IsVisible()),this.IsCollisionEnabled()||(t.ce=this.IsCollisionEnabled()),this.IsBboxChangeEventEnabled()&&(t.be=this.IsBboxChangeEventEnabled()),this._instanceEffectList&&(t.fx=this._instanceEffectList._SaveToJson());const s=0!=(this._flags&G);return s&&(t.sfi=s),this._solidFilterTags&&(t.sft=[...this._solidFilterTags].join(" ")),this._sceneGraphInfo&&"visual-state"!==e&&(t.sgi=this._sceneGraphInfo._SaveToJson(e),U.has(this)&&(t.sgcd=U.get(this).childrenData,t.sgzid=U.get(this).zIndexData)),this.HasMesh()&&(t.mesh=this.GetSourceMesh().SaveToJson()),t}_SaveSceneGraphPropertiesToJson(){return{x:this._x,y:this._y,z:this._zElevation,w:this._w,h:this._h,a:this._a}}_LoadSceneGraphPropertiesFromJson(e){e&&(this._x=e.x,this._y=e.y,this._zElevation=e.z,this._w=e.w,this._h=e.h,this._a=e.a,this._MarkSinCosAngleChanged(),this.SetBboxChanged())}_SetupSceneGraphConnectionsOnChangeOfLayout(){this._ReleaseTmpSceneGraphInfo(),this._ResetAllSceneGraphState(),this._CreateSceneGraphInfo(null),this._sceneGraphInfo&&this._sceneGraphInfo._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes)}_OnBeforeLoad(e){"visual-state"!==e&&this._ResetAllSceneGraphState()}_LoadFromJson(t,s){if(p=!1,this.SetX(t.x),this.SetY(t.y),this.SetWidth(t.w),this.SetHeight(t.h),this._SetZIndex(t.zi),this.SetZElevation(t.hasOwnProperty("ze")?t.ze:0),this.SetAngle(t.hasOwnProperty("a")?t.a:0),t.hasOwnProperty("c")?o.setFromJSON(t.c):t.hasOwnProperty("o")?(o.copyRgb(this._color),o.a=t.o):o.setRgba(1,1,1,1),this._SetColor(o),this.SetOriginX(t.hasOwnProperty("oX")?t.oX:.5),this.SetOriginY(t.hasOwnProperty("oY")?t.oY:.5),this.SetBlendMode(t.hasOwnProperty("bm")?t.bm:0),this.SetVisible(!t.hasOwnProperty("v")||t.v),this.SetCollisionEnabled(!t.hasOwnProperty("ce")||t.ce),this.SetBboxChangeEventEnabled(!!t.hasOwnProperty("be")&&t.be),this.SetSolidCollisionFilter(!!t.hasOwnProperty("sfi")&&t.sfi,t.hasOwnProperty("sft")?t.sft:""),this._instanceEffectList&&t.hasOwnProperty("fx")&&this._instanceEffectList._LoadFromJson(t.fx),!t.hasOwnProperty("sgi")&&"visual-state"!==s&&this._tmpSceneGraphChildren)for(const e of this._tmpSceneGraphChildren)e.IsDestroyed()||this._runtime.DestroyInstance(e);if(t.hasOwnProperty("sgi")&&"visual-state"!==s){this._CreateSceneGraphInfo(null);const s=this._sceneGraphInfo,i=t.sgi;s._LoadFromJson(i),s._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes),H.set(this,!0);const r=this.GetRuntime().Dispatcher();this._after_load&&r.removeEventListener("afterload",this._after_load),this._after_load_instance&&r.removeEventListener("afterloadinstance",this._after_load_instance),this._after_load=null,this._after_load_instance=null,this._after_load=(e,t)=>{this._after_load&&r.removeEventListener("afterload",this._after_load),this._after_load_instance&&r.removeEventListener("afterloadinstance",this._after_load_instance),this._after_load_instance=null,this._after_load=null,0==(this._flags&b)&&(s._OnAfterLoad(i,t),s._SetTmpSceneGraphChildren(null,null),this._ReleaseTmpSceneGraphInfo(),this.SetBboxChanged())},this._after_load_instance=e=>{e.instance===this.GetInstance()&&this._after_load(e,{ignoreMissingInstances:!0})},r.addEventListener("afterload",this._after_load),r.addEventListener("afterloadinstance",this._after_load_instance),t.sgcd&&e.IsFiniteNumber(t.sgzid)&&U.set(this,{childrenData:t.sgcd,zIndexData:t.sgzid})}if(t.hasOwnProperty("mesh")){const e=t.mesh;this.CreateMesh(e.cols,e.rows),this.GetSourceMesh().LoadFromJson(e)}else this.ReleaseMesh();this.SetBboxChanged(),p=!0,this._UpdateRendererStateGroup()}}}{const e=self.C3;e.BehaviorType=class extends e.DefendedBase{constructor(t,s){super();const i=t.GetRuntime(),r=i.GetPluginManager(),n=i.GetObjectReference(s[1]);r.HasBehaviorByConstructorFunction(n)||r.CreateBehavior(s),this._runtime=i,this._objectClass=t,this._behavior=r.GetBehaviorByConstructorFunction(n),this._sdkType=null,this._instSdkCtor=n.Instance,this._sid=s[2],this._name=s[0],this._jsPropName=this._runtime.GetJsPropName(s[3]),this._sdkType=e.New(n.Type,this),this.OnCreate()}static Create(t,s){return e.New(e.BehaviorType,t,s)}Release(){this._runtime=null,this._behavior=null,this._sdkType.Release(),this._sdkType=null,this._instSdkCtor=null}GetSdkType(){return this._sdkType}OnCreate(){this._sdkType.OnCreate()}GetRuntime(){return this._runtime}GetObjectClass(){return this._objectClass}GetBehavior(){return this._behavior}GetInstanceSdkCtor(){return this._instSdkCtor}GetName(){return this._name}GetSID(){return this._sid}GetJsPropName(){return this._jsPropName}}}{const e=self.C3,t=self.IBehaviorInstance;e.BehaviorInstance=class extends e.DefendedBase{constructor(e){super(),this._runtime=e.runtime,this._behaviorType=e.behaviorType,this._behavior=this._behaviorType.GetBehavior(),this._inst=e.instance,this._index=e.index,this._sdkInst=null,this._iScriptInterface=null,this._behavior._AddInstance(this._inst)}Release(){this._iScriptInterface&&(this._iScriptInterface._Release(),this._iScriptInterface=null),this._behavior._RemoveInstance(this._inst),this._sdkInst.Release(),this._sdkInst=null,this._runtime=null,this._behaviorType=null,this._behavior=null,this._inst=null}_CreateSdkInstance(t){if(this._sdkInst)throw new Error("already got sdk instance");this._sdkInst=e.New(this._behaviorType.GetInstanceSdkCtor(),this,t)}GetSdkInstance(){return this._sdkInst}GetObjectInstance(){return this._inst}GetRuntime(){return this._runtime}GetBehaviorType(){return this._behaviorType}GetBehavior(){return this._behavior}_GetIndex(){return this._index}PostCreate(){this._sdkInst.PostCreate()}OnSpriteFrameChanged(e,t){this._sdkInst.OnSpriteFrameChanged(e,t)}_GetDebuggerProperties(){return this._sdkInst.GetDebuggerProperties()}SaveToJson(){return this._sdkInst.SaveToJson()}LoadFromJson(e){return this._sdkInst.LoadFromJson(e)}static SortByTickSequence(e,t){const s=e.GetObjectInstance(),i=t.GetObjectInstance(),r=s.GetObjectClass().GetIndex(),n=i.GetObjectClass().GetIndex();if(r!==n)return r-n;const a=s.GetPUID(),o=i.GetPUID();return a!==o?a-o:e.GetBehaviorInstance()._GetIndex()-t.GetBehaviorInstance()._GetIndex()}_InitScriptInterface(){const e=t,s=this._sdkInst.GetScriptInterfaceClass(),i=s||e;if(t._Init(this),this._iScriptInterface=new i,t._Init(null),s&&!(this._iScriptInterface instanceof e))throw new TypeError(`script interface class '${s.name}' does not extend the right base class '${e.name}'`);return this._iScriptInterface}GetScriptInterface(){return this._iScriptInterface||this._InitScriptInterface()}HasScriptInterface(){return!!this._iScriptInterface}}}{const e=self.C3;e.EffectList=class extends e.DefendedBase{constructor(t,s){super(),this._owner=t,this._allEffectTypes=[],this._activeEffectTypes=[],this._effectTypesByName=new Map,this._effectParams=[],this._effectParamBuffers=[],this._allInstanceEffectLists=new Set,this._preservesOpaqueness=!0;for(const t of s){const s=e.New(e.EffectType,this,t,this._allEffectTypes.length);this._allEffectTypes.push(s),this._effectTypesByName.set(s.GetName().toLowerCase(),s),t.length>=3&&this._effectParams.push(this._LoadSingleEffectParameters(s,t[2]))}this.GetRuntime()._AddEffectList(this)}Release(){for(const e of this._effectParamBuffers)e.Release();e.clearArray(this._effectParamBuffers),e.clearArray(this._allEffectTypes),e.clearArray(this._activeEffectTypes),this._effectTypesByName.clear(),e.clearArray(this._effectParams),this._owner=null}_AddInstanceEffectList(e){this._allInstanceEffectLists.add(e)}_RemoveInstanceEffectList(e){this._allInstanceEffectLists.delete(e)}_InitRenderer(t){t.IsWebGPU()&&(this._effectParamBuffers=this._allEffectTypes.map((t=>{const s=t.GetShaderProgram();return s.GetCustomParametersByteSize()>0?e.New(e.Gfx.WebGPUEffectCustomParamsBuffer,s):null})),this._UpdateAllEffectParamBuffers());for(const e of this._allInstanceEffectLists)e._InitRenderer(t)}PrependEffectTypes(e){if(e.length){this._allEffectTypes=e.concat(this._allEffectTypes);for(const t of e)this._effectTypesByName.set(t.GetName().toLowerCase(),t);for(let e=0,t=this._allEffectTypes.length;e<t;++e)this._allEffectTypes[e]._SetIndex(e)}}_LoadSingleEffectParameters(t,s){t.SetActive(s[0]);const i=s.slice(1);for(let t=0,s=i.length;t<s;++t){const s=i[t];if(Array.isArray(s)){const r=e.New(e.Color);r.setFromJSON(s),i[t]=r}}return i}GetOwner(){return this._owner}GetRuntime(){return this._owner.GetRuntime()}UpdateActiveEffects(){e.clearArray(this._activeEffectTypes);let t=!0;for(const e of this._allEffectTypes)e.IsActive()&&(this._activeEffectTypes.push(e),e.GetShaderProgram().PreservesOpaqueness()||(t=!1));this._preservesOpaqueness=t}GetAllEffectTypes(){return this._allEffectTypes}HasAnyEffectType(){return this._allEffectTypes.length>0}GetEffectTypeByName(e){return this._effectTypesByName.get(e.toLowerCase())||null}GetEffectTypeByIndex(e){if((e=Math.floor(+e))<0||e>=this._allEffectTypes.length)throw new RangeError("invalid effect type index");return this._allEffectTypes[e]}IsEffectIndexActive(e){return this.GetEffectTypeByIndex(e).IsActive()}SetEffectIndexActive(e,t){this.GetEffectTypeByIndex(e).SetActive(t)}GetActiveEffectTypes(){return this._activeEffectTypes}HasAnyActiveEffect(){return this._activeEffectTypes.length>0}PreservesOpaqueness(){return this._preservesOpaqueness}GetEffectParametersForIndex(e){return this._effectParams[e]}_GetEffectChainShaderParametersForIndex(e){return e<this._effectParamBuffers.length?this._effectParamBuffers[e]:this._effectParams[e]}GetEffectParameter(e,t){if(e<0||e>=this._effectParams.length)return null;const s=this._effectParams[e];return t<0||t>=s.length?null:s[t]}SetEffectParameter(t,s,i){if(t<0||t>=this._effectParams.length)return!1;const r=this._effectParams[t];if(s<0||s>=r.length)return!1;const n=r[s];if(n instanceof e.Color){if(n.equalsIgnoringAlpha(i))return!1;n.copyRgb(i)}else{if(n===i)return!1;r[s]=i}return t<this._effectParamBuffers.length&&this._effectParamBuffers[t].SetParameterValue(s,i),!0}_UpdateAllEffectParamBuffers(){const e=this._effectParams,t=this._effectParamBuffers;for(let s=0,i=Math.min(e.length,t.length);s<i;++s){const i=t[s],r=e[s];for(let e=0,t=r.length;e<t;++e)i.SetParameterValue(e,r[e])}}static SaveFxParamToJson(t){return t&&t instanceof e.Color?{t:"color",v:t.toJSON()}:t}static LoadFxParamFromJson(t){if(null===t)return NaN;if("object"==typeof t){if("color"===t.t){const s=e.New(e.Color);return s.setFromJSON(t.v),s}throw new Error("invalid effect parameter type")}return t}static SaveFxParamsToJson(t){return t.map(e.EffectList.SaveFxParamToJson)}static LoadFxParamsFromJson(t){return t.map(e.EffectList.LoadFxParamFromJson)}SaveToJson(){return this._allEffectTypes.map((t=>({name:t.GetName(),active:t.IsActive(),params:e.EffectList.SaveFxParamsToJson(this._effectParams[t.GetIndex()])})))}LoadFromJson(t){for(const s of t){const t=this.GetEffectTypeByName(s.name);t&&(t.SetActive(s.active),this._effectParams[t.GetIndex()]=e.EffectList.LoadFxParamsFromJson(s.params))}this.UpdateActiveEffects(),this._UpdateAllEffectParamBuffers()}}}{const e=self.C3;e.EffectType=class extends e.DefendedBase{constructor(e,t,s){super(),this._effectList=e,this._id=t[0],this._name=t[1],this._index=s,this._shaderProgram=null,this._isActive=!0}Release(){this._effectList=null,this._shaderProgram=null}Clone(t){const s=e.New(e.EffectType,t,[this._id,this._name],-1);return s._shaderProgram=this._shaderProgram,s._isActive=this._isActive,s}_InitRenderer(e){const t=e.GetShaderProgramByName(this._id);if(!t)throw new Error("failed to find shader program '"+this._id+"'");this._shaderProgram=t}GetEffectList(){return this._effectList}GetName(){return this._name}_SetIndex(e){this._index=e}GetIndex(){return this._index}GetOwner(){return this._effectList.GetOwner()}GetRuntime(){return this._effectList.GetRuntime()}SetActive(e){this._isActive=!!e}IsActive(){return this._isActive}GetShaderProgram(){return this._shaderProgram}GetDefaultParameterValues(){const t=[];for(let s=0,i=this._shaderProgram.GetParameterCount();s<i;++s){const i=this._shaderProgram.GetParameterType(s);if("float"===i||"percent"===i)t.push(0);else{if("color"!==i)throw new TypeError("unknown effect parameter type");t.push(e.New(e.Color,1,1,1,1))}}return t}}}{const e=self.C3;e.InstanceEffectList=class extends e.DefendedBase{constructor(t,s){super(),this._inst=t,this._wi=s,this._effectList=t.GetObjectClass().GetEffectList(),this._needsRebuildSteps=!0,this._wasDefaultColor=!0,this._was3D=!1,this._wasRotatedOrNegativeSize=!1,this._wasTexRotated=!1,this._effectChain=e.New(e.Gfx.EffectChain,t.GetRuntime().GetCanvasManager().GetEffectChainManager(),{drawContent:(e,t)=>{const s=t.GetContentObject(),i=s.GetWorldInfo();e.SetColor(i.GetPremultipliedColor()),e.SetCurrentZ(i.GetTotalZElevation()),s.Draw(e),e.SetCurrentZ(0)},getSourceTextureInfo:e=>{const t=e.GetCurrentTexRect(),[s,i]=e.GetCurrentSurfaceSize();return{srcTexRect:t,srcWidth:s,srcHeight:i}},getShaderParameters:e=>this._GetEffectChainShaderParametersForIndex(e)}),this._activeEffectFlags=[],this._activeEffectTypes=[],this._preservesOpaqueness=!0,this._effectParams=[],this._effectParamBuffers=[],this._InitRenderer(t.GetRuntime().GetRenderer());for(let e=0,t=this._effectList.GetAllEffectTypes().length;e<t;++e)this._activeEffectFlags.push(!0);this.UpdateActiveEffects(),this._effectList._AddInstanceEffectList(this)}Release(){this._effectList._RemoveInstanceEffectList(this);for(const e of this._effectParamBuffers)e.Release();e.clearArray(this._effectParamBuffers),this._effectChain.Release(),this._effectChain=null,e.clearArray(this._activeEffectFlags),e.clearArray(this._activeEffectTypes),e.clearArray(this._effectParams),this._inst=null,this._effectList=null}_InitRenderer(t){t.IsWebGPU()&&(this._effectParamBuffers=this._effectList.GetAllEffectTypes().map((t=>{const s=t.GetShaderProgram();return s.GetCustomParametersByteSize()>0?e.New(e.Gfx.WebGPUEffectCustomParamsBuffer,s):null})))}_LoadEffectParameters(e){let t=0;for(const s of e)this._effectParams.push(this._LoadSingleEffectParameters(t,s)),++t;this._UpdateAllEffectParamBuffers(),this.UpdateActiveEffects()}_LoadSingleEffectParameters(t,s){this._activeEffectFlags[t]=s[0];const i=s.slice(1);for(let t=0,s=i.length;t<s;++t){const s=i[t];if(Array.isArray(s)){const r=e.New(e.Color);r.setFromJSON(s),i[t]=r}}return i}LoadDefaultEffectParameters(){for(const e of this._effectList.GetAllEffectTypes())this._effectParams.push(e.GetDefaultParameterValues());this._UpdateAllEffectParamBuffers()}GetOwner(){return this._owner}GetEffectList(){return this._effectList}GetEffectChain(){return this._MaybeRebuildEffectChainSteps(),this._effectChain}GetRuntime(){return this._inst.GetRuntime()}UpdateActiveEffects(){e.clearArray(this._activeEffectTypes);const t=this._wi,s=this._effectList.GetAllEffectTypes(),i=this._activeEffectTypes,r=this._activeEffectFlags;let n=!0;for(let e=0,t=s.length;e<t;++e)if(r[e]){const t=s[e];i.push(t),t.GetShaderProgram().PreservesOpaqueness()||(n=!1)}this._preservesOpaqueness=n,t._SetHasAnyActiveEffect(!!i.length),this._needsRebuildSteps=!0}_MaybeRebuildEffectChainSteps(){const e=this._inst,t=this._wi,s=t.HasDefaultColor(),i=t.GetDepth()>0,r=0!==t.GetAngle()||t.GetWidth()<0||t.GetHeight()<0,n=e.IsCurrentTexRotated();(this._needsRebuildSteps||s!==this._wasDefaultColor||i!==this._was3D||r!==this._wasRotatedOrNegativeSize||n!==this._wasTexRotated||this._effectChain.NeedsRebuild())&&(this._effectChain.BuildSteps(this._activeEffectTypes.map((e=>e.GetShaderProgram())),{indexMap:this._activeEffectTypes.map((e=>e.GetIndex())),forcePreDraw:!s||e.MustPreDraw(),is3D:i,isSourceTextureRotated:n,isRotatedOrNegativeSizeInstance:r}),this._needsRebuildSteps=!1,this._wasDefaultColor=s,this._was3D=i,this._wasRotatedOrNegativeSize=r,this._wasTexRotated=n)}GetActiveEffectTypes(){return this._activeEffectTypes}GetEffectParametersForIndex(e){return this._effectParams[e]}_GetEffectChainShaderParametersForIndex(e){return e<this._effectParamBuffers.length?this._effectParamBuffers[e]:this._effectParams[e]}GetEffectParameter(e,t){if(e<0||e>=this._effectParams.length)return null;const s=this._effectParams[e];return t<0||t>=s.length?null:s[t]}SetEffectParameter(t,s,i){if(t<0||t>=this._effectParams.length)return!1;const r=this._effectParams[t];if(s<0||s>=r.length)return!1;const n=r[s];if(n instanceof e.Color){if(n.equalsIgnoringAlpha(i))return!1;n.copyRgb(i)}else{if(n===i)return!1;r[s]=i}return t<this._effectParamBuffers.length&&this._effectParamBuffers[t].SetParameterValue(s,i),!0}_UpdateAllEffectParamBuffers(){const e=this._effectParams,t=this._effectParamBuffers;for(let s=0,i=t.length;s<i;++s){const i=t[s],r=e[s];for(let e=0,t=r.length;e<t;++e)i.SetParameterValue(e,r[e])}}PreservesOpaqueness(){return this._preservesOpaqueness}HasAnyActiveBackgroundBlendingEffect(){return this._activeEffectTypes.some((e=>e.GetShaderProgram().BlendsBackground()))}IsEffectIndexActive(e){return this._activeEffectFlags[e]}SetEffectIndexActive(e,t){this._activeEffectFlags[e]=!!t}GetAllEffectTypes(){return this._effectList.GetAllEffectTypes()}_SaveToJson(){return this._effectList.GetAllEffectTypes().map((t=>({name:t.GetName(),active:this._activeEffectFlags[t.GetIndex()],params:e.EffectList.SaveFxParamsToJson(this._effectParams[t.GetIndex()])})))}_LoadFromJson(t){for(const s of t){const t=this._effectList.GetEffectTypeByName(s.name);t&&(this._activeEffectFlags[t.GetIndex()]=s.active,this._effectParams[t.GetIndex()]=e.EffectList.LoadFxParamsFromJson(s.params))}this.UpdateActiveEffects(),this._UpdateAllEffectParamBuffers()}}}{const e=self.C3,t=[],s=[],i=[],r=e.New(e.CollisionPoly),n=e.New(e.CollisionPoly),a=e.New(e.Quad),o=e.New(e.Rect),h=e.New(e.Rect);let l=null,c=null,u=null;e.CollisionEngine=class extends e.DefendedBase{constructor(e){super(),this._runtime=e,this._registeredCollisions=[],this._collisionCheckCount=0,this._collisionCheckSec=0,this._polyCheckCount=0,this._polyCheckSec=0}Release(){this._runtime=null}_Update1sStats(){this._collisionCheckSec=this._collisionCheckCount,this._collisionCheckCount=0,this._polyCheckSec=this._polyCheckCount,this._polyCheckCount=0}Get1secCollisionChecks(){return this._collisionCheckSec}Get1secPolyChecks(){return this._polyCheckSec}RegisterCollision(e,t){const s=e.GetWorldInfo(),i=t.GetWorldInfo();s&&i&&s.IsCollisionEnabled()&&i.IsCollisionEnabled()&&this._registeredCollisions.push([e,t])}AddRegisteredCollisionCandidates(e,t,s){for(const[i,r]of this._registeredCollisions){let n=null;if(e===i)n=r;else{if(e!==r)continue;n=i}n.BelongsToObjectClass(t)&&(s.includes(n)||s.push(n))}}CheckRegisteredCollision(e,t){if(!this._registeredCollisions.length)return!1;for(const[s,i]of this._registeredCollisions)if(e===s&&t===i||e===i&&t===s)return!0;return!1}ClearRegisteredCollisions(){e.clearArray(this._registeredCollisions)}TestOverlap(e,t){if(!e||!t||e===t)return!1;const s=e.GetWorldInfo(),i=t.GetWorldInfo();if(!s.IsCollisionEnabled()||!i.IsCollisionEnabled())return!1;this._collisionCheckCount++;const r=s.GetLayer(),n=i.GetLayer();return r.IsTransformCompatibleWith(n)?this._TestOverlap_SameLayers(s,i):this._TestOverlap_DifferentLayers(s,i)}_TestOverlap_SameLayers(e,t){if(!e.GetBoundingBox().intersectsRect(t.GetBoundingBox()))return!1;if(this._polyCheckCount++,!e.GetBoundingQuad().intersectsQuad(t.GetBoundingQuad()))return!1;if(e.HasTilemap()&&t.HasTilemap())return!1;if(e.HasTilemap())return this.TestTilemapOverlap(e,t);if(t.HasTilemap())return this.TestTilemapOverlap(t,e);if(!e.HasOwnCollisionPoly()&&!t.HasOwnCollisionPoly())return!0;const s=e.GetTransformedCollisionPoly(),i=t.GetTransformedCollisionPoly();return s.intersectsPoly(i,t.GetX()-e.GetX(),t.GetY()-e.GetY())}_TestOverlap_DifferentLayers(e,t){const s=e.HasTilemap(),i=t.HasTilemap();if(s&&!i)return this.TestTilemapOverlapDifferentLayers(e,t);if(i&&!s)return this.TestTilemapOverlapDifferentLayers(t,e);if(i||s)return!1;{const s=e.GetLayer(),i=t.GetLayer();r.copy(e.GetTransformedCollisionPoly()),n.copy(t.GetTransformedCollisionPoly());const a=r.pointsArr();for(let t=0,i=a.length;t<i;t+=2){const i=t+1,r=a[t],n=a[i],[o,h]=s.LayerToCanvasCss(r+e.GetX(),n+e.GetY());a[t]=o,a[i]=h}const o=n.pointsArr();for(let e=0,s=o.length;e<s;e+=2){const s=e+1,r=o[e],n=o[s],[a,h]=i.LayerToCanvasCss(r+t.GetX(),n+t.GetY());o[e]=a,o[s]=h}return r.setBboxChanged(),n.setBboxChanged(),this._polyCheckCount++,r.intersectsPoly(n,0,0)}}TestTilemapOverlapDifferentLayers(t,s){const i=t.GetLayer(),r=s.GetLayer();l||(l=e.New(e.CollisionPoly)),c||(c=e.New(e.Rect)),u||(u=e.New(e.Quad));const n=s.GetX(),a=s.GetY(),[o,h]=r.LayerToCanvasCss(n,a),[_,d]=i.CanvasCssToLayer(o,h),p=_-n,f=d-a;if(c.copy(s.GetBoundingBox()),c.offset(p,f),!t.GetBoundingBox().intersectsRect(c))return!1;if(u.copy(s.GetBoundingQuad()),u.offset(p,f),this._polyCheckCount++,!t.GetBoundingQuad().intersectsQuad(u))return!1;l.copy(s.GetTransformedCollisionPoly());const m=l.pointsArr();for(let e=0,t=m.length;e<t;e+=2){const t=e+1;m[e]+=p,m[t]+=f}return l.setBboxChanged(),this.TestTilemapOverlap(t,s,_,d,l,c,u)}TestTilemapOverlap(t,i,n,o,h,l,c){const u=void 0!==l?l:i.GetBoundingBox(),_=t.GetX(),d=t.GetY(),p=t.GetInstance().GetSdkInstance(),f=void 0!==n?n:i.GetX(),m=void 0!==o?o:i.GetY(),g=i.HasOwnCollisionPoly(),S=void 0!==c?c:i.GetBoundingQuad(),y=s;p.GetCollisionRectCandidates(u,y);for(let t=0,s=y.length;t<s;++t){const s=y[t],n=s.GetRect();if(this._collisionCheckCount++,u.intersectsRectOffset(n,_,d)&&(a.setFromRect(n),a.offset(_,d),a.intersectsQuad(S)))if(g){const t=void 0!==h?h:i.GetTransformedCollisionPoly(),o=s.GetPoly();if(o){if(this._polyCheckCount++,o.intersectsPoly(t,f-(_+n.getLeft()),m-(d+n.getTop())))return e.clearArray(y),!0}else if(r.setFromQuad(a,0,0),r.intersectsPoly(t,f,m))return e.clearArray(y),!0}else{const t=s.GetPoly();if(!t)return e.clearArray(y),!0;if(r.setFromQuad(S,0,0),t.intersectsPoly(r,-(_+n.getLeft()),-(d+n.getTop())))return e.clearArray(y),!0}}return e.clearArray(y),!1}TestAndSelectCanvasPointOverlap(t,s,i,r){const n=t.GetCurrentSol(),a=this._runtime.GetCurrentEvent();if(!a)throw new Error("cannot call outside event");const o=a.IsOrBlock(),h=new Map,l=e=>{let t=h.get(e);return void 0===t&&(t=e.IsSelfAndParentsInteractive(),h.set(e,t)),t};if(n.IsSelectAll()){r||(n._SetSelectAll(!1),e.clearArray(n._GetOwnInstances()));for(const e of t.GetInstances()){const t=e.GetWorldInfo(),a=t.GetLayer();let h=!1;if(l(a)&&t.IsInViewport2()){const[e,r]=a.CanvasCssToLayer(s,i,t.GetTotalZElevation());h=t.ContainsPoint(e,r)}if(h){if(r)return!1;n._PushInstance(e)}else o&&n._PushElseInstance(e)}}else{let e,t=!1;o?this._runtime.IsCurrentConditionFirst()&&!n._GetOwnElseInstances().length&&n._GetOwnInstances().length?e=n._GetOwnInstances():(e=n._GetOwnElseInstances(),t=!0):e=n._GetOwnInstances();let a=0;for(let h=0,c=e.length;h<c;++h){const c=e[h],u=c.GetWorldInfo(),_=u.GetLayer();let d=!1;if(l(_)&&u.IsInViewport2()){const[e,t]=_.CanvasCssToLayer(s,i,u.GetTotalZElevation());d=u.ContainsPoint(e,t)}if(d){if(r)return!1;t?n._PushInstance(c):e[a++]=c}else t?e[a++]=c:o&&n._PushElseInstance(c)}r||(e.length=a)}return t.ApplySolToContainer(),h.clear(),!!r||n.HasAnyInstances()}GetCollisionCandidates(t,s,i,r){const n=!!t&&(1!==t.GetParallaxX()||1!==t.GetParallaxY());if(s.IsFamily())for(const t of s.GetFamilyMembers())n||t.IsAnyInstanceParallaxed()?e.appendArray(r,t.GetInstances()):(t._UpdateAllCollisionCells(),t._GetCollisionCellGrid().QueryRange(i,r));else n||s.IsAnyInstanceParallaxed()?e.appendArray(r,s.GetInstances()):(s._UpdateAllCollisionCells(),s._GetCollisionCellGrid().QueryRange(i,r))}GetObjectClassesCollisionCandidates(e,t,s,i){for(const r of t)this.GetCollisionCandidates(e,r,s,i)}GetSolidCollisionCandidates(e,t,s){const i=this._runtime.GetSolidBehavior();i&&this.GetObjectClassesCollisionCandidates(e,i.GetObjectClasses(),t,s)}GetJumpthruCollisionCandidates(e,t,s){const i=this._runtime.GetJumpthruBehavior();i&&this.GetObjectClassesCollisionCandidates(e,i.GetObjectClasses(),t,s)}IsSolidCollisionAllowed(e,t){return e._IsSolidEnabled()&&(!t||t.GetWorldInfo().IsSolidCollisionAllowed(e.GetSavedDataMap().get("solidTags")))}TestOverlapSolid(s){const i=s.GetWorldInfo();this.GetSolidCollisionCandidates(i.GetLayer(),i.GetBoundingBox(),t);for(const i of t)if(this.IsSolidCollisionAllowed(i,s)&&this.TestOverlap(s,i))return e.clearArray(t),i;return e.clearArray(t),null}TestRectOverlapSolid(s,i){this.GetSolidCollisionCandidates(null,s,t);for(const r of t)if(this.IsSolidCollisionAllowed(r,i)&&this.TestRectOverlap(s,r))return e.clearArray(t),r;return e.clearArray(t),null}TestOverlapJumpthru(s,r){let n=null;r&&(n=i,e.clearArray(n));const a=s.GetWorldInfo();this.GetJumpthruCollisionCandidates(a.GetLayer(),a.GetBoundingBox(),t);for(const i of t)if(i._IsJumpthruEnabled()&&this.TestOverlap(s,i)){if(!r)return e.clearArray(t),i;n.push(i)}return e.clearArray(t),n}PushOut(e,t,s,i,r){i=i||50;const n=e.GetWorldInfo(),a=n.GetX(),o=n.GetY();for(let h=0;h<i;++h)if(n.SetXY(a+t*h,o+s*h),n.SetBboxChanged(),!this.TestOverlap(e,r))return!0;return n.SetXY(a,o),n.SetBboxChanged(),!1}PushOutSolid(e,t,s,i,r,n){i=i||50;const a=e.GetWorldInfo(),o=a.GetX(),h=a.GetY();let l=null,c=null;for(let u=0;u<i;++u)if(a.SetXY(o+t*u,h+s*u),a.SetBboxChanged(),!this.TestOverlap(e,l))if(l=this.TestOverlapSolid(e),l)c=l;else if(r&&(l=n?this.TestOverlap(e,n)?n:null:this.TestOverlapJumpthru(e),l&&(c=l)),!l)return c&&this.PushInFractional(e,t,s,c,16,!0),!0;return a.SetXY(o,h),a.SetBboxChanged(),!1}PushOutSolidAxis(e,t,s,i){i=i||50;const r=e.GetWorldInfo(),n=r.GetX(),a=r.GetY();let o=null,h=null;for(let l=0;l<i;++l)for(let i=0;i<2;++i){const c=2*i-1;if(r.SetXY(n+t*l*c,a+s*l*c),r.SetBboxChanged(),!this.TestOverlap(e,o)){if(o=this.TestOverlapSolid(e),!o)return h&&this.PushInFractional(e,t*c,s*c,h,16,!0),!0;h=o}}return r.SetXY(n,a),r.SetBboxChanged(),!1}PushInFractional(e,t,s,i,r,n){let a=2,o=!1,h=!1;const l=e.GetWorldInfo();let c=l.GetX(),u=l.GetY();for(;a<=r;){const r=1/a;a*=2,l.OffsetXY(t*r*(o?1:-1),s*r*(o?1:-1)),l.SetBboxChanged(),this.TestOverlap(e,i)||n&&this.TestOverlapSolid(e)?(o=!0,h=!0):(o=!1,h=!1,c=l.GetX(),u=l.GetY())}h&&(l.SetXY(c,u),l.SetBboxChanged())}PushOutSolidNearest(e,t=100){let s=0;const i=e.GetWorldInfo(),r=i.GetX(),n=i.GetY();let a=0,o=this.TestOverlapSolid(e);if(!o)return!0;for(;s<=t;){let t=0,h=0;switch(a){case 0:t=0,h=-1,s++;break;case 1:t=1,h=-1;break;case 2:t=1,h=0;break;case 3:t=1,h=1;break;case 4:t=0,h=1;break;case 5:t=-1,h=1;break;case 6:t=-1,h=0;break;case 7:t=-1,h=-1;break}if(a=(a+1)%8,i.SetXY(Math.floor(r+t*s),Math.floor(n+h*s)),i.SetBboxChanged(),!this.TestOverlap(e,o)&&(o=this.TestOverlapSolid(e),!o))return!0}return i.SetXY(r,n),i.SetBboxChanged(),!1}CalculateBounceAngle(t,s,i,r){const n=t.GetWorldInfo(),a=n.GetX(),o=n.GetY(),h=Math.max(10,e.distanceTo(s,i,a,o)),l=e.angleTo(s,i,a,o),c=r||this.TestOverlapSolid(t);if(!c)return e.clampAngle(l+Math.PI);let u=c,_=0,d=0;const p=e.toRadians(5);let f;for(f=1;f<36;++f){const e=l-f*p;if(n.SetXY(s+Math.cos(e)*h,i+Math.sin(e)*h),n.SetBboxChanged(),!this.TestOverlap(t,u)&&(u=r?null:this.TestOverlapSolid(t),!u)){_=e;break}}for(36===f&&(_=e.clampAngle(l+Math.PI)),u=c,f=1;f<36;++f){const e=l+f*p;if(n.SetXY(s+Math.cos(e)*h,i+Math.sin(e)*h),n.SetBboxChanged(),!this.TestOverlap(t,u)&&(u=r?null:this.TestOverlapSolid(t),!u)){d=e;break}}if(36===f&&(d=e.clampAngle(l+Math.PI)),n.SetXY(a,o),n.SetBboxChanged(),d===_)return d;const m=e.angleDiff(d,_)/2;let g;g=e.angleClockwise(d,_)?e.clampAngle(_+m+Math.PI):e.clampAngle(d+m);const S=Math.cos(l),y=Math.sin(l),G=Math.cos(g),I=Math.sin(g),T=S*G+y*I,b=S-2*T*G,C=y-2*T*I;return e.angleTo(0,0,b,C)}TestSegmentOverlap(e,t,s,i,r){if(!r)return!1;const n=r.GetWorldInfo();if(!n.IsCollisionEnabled())return!1;if(this._collisionCheckCount++,o.set(Math.min(e,s),Math.min(t,i),Math.max(e,s),Math.max(t,i)),!n.GetBoundingBox().intersectsRect(o))return!1;if(r.HasTilemap())return this._TestSegmentOverlapTilemap(e,t,s,i,r,n);if(this._polyCheckCount++,!n.GetBoundingQuad().intersectsSegment(e,t,s,i))return!1;if(!n.HasOwnCollisionPoly())return!0;return n.GetTransformedCollisionPoly().intersectsSegment(n.GetX(),n.GetY(),e,t,s,i)}_TestSegmentOverlapTilemap(t,i,r,n,l,c){const u=c.GetX(),_=c.GetY(),d=l.GetSdkInstance(),p=s;h.set(t,i,r,n),h.normalize(),d.GetCollisionRectCandidates(h,p);for(let s=0,h=p.length;s<h;++s){const h=p[s],l=h.GetRect();if(this._collisionCheckCount++,o.intersectsRectOffset(l,u,_)&&(a.setFromRect(l),a.offset(u,_),a.intersectsSegment(t,i,r,n))){const s=h.GetPoly();if(!s)return e.clearArray(p),!0;if(this._polyCheckCount++,s.intersectsSegment(u+l.getLeft(),_+l.getTop(),t,i,r,n))return e.clearArray(p),!0}}return e.clearArray(p),!1}TestRectOverlap(e,t){if(!t)return!1;const s=t.GetWorldInfo();if(!s.IsCollisionEnabled())return!1;if(this._collisionCheckCount++,!s.GetBoundingBox().intersectsRect(e))return!1;if(t.HasTilemap())return this._TestRectOverlapTilemap(e,t,s);if(this._polyCheckCount++,a.setFromRect(e),!s.GetBoundingQuad().intersectsQuad(a))return!1;if(!s.HasOwnCollisionPoly())return!0;const i=r;i.setFromRect(e,s.GetX(),s.GetY());const n=s.GetTransformedCollisionPoly();return i.intersectsPoly(n,0,0)}_TestRectOverlapTilemap(t,i,n){const a=n.GetX(),o=n.GetY(),h=i.GetSdkInstance(),l=s;h.GetCollisionRectCandidates(t,l);for(let s=0,i=l.length;s<i;++s){const i=l[s],n=i.GetRect();if(this._collisionCheckCount++,t.intersectsRectOffset(n,a,o)){const s=i.GetPoly();if(!s)return e.clearArray(l),!0;if(this._polyCheckCount++,r.setFromRect(t,0,0),s.intersectsPoly(r,-(a+n.getLeft()),-(o+n.getTop())))return e.clearArray(l),!0}}return e.clearArray(l),!1}TestRayIntersectsInstance(e,t){if(!e)return;const s=e.GetWorldInfo();s.IsCollisionEnabled()&&(this._collisionCheckCount++,s.GetBoundingBox().intersectsRect(t.rect)&&(e.HasTilemap()?this._TestRayIntersectsTilemap(e,s,t):(this._polyCheckCount++,s.HasOwnCollisionPoly()?t.TestInstancePoly(e,s.GetX(),s.GetY(),s.GetTransformedCollisionPoly()):t.TestInstanceQuad(e,s.GetBoundingQuad()))))}_TestRayIntersectsTilemap(t,i,r){const n=i.GetX(),a=i.GetY(),o=s;t.GetSdkInstance().GetCollisionRectCandidates(r.rect,o);for(let e=0,s=o.length;e<s;e++){const s=o[e],h=s.GetRect();if(this._collisionCheckCount++,r.rect.intersectsRectOffset(h,n,a)){const e=s.GetPoly();this._polyCheckCount++,e?r.TestInstancePoly(t,n+h.getLeft(),a+h.getTop(),e):r.TestInstanceRect(t,i.GetX(),i.GetY(),h)}}e.clearArray(o)}}}{const e=self.C3;e.SparseGrid=class extends e.DefendedBase{constructor(t,s){super(),this._cellWidth=t,this._cellHeight=s,this._cells=e.New(e.PairMap)}Release(){this._cells.Release(),this._cells=null}GetCell(t,s,i){let r=this._cells.Get(t,s);return r||(i?(r=e.New(e.GridCell,this,t,s),this._cells.Set(t,s,r),r):null)}XToCell(e){const t=Math.floor(e/this._cellWidth);return isFinite(t)?t:0}YToCell(e){const t=Math.floor(e/this._cellHeight);return isFinite(t)?t:0}Update(e,t,s){if(t)for(let i=t.getLeft(),r=t.getRight();i<=r;++i)for(let r=t.getTop(),n=t.getBottom();r<=n;++r){if(s&&s.containsPoint(i,r))continue;const t=this.GetCell(i,r,!1);t&&(t.Remove(e),t.IsEmpty()&&this._cells.Delete(i,r))}if(s)for(let i=s.getLeft(),r=s.getRight();i<=r;++i)for(let r=s.getTop(),n=s.getBottom();r<=n;++r)t&&t.containsPoint(i,r)||this.GetCell(i,r,!0).Insert(e)}QueryRange(e,t){let s=this.XToCell(e.getLeft());const i=this.YToCell(e.getTop()),r=this.XToCell(e.getRight()),n=this.YToCell(e.getBottom());if(isFinite(r)&&isFinite(n))for(;s<=r;++s)for(let e=i;e<=n;++e){const i=this.GetCell(s,e,!1);i&&i.Dump(t)}}}}{const e=self.C3;e.GridCell=class extends e.DefendedBase{constructor(t,s,i){super(),this._grid=t,this._x=s,this._y=i,this._instances=e.New(e.ArraySet)}Release(){this._instances.Release(),this._instances=null,this._grid=null}IsEmpty(){return this._instances.IsEmpty()}Insert(e){this._instances.Add(e)}Remove(e){this._instances.Delete(e)}Dump(t){e.appendArray(t,this._instances.GetArray())}}}{const e=self.C3,t=1e-6,s=2;e.Ray=class{constructor(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.dx=0,this.dy=0,this.rect=new e.Rect,this.hitFraction=s,this.hitUid=null,this.hitNormal=0,this.hitNormalDx=0,this.hitNormalDy=0,this.hitX=0,this.hitY=0,this.distance=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0}DidCollide(){return this.hitFraction<1+t}Reset(){this.hitFraction=s}Set(e,t,i,r){return this.x1=e,this.y1=t,this.x2=i,this.y2=r,this.dx=i-e,this.dy=r-t,this.rect.set(e,t,i,r),this.rect.normalize(),this.hitFraction=s,this.hitUid=null,this.hitNormal=0,this.hitNormalDx=0,this.hitNormalDy=0,this.hitX=0,this.hitY=0,this.distance=0,this.normalX=1,this.normalY=0,this.reflectionX=1,this.reflectionY=0,this}Complete(){if(!1===this.DidCollide())return;const s=this.dx*this.hitFraction,i=this.dy*this.hitFraction,r=Math.hypot(s,i),n=s/r,a=i/r;this.distance=r-t,this.hitX=this.x1+n*this.distance,this.hitY=this.y1+a*this.distance,this.hitNormal=Math.atan2(this.hitNormalDy,this.hitNormalDx)+Math.PI/2,this.normalX=Math.cos(this.hitNormal),this.normalY=Math.sin(this.hitNormal);const o=n*this.normalX+a*this.normalY;if(this.reflectionX=n-2*this.normalX*o,this.reflectionY=a-2*this.normalY*o,o>0){const t=Math.PI;this.hitNormal=e.clampAngle(this.hitNormal+t),this.normalX=-this.normalX,this.normalY=-this.normalY}}TestInstanceSegment(t,s,i,r,n){const a=e.rayIntersect(this.x1,this.y1,this.x2,this.y2,s,i,r,n);a>=0&&a<this.hitFraction&&(this.hitFraction=a,this.hitUid=t.GetUID(),this.hitNormalDx=s-r,this.hitNormalDy=i-n)}TestInstanceRect(e,t,s,i){const r=t+i.getLeft(),n=t+i.getRight(),a=s+i.getTop(),o=s+i.getBottom();this.TestInstanceSegment(e,r,a,n,a),this.TestInstanceSegment(e,n,a,n,o),this.TestInstanceSegment(e,n,o,r,o),this.TestInstanceSegment(e,r,o,r,a)}TestInstanceQuad(e,t){const s=t.getTlx(),i=t.getTly(),r=t.getTrx(),n=t.getTry(),a=t.getBrx(),o=t.getBry(),h=t.getBlx(),l=t.getBly();this.TestInstanceSegment(e,s,i,r,n),this.TestInstanceSegment(e,r,n,a,o),this.TestInstanceSegment(e,a,o,h,l),this.TestInstanceSegment(e,h,l,s,i)}TestInstancePoly(e,t,s,i){const r=i.pointsArr();for(let i=0,n=r.length;i<n;i+=2){const a=(i+2)%n,o=r[i]+t,h=r[i+1]+s,l=r[a]+t,c=r[a+1]+s;this.TestInstanceSegment(e,o,h,l,c)}}}}{const e=self.C3,t=new Set(["off","crop","scale-inner","scale-outer","letterbox-scale","letterbox-integer-scale"]),s=new Set(["high","low"]),i=self.glMatrix,r=i.mat4,n=i.vec3,a=r.create(),o=300,h=200,l=120,c=8,u=e.New(e.Quad),_=e.New(e.Rect),d=3e3,p=200,f=300;e.CanvasManager=class extends e.DefendedBase{constructor(t){super(),this._runtime=t,this._canvas=null,this._isWebGPUEnabled=!1,this._webglRenderer=null,this._webgpuRenderer=null,this._gpuPreference="high-performance",this._isLimitedToWebGL1=!1,this._windowInnerWidth=0,this._windowInnerHeight=0,this._canvasCssWidth=0,this._canvasCssHeight=0,this._canvasDeviceWidth=0,this._canvasDeviceHeight=0,this._canvasCssOffsetX=0,this._canvasCssOffsetY=0,this._zAxisScale="normalized",this._fieldOfView=0,this._zNear=1,this._zFar=1e4,this._enableMipmaps=!0,this._textureAnisotropy=0,this._drawWidth=0,this._drawHeight=0,this._fullscreenMode="letterbox-scale",this._documentFullscreenMode="letterbox-scale",this._deviceTransformOffX=0,this._deviceTransformOffY=0,this._defaultProjectionMatrix=r.create(),this._wantFullscreenScalingQuality="high",this._fullscreenScalingQuality=this._wantFullscreenScalingQuality,this._isDocumentFullscreen=!1,this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets=new Set,this._shaderData=self.C3_Shaders,this._effectChainManager=e.New(e.Gfx.EffectChainManager,{getDrawSize:()=>[this.GetDrawWidth(),this.GetDrawHeight()],getRenderTarget:()=>this.GetEffectCompositorRenderTarget(),releaseRenderTarget:e=>this.ReleaseEffectCompositorRenderTarget(e),getTime:()=>this.GetRuntime().GetGameTime(),redraw:()=>this.GetRuntime().UpdateRender()}),this._gpuTimeStartFrame=0,this._gpuTimeEndFrame=0,this._gpuLastUtilisation=NaN,this._gpuFrameTimingsBuffer=null,this._layersGpuProfile=new Map,this._gpuCurUtilisation=NaN,this._webgpuFrameTimings=new Map,this._snapshotFormat="",this._snapshotQuality=1,this._snapshotArea=e.New(e.Rect),this._snapshotUrl="",this._snapshotPromise=null,this._snapshotResolve=null,this._isPastingToDrawingCanvas=0,this._loaderStartTime=0,this._rafId=-1,this._loadingProgress=0,this._loadingprogress_handler=e=>this._loadingProgress=e.progress,this._percentText=null,this._splashTextures={logo:null,powered:null,website:null},this._splashFrameNumber=0,this._splashFadeInFinishTime=0,this._splashFadeOutStartTime=0,this._splashState="fade-in",this._splashDoneResolve=null,this._splashDonePromise=new Promise((e=>this._splashDoneResolve=e))}_SetGPUPowerPreference(e){this._gpuPreference=e}_SetWebGPUEnabled(e){this._isWebGPUEnabled=!!e}_SetZAxisScale(e){this._zAxisScale=e}_SetFieldOfView(e){this._fieldOfView=e}_SetZDistances(e,t){this._zNear=e,this._zFar=t}_SetLimitedToWebGL1(e){this._isLimitedToWebGL1=!!e}async CreateCanvas(e){this._canvas=e.canvas,this._runtime.AddDOMComponentMessageHandler("runtime","window-resize",(e=>this._OnWindowResize(e))),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenchange",(e=>this._OnFullscreenChange(e))),this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenerror",(e=>this._OnFullscreenError(e))),this._canvas.addEventListener("webglcontextlost",(e=>this._OnWebGLContextLost(e))),this._canvas.addEventListener("webglcontextrestored",(e=>this._OnWebGLContextRestored(e))),this._isDocumentFullscreen=!!e.isFullscreen;const t=navigator.gpu&&this._isWebGPUEnabled;let s=!1;if(t)try{await this._InitWebGPUContext(!0)}catch(e){this._MaybeLogRendererError("WebGPU",e),this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!0)}catch(e){this._MaybeLogRendererError("WebGL",e),this._webglRenderer=null}if(this.GetRenderer()||(s=!0),!this.GetRenderer()&&t)try{await this._InitWebGPUContext(!1)}catch(e){this._MaybeLogRendererError("WebGPU",e),this._webgpuRenderer=null}if(!this.GetRenderer())try{await this._InitWebGLContext(!1)}catch(e){this._MaybeLogRendererError("WebGL",e),this._webglRenderer=null}const i=this.GetRenderer();if(!i)throw new Error("failed to acquire a renderer - check WebGL or WebGPU is supported");i.SetHasMajorPerformanceCaveat(s),this._webgpuRenderer&&(this._webgpuRenderer.ondevicelost=()=>this._OnWebGPUDeviceLost(),this._webgpuRenderer.ondevicerestored=()=>this._OnWebGPUDeviceRestored()),"normalized"===this._zAxisScale?i.SetZAxisScaleNormalized():(i.SetZAxisScaleRegular(),i.SetFovY(this._fieldOfView)),this.SetSize(e.windowInnerWidth,e.windowInnerHeight,!0),await this._InitRenderer()}_MaybeLogRendererError(e,t){!t||"string"!=typeof t.message||t.message.startsWith("renderer-unavailable")}async _InitWebGPUContext(t){const s={powerPreference:this._gpuPreference,depth:this._runtime.Uses3DFeatures(),failIfMajorPerformanceCaveat:t,usesBackgroundBlending:this._runtime.UsesAnyBackgroundBlending(),canSampleBackbuffer:this._runtime.UsesAnyCrossSampling(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),nearZ:this._zNear,farZ:this._zFar};this._webgpuRenderer=e.New(e.Gfx.WebGPURenderer),await this._webgpuRenderer.Create(this._canvas,s)}async _InitWebGLContext(t){const s={powerPreference:this._gpuPreference,enableGpuProfiling:!0,depth:this._runtime.Uses3DFeatures(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),failIfMajorPerformanceCaveat:t,nearZ:this._zNear,farZ:this._zFar};this._isLimitedToWebGL1&&(s.maxWebGLVersion=1),"Android"===e.Platform.OS&&"Chromium"===e.Platform.BrowserEngine&&e.Platform.BrowserVersionNumber<75&&(s.maxWebGLVersion=1),"standard"===this._runtime.GetCompositingMode()?s.alpha=!0:(s.alpha=!1,s.lowLatency=!0),this._webglRenderer=e.New(e.Gfx.WebGLRenderer,this._canvas,s),await this._webglRenderer.InitState()}async _InitWebGPU(){if(this._shaderData){const t=[];for(const[s,i]of Object.entries(this._shaderData)){i.src=i.wgsl;const r=e.Gfx.WebGPUShaderProgram.GetDefaultVertexShaderSource();t.push(this._webgpuRenderer.CreateShaderProgram(i,r,s))}await Promise.all(t)}}async _InitWebGL(){if(this._shaderData){const t=[];for(const[s,i]of Object.entries(this._shaderData)){let r;if(i.glslWebGL2&&this._webglRenderer.GetWebGLVersionNumber()>=2)i.src=i.glslWebGL2,r=e.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2();else{if(!i.glsl)throw new Error(`shader '${s}' does not support WebGL 1`);i.src=i.glsl,r=e.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource()}t.push(this._webglRenderer.CreateShaderProgram(i,r,s))}await Promise.all(t),this._webglRenderer.ResetLastProgram(),this._webglRenderer.SetTextureFillMode()}this._webglRenderer.SupportsGPUProfiling()&&(this._gpuFrameTimingsBuffer=e.New(e.Gfx.WebGLQueryResultBuffer,this._webglRenderer))}async _InitRenderer(){this._webgpuRenderer?await this._InitWebGPU():this._webglRenderer&&await this._InitWebGL();const e=this.GetRenderer();e.SetMipmapsEnabled(this._enableMipmaps),e.SupportsGPUProfiling()&&(this._gpuLastUtilisation=0);for(const t of this._runtime._GetAllEffectLists()){for(const s of t.GetAllEffectTypes())s._InitRenderer(e);t._InitRenderer(e),t.UpdateActiveEffects()}}Release(){this._runtime=null,this._webglRenderer=null,this._canvas=null}_OnWindowResize(t){const s=this._runtime;if(s.IsExportToVideo())return;const i=t.devicePixelRatio;s.IsInWorker()&&(self.devicePixelRatio=i),s._SetDevicePixelRatio(i),this._isDocumentFullscreen=!!t.isFullscreen,this.SetSize(t.innerWidth,t.innerHeight),s.UpdateRender();const r=new e.Event("window-resize");r.data=t,s.Dispatcher().dispatchEventAndWaitAsyncSequential(r);const n=new e.Event("resize");n.cssWidth=this.GetCssWidth(),n.cssHeight=this.GetCssHeight(),n.deviceWidth=this.GetDeviceWidth(),n.deviceHeight=this.GetDeviceHeight(),s.DispatchUserScriptEvent(n),s.IsDebug()&&(s.HitBreakpoint()||self.C3Debugger.IsDebuggerPaused())&&s.Render()}_OnFullscreenChange(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}_OnFullscreenError(e){this._isDocumentFullscreen=!!e.isFullscreen,this.SetSize(e.innerWidth,e.innerHeight,!0),this._runtime.UpdateRender()}SetSize(t,s,i=!1){if(t=Math.floor(t),s=Math.floor(s),t<=0||s<=0)throw new Error("invalid size");if(this._windowInnerWidth===t&&this._windowInnerHeight===s&&!i)return;this._windowInnerWidth=t,this._windowInnerHeight=s;const r=this.GetCurrentFullscreenMode();"letterbox-scale"===r?this._CalculateLetterboxScale(t,s):"letterbox-integer-scale"===r?this._CalculateLetterboxIntegerScale(t,s):"off"===r?this._CalculateFixedSizeCanvas(t,s):this._CalculateFullsizeCanvas(t,s),this._UpdateFullscreenScalingQuality(r),this._canvas.width=this._canvasDeviceWidth,this._canvas.height=this._canvasDeviceHeight,this._runtime.PostComponentMessageToDOM("canvas","update-size",{marginLeft:this._canvasCssOffsetX,marginTop:this._canvasCssOffsetY,styleWidth:this._canvasCssWidth,styleHeight:this._canvasCssHeight,displayScale:this.GetDisplayScale()});const n=this.GetRenderer();n.SetSize(this._canvasDeviceWidth,this._canvasDeviceHeight,!0);for(const e of this._availableAdditionalRenderTargets)n.DeleteRenderTarget(e);e.clearArray(this._availableAdditionalRenderTargets),n.CalculatePerspectiveMatrix(this._defaultProjectionMatrix,this.GetDrawWidth()/this.GetDrawHeight());const a=this._runtime.GetLayoutManager();a.SetAllLayerProjectionChanged(),a.SetAllLayerMVChanged()}GetDefaultProjectionMatrix(){return this._defaultProjectionMatrix}_CalculateLetterboxScale(e,t){const s=this._runtime.GetDevicePixelRatio(),i=this._runtime.GetOriginalViewportWidth(),r=this._runtime.GetOriginalViewportHeight(),n=i/r;if(e/t>n){const s=t*n;this._canvasCssWidth=Math.round(s),this._canvasCssHeight=t,this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=0}else{const s=e/n;this._canvasCssWidth=e,this._canvasCssHeight=Math.round(s),this._canvasCssOffsetX=0,this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)}this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this._runtime.SetViewportSize(i,r)}_CalculateLetterboxIntegerScale(e,t){const s=this._runtime.GetDevicePixelRatio();1!==s&&(e+=1,t+=1);const i=this._runtime.GetOriginalViewportWidth(),r=this._runtime.GetOriginalViewportHeight(),n=i/r;let a;if(e/t>n){a=t*n*s/i}else{a=e/n*s/r}a>1?a=Math.floor(a):a<1&&(a=1/Math.ceil(1/a)),this._canvasDeviceWidth=Math.round(i*a),this._canvasDeviceHeight=Math.round(r*a),this._canvasCssWidth=this._canvasDeviceWidth/s,this._canvasCssHeight=this._canvasDeviceHeight/s,this._canvasCssOffsetX=Math.max(Math.floor((e-this._canvasCssWidth)/2),0),this._canvasCssOffsetY=Math.max(Math.floor((t-this._canvasCssHeight)/2),0),this._runtime.SetViewportSize(i,r)}_CalculateFullsizeCanvas(e,t){const s=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=e,this._canvasCssHeight=t,this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this._canvasCssOffsetX=0,this._canvasCssOffsetY=0;const i=this.GetDisplayScale();this._runtime.SetViewportSize(this._canvasCssWidth/i,this._canvasCssHeight/i)}_CalculateFixedSizeCanvas(e,t){const s=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=this._runtime.GetViewportWidth(),this._canvasCssHeight=this._runtime.GetViewportHeight(),this._canvasDeviceWidth=Math.round(this._canvasCssWidth*s),this._canvasDeviceHeight=Math.round(this._canvasCssHeight*s),this.IsDocumentFullscreen()?(this._canvasCssOffsetX=Math.floor((e-this._canvasCssWidth)/2),this._canvasCssOffsetY=Math.floor((t-this._canvasCssHeight)/2)):(this._canvasCssOffsetX=0,this._canvasCssOffsetY=0),this._runtime.SetViewportSize(this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight())}_UpdateFullscreenScalingQuality(e){if("high"===this._wantFullscreenScalingQuality)this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high";else{let t,s;if("off"===this.GetCurrentFullscreenMode()?(t=this._runtime.GetViewportWidth(),s=this._runtime.GetViewportHeight()):(t=this._runtime.GetOriginalViewportWidth(),s=this._runtime.GetOriginalViewportHeight()),this._canvasDeviceWidth<t||this._canvasDeviceHeight<s)this._drawWidth=this._canvasDeviceWidth,this._drawHeight=this._canvasDeviceHeight,this._fullscreenScalingQuality="high";else if(this._drawWidth=t,this._drawHeight=s,this._fullscreenScalingQuality="low","scale-inner"===e){const e=t/s,i=this._windowInnerWidth/this._windowInnerHeight;i<e?this._drawWidth=this._drawHeight*i:i>e&&(this._drawHeight=this._drawWidth/i)}else if("scale-outer"===e){const e=t/s,i=this._windowInnerWidth/this._windowInnerHeight;i>e?this._drawWidth=this._drawHeight*i:i<e&&(this._drawHeight=this._drawWidth/i)}}}GetRuntime(){return this._runtime}GetCanvas(){return this._canvas}GetEffectChainManager(){return this._effectChainManager}IsDocumentFullscreen(){return this._isDocumentFullscreen}SetFullscreenMode(e){if(!t.has(e))throw new Error("invalid fullscreen mode");this._fullscreenMode=e;const s=this._runtime.GetLayoutManager();s.SetAllLayerProjectionChanged(),s.SetAllLayerMVChanged()}GetFullscreenMode(){return this._fullscreenMode}SetDocumentFullscreenMode(e){if(!t.has(e))throw new Error("invalid fullscreen mode");this._documentFullscreenMode=e;const s=this._runtime.GetLayoutManager();s.SetAllLayerProjectionChanged(),s.SetAllLayerMVChanged()}GetDocumentFullscreenMode(){return this._documentFullscreenMode}GetCurrentFullscreenMode(){return this.IsDocumentFullscreen()?this.GetDocumentFullscreenMode():this.GetFullscreenMode()}SetFullscreenScalingQuality(e){if(!s.has(e))throw new Error("invalid fullscreen scaling quality");this._wantFullscreenScalingQuality=e,this._runtime.GetLayoutManager().SetAllLayerProjectionChanged()}GetSetFullscreenScalingQuality(){return this._wantFullscreenScalingQuality}GetCurrentFullscreenScalingQuality(){return this._fullscreenScalingQuality}static _FullscreenModeNumberToString(e){switch(e){case 0:return"off";case 1:return"crop";case 2:return"scale-inner";case 3:return"scale-outer";case 4:return"letterbox-scale";case 5:return"letterbox-integer-scale";default:throw new Error("invalid fullscreen mode")}}GetLastWidth(){return this._windowInnerWidth}GetLastHeight(){return this._windowInnerHeight}GetDrawWidth(){return this._drawWidth}GetDrawHeight(){return this._drawHeight}SetMipmapsEnabled(e){this._enableMipmaps=!!e}_SetTextureAnisotropy(e){this._textureAnisotropy=e}GetTextureAnisotropy(){return this._textureAnisotropy}IsRendererContextLost(){return this.GetRenderer().IsContextLost()}_OnWebGLContextLost(e){e.preventDefault(),this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets.clear(),this._effectChainManager.OnContextLost(),this._webglRenderer.OnContextLost(),this._runtime._OnRendererContextLost()}_OnWebGPUDeviceLost(){this._availableAdditionalRenderTargets=[],this._usedAdditionalRenderTargets.clear(),this._effectChainManager.OnContextLost(),this._runtime._OnRendererContextLost()}async _OnWebGLContextRestored(e){await this._webglRenderer.OnContextRestored(),await this._InitRenderer(),await this._runtime._OnRendererContextRestored()}async _OnWebGPUDeviceRestored(){await this._InitRenderer(),await this._runtime._OnRendererContextRestored()}GetWebGLRenderer(){return this._webglRenderer}GetWebGPURenderer(){return this._webgpuRenderer}GetRenderer(){return this._webgpuRenderer||this._webglRenderer}GetRenderScale(){return"low"===this._fullscreenScalingQuality?1/this._runtime.GetDevicePixelRatio():this.GetDisplayScale()}GetDisplayScale(){const e=this.GetCurrentFullscreenMode();if("off"===e||"crop"===e)return 1;const t=this._runtime.GetOriginalViewportWidth(),s=this._runtime.GetOriginalViewportHeight(),i=t/s,r=this._canvasDeviceWidth/this._canvasDeviceHeight;return"scale-inner"!==e&&r>i||"scale-inner"===e&&r<i?this._canvasCssHeight/s:this._canvasCssWidth/t}GetEffectLayerScaleParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this.GetDisplayScale()}GetEffectDevicePixelRatioParam(){return"low"===this.GetCurrentFullscreenScalingQuality()?1:this._runtime.GetDevicePixelRatio()}SetDeviceTransformOffset(e,t){this._deviceTransformOffX=e,this._deviceTransformOffY=t}SetDeviceTransform(e,t,s,i=!0){t=t||this._drawWidth,s=s||this._drawHeight;const r=t/2+this._deviceTransformOffX,n=s/2+this._deviceTransformOffY;if(i){let i=this.GetDefaultProjectionMatrix();t===this._drawWidth&&s===this._drawHeight||(e.CalculatePerspectiveMatrix(a,t/s),i=a),e.SetProjectionMatrix(i)}const o=e.CalculateLookAtModelView2(r,n,e.GetDefaultCameraZ(s),r,n,0,s);e.SetModelViewMatrix(o)}SetCssTransform(e,t=!0){const s=this.GetCssWidth(),i=this.GetCssHeight(),r=s/2,n=i/2;t&&e.SetProjectionMatrix(this.GetDefaultProjectionMatrix());const a=e.CalculateLookAtModelView2(r,n,e.GetDefaultCameraZ(i),r,n,0,i);e.SetModelViewMatrix(a)}GetDeviceWidth(){return this._canvasDeviceWidth}GetDeviceHeight(){return this._canvasDeviceHeight}GetCssWidth(){return this._canvasCssWidth}GetCssHeight(){return this._canvasCssHeight}GetCanvasClientX(){return this._canvasCssOffsetX}GetCanvasClientY(){return this._canvasCssOffsetY}GetAdditionalRenderTarget(e){e.depth=this._runtime.Uses3DFeatures();const t=this._availableAdditionalRenderTargets,s=t.findIndex((t=>t.IsCompatibleWithOptions(e)));let i;return-1!==s?(i=t[s],t.splice(s,1)):i=this.GetRenderer().CreateRenderTarget(e),this._usedAdditionalRenderTargets.add(i),i}ReleaseAdditionalRenderTarget(e){if(!this._usedAdditionalRenderTargets.has(e))throw new Error("render target not in use");this._usedAdditionalRenderTargets.delete(e),this._availableAdditionalRenderTargets.push(e)}GetEffectCompositorRenderTarget(){const e={sampling:this._runtime.GetSampling()};return"low"===this.GetCurrentFullscreenScalingQuality()&&(e.width=this.GetDrawWidth(),e.height=this.GetDrawHeight()),this.GetAdditionalRenderTarget(e)}ReleaseEffectCompositorRenderTarget(e){this.ReleaseAdditionalRenderTarget(e)}*activeLayersGpuProfiles(){for(const e of this._runtime.GetLayoutManager().runningLayouts())for(const t of e.GetLayers()){const e=this._layersGpuProfile.get(t);e&&(yield e)}}GetLayerTimingsBuffer(t){if(!this.GetRenderer().SupportsGPUProfiling())return null;let s=this._layersGpuProfile.get(t);return s||(s={name:t.GetName(),timingsBuffer:e.New(e.Gfx.WebGLQueryResultBuffer,this._webglRenderer),curUtilisation:0,lastUtilisation:0},this._layersGpuProfile.set(t,s)),s.timingsBuffer}_Update1sFrameRange(){const e=this.GetRenderer();if(e.SupportsGPUProfiling()&&0===this._gpuTimeEndFrame){this._gpuTimeEndFrame=e.GetFrameNumber(),this._gpuCurUtilisation=NaN;for(const e of this.activeLayersGpuProfiles())e.curUtilisation=NaN}}_UpdateTick(){this._webglRenderer&&this._webglRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGL(),this._webgpuRenderer&&this._webgpuRenderer.SupportsGPUProfiling()&&this._UpdateTick_WebGPU()}_UpdateTick_WebGL(){if(isNaN(this._gpuCurUtilisation)&&(this._gpuCurUtilisation=this._gpuFrameTimingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),!isNaN(this._gpuCurUtilisation))){if(this._runtime.IsDebug())for(const e of this.activeLayersGpuProfiles())if(e.curUtilisation=e.timingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame),isNaN(e.curUtilisation))return;if(this._gpuFrameTimingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),this._gpuLastUtilisation=Math.min(this._gpuCurUtilisation,1),this._runtime.IsDebug()){for(const e of this.activeLayersGpuProfiles())e.timingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame),e.lastUtilisation=Math.min(e.curUtilisation,1);self.C3Debugger.UpdateGPUProfile(this._gpuLastUtilisation,[...this.activeLayersGpuProfiles()])}this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}}GetGPUFrameTimingsBuffer(){return this._gpuFrameTimingsBuffer}_UpdateTick_WebGPU(){if(0===this._gpuTimeEndFrame)return;for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e){const t=this._webgpuFrameTimings.get(e);if(t&&!t.HasResult())return}const t=this._runtime.GetMainRunningLayout(),s=e.MakeFilledArray(t.GetLayerCount()+1,0);for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e){const t=this._webgpuFrameTimings.get(e);if(!t)continue;const i=t.GetResult();for(let e=0,t=Math.min(s.length,i.length/2);e<t;++e){const t=i[2*e],r=i[2*e+1];if(0===Number(t)||0===Number(r)){s[e]=NaN;continue}const n=Number(r-t)/1e9;s[e]+=n}}if(this._gpuLastUtilisation=e.clamp(s[0],0,1),this._runtime.IsDebug()){const i=[],r=t.GetLayers();for(let t=0,n=Math.min(r.length,s.length-1);t<n;++t)i.push({name:r[t].GetName(),lastUtilisation:e.clamp(s[t+1],0,1)});self.C3Debugger.UpdateGPUProfile(this._gpuLastUtilisation,i)}for(let e=this._gpuTimeStartFrame;e<this._gpuTimeEndFrame;++e)this._webgpuFrameTimings.delete(e);this._gpuTimeStartFrame=this._gpuTimeEndFrame,this._gpuTimeEndFrame=0}_AddWebGPUFrameTiming(e){this._webgpuFrameTimings.set(this._webgpuRenderer.GetFrameNumber(),e)}GetGPUUtilisation(){return this._gpuLastUtilisation}SnapshotCanvas(e,t,s,i,r,n){return this._snapshotFormat=e,this._snapshotQuality=t,this._snapshotArea.setWH(s,i,r,n),this._snapshotPromise||(this._snapshotPromise=new Promise((e=>{this._snapshotResolve=e}))),this._snapshotPromise}_MaybeTakeSnapshot(){if(!this._snapshotFormat)return;let t=this._canvas;const s=this._snapshotArea,i=e.clamp(Math.floor(s.getLeft()),0,t.width),r=e.clamp(Math.floor(s.getTop()),0,t.height);let n=s.width();n=0===n?t.width-i:e.clamp(Math.floor(n),0,t.width-i);let a=s.height();if(a=0===a?t.height-r:e.clamp(Math.floor(a),0,t.height-r),(0!==i||0!==r||n!==t.width||a!==t.height)&&n>0&&a>0){t=e.CreateCanvas(n,a);t.getContext("2d").drawImage(this._canvas,i,r,n,a,0,0,n,a)}e.CanvasToBlob(t,this._snapshotFormat,this._snapshotQuality).then((e=>{this._snapshotUrl&&URL.revokeObjectURL(this._snapshotUrl),this._snapshotUrl=URL.createObjectURL(e),this._snapshotPromise=null,this._snapshotResolve(this._snapshotUrl)})),this._snapshotFormat="",this._snapshotQuality=1}GetCanvasSnapshotUrl(){return this._snapshotUrl}SetIsPastingToDrawingCanvas(e){e?this._isPastingToDrawingCanvas++:this._isPastingToDrawingCanvas--}IsPastingToDrawingCanvas(){return this._isPastingToDrawingCanvas>0}InitLoadingScreen(t){const s=this.GetRenderer();if(2===t)this._percentText=e.New(e.Gfx.RendererText,this.GetRenderer()),this._percentText.SetIsAsync(!1),this._percentText.SetFontName("Arial"),this._percentText.SetFontSize(16),this._percentText.SetHorizontalAlignment("center"),this._percentText.SetVerticalAlignment("center"),this._percentText.SetSize(o,h);else if(0===t){const e=this._runtime.GetLoadingLogoAsset();e&&e.LoadStaticTexture(s).catch((e=>{}))}else 4===t&&(this._LoadSvgSplashImage("splash-images/splash-logo.svg").then((e=>{"done"===this._splashState?s.DeleteTexture(e):this._splashTextures.logo=e})).catch((e=>{})),this._LoadBitmapSplashImage("splash-images/splash-poweredby-512.png").then((e=>{"done"===this._splashState?s.DeleteTexture(e):this._splashTextures.powered=e})).catch((e=>{})),this._LoadBitmapSplashImage("splash-images/splash-website-512.png").then((e=>{"done"===this._splashState?s.DeleteTexture(e):this._splashTextures.website=e})).catch((e=>{})))}async _LoadSvgSplashImage(t){t=new URL(t,this._runtime.GetRuntimeBaseURL()).toString();const s=await e.FetchBlob(t),i=await this._runtime.RasterSvgImage(s,2048,2048);return await this.GetRenderer().CreateStaticTextureAsync(i,{mipMapQuality:"high"})}async _LoadBitmapSplashImage(t){t=new URL(t,this._runtime.GetRuntimeBaseURL()).toString();const s=await e.FetchBlob(t);return await this.GetRenderer().CreateStaticTextureAsync(s,{mipMapQuality:"high"})}HideCordovaSplashScreen(){this._runtime.PostComponentMessageToDOM("runtime","hide-cordova-splash")}StartLoadingScreen(){this._loaderStartTime=Date.now(),this._runtime.Dispatcher().addEventListener("loadingprogress",this._loadingprogress_handler),this._rafId=requestAnimationFrame((()=>this._DrawLoadingScreen()));3!==this._runtime.GetLoaderStyle()&&this.HideCordovaSplashScreen()}async EndLoadingScreen(){const e=this.GetRenderer();this._loadingProgress=1;const t=this._runtime.GetLoaderStyle();4===t&&await this._splashDonePromise,this._splashDoneResolve=null,this._splashDonePromise=null,-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1),this._runtime.Dispatcher().removeEventListener("loadingprogress",this._loadingprogress_handler),this._loadingprogress_handler=null,this._percentText&&(this._percentText.Release(),this._percentText=null),this._runtime.ReleaseLoadingLogoAsset(),e.Start(),this._splashTextures.logo&&(e.DeleteTexture(this._splashTextures.logo),this._splashTextures.logo=null),this._splashTextures.powered&&(e.DeleteTexture(this._splashTextures.powered),this._splashTextures.powered=null),this._splashTextures.website&&(e.DeleteTexture(this._splashTextures.website),this._splashTextures.website=null),e.ClearRgba(0,0,0,0),e.Finish(),this._splashState="done",this._gpuTimeStartFrame=e.GetFrameNumber(),3===t&&this.HideCordovaSplashScreen()}_DrawLoadingScreen(){if(-1===this._rafId)return;const t=this.GetRenderer();t.Start(),this._rafId=-1;const s=this._runtime.GetAssetManager().HasHadErrorLoading(),i=this._runtime.GetLoaderStyle();if(3!==i&&(this.SetCssTransform(t),t.ClearRgba(0,0,0,0),t.ResetColor(),t.SetTextureFillMode(),t.SetTexture(null)),0===i)this._DrawProgressBarAndLogoLoadingScreen(s);else if(1===i)this._DrawProgressBarLoadingScreen(s,l,0);else if(2===i)this._DrawPercentTextLoadingScreen(s);else if(3===i)e.noop();else{if(4!==i)throw new Error("invalid loader style");this._DrawSplashLoadingScreen(s)}t.Finish(),this._rafId=requestAnimationFrame((()=>this._DrawLoadingScreen()))}_DrawPercentTextLoadingScreen(e){e?this._percentText.SetColorRgb(1,0,0):this._percentText.SetColorRgb(.6,.6,.6),this._percentText.SetText(Math.round(100*this._loadingProgress)+"%");const t=this._canvasCssWidth/2,s=this._canvasCssHeight/2,i=o/2,r=h/2;u.setRect(t-i,s-r,t+i,s+r);const n=this.GetRenderer();n.SetTexture(this._percentText.GetTexture()),n.Quad3(u,this._percentText.GetTexRect())}_DrawProgressBarLoadingScreen(e,t,s){const i=this.GetRenderer(),r=c;i.SetColorFillMode(),e?i.SetColorRgba(1,0,0,1):i.SetColorRgba(.118,.565,1,1);const n=this._canvasCssWidth/2,a=this._canvasCssHeight/2,o=t/2,h=r/2;_.setWH(n-o,a-h+s,Math.floor(t*this._loadingProgress),r),i.Rect(_),_.setWH(n-o,a-h+s,t,r),_.offset(-.5,-.5),_.inflate(.5,.5),i.SetColorRgba(0,0,0,1),i.LineRect2(_),_.inflate(1,1),i.SetColorRgba(1,1,1,1),i.LineRect2(_)}_DrawProgressBarAndLogoLoadingScreen(e){const t=this.GetRenderer(),s=this._runtime.GetLoadingLogoAsset();if(!s)return void this._DrawProgressBarLoadingScreen(e,l,0);const i=s.GetTexture();if(!i)return void this._DrawProgressBarLoadingScreen(e,l,0);const r=i.GetWidth(),n=i.GetHeight(),a=this._canvasCssWidth/2,o=this._canvasCssHeight/2,h=r/2,c=n/2;u.setRect(a-h,o-c,a+h,o+c),t.SetTexture(i),t.Quad(u),this._DrawProgressBarLoadingScreen(e,r,c+16)}_DrawSplashLoadingScreen(t){const s=this.GetRenderer(),i=this._splashTextures.logo,r=this._splashTextures.powered,n=this._splashTextures.website,a=Date.now();0===this._splashFrameNumber&&(this._loaderStartTime=a);const o=this._runtime.IsPreview()||this._runtime.IsFBInstantAvailable()&&!this._runtime.IsCordova(),h=o?0:p,l=o?0:d;let c=1;"fade-in"===this._splashState?c=Math.min((a-this._loaderStartTime)/f,1):"fade-out"===this._splashState&&(c=Math.max(1-(a-this._splashFadeOutStartTime)/f,0)),s.SetColorFillMode(),s.SetColorRgba(.231*c,.251*c,.271*c,c),_.set(0,0,this._canvasCssWidth,this._canvasCssHeight),s.Rect(_);const u=Math.ceil(this._canvasCssWidth),m=Math.ceil(this._canvasCssHeight);let g,S;this._canvasCssHeight>256?(s.SetColorRgba(.302*c,.334*c,.365*c,c),g=u,S=Math.max(.005*m,2),_.setWH(0,.8*m-S/2,g,S),s.Rect(_),t?s.SetColorRgba(c,0,0,c):s.SetColorRgba(.161*c,.953*c,.816*c,c),g=u*this._loadingProgress,_.setWH(.5*u-g/2,.8*m-S/2,g,S),s.Rect(_),s.SetColorRgba(c,c,c,c),s.SetTextureFillMode(),r&&(g=1.5*e.clamp(.22*m,105,.6*u),S=g/8,_.setWH(.5*u-g/2,.2*m-S/2,g,S),s.SetTexture(r),s.Rect(_)),i&&(g=Math.min(.395*m,.95*u),S=g,_.setWH(.5*u-g/2,.485*m-S/2,g,S),s.SetTexture(i),s.Rect(_)),n&&(g=1.5*e.clamp(.22*m,105,.6*u),S=g/8,_.setWH(.5*u-g/2,.868*m-S/2,g,S),s.SetTexture(n),s.Rect(_))):(s.SetColorRgba(.302*c,.334*c,.365*c,c),g=u,S=Math.max(.005*m,2),_.setWH(0,.85*m-S/2,g,S),s.Rect(_),t?s.SetColorRgba(c,0,0,c):s.SetColorRgba(.161*c,.953*c,.816*c,c),g=u*this._loadingProgress,_.setWH(.5*u-g/2,.85*m-S/2,g,S),s.Rect(_),s.SetColorRgba(c,c,c,c),s.SetTextureFillMode(),i&&(g=.55*m,S=g,_.setWH(.5*u-g/2,.45*m-S/2,g,S),s.SetTexture(i),s.Rect(_))),this._splashFrameNumber++,"fade-in"===this._splashState&&a-this._loaderStartTime>=f&&this._splashFrameNumber>=2&&(this._splashState="wait",this._splashFadeInFinishTime=a),"wait"===this._splashState&&a-this._splashFadeInFinishTime>=l&&this._loadingProgress>=1&&(this._splashState="fade-out",this._splashFadeOutStartTime=a),("fade-out"===this._splashState&&a-this._splashFadeOutStartTime>=f+h||o&&this._loadingProgress>=1&&a-this._loaderStartTime<500)&&this._splashDoneResolve()}}}{const e=self.C3,t=self.C3Debugger,s=self.assert,i={messagePort:null,runtimeBaseUrl:"",headless:!1,hasDom:!0,isInWorker:!1,useAudio:!0,projectData:"",exportType:""};let r=!0;e.Runtime=class extends e.DefendedBase{constructor(t){t=Object.assign({},i,t),super(),this._messagePort=t.messagePort,this._runtimeBaseUrl=t.runtimeBaseUrl,this._previewUrl=t.previewUrl,this._isHeadless=!!t.headless,this._hasDom=!!t.hasDom,this._isInWorker=!!t.isInWorker,r=t.ife,this._useAudio=!!t.useAudio,this._exportType=t.exportType,this._isiOSCordova=!!t.isiOSCordova,this._isiOSWebView=!!t.isiOSWebView,this._isFBInstantAvailable=!!t.isFBInstantAvailable,this._opusWasmScriptUrl=t.opusWasmScriptUrl,this._opusWasmBinaryUrl=t.opusWasmBinaryUrl,this._isDebug=!("preview"!==this._exportType||!t.isDebug),this._breakpointsEnabled=this._isDebug,this._isDebugging=this._isDebug,this._debuggingDisabled=0,this._additionalLoadPromises=[],this._additionalCreatePromises=[],this._isUsingCreatePromises=!1,this._projectName="",this._projectVersion="",this._projectUniqueId="",this._appId="",this._originalViewportWidth=0,this._originalViewportHeight=0,this._devicePixelRatio=self.devicePixelRatio,this._parallaxXorigin=0,this._parallaxYorigin=0,this._viewportWidth=0,this._viewportHeight=0,this._loaderStyle=0,this._usesLoaderLayout=!1,this._isLoading=!0,this._usesAnyBackgroundBlending=!1,this._usesAnyCrossSampling=!1,this._usesAnyDepthSampling=!1,this._loadingLogoAsset=null,this._assetManager=e.New(e.AssetManager,this,t),this._layoutManager=e.New(e.LayoutManager,this),this._eventSheetManager=e.New(e.EventSheetManager,this),this._pluginManager=e.New(e.PluginManager,this),this._collisionEngine=e.New(e.CollisionEngine,this),this._timelineManager=e.New(e.TimelineManager,this),this._transitionManager=e.New(e.TransitionManager,this),this._templateManager=e.New(e.TemplateManager,this),this._allObjectClasses=[],this._objectClassesByName=new Map,this._objectClassesBySid=new Map,this._familyCount=0,this._allContainers=[],this._allEffectLists=[],this._currentLayoutStack=[],this._instancesPendingCreate=[],this._instancesPendingDestroy=new Map,this._hasPendingInstances=!1,this._isFlushingPendingInstances=!1,this._objectCount=0,this._nextUid=0,this._instancesByUid=new Map,this._instancesToReleaseAtEndOfTick=new Set,this._instancesToReleaseAffectedObjectClasses=new Set,this._objectReferenceTable=[],this._jsPropNameTable=[],this._canvasManager=null,this._uses3dFeatures=!1,this._framerateMode="vsync",this._compositingMode="standard",this._sampling="trilinear",this._isPixelRoundingEnabled=!1,this._needRender=!0,this._pauseOnBlur=!1,this._isPausedOnBlur=!1,this._exportToVideo=null,this._tickCallbacks={normal:e=>{this._rafId=-1,this._ruafId=-1,this.Tick(e)},tickOnly:e=>{this._ruafId=-1,this.Tick(e,!1,"skip-render")},renderOnly:()=>{this._rafId=-1,this.Render()}},this._rafId=-1,this._ruafId=-1,this._tickCount=0,this._tickCountNoSave=0,this._hasStarted=!1,this._isInTick=!1,this._hasStartedTicking=!1,this._isLayoutFirstTick=!0,this._suspendCount=0,this._scheduleTriggersThrottle=new e.PromiseThrottle(1),this._randomNumberCallback=()=>Math.random(),this._startTime=0,this._lastTickTime=0,this._dtRaw=0,this._dt1=0,this._dt=0,this._timeScale=1,this._minimumFramerate=30,this._gameTime=e.New(e.KahanSum),this._gameTimeRaw=e.New(e.KahanSum),this._wallTime=e.New(e.KahanSum),this._instanceTimes=new Map,this._fpsFrameCount=-1,this._fpsLastTime=0,this._fps=0,this._mainThreadTimeCounter=0,this._mainThreadTime=0,this._isLoadingState=!1,this._saveToSlotName="",this._loadFromSlotName="",this._loadFromJson=null,this._lastSaveJson="",this._projectStorage=null,this._savegamesStorage=null,this._dispatcher=e.New(e.Event.Dispatcher),this._domEventHandlers=new Map,this._pendingResponsePromises=new Map,this._nextDomResponseId=0,this._didRequestDeviceOrientationEvent=!1,this._didRequestDeviceMotionEvent=!1,this._isReadyToHandleEvents=!1,this._waitingToHandleEvents=[],this._eventObjects={pretick:e.New(e.Event,"pretick",!1),tick:e.New(e.Event,"tick",!1),tick2:e.New(e.Event,"tick2",!1),instancedestroy:e.New(e.Event,"instancedestroy",!1),beforelayoutchange:e.New(e.Event,"beforelayoutchange",!1),layoutchange:e.New(e.Event,"layoutchange",!1)},this._eventObjects.instancedestroy.instance=null,this._userScriptDispatcher=e.New(e.Event.Dispatcher),this._userScriptEventObjects=null,this._behInstsToTick=e.New(e.RedBlackSet,e.BehaviorInstance.SortByTickSequence),this._behInstsToPostTick=e.New(e.RedBlackSet,e.BehaviorInstance.SortByTickSequence),this._behInstsToTick2=e.New(e.RedBlackSet,e.BehaviorInstance.SortByTickSequence),this._jobScheduler=e.New(e.JobSchedulerRuntime,this,t.jobScheduler),t.canvas&&(this._canvasManager=e.New(e.CanvasManager,this)),this._messagePort.onmessage=e=>this._OnMessageFromDOM(e.data),this.AddDOMComponentMessageHandler("runtime","visibilitychange",(e=>this._OnVisibilityChange(e))),this.AddDOMComponentMessageHandler("runtime","opus-decode",(e=>this._WasmDecodeWebMOpus(e.arrayBuffer))),this.AddDOMComponentMessageHandler("runtime","get-remote-preview-status-info",(()=>this._GetRemotePreviewStatusInfo())),this.AddDOMComponentMessageHandler("runtime","js-invoke-function",(e=>this._InvokeFunctionFromJS(e))),this.AddDOMComponentMessageHandler("runtime","go-to-last-error-script",self.goToLastErrorScript),this.AddDOMComponentMessageHandler("runtime","offline-audio-render-completed",(e=>this._OnOfflineAudioRenderCompleted(e))),this._dispatcher.addEventListener("window-blur",(e=>this._OnWindowBlur(e))),this._dispatcher.addEventListener("window-focus",(()=>this._OnWindowFocus())),this._timelineManager.AddRuntimeListeners(),this._templateManager.AddRuntimeListeners(),this._iRuntime=null,this._interfaceMap=new WeakMap,this._commonScriptInterfaces={keyboard:null,mouse:null,touch:null}}static Create(t){return e.New(e.Runtime,t)}Release(){e.clearArray(this._allObjectClasses),this._objectClassesByName.clear(),this._objectClassesBySid.clear(),this._layoutManager.Release(),this._layoutManager=null,this._eventSheetManager.Release(),this._eventSheetManager=null,this._pluginManager.Release(),this._pluginManager=null,this._assetManager.Release(),this._assetManager=null,this._collisionEngine.Release(),this._collisionEngine=null,this._timelineManager.Release(),this._timelineManager=null,this._transitionManager.Release(),this._transitionManager=null,this._templateManager.Release(),this._templateManager=null,this._canvasManager&&(this._canvasManager.Release(),this._canvasManager=null),this._dispatcher.Release(),this._dispatcher=null,this._tickEvent=null}_OnMessageFromDOM(e){const t=e.type;if("event"===t)this._OnEventFromDOM(e);else{if("result"!==t)throw new Error(`unknown message '${t}'`);this._OnResultFromDOM(e)}}_OnEventFromDOM(t){if(!this._isReadyToHandleEvents)return void this._waitingToHandleEvents.push(t);const s=t.component,i=t.handler,r=t.data,n=t.dispatchOpts,a=!(!n||!n.dispatchRuntimeEvent),o=!(!n||!n.dispatchUserScriptEvent),h=t.responseId;if("runtime"===s){if(a){const t=new e.Event(i);t.data=r,this._dispatcher.dispatchEventAndWaitAsyncSequential(t)}if(o){const t=new e.Event(i,!0);for(const[e,s]of Object.entries(r))t[e]=s;this.DispatchUserScriptEvent(t)}}const l=this._domEventHandlers.get(s);if(!l)return;const c=l.get(i);if(!c)return;let u=null;try{u=c(r)}catch(e){return void(null!==h&&this._PostResultToDOM(h,!1,""+e))}null!==h&&(u&&u.then?u.then((e=>this._PostResultToDOM(h,!0,e))).catch((e=>{this._PostResultToDOM(h,!1,""+e)})):this._PostResultToDOM(h,!0,u))}_PostResultToDOM(e,t,s){this._messagePort.postMessage({type:"result",responseId:e,isOk:t,result:s})}_OnResultFromDOM(e){const t=e.responseId,s=e.isOk,i=e.result,r=this._pendingResponsePromises.get(t);s?r.resolve(i):r.reject(i),this._pendingResponsePromises.delete(t)}AddDOMComponentMessageHandler(e,t,s){let i=this._domEventHandlers.get(e);if(i||(i=new Map,this._domEventHandlers.set(e,i)),i.has(t))throw new Error(`[Runtime] Component '${e}' already has handler '${t}'`);i.set(t,s)}PostComponentMessageToDOM(e,t,s,i){this._messagePort.postMessage({type:"event",component:e,handler:t,data:s,responseId:null},i)}PostComponentMessageToDOMAsync(e,t,s,i){const r=this._nextDomResponseId++,n=new Promise(((e,t)=>{this._pendingResponsePromises.set(r,{resolve:e,reject:t})}));return this._messagePort.postMessage({type:"event",component:e,handler:t,data:s,responseId:r},i),n}PostToDebugger(e){if(!this.IsDebug())throw new Error("not in debug mode");this.PostComponentMessageToDOM("runtime","post-to-debugger",e)}async Init(s){this.IsDebug()?await t.Init(this):self.C3Debugger&&self.C3Debugger.InitPreview(this);const[i]=await Promise.all([this._assetManager.FetchJson("data.json"),this._MaybeLoadOpusDecoder(),this._jobScheduler.Init()]);if(await this._LoadDataJson(i),await this._InitialiseCanvas(s),this.IsPreview(),this.GetWebGLRenderer()){this.GetWebGLRenderer()}else this.GetWebGPURenderer();this.GetRenderer().HasMajorPerformanceCaveat(),this._isReadyToHandleEvents=!0;for(const e of this._waitingToHandleEvents)this._OnEventFromDOM(e);e.clearArray(this._waitingToHandleEvents),this._canvasManager&&this._canvasManager.StartLoadingScreen();for(const e of s.runOnStartupFunctions)this._additionalLoadPromises.push(this._RunOnStartupFunction(e));if(await Promise.all([this._assetManager.WaitForAllToLoad(),...this._additionalLoadPromises]),e.clearArray(this._additionalLoadPromises),!this._assetManager.HasHadErrorLoading())return this._canvasManager&&await this._canvasManager.EndLoadingScreen(),await this._dispatcher.dispatchEventAndWaitAsync(new e.Event("beforeruntimestart")),await this.Start(),this._messagePort.postMessage({type:"runtime-ready"}),this;this._canvasManager&&this._canvasManager.HideCordovaSplashScreen()}async _RunOnStartupFunction(e){try{await e(this._iRuntime)}catch(e){}}async _LoadDataJson(t){const s=t.project;this._projectName=s[0],this._projectVersion=s[16],this._projectUniqueId=s[31],this._appId=s[38];const i=s[39]||"loading-logo.png";this._isPixelRoundingEnabled=!!s[9],this._originalViewportWidth=this._viewportWidth=s[10],this._originalViewportHeight=this._viewportHeight=s[11],this._parallaxXorigin=this._originalViewportWidth/2,this._parallaxYorigin=this._originalViewportHeight/2,this._compositingMode=s[36],this._framerateMode=s[37],"low-latency"===this._compositingMode&&this.IsAndroidWebView()&&e.Platform.BrowserVersionNumber<=77&&(this._compositingMode="standard"),this._uses3dFeatures=!!s[40],this._sampling=s[14],this._usesAnyBackgroundBlending=s[15],this._usesAnyCrossSampling=s[42],this._usesAnyDepthSampling=s[17],this._usesLoaderLayout=!!s[18],this._loaderStyle=s[19],this._nextUid=s[21],this._pauseOnBlur=s[22];const r=this._assetManager;if(r._SetFileStructure(s[45]),r._SetAudioFiles(s[7],s[25]),r._SetMediaSubfolder(s[8]),r._SetFontsSubfolder(s[32]),r._SetIconsSubfolder(s[28]),r._SetWebFonts(s[29]),0===this._loaderStyle){let e="";this.IsPreview()?r._HasLocalUrlBlob(i)&&(e=r.GetLocalUrlAsBlobUrl(i)):e="flat"===r.GetFileStructure()?r.GetIconsSubfolder()+i:i,e&&(this._loadingLogoAsset=r.LoadImage({url:e}))}this._canvasManager&&(this._canvasManager.SetFullscreenMode(e.CanvasManager._FullscreenModeNumberToString(s[12])),this._canvasManager.SetFullscreenScalingQuality(s[23]?"high":"low"),this._canvasManager.SetMipmapsEnabled(0!==s[24]),this._canvasManager._SetGPUPowerPreference(s[34]),this._canvasManager._SetTextureAnisotropy(s[41]),this._canvasManager._SetWebGPUEnabled(s[13]),this._canvasManager._SetZAxisScale(s[30]),this._canvasManager._SetZDistances(s[46],s[47]),this._canvasManager._SetFieldOfView(s[26]),this._canvasManager._SetLimitedToWebGL1(s[48]));const n=s[43];n&&await this._LoadExportToVideoData(n),this._pluginManager.CreateSystemPlugin(),this._objectReferenceTable=self.C3_GetObjectRefTable();for(const e of s[2])this._pluginManager.CreatePlugin(e);this._objectReferenceTable=self.C3_GetObjectRefTable(),this._LoadJsPropNameTable();for(const t of s[3]){const s=e.ObjectClass.Create(this,this._allObjectClasses.length,t);this._allObjectClasses.push(s),this._objectClassesByName.set(s.GetName().toLowerCase(),s),this._objectClassesBySid.set(s.GetSID(),s)}for(const e of s[4]){this._allObjectClasses[e[0]]._LoadFamily(e)}for(const t of s[27]){const s=t.map((e=>this._allObjectClasses[e]));this._allContainers.push(e.New(e.Container,this,s))}for(const e of this._allObjectClasses)e._OnAfterCreate();for(const e of s[5])this._layoutManager.Create(e);const a=s[1];if(a){const e=this._layoutManager.GetLayoutByName(a);e&&this._layoutManager.SetFirstLayout(e)}for(const e of s[33])this._timelineManager.Create(e);for(const e of s[35])this._transitionManager.Create(e);for(const e of s[44])this._templateManager.Create(e);this._templateManager.HasTemplates()||(this._templateManager.Release(),this._templateManager=null),this._InitScriptInterfaces();for(const e of s[6])this._eventSheetManager.Create(e);this._eventSheetManager._PostInit(),this._InitGlobalVariableScriptInterface(),e.clearArray(this._objectReferenceTable),this.FlushPendingInstances();let o="any";const h=s[20];1===h?o="portrait":2===h&&(o="landscape"),this.PostComponentMessageToDOM("runtime","set-target-orientation",{targetOrientation:o})}async _LoadExportToVideoData(e){const t=e.format;"image-sequence"===t?this._exportToVideo=new self.C3ExportToImageSequence(this,e):"image-sequence-gif"===t?this._exportToVideo=new self.C3ExportToGIF(this,e):"webm"===t?this._exportToVideo=new self.C3ExportToWebMVideo(this,e):"mp4"===t&&(this._exportToVideo=new self.C3ExportToMP4Video(this,e)),this._framerateMode="unlimited-frame",this._canvasManager.SetFullscreenMode("off"),this._devicePixelRatio=1,self.devicePixelRatio=1,await this.PostComponentMessageToDOMAsync("runtime","set-exporting-to-video",{message:this._exportToVideo.GetExportingMessageForPercent(0),duration:this._exportToVideo.GetDuration()})}GetLoaderStyle(){return this._loaderStyle}IsExportToVideo(){return null!==this._exportToVideo}GetExportVideoDuration(){return this._exportToVideo.GetDuration()}GetExportVideoFramerate(){return this._exportToVideo.GetFramerate()}_InitExportToVideo(){return this._exportToVideo.Init({width:this._canvasManager.GetDeviceWidth(),height:this._canvasManager.GetDeviceHeight()})}_ExportToVideoAddFrame(){const e=this._tickCount/this.GetExportVideoFramerate();return this._exportToVideo.AddFrame(this._canvasManager.GetCanvas(),e)}_ExportToVideoAddKeyframe(){this._exportToVideo&&this._exportToVideo.AddKeyframe()}_OnOfflineAudioRenderCompleted(e){this._exportToVideo.OnOfflineAudioRenderCompleted(e)}_ExportToVideoFinish(){return this._exportToVideo.Finish()}IsFBInstantAvailable(){return this._isFBInstantAvailable}IsLoading(){return this._isLoading}AddLoadPromise(e){this._additionalLoadPromises.push(e)}SetUsingCreatePromises(e){this._isUsingCreatePromises=!!e}AddCreatePromise(e){this._isUsingCreatePromises&&this._additionalCreatePromises.push(e)}GetCreatePromises(){return this._additionalCreatePromises}_GetNextFamilyIndex(){return this._familyCount++}GetFamilyCount(){return this._familyCount}_AddEffectList(e){this._allEffectLists.push(e)}_GetAllEffectLists(){return this._allEffectLists}async _InitialiseCanvas(e){this._canvasManager&&(await this._canvasManager.CreateCanvas(e),this._canvasManager.InitLoadingScreen(this._loaderStyle))}async _MaybeLoadOpusDecoder(){if(this._assetManager.IsAudioFormatSupported("audio/webm; codecs=opus"))return;let e=null;try{e=this.IsiOSCordova()&&this._assetManager.IsFileProtocol()?await this._assetManager.CordovaFetchLocalFileAsArrayBuffer(this._opusWasmBinaryUrl):await this._assetManager.FetchArrayBuffer(this._opusWasmBinaryUrl)}catch(e){return}e?this.AddJobWorkerBuffer(e,"opus-decoder-wasm"):this.AddJobWorkerBlob(null,"opus-decoder-wasm"),await this.AddJobWorkerScripts([this._opusWasmScriptUrl])}async _WasmDecodeWebMOpus(e){return await this.AddJob("OpusDecode",{arrayBuffer:e},[e])}async Start(){if(this._hasStarted=!0,this._startTime=Date.now(),this._usesLoaderLayout){for(const e of this._allObjectClasses)e.IsFamily()||e.IsOnLoaderLayout()||!e.IsWorldType()||e.OnCreate();this._assetManager.WaitForAllToLoad().then((()=>{this._isLoading=!1,this._OnLoadFinished()}))}else this._isLoading=!1;this._assetManager.SetInitialLoadFinished(),this.IsDebug()&&t.RuntimeInit(r);for(const e of this._layoutManager.GetAllLayouts())e._CreateGlobalNonWorlds();this.IsExportToVideo()&&await this._InitExportToVideo();const e=this._layoutManager.GetFirstLayout();await e._Load(null,this.GetRenderer()),await e._StartRunning(!0),this._fpsLastTime=performance.now(),this._usesLoaderLayout||this._OnLoadFinished();(await this.PostComponentMessageToDOMAsync("runtime","before-start-ticking")).isSuspended&&!this.IsExportToVideo()?this._suspendCount++:this.Tick()}_OnLoadFinished(){this.Trigger(e.Plugins.System.Cnds.OnLoadFinished,null,null),this.PostComponentMessageToDOM("runtime","register-sw")}GetObjectReference(e){e=Math.floor(e);const t=this._objectReferenceTable;if(e<0||e>=t.length)throw new Error("invalid object reference");return t[e]}_LoadJsPropNameTable(){for(const t of self.C3_JsPropNameTable){const s=e.first(Object.keys(t));this._jsPropNameTable.push(s)}}GetJsPropName(e){e=Math.floor(e);const t=this._jsPropNameTable;if(e<0||e>=t.length)throw new Error("invalid prop reference");return t[e]}HasDOM(){return this._hasDom}IsHeadless(){return this._isHeadless}IsInWorker(){return this._isInWorker}GetRuntimeBaseURL(){return this._runtimeBaseUrl}GetPreviewURL(){return this._previewUrl}GetEventSheetManager(){return this._eventSheetManager}GetEventStack(){return this._eventSheetManager.GetEventStack()}GetCurrentEventStackFrame(){return this._eventSheetManager.GetCurrentEventStackFrame()}GetCurrentEvent(){return this._eventSheetManager.GetCurrentEvent()}GetCurrentCondition(){return this._eventSheetManager.GetCurrentCondition()}IsCurrentConditionFirst(){return 0===this.GetCurrentEventStackFrame().GetConditionIndex()}GetCurrentAction(){return this._eventSheetManager.GetCurrentAction()}GetPluginManager(){return this._pluginManager}GetSystemPlugin(){return this._pluginManager.GetSystemPlugin()}GetObjectClassByIndex(e){if((e=Math.floor(e))<0||e>=this._allObjectClasses.length)throw new RangeError("invalid index");return this._allObjectClasses[e]}GetObjectClassByName(e){return this._objectClassesByName.get(e.toLowerCase())||null}GetObjectClassBySID(e){return this._objectClassesBySid.get(e)||null}GetSingleGlobalObjectClassByCtor(e){const t=this._pluginManager.GetPluginByConstructorFunction(e);return t?t.GetSingleGlobalObjectClass():null}GetAllObjectClasses(){return this._allObjectClasses}*allInstances(){for(const e of this._allObjectClasses)e.IsFamily()||(yield*e.instances())}Dispatcher(){return this._dispatcher}UserScriptDispatcher(){return this._userScriptDispatcher}DispatchUserScriptEvent(e){e.runtime=this.GetIRuntime();const s=this.IsDebug()&&!this._eventSheetManager.IsInEventEngine();s&&t.StartMeasuringScriptTime(),this._userScriptDispatcher.dispatchEvent(e),s&&t.AddScriptTime()}DispatchUserScriptEventAsyncWait(e){return e.runtime=this.GetIRuntime(),this._userScriptDispatcher.dispatchEventAndWaitAsync(e)}GetOriginalViewportWidth(){return this._originalViewportWidth}GetOriginalViewportHeight(){return this._originalViewportHeight}SetOriginalViewportSize(e,t){if(this._originalViewportWidth===e&&this._originalViewportHeight===t)return;this._originalViewportWidth=e,this._originalViewportHeight=t;const s=this.GetLayoutManager();s.SetAllLayerProjectionChanged(),s.SetAllLayerMVChanged()}GetViewportWidth(){return this._viewportWidth}GetViewportHeight(){return this._viewportHeight}SetViewportSize(e,t){if(this._viewportWidth===e&&this._viewportHeight===t)return;this._viewportWidth=e,this._viewportHeight=t;const s=this.GetLayoutManager();s.SetAllLayerProjectionChanged(),s.SetAllLayerMVChanged()}_SetDevicePixelRatio(e){this.IsExportToVideo()||(this._devicePixelRatio=e)}GetDevicePixelRatio(){return this._devicePixelRatio}GetParallaxXOrigin(){return this._parallaxXorigin}GetParallaxYOrigin(){return this._parallaxYorigin}GetCanvasManager(){return this._canvasManager}GetDrawWidth(){return this._canvasManager?this._canvasManager.GetDrawWidth():this._viewportWidth}GetDrawHeight(){return this._canvasManager?this._canvasManager.GetDrawHeight():this._viewportHeight}GetRenderScale(){return this._canvasManager?this._canvasManager.GetRenderScale():1}GetDisplayScale(){return this._canvasManager?this._canvasManager.GetDisplayScale():1}GetEffectLayerScaleParam(){return this._canvasManager?this._canvasManager.GetEffectLayerScaleParam():1}GetEffectDevicePixelRatioParam(){return this._canvasManager?this._canvasManager.GetEffectDevicePixelRatioParam():1}GetCanvasClientX(){return this._canvasManager?this._canvasManager.GetCanvasClientX():0}GetCanvasClientY(){return this._canvasManager?this._canvasManager.GetCanvasClientY():0}GetCanvasCssWidth(){return this._canvasManager?this._canvasManager.GetCssWidth():0}GetCanvasCssHeight(){return this._canvasManager?this._canvasManager.GetCssHeight():0}GetFullscreenMode(){return this._canvasManager?this._canvasManager.GetFullscreenMode():"off"}GetAdditionalRenderTarget(e){return this._canvasManager?this._canvasManager.GetAdditionalRenderTarget(e):null}ReleaseAdditionalRenderTarget(e){this._canvasManager&&this._canvasManager.ReleaseAdditionalRenderTarget(e)}UsesAnyBackgroundBlending(){return this._usesAnyBackgroundBlending}UsesAnyCrossSampling(){return this._usesAnyCrossSampling}UsesAnyDepthSampling(){return this._usesAnyDepthSampling}GetGPUUtilisation(){return this._canvasManager?this._canvasManager.GetGPUUtilisation():NaN}IsLinearSampling(){return"nearest"!==this.GetSampling()}GetFramerateMode(){return this._framerateMode}GetCompositingMode(){return this._compositingMode}GetSampling(){return this._sampling}UsesLoaderLayout(){return this._usesLoaderLayout}GetLoadingLogoAsset(){return this._loadingLogoAsset}ReleaseLoadingLogoAsset(){this._loadingLogoAsset&&(this._loadingLogoAsset.Release(),this._loadingLogoAsset=null)}GetLayoutManager(){return this._layoutManager}GetMainRunningLayout(){return this._layoutManager.GetMainRunningLayout()}GetTimelineManager(){return this._timelineManager}GetTransitionManager(){return this._transitionManager}GetTemplateManager(){return this._templateManager}GetAssetManager(){return this._assetManager}LoadImage(e){return this._assetManager.LoadImage(e)}CreateInstance(e,t,s,i,r,n){if(n&&this._templateManager){const a=this._templateManager.GetTemplateData(e,n);if(a){const e=this.CreateInstanceFromData(a,t,!1,s,i,!1,r,void 0,r);return this._templateManager.MapInstanceToTemplateName(e,n),e}}return this.CreateInstanceFromData(e,t,!1,s,i,!1,r,void 0,r)}CreateInstanceFromData(s,i,r,n,a,o,h,l,c){let u=null,_=null;if(s instanceof e.ObjectClass){if(_=s,_.IsFamily()){const e=_.GetFamilyMembers();_=e[Math.floor(this.Random()*e.length)]}u=_.GetDefaultInstanceData()}else u=s,_=this.GetObjectClassByIndex(u[1]);const d=_.GetPlugin().IsWorldType();if(this._isLoading&&d&&!_.IsOnLoaderLayout())return null;const p=i;let f;d||(i=null),f=r&&!o&&u&&!this._instancesByUid.has(u[2])?u[2]:this._nextUid++;const m=u?u[0]:null,g=e.New(e.Instance,{runtime:this,objectType:_,layer:i,worldData:m,instVarData:u?u[3]:null,uid:f});this._instancesByUid.set(f,g);let S=null;d&&(S=g.GetWorldInfo(),void 0!==n&&void 0!==a&&(S.SetX(n),S.SetY(a)),_._SetAnyCollisionCellChanged(!0)),i&&(c||i._AddInstance(g,!0),1===i.GetParallaxX()&&1===i.GetParallaxY()||_._SetAnyInstanceParallaxed(!0),i.GetLayout().MaybeLoadTexturesFor(_)),this._objectCount++;let y=!0;if(l){const e=l.GetObjectClass();if(e.IsInContainer()&&_.IsInContainer()){_.GetContainer()===e.GetContainer()&&(y=!1)}}if(_.IsInContainer()&&!r&&!o&&y){for(const e of _.GetContainer().objectTypes()){if(e===_)continue;const t=this.CreateInstanceFromData(e,p,!1,S?S.GetX():n,S?S.GetY():a,!0,!1,void 0,c);g._AddSibling(t)}for(const e of g.siblings()){e._AddSibling(g);for(const t of g.siblings())e!==t&&e._AddSibling(t)}}if(d&&!r&&h&&this._CreateChildInstancesFromData(g,m,S,i,n,a,c),_.IsInContainer()&&!r&&!o&&h)for(const e of g.siblings()){const t=e.GetWorldInfo();if(!t)continue;const s=e.GetPlugin(),r=e.GetObjectClass().GetDefaultInstanceData()[0];s.IsWorldType()?this._CreateChildInstancesFromData(e,r,t,i,t.GetX(),t.GetY(),c):this._CreateChildInstancesFromData(e,r,t,i,void 0,void 0,c)}if(!o&&h){void 0===n&&(n=m[0]),void 0===a&&(a=m[1]);const e=S.GetTopParent(),t=n-S.GetX()+e.GetX(),s=a-S.GetY()+e.GetY();e.SetXY(t,s)}_._SetIIDsStale();const G=u?e.cloneArray(u[5]):null,I=u?u[4].map((t=>e.cloneArray(t))):null,T=d&&m&&m[13];if(T&&g._SetHasTilemap(),g._CreateSdkInstance(G,I),T){const e=m[13];g.GetSdkInstance().LoadTilemapData(e[2],e[0],e[1])}return this._instancesPendingCreate.push(g),this._hasPendingInstances=!0,this.IsDebug()&&t.InstanceCreated(g),g}_CreateChildInstancesFromData(e,t,s,i,r,n,a){const o=s.GetSceneGraphZIndexExportData(),h=s.GetSceneGraphChildrenExportData();if(e.GetWorldInfo().SetSceneGraphZIndex(o),!h)return;void 0===r&&(r=t[0]),void 0===n&&(n=t[1]);const l=new Set,c=t[0],u=t[1];for(const t of h){const s=t[0],o=t[1],h=t[2],_=t[3],d=!!t[4],p=t[5],f=t[6];let m;if(f)m=f;else{m=this._layoutManager.GetLayoutBySID(s).GetLayer(o).GetInitialInstanceData(h)}const g=this.GetObjectClassByIndex(m[1]),S=e.HasSibling(g),y=l.has(g);if(S&&!y&&d){const t=e.GetSibling(g),s=r+m[0][0]-c,i=n+m[0][1]-u;t.GetWorldInfo().SetXY(s,i),t.GetWorldInfo().SetSceneGraphZIndex(p),e.AddChild(t,{transformX:!!(_>>0&1),transformY:!!(_>>1&1),transformWidth:!!(_>>2&1),transformHeight:!!(_>>3&1),transformAngle:!!(_>>4&1),destroyWithParent:!!(_>>5&1),transformZElevation:!!(_>>6&1),transformOpacity:!!(_>>7&1),transformVisibility:!!(_>>8&1)}),l.add(g)}else{const t=r+m[0][0]-c,s=n+m[0][1]-u,o=this.CreateInstanceFromData(m,i,!1,t,s,!1,!0,e,a);o.GetWorldInfo().SetSceneGraphZIndex(p),e.AddChild(o,{transformX:!!(_>>0&1),transformY:!!(_>>1&1),transformWidth:!!(_>>2&1),transformHeight:!!(_>>3&1),transformAngle:!!(_>>4&1),destroyWithParent:!!(_>>5&1),transformZElevation:!!(_>>6&1),transformOpacity:!!(_>>7&1),transformVisibility:!!(_>>8&1)})}}}DestroyInstance(e){if(this._instancesToReleaseAtEndOfTick.has(e))return;const s=e.GetObjectClass();let i=this._instancesPendingDestroy.get(s);if(i){if(i.has(e))return;i.add(e)}else i=new Set,i.add(e),this._instancesPendingDestroy.set(s,i);if(this.IsDebug()&&t.InstanceDestroyed(e),e._MarkDestroyed(),this._hasPendingInstances=!0,e.IsInContainer())for(const t of e.siblings())this.DestroyInstance(t);for(const t of e.children())t.GetDestroyWithParent()&&this.DestroyInstance(t);if(!this._layoutManager.IsEndingLayout()&&!this._isLoadingState){const t=this.GetEventSheetManager();t.BlockFlushingInstances(!0),e._TriggerOnDestroyed(),t.BlockFlushingInstances(!1)}e._FireDestroyedScriptEvents(this._layoutManager.IsEndingLayout())}FlushPendingInstances(){this._hasPendingInstances&&(this._isFlushingPendingInstances=!0,this._FlushInstancesPendingCreate(),this._FlushInstancesPendingDestroy(),this._isFlushingPendingInstances=!1,this._hasPendingInstances=!1,this.UpdateRender())}_FlushInstancesPendingCreate(){for(const e of this._instancesPendingCreate){const t=e.GetObjectClass();t._AddInstance(e);for(const s of t.GetFamilies())s._AddInstance(e),s._SetIIDsStale()}e.clearArray(this._instancesPendingCreate)}_FlushInstancesPendingDestroy(){this._dispatcher.SetDelayRemoveEventsEnabled(!0);for(const[e,t]of this._instancesPendingDestroy.entries())this._FlushInstancesPendingDestroyForObjectClass(e,t),t.clear();this._instancesPendingDestroy.clear(),this._dispatcher.SetDelayRemoveEventsEnabled(!1)}_FlushInstancesPendingDestroyForObjectClass(t,s){for(const e of s){const t=this._eventObjects.instancedestroy;t.instance=e,this._dispatcher.dispatchEvent(t),this._instancesByUid.delete(e.GetUID()),this._instanceTimes.delete(e);const s=e.GetWorldInfo();s&&(s._RemoveFromCollisionCells(),s._RemoveFromRenderCells(),s._MarkDestroyed()),this._instancesToReleaseAtEndOfTick.add(e),this._objectCount--}e.arrayRemoveAllInSet(t.GetInstances(),s),t._SetIIDsStale(),this._instancesToReleaseAffectedObjectClasses.add(t),0===t.GetInstances().length&&t._SetAnyInstanceParallaxed(!1);for(const i of t.GetFamilies())e.arrayRemoveAllInSet(i.GetInstances(),s),i._SetIIDsStale(),this._instancesToReleaseAffectedObjectClasses.add(i);if(t.GetPlugin().IsWorldType()){const e=new Set([...s].map((e=>e.GetWorldInfo().GetLayer())));for(const t of e)t._RemoveAllInstancesInSet(s)}}_GetInstancesPendingCreate(){return this._instancesPendingCreate}*instancesPendingCreateForObjectClass(e){for(const t of this._GetInstancesPendingCreate())e.IsFamily()?t.GetObjectClass().BelongsToFamily(e)&&(yield t):t.GetObjectClass()===e&&(yield t)}_GetNewUID(){return this._nextUid++}_MapInstanceByUID(e,t){this._instancesByUid.set(e,t)}_OnRendererContextLost(){this._dispatcher.dispatchEvent(e.New(e.Event,"renderercontextlost")),this.SetSuspended(!0);for(const e of this._allObjectClasses)!e.IsFamily()&&e.HasLoadedTextures()&&e.ReleaseTextures();const t=this.GetMainRunningLayout();t&&t._OnRendererContextLost(),e.ImageInfo.OnRendererContextLost(),e.ImageAsset.OnRendererContextLost()}async _OnRendererContextRestored(){await this.GetMainRunningLayout()._Load(null,this.GetRenderer()),this._dispatcher.dispatchEvent(e.New(e.Event,"renderercontextrestored")),this.SetSuspended(!1),this.UpdateRender()}_OnVisibilityChange(e){this.SetSuspended(e.hidden)}_OnWindowBlur(t){this.IsPreview()&&this._pauseOnBlur&&!e.Platform.IsMobile&&(t.data.parentHasFocus||(this.SetSuspended(!0),this._isPausedOnBlur=!0))}_OnWindowFocus(){this._isPausedOnBlur&&(this.SetSuspended(!1),this._isPausedOnBlur=!1)}_RequestAnimationFrame(){const t=this._tickCallbacks;"vsync"===this._framerateMode?-1===this._rafId&&(this._rafId=self.requestAnimationFrame(t.normal)):"unlimited-tick"===this._framerateMode?(-1===this._ruafId&&(this._ruafId=e.RequestUnlimitedAnimationFrame(t.tickOnly)),-1===this._rafId&&(this._rafId=self.requestAnimationFrame(t.renderOnly))):-1===this._ruafId&&(this._ruafId=e.RequestUnlimitedAnimationFrame(t.normal))}_CancelAnimationFrame(){-1!==this._rafId&&(self.cancelAnimationFrame(this._rafId),this._rafId=-1),-1!==this._ruafId&&(e.CancelUnlimitedAnimationFrame(this._ruafId),this._ruafId=-1)}IsSuspended(){return this._suspendCount>0}SetSuspended(t){if(this.IsExportToVideo())return;const s=this.IsSuspended();this._suspendCount+=t?1:-1,this._suspendCount<0&&(this._suspendCount=0);const i=this.IsSuspended();if(!s&&i)this._CancelAnimationFrame(),this._dispatcher.dispatchEvent(e.New(e.Event,"suspend")),this.Trigger(e.Plugins.System.Cnds.OnSuspend,null,null);else if(s&&!i){const t=performance.now();this._lastTickTime=t,this._fpsLastTime=t,this._fpsFrameCount=0,this._fps=0,this._mainThreadTime=0,this._mainThreadTimeCounter=0,this._dispatcher.dispatchEvent(e.New(e.Event,"resume")),this.Trigger(e.Plugins.System.Cnds.OnResume,null,null),this.HitBreakpoint()||this.Tick(t)}}_AddBehInstToTick(e){this._behInstsToTick.Add(e)}_AddBehInstToPostTick(e){this._behInstsToPostTick.Add(e)}_AddBehInstToTick2(e){this._behInstsToTick2.Add(e)}_RemoveBehInstToTick(e){this._behInstsToTick.Remove(e)}_RemoveBehInstToPostTick(e){this._behInstsToPostTick.Remove(e)}_RemoveBehInstToTick2(e){this._behInstsToTick2.Remove(e)}_BehaviorTick(){this._behInstsToTick.SetQueueingEnabled(!0);for(const e of this._behInstsToTick)e.Tick();this._behInstsToTick.SetQueueingEnabled(!1)}_BehaviorPostTick(){this._behInstsToPostTick.SetQueueingEnabled(!0);for(const e of this._behInstsToPostTick)e.PostTick();this._behInstsToPostTick.SetQueueingEnabled(!1)}_BehaviorTick2(){this._behInstsToTick2.SetQueueingEnabled(!0);for(const e of this._behInstsToTick2)e.Tick2();this._behInstsToTick2.SetQueueingEnabled(!1)}*_DebugBehaviorTick(){this._behInstsToTick.SetQueueingEnabled(!0);for(const t of this._behInstsToTick){const s=t.Tick();e.IsIterator(s)&&(yield*s)}this._behInstsToTick.SetQueueingEnabled(!1)}*_DebugBehaviorPostTick(){this._behInstsToPostTick.SetQueueingEnabled(!0);for(const t of this._behInstsToPostTick){const s=t.PostTick();e.IsIterator(s)&&(yield*s)}this._behInstsToPostTick.SetQueueingEnabled(!1)}*_DebugBehaviorTick2(){this._behInstsToTick2.SetQueueingEnabled(!0);for(const t of this._behInstsToTick2){const s=t.Tick2();e.IsIterator(s)&&(yield*s)}this._behInstsToTick2.SetQueueingEnabled(!1)}async Tick(e,t,s){this._hasStartedTicking=!0;const i="background-wake"===s,r="background-wake"!==s&&"skip-render"!==s;if(!this._hasStarted||this.IsSuspended()&&!t&&!i)return;const n=performance.now();this._isInTick=!0,this._MeasureDt(e||0);const a=this.Step_BeforePreTick();this.IsDebugging()&&await a;const o=this._dispatcher.dispatchEventAndWait_AsyncOptional(this._eventObjects.pretick);o instanceof Promise&&await o;const h=this.Step_AfterPreTick();this.IsDebugging()&&await h,this._NeedsHandleSaveOrLoad()&&await this._HandleSaveOrLoad(),this.GetLayoutManager().IsPendingChangeMainLayout()&&await this._MaybeChangeLayout();const l=this.Step_RunEventsEtc();this.IsDebugging()&&await l,r&&this.Render(),this.IsExportToVideo()&&(await this._ExportToVideoAddFrame(),this.GetGameTime()>=this.GetExportVideoDuration())?this._ExportToVideoFinish():(this.IsSuspended()||i||this._RequestAnimationFrame(),this._tickCount++,this._tickCountNoSave++,this._isInTick=!1,this._mainThreadTimeCounter+=performance.now()-n)}async Step_BeforePreTick(){const e=this._eventSheetManager,s=this.IsDebug();this.FlushPendingInstances(),e.BlockFlushingInstances(!0),this.PushCurrentLayout(this.GetMainRunningLayout()),s&&t.StartMeasuringTime(),this.IsDebugging()?await e.DebugRunScheduledWaits():e.RunScheduledWaits(),s&&t.AddEventsTime(),this.PopCurrentLayout(),e.BlockFlushingInstances(!1),this.FlushPendingInstances(),e.BlockFlushingInstances(!0)}async Step_AfterPreTick(){const e=this.IsDebug(),s=this.IsDebugging(),i=this._dispatcher,r=this._eventObjects,n=this._userScriptEventObjects;e&&t.StartMeasuringTime(),s?await this.DebugIterateAndBreak(this._DebugBehaviorTick()):this._BehaviorTick(),s?await this.DebugIterateAndBreak(this._DebugBehaviorPostTick()):this._BehaviorPostTick(),e&&t.AddBehaviorTickTime(),e&&t.StartMeasuringTime(),s?await this.DebugFireGeneratorEventAndBreak(r.tick):i.dispatchEvent(r.tick),e&&t.AddPluginTickTime(),this._eventSheetManager.BlockFlushingInstances(!1),this.DispatchUserScriptEvent(n.tick)}async Step_RunEventsEtc(){const e=this._eventSheetManager,s=this._dispatcher,i=this._eventObjects,r=this.IsDebug(),n=this.IsDebugging();r&&t.StartMeasuringTime(),n?await e.DebugRunEvents(this._layoutManager):e.RunEvents(this._layoutManager),r&&t.AddEventsTime(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleaseInstancesAtEndOfTick(),this._isLayoutFirstTick=!1,e.BlockFlushingInstances(!0),r&&t.StartMeasuringTime(),n?await this.DebugIterateAndBreak(this._DebugBehaviorTick2()):this._BehaviorTick2(),r&&t.AddBehaviorTickTime(),r&&t.StartMeasuringTime(),n?await this.DebugFireGeneratorEventAndBreak(i.tick2):s.dispatchEvent(i.tick2),r&&t.AddPluginTickTime(),e.BlockFlushingInstances(!1),n&&await e.RunQueuedDebugTriggersAsync()}_ReleaseInstancesAtEndOfTick(){if(0===this._instancesToReleaseAtEndOfTick.size)return;const e=this._dispatcher;e.SetDelayRemoveEventsEnabled(!0);for(const e of this._instancesToReleaseAffectedObjectClasses)e.GetSolStack().RemoveInstances(this._instancesToReleaseAtEndOfTick);this._instancesToReleaseAffectedObjectClasses.clear(),this._eventSheetManager.RemoveInstancesFromScheduledWaits(this._instancesToReleaseAtEndOfTick);for(const e of this._instancesToReleaseAtEndOfTick)e.Release();this._instancesToReleaseAtEndOfTick.clear(),e.SetDelayRemoveEventsEnabled(!1)}async _MaybeChangeLayout(){const e=this.GetLayoutManager();let t=0;for(;e.IsPendingChangeMainLayout()&&t++<10;)await this._DoChangeLayout(e.GetPendingChangeMainLayout())}_MeasureDt(e){let s=0;if(this.IsExportToVideo())s=1/this.GetExportVideoFramerate(),this._dtRaw=s,this._dt1=s;else if(0!==this._lastTickTime){s=Math.max(e-this._lastTickTime,0)/1e3,s>.5&&(s=0),this._dtRaw=s;const t=1/this._minimumFramerate;this._dt1=Math.min(s,t)}this._lastTickTime=e,this._dt=this._dt1*this._timeScale,this._gameTime.Add(this._dt),this._gameTimeRaw.Add(s*this._timeScale),this._wallTime.Add(this._dt1);for(const[e,t]of this._instanceTimes)t.Add(this._dt1*e.GetTimeScale());this._canvasManager&&this._canvasManager._UpdateTick(),e-this._fpsLastTime>=1e3&&(this._fpsLastTime+=1e3,e-this._fpsLastTime>=1e3&&(this._fpsLastTime=e),this._fps=this._fpsFrameCount,this._fpsFrameCount=0,this._mainThreadTime=Math.min(this._mainThreadTimeCounter/1e3,1),this._mainThreadTimeCounter=0,this._canvasManager&&this._canvasManager._Update1sFrameRange(),this._collisionEngine._Update1sStats(),this.IsDebug()&&t.Update1sPerfStats()),this._fpsFrameCount++}_SetTrackingInstanceTime(t,s){if(s){if(!this._instanceTimes.has(t)){const s=e.New(e.KahanSum);s.Copy(this._gameTime),this._instanceTimes.set(t,s)}}else this._instanceTimes.delete(t)}_GetInstanceGameTime(e){const t=this._instanceTimes.get(e);return t?t.Get():this.GetGameTime()}async _DoChangeLayout(t){const s=this._dispatcher,i=this.GetLayoutManager().GetMainRunningLayout();await i._StopRunning(),i._Unload(t,this.GetRenderer()),i===t&&this._eventSheetManager.ClearAllScheduledWaits(),this._collisionEngine.ClearRegisteredCollisions(),this._ReleaseInstancesAtEndOfTick(),s.dispatchEvent(this._eventObjects.beforelayoutchange),e.Asyncify.SetHighThroughputMode(!0),await t._Load(i,this.GetRenderer()),e.Asyncify.SetHighThroughputMode(!1),await t._StartRunning(!1),s.dispatchEvent(this._eventObjects.layoutchange),this.UpdateRender(),this._isLayoutFirstTick=!0,this.FlushPendingInstances(),this._ExportToVideoAddKeyframe()}UpdateRender(){this._needRender=!0}GetWebGLRenderer(){return this._canvasManager?this._canvasManager.GetWebGLRenderer():null}GetWebGPURenderer(){return this._canvasManager?this._canvasManager.GetWebGPURenderer():null}GetRenderer(){return this._canvasManager?this._canvasManager.GetRenderer():null}Render(){const e=this._canvasManager;if(!e||e.IsRendererContextLost())return;const s=this.GetRenderer(),i=s.SupportsGPUProfiling(),r=i&&s.IsWebGL(),n=i&&s.IsWebGPU();if(r&&s.CheckForQueryResults(),!this._needRender&&!this.IsExportToVideo())return void s.IncrementFrameNumber();const a=this._layoutManager.GetMainRunningLayout();s.Start();const o=this.IsDebug();o&&t.StartMeasuringTime(),this._needRender=!1;let h=null;r&&(h=e.GetGPUFrameTimingsBuffer().AddTimeElapsedQuery(),s.StartQuery(h));let l=null;n&&(l=s.StartFrameTiming(2*(1+a.GetLayerCount())),s.WriteTimestamp(0)),this.Uses3DFeatures()&&"low"===e.GetCurrentFullscreenScalingQuality()?s.SetFixedSizeDepthBuffer(e.GetDrawWidth(),e.GetDrawHeight()):s.SetAutoSizeDepthBuffer(),this._Render(this.GetRenderer(),a),h&&s.EndQuery(h),n&&(s.WriteTimestamp(1),this._canvasManager._AddWebGPUFrameTiming(l)),s.Finish(),o&&(t.AddDrawCallsTime(),t.UpdateInspectHighlight()),e&&e._MaybeTakeSnapshot()}_Render(e,t){e.SetTextureFillMode(),e.SetAlphaBlend(),e.SetColorRgba(1,1,1,1),e.SetRenderTarget(null),e.SetTexture(null),e.SetDepthEnabled(this.Uses3DFeatures()),t.Draw(e)}Trigger(e,s,i){if(!this._hasStarted)return!1;const r=!this._isInTick&&!this._eventSheetManager.IsInTrigger();let n=0;r&&(n=performance.now());const a=this.IsDebug();a&&this.SetDebuggingEnabled(!1);const o=this._eventSheetManager._Trigger(this._layoutManager,e,s,i);if(r){const e=performance.now()-n;this._mainThreadTimeCounter+=e,a&&t.AddTriggersTime(e)}return a&&this.SetDebuggingEnabled(!0),o}DebugTrigger(e,t,s){if(!this.IsDebug())return this.Trigger(e,t,s);if(this.HitBreakpoint())throw new Error("called DebugTrigger() while stopped on breakpoint");if(!this._isInTick&&!this._eventSheetManager.IsInTrigger())throw new Error("called DebugTrigger() outside of event code - use TriggerAsync() instead");return this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,s)}async TriggerAsync(e,t,s){if(!this.IsDebugging())return this.Trigger(e,t,s);if(!this._hasStarted)return!1;if(this.HitBreakpoint())return this._eventSheetManager.QueueDebugTrigger(e,t,s);if(!this.GetMainRunningLayout())return this._eventSheetManager.QueueTrigger(e,t,s);const i=performance.now(),r=this._eventSheetManager._DebugTrigger(this._layoutManager,e,t,s);let n=r.next();for(;!n.done;)await this.DebugBreak(n.value),n=r.next();return this.IsSuspended()||this._eventSheetManager.IsInTrigger()||(await this._eventSheetManager.RunQueuedDebugTriggersAsync(),this._hasStartedTicking&&!this._isInTick&&this._RequestAnimationFrame()),this._mainThreadTimeCounter+=performance.now()-i,n.value}FastTrigger(e,t,s){const i=this.IsDebug();i&&this.SetDebuggingEnabled(!1);const r=this._eventSheetManager._FastTrigger(this._layoutManager,e,t,s);return i&&this.SetDebuggingEnabled(!0),r}DebugFastTrigger(e,t,s){return this._eventSheetManager._DebugFastTrigger(this._layoutManager,e,t,s)}ScheduleTriggers(e){return this._scheduleTriggersThrottle.Add(e)}PushCurrentLayout(e){this._currentLayoutStack.push(e)}PopCurrentLayout(){if(!this._currentLayoutStack.length)throw new Error("layout stack empty");this._currentLayoutStack.pop()}GetCurrentLayout(){return this._currentLayoutStack.length?this._currentLayoutStack.at(-1):this.GetMainRunningLayout()}GetDt(e){return e&&-1!==e.GetTimeScale()?this._dt1*e.GetTimeScale():this._dt}_GetDtFast(){return this._dt}GetDt1(){return this._dt1}GetDtRaw(){return this._dtRaw}GetTimeScale(){return this._timeScale}SetTimeScale(e){(isNaN(e)||e<0)&&(e=0),this._timeScale=e}SetMinimumFramerate(t){this._minimumFramerate=e.clamp(t,1,120)}GetMinimumFramerate(){return this._minimumFramerate}GetFPS(){return this._fps}GetMainThreadTime(){return this._mainThreadTime}GetStartTime(){return this._startTime}GetGameTime(){return this._gameTime.Get()}GetGameTimeRaw(){return this._gameTimeRaw.Get()}GetWallTime(){return this._wallTime.Get()}GetTickCount(){return this._tickCount}GetTickCountNoSave(){return this._tickCountNoSave}GetObjectCount(){return this._objectCount}GetProjectName(){return this._projectName}GetProjectVersion(){return this._projectVersion}GetProjectUniqueId(){return this._projectUniqueId}GetAppId(){return this._appId}GetInstanceByUID(e){if(this._isLoadingState)throw new Error("cannot call while loading state - wait until afterload event");return this._instancesByUid.get(e)||null}_RefreshUidMap(){this._instancesByUid.clear();for(const e of this._allObjectClasses)if(!e.IsFamily())for(const t of e.GetInstances())this._instancesByUid.set(t.GetUID(),t)}IsPreview(){return"preview"===this._exportType}IsDebug(){return this._isDebug}GetExportType(){return this._exportType}IsCordova(){return"cordova"===this._exportType}IsAndroidWebView(){return"Android"===e.Platform.OS&&("cordova"===this._exportType||"playable-ad"===this._exportType||"instant-games"===this._exportType)}IsiOSCordova(){return this._isiOSCordova}IsiOSWebView(){return this._isiOSWebView}GetCollisionEngine(){return this._collisionEngine}GetSolidBehavior(){return this._pluginManager.GetSolidBehavior()}GetJumpthruBehavior(){return this._pluginManager.GetJumpthruBehavior()}Uses3DFeatures(){return this._uses3dFeatures}GetZScaleFactor(){return this.GetRenderer().GetZAxisScaleFactor(this.GetViewportHeight())}GetDefaultCameraZ(e){return this.GetRenderer().GetDefaultCameraZ(e||this.GetViewportHeight())}IsLayoutFirstTick(){return this._isLayoutFirstTick}SetPixelRoundingEnabled(e){e=!!e,this._isPixelRoundingEnabled!==e&&(this._isPixelRoundingEnabled=e,this.GetLayoutManager().SetAllLayerMVChanged(),this.UpdateRender())}IsPixelRoundingEnabled(){return this._isPixelRoundingEnabled}SaveToSlot(e){this._saveToSlotName=e}LoadFromSlot(e){this._loadFromSlotName=e}LoadFromJsonString(e){this._loadFromJson=e}GetLastSaveJsonString(){return this._lastSaveJson}_NeedsHandleSaveOrLoad(){return!(!this._saveToSlotName&&!this._loadFromSlotName&&null===this._loadFromJson)}async _HandleSaveOrLoad(){if(this._saveToSlotName&&(this.FlushPendingInstances(),await this._DoSaveToSlot(this._saveToSlotName),this._ClearSaveOrLoad()),this._loadFromSlotName&&(await this._DoLoadFromSlot(this._loadFromSlotName),this._ClearSaveOrLoad(),this.IsDebug()&&t.StepIfPausedInDebugger()),null!==this._loadFromJson){this.FlushPendingInstances();try{await this._DoLoadFromJsonString(this._loadFromJson),this._lastSaveJson=this._loadFromJson,await this.TriggerAsync(e.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(t){await this.TriggerAsync(e.Plugins.System.Cnds.OnLoadFailed,null)}this._ClearSaveOrLoad()}}_ClearSaveOrLoad(){this._saveToSlotName="",this._loadFromSlotName="",this._loadFromJson=null}_GetProjectStorage(){return this._projectStorage||(this._projectStorage=localforage.createInstance({name:"c3-localstorage-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._projectStorage}_GetSavegamesStorage(){return this._savegamesStorage||(this._savegamesStorage=localforage.createInstance({name:"c3-savegames-"+this.GetProjectUniqueId(),description:this.GetProjectName()})),this._savegamesStorage}async _DoSaveToSlot(t){const s=await this._SaveToJsonString();try{await this._GetSavegamesStorage().setItem(t,s),this._lastSaveJson=s,await this.TriggerAsync(e.Plugins.System.Cnds.OnSaveComplete,null),this._lastSaveJson=""}catch(t){await this.TriggerAsync(e.Plugins.System.Cnds.OnSaveFailed,null)}}async _DoLoadFromSlot(t){try{const s=await this._GetSavegamesStorage().getItem(t);if(!s)throw new Error("empty slot");await this._DoLoadFromJsonString(s),this._lastSaveJson=s,await this.TriggerAsync(e.Plugins.System.Cnds.OnLoadComplete,null),this._lastSaveJson=""}catch(t){await this.TriggerAsync(e.Plugins.System.Cnds.OnLoadFailed,null)}}async _SaveToJsonString(){const e={c3save:!0,version:1,rt:{time:this.GetGameTime(),timeRaw:this.GetGameTimeRaw(),walltime:this.GetWallTime(),timescale:this.GetTimeScale(),tickcount:this.GetTickCount(),next_uid:this._nextUid,running_layout:this.GetMainRunningLayout().GetSID(),start_time_offset:Date.now()-this._startTime},types:{},layouts:{},events:this._eventSheetManager._SaveToJson(),timelines:this._timelineManager._SaveToJson(),user_script_data:null};for(const t of this._allObjectClasses)t.IsFamily()||t.HasNoSaveBehavior()||(e.types[t.GetSID().toString()]=t._SaveToJson());for(const t of this._layoutManager.GetAllLayouts())e.layouts[t.GetSID().toString()]=t._SaveToJson();const t=this._CreateUserScriptEvent("save");return t.saveData=null,await this.DispatchUserScriptEventAsyncWait(t),e.user_script_data=t.saveData,JSON.stringify(e)}IsLoadingState(){return this._isLoadingState}async _DoLoadFromJsonString(t){const s=this.GetLayoutManager(),i=JSON.parse(t);if(i.c2save)throw new Error("C2 saves are incompatible with C3 runtime");if(!i.c3save)throw new Error("not valid C3 save data");if(i.version>1)throw new Error("C3 save data from future version");this._dispatcher.dispatchEvent(e.New(e.Event,"beforeload"));for(const e of this.allInstances()){e.GetObjectClass().HasNoSaveBehavior()||e._OnBeforeLoad()}const r=i.rt;this._gameTime.Set(r.time),r.hasOwnProperty("timeRaw")&&this._gameTimeRaw.Set(r.timeRaw),this._wallTime.Set(r.walltime),this._timeScale=r.timescale,this._tickCount=r.tickcount,this._startTime=Date.now()-r.start_time_offset;const n=r.running_layout;this._isLoadingState=!0;let a=!1;if(n!==this.GetMainRunningLayout().GetSID()){const e=s.GetLayoutBySID(n);if(!e)return;await this._DoChangeLayout(e),a=!0}for(const[e,t]of Object.entries(i.types)){const s=parseInt(e,10),i=this.GetObjectClassBySID(s);!i||i.IsFamily()||i.HasNoSaveBehavior()||i._LoadFromJson(t)}if(this.FlushPendingInstances(),this._RefreshUidMap(),this._isLoadingState=!1,a){for(const e of this.allInstances())e.SetupInitialSceneGraphConnections();for(const[e,t]of Object.entries(i.types)){const s=parseInt(e,10),i=this.GetObjectClassBySID(s);!i||i.IsFamily()||i.HasNoSaveBehavior()||i._SetupSceneGraphConnectionsOnChangeOfLayout(t)}}this._nextUid=r.next_uid;for(const[e,t]of Object.entries(i.layouts)){const i=parseInt(e,10),r=s.GetLayoutBySID(i);r&&r._LoadFromJson(t)}this._eventSheetManager._LoadFromJson(i.events);for(const e of this._allObjectClasses)if(!e.IsFamily()&&e.IsInContainer())for(const t of e.GetInstances()){const s=t.GetIID();for(const i of e.GetContainer().objectTypes()){if(i===e)continue;const r=i.GetInstances();if(s<0||s>=r.length)throw new Error("missing sibling instance");t._AddSibling(r[s])}}this._timelineManager._LoadFromJson(i.timelines),s.SetAllLayerProjectionChanged(),s.SetAllLayerMVChanged(),this._dispatcher.dispatchEvent(e.New(e.Event,"afterload"));for(const[e,t]of Object.entries(i.types)){const t=parseInt(e,10),s=this.GetObjectClassBySID(t);s&&s._ClearLoadInstancesJson()}const o=this._CreateUserScriptEvent("load");o.saveData=i.user_script_data,await this.DispatchUserScriptEventAsyncWait(o),this.UpdateRender()}async AddJobWorkerScripts(t){const s=await Promise.all(t.map((async t=>{const s=e.IsAbsoluteURL(t)&&new URL(t).origin!==location.origin,i=this.IsCordova()&&this._assetManager.IsFileProtocol();if(s||i||this.IsPreview()||"playable-ad"===this.GetExportType()){const e=await this._assetManager.FetchBlob(t);return URL.createObjectURL(e)}return e.IsRelativeURL(t)?new URL(t,this._runtimeBaseUrl).toString():t})));this._jobScheduler.ImportScriptsToJobWorkers(s)}AddJobWorkerBlob(e,t){this._jobScheduler.SendBlobToJobWorkers(e,t)}AddJobWorkerBuffer(e,t){this._jobScheduler.SendBufferToJobWorkers(e,t)}AddJob(e,t,s,i){return this._jobScheduler.AddJob(e,t,s,null,null,i)}BroadcastJob(e,t,s,i){return this._jobScheduler.BroadcastJob(e,t,s,i)}GetMaxNumJobWorkers(){return this._jobScheduler.GetMaxNumWorkers()}InvokeDownload(e,t){this.PostComponentMessageToDOM("runtime","invoke-download",{url:e,filename:t})}async RasterSvgImage(e,t,s,i,r,n){if(i=i||t,r=r||s,this.IsInWorker()){return(await this.PostComponentMessageToDOMAsync("runtime","raster-svg-image",{blob:e,imageWidth:t,imageHeight:s,surfaceWidth:i,surfaceHeight:r,imageBitmapOpts:n})).imageBitmap}{const a=await self.C3_RasterSvgImageBlob(e,t,s,i,r);return n?await self.createImageBitmap(a,n):a}}async GetSvgImageSize(e){return this.IsInWorker()?await this.PostComponentMessageToDOMAsync("runtime","get-svg-image-size",{blob:e}):await self.C3_GetSvgImageSize(e)}RequestDeviceOrientationEvent(){this._didRequestDeviceOrientationEvent||(this._didRequestDeviceOrientationEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-orientation"))}RequestDeviceMotionEvent(){this._didRequestDeviceMotionEvent||(this._didRequestDeviceMotionEvent=!0,this.PostComponentMessageToDOM("runtime","enable-device-motion"))}Random(){return this._randomNumberCallback()}SetRandomNumberGeneratorCallback(e){this._randomNumberCallback=e}_GetRemotePreviewStatusInfo(){const e=this.GetWebGLRenderer();return{fps:this.GetFPS(),cpu:this.GetMainThreadTime(),gpu:this.GetGPUUtilisation(),layout:this.GetMainRunningLayout()?this.GetMainRunningLayout().GetName():"",renderer:e?e.GetUnmaskedRenderer():"<unavailable>"}}HitBreakpoint(){return!!this.IsDebug()&&t.HitBreakpoint()}DebugBreak(e){return this.IsDebugging()?t.DebugBreak(e):Promise.resolve()}DebugBreakNext(){return!!this.IsDebugging()&&t.BreakNext()}SetDebugBreakpointsEnabled(e){this._breakpointsEnabled=!!e,this._UpdateDebuggingFlag()}AreDebugBreakpointsEnabled(){return this._breakpointsEnabled}IsDebugging(){return this._isDebugging}SetDebuggingEnabled(e){e?this._debuggingDisabled--:this._debuggingDisabled++,this._UpdateDebuggingFlag()}_UpdateDebuggingFlag(){this._isDebugging=this.IsDebug()&&this._breakpointsEnabled&&0===this._debuggingDisabled}IsCPUProfiling(){return this.IsDebug()&&t.IsCPUProfiling()}IsGPUProfiling(){return this.IsDebug()&&this.GetRenderer().SupportsGPUProfiling()&&t.IsGPUProfiling()}async DebugIterateAndBreak(e){if(e)for(const t of e)await this.DebugBreak(t)}DebugFireGeneratorEventAndBreak(e){return this.DebugIterateAndBreak(this._dispatcher.dispatchGeneratorEvent(e))}_InvokeFunctionFromJS(e){return this._eventSheetManager._InvokeFunctionFromJS(e.name,e.params)}GetIRuntime(){return this._iRuntime}_CreateUserScriptEvent(t){const s=e.New(e.Event,t,!1);return s.runtime=this._iRuntime,s}_InitScriptInterfaces(){const e={};for(const t of this._allObjectClasses)e[t.GetJsPropName()]={value:t.GetIObjectClass(),enumerable:!0,writable:!1};const t=Object.create(Object.prototype,e);this._iRuntime=new self.IRuntime(this,t),this._userScriptEventObjects={tick:this._CreateUserScriptEvent("tick")}}_InitGlobalVariableScriptInterface(){const e={};for(const t of this.GetEventSheetManager().GetAllGlobalVariables())e[t.GetJsPropName()]=t._GetScriptInterfaceDescriptor();this._iRuntime._InitGlobalVars(e)}_GetCommonScriptInterfaces(){return this._commonScriptInterfaces}_MapScriptInterface(e,t){this._interfaceMap.set(e,t)}_UnwrapScriptInterface(e){return this._interfaceMap.get(e)}_UnwrapIObjectClass(t){if(!(t instanceof self.IObjectClass))throw new TypeError("expected IObjectClass");const s=this._UnwrapScriptInterface(t);if(!(s&&s instanceof e.ObjectClass))throw new Error("invalid IObjectClass");return s}_UnwrapIWorldInstance(t){if(!(t instanceof self.IWorldInstance))throw new TypeError("expected IWorldInstance");const s=this._UnwrapScriptInterface(t);if(!(s&&s instanceof e.Instance))throw new Error("invalid IInstance");return s}},self.C3_CreateRuntime=e.Runtime.Create,self.C3_InitRuntime=(e,t)=>e.Init(t)}{const e=self.C3;e.JobSchedulerRuntime=class extends e.DefendedBase{constructor(e,t){super(),this._runtime=e,this._jobPromises=new Map,this._nextJobId=0,this._inputPort=t.inputPort,t.outputPort.onmessage=e=>this._OnJobWorkerMessage(e),this._maxNumWorkers=t.maxNumWorkers,this._jobWorkerCount=1,this._isCreatingWorker=!1,this._hadErrorCreatingWorker=!1}async Init(){}GetMaxNumWorkers(){return this._maxNumWorkers}ImportScriptsToJobWorkers(e){this._inputPort.postMessage({type:"_import_scripts",scripts:e})}SendBlobToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_blob",blob:e,id:t})}SendBufferToJobWorkers(e,t){this._inputPort.postMessage({type:"_send_buffer",buffer:e,id:t},[e])}AddJob(e,t,s,i,r,n){if(s||(s=[]),"number"==typeof n&&(n=Math.floor(n))<=0)throw new Error("invalid maxWorkerNum");const a=this._nextJobId++,o={type:e,isBroadcast:!1,maxWorkerNum:n,jobId:a,params:t,transferables:s},h=new Promise(((e,t)=>{this._jobPromises.set(a,{resolve:e,progress:i,reject:t,cancelled:!1,maxWorkerNum:n})}));return r&&r.SetAction((()=>this._CancelJob(a))),this._inputPort.postMessage(o,s),this._MaybeCreateExtraWorker(),h}BroadcastJob(e,t,s,i){if(s||(s=[]),"number"==typeof i&&(i=Math.floor(i))<=0)throw new Error("invalid maxWorkerNum");const r={type:e,isBroadcast:!0,maxWorkerNum:i,jobId:this._nextJobId++,params:t,transferables:s};this._inputPort.postMessage(r,s)}_CancelJob(e){const t=this._jobPromises.get(e);t&&(t.cancelled=!0,t.resolve=null,t.progress=null,t.reject=null,this._inputPort.postMessage({type:"_cancel",jobId:e}))}_OnJobWorkerMessage(e){const t=e.data,s=t.type,i=t.jobId;switch(s){case"result":this._OnJobResult(i,t.result);break;case"progress":this._OnJobProgress(i,t.progress);break;case"error":this._OnJobError(i,t.error);break;case"ready":this._OnJobWorkerReady();break;default:throw new Error(`unknown message from worker '${s}'`)}}_OnJobResult(e,t){const s=this._jobPromises.get(e);if(!s)throw new Error("invalid job ID");s.cancelled||s.resolve(t),this._jobPromises.delete(e)}_OnJobProgress(e,t){const s=this._jobPromises.get(e);if(!s)throw new Error("invalid job ID");!s.cancelled&&s.progress&&s.progress(t)}_OnJobError(e,t){const s=this._jobPromises.get(e);if(!s)throw new Error("invalid job ID");s.cancelled||s.reject(t),this._jobPromises.delete(e)}_OnJobWorkerReady(){this._isCreatingWorker&&(this._isCreatingWorker=!1,this._jobWorkerCount++,this._jobWorkerCount<this._maxNumWorkers?this._MaybeCreateExtraWorker():this._inputPort.postMessage({type:"_no_more_workers"}))}_GetWorkerCountNeededForPendingJobs(){let e=0;const t=[...this._jobPromises.values()].sort(((e,t)=>(e.maxWorkerNum||1/0)-(t.maxWorkerNum||1/0)));for(const s of t){e<(s.maxWorkerNum||1/0)&&e++}return e}async _MaybeCreateExtraWorker(){if(!(this._jobWorkerCount>=this._maxNumWorkers||this._isCreatingWorker||this._hadErrorCreatingWorker||this._GetWorkerCountNeededForPendingJobs()<=this._jobWorkerCount))try{this._isCreatingWorker=!0;(await this._runtime.PostComponentMessageToDOMAsync("runtime","create-job-worker")).outputPort.onmessage=e=>this._OnJobWorkerMessage(e)}catch(e){this._hadErrorCreatingWorker=!0,this._isCreatingWorker=!1}}}}self.C3_Shaders={},self.C3_Shaders.radialblur={glsl:"precision mediump float;\nvarying vec2 vTex;\nuniform sampler2D samplerFront;\nuniform vec2 srcStart;\nuniform vec2 srcEnd;\nuniform float devicePixelRatio;\nuniform float layerScale;\nuniform float intensity;\nuniform float radius;\nvoid main(void)\n{\nvec2 dir = ((srcStart + srcEnd) / 2.0 - vTex) / (length(srcEnd - srcStart) / 2.0);\nfloat dist = sqrt(dir.x*dir.x + dir.y*dir.y);\ndir = dir/dist;\nvec4 front = texture2D(samplerFront, vTex);\nvec4 sum = front;\nfloat scaledRadius = radius * devicePixelRatio * layerScale;\nsum += texture2D(samplerFront, vTex + dir * -0.08 * scaledRadius);\nsum += texture2D(samplerFront, vTex + dir * -0.05 * scaledRadius);\nsum += texture2D(samplerFront, vTex + dir * -0.03 * scaledRadius);\nsum += texture2D(samplerFront, vTex + dir * -0.02 * scaledRadius);\nsum += texture2D(samplerFront, vTex + dir * -0.01 * scaledRadius);\nsum += texture2D(samplerFront, vTex + dir * 0.01 * scaledRadius);\nsum += texture2D(samplerFront, vTex + dir * 0.02 * scaledRadius);\nsum += texture2D(samplerFront, vTex + dir * 0.03 * scaledRadius);\nsum += texture2D(samplerFront, vTex + dir * 0.05 * scaledRadius);\nsum += texture2D(samplerFront, vTex + dir * 0.08 * scaledRadius);\nsum /= 11.0;\nfloat t = dist * 2.2;\nt = clamp(t, 0.0, 1.0);\ngl_FragColor = mix(front, mix(front, sum, t), intensity);\n}",glslWebGL2:"",wgsl:"%%SAMPLERFRONT_BINDING%% var samplerFront : sampler;\n%%TEXTUREFRONT_BINDING%% var textureFront : texture_2d<f32>;\nstruct ShaderParams {\nradius : f32,\nintensity : f32\n};\n%%SHADERPARAMS_BINDING%% var<uniform> shaderParams : ShaderParams;\n%%C3PARAMS_STRUCT%%\n%%FRAGMENTINPUT_STRUCT%%\n%%FRAGMENTOUTPUT_STRUCT%%\n@fragment\nfn main(input : FragmentInput) -> FragmentOutput\n{\nvar front : vec4<f32> = textureSample(textureFront, samplerFront, input.fragUV);\nvar dir : vec2<f32> = ((c3Params.srcStart + c3Params.srcEnd) / 2.0 - input.fragUV) / (length(c3Params.srcEnd - c3Params.srcStart) / 2.0);\nvar dist : f32 = length(dir);\ndir = dir / dist;\nvar scaledRadius = shaderParams.radius * c3Params.devicePixelRatio * c3Params.layerScale;\nvar sum : vec4<f32> =\nfront +\ntextureSample(textureFront, samplerFront, input.fragUV + dir * -0.08 * scaledRadius) +\ntextureSample(textureFront, samplerFront, input.fragUV + dir * -0.05 * scaledRadius) +\ntextureSample(textureFront, samplerFront, input.fragUV + dir * -0.03 * scaledRadius) +\ntextureSample(textureFront, samplerFront, input.fragUV + dir * -0.02 * scaledRadius) +\ntextureSample(textureFront, samplerFront, input.fragUV + dir * -0.01 * scaledRadius) +\ntextureSample(textureFront, samplerFront, input.fragUV + dir *  0.01 * scaledRadius) +\ntextureSample(textureFront, samplerFront, input.fragUV + dir *  0.02 * scaledRadius) +\ntextureSample(textureFront, samplerFront, input.fragUV + dir *  0.03 * scaledRadius) +\ntextureSample(textureFront, samplerFront, input.fragUV + dir *  0.05 * scaledRadius) +\ntextureSample(textureFront, samplerFront, input.fragUV + dir *  0.08 * scaledRadius);\nsum = sum / 11.0;\nvar t : f32 = clamp(dist * 2.2, 0.0, 1.0);\nvar output : FragmentOutput;\noutput.color = mix(front, mix(front, sum, t), shaderParams.intensity);\nreturn output;\n}",blendsBackground:!1,usesDepth:!1,extendBoxHorizontal:50,extendBoxVertical:50,crossSampling:!1,mustPreDraw:!1,preservesOpaqueness:!1,animated:!1,parameters:[["radius",0,"percent"],["intensity",0,"percent"]]};{const e=self.C3;let t=null,s="",i="",r=[],n="",a="",o="";const h=e.New(e.ArrayStack);function ForEachOrdered_SortInstances(e,t){const s=e[1],i=t[1];if("number"==typeof s&&"number"==typeof i)return s-i;{const e=""+s,t=""+i;return e<t?-1:e>t?1:0}}e.Plugins.System=class extends e.SDKPluginBase{constructor(e){super(e),this._loopStack=this._runtime.GetEventSheetManager().GetLoopStack(),this._eventStack=this._runtime.GetEventSheetManager().GetEventStack(),this._imagesLoadingTotal=0,this._imagesLoadingComplete=0,this._functionMaps=new Map,this._signalTags=[]}Release(){super.Release()}UpdateRender(){this._runtime.UpdateRender()}Trigger(e){this._runtime.Trigger(e,null,null)}GetRegex(e,r){return t&&e===s&&r===i||(t=new RegExp(e,r),s=e,i=r),t.lastIndex=0,t}GetRegexMatches(e,t,s){if(e===n&&t===a&&s===o)return r;const i=this.GetRegex(t,s);return r=e.match(i),n=e,a=t,o=s,r}async _LoadTexturesForObjectClasses(t,s){if(!s.length)return;this._imagesLoadingTotal+=s.length;const i=[];for(const e of s)i.push(t.MaybeLoadTexturesFor(e));await e.PromiseAllWithProgress(i,(()=>{this._imagesLoadingComplete++})),this._imagesLoadingComplete++,this._imagesLoadingComplete===this._imagesLoadingTotal&&(this._imagesLoadingComplete=0,this._imagesLoadingTotal=0,this._runtime.Trigger(e.Plugins.System.Cnds.OnImageLoadingComplete,null,null))}_UnloadTexturesForObjectClasses(e,t){for(const s of t)0===s.GetInstanceCount()&&e.MaybeUnloadTexturesFor(s)}_GetForEachStack(){return h}_Repeat(e){const t=this._runtime.GetEventSheetManager(),s=t.GetEventStack(),i=s.GetCurrentStackFrame(),r=i.GetCurrentEvent(),n=r.GetSolModifiers(),a=i.IsSolModifierAfterCnds(),o=s.Push(r),h=t.GetLoopStack(),l=h.Push();if(l.SetEnd(e),a)for(let s=0;s<e&&!l.IsStopped();++s)t.PushCopySol(n),l.SetIndex(s),r.Retrigger(i,o),t.PopSol(n);else for(let t=0;t<e&&!l.IsStopped();++t)l.SetIndex(t),r.Retrigger(i,o);return s.Pop(),h.Pop(),!1}*_DebugRepeat(e){const t=this._runtime.GetEventSheetManager(),s=t.GetEventStack(),i=s.GetCurrentStackFrame(),r=i.GetCurrentEvent(),n=r.GetSolModifiers(),a=i.IsSolModifierAfterCnds(),o=s.Push(r),h=t.GetLoopStack(),l=h.Push();if(l.SetEnd(e),a)for(let s=0;s<e&&!l.IsStopped();++s)t.PushCopySol(n),l.SetIndex(s),yield*r.DebugRetrigger(i,o),t.PopSol(n);else for(let t=0;t<e&&!l.IsStopped();++t)l.SetIndex(t),yield*r.DebugRetrigger(i,o);return s.Pop(),h.Pop(),!1}_While(){const e=this._runtime.GetEventSheetManager(),t=e.GetEventStack(),s=t.GetCurrentStackFrame(),i=s.GetCurrentEvent(),r=i.GetSolModifiers(),n=s.IsSolModifierAfterCnds(),a=t.Push(i),o=e.GetLoopStack(),h=o.Push();if(n)for(let t=0;!h.IsStopped();++t)e.PushCopySol(r),h.SetIndex(t),i.Retrigger(s,a)||h.Stop(),e.PopSol(r);else for(let e=0;!h.IsStopped();++e)h.SetIndex(e),i.Retrigger(s,a)||h.Stop();return t.Pop(),o.Pop(),!1}*_DebugWhile(){const e=this._runtime.GetEventSheetManager(),t=e.GetEventStack(),s=t.GetCurrentStackFrame(),i=s.GetCurrentEvent(),r=i.GetSolModifiers(),n=s.IsSolModifierAfterCnds(),a=t.Push(i),o=e.GetLoopStack(),h=o.Push();if(n)for(let t=0;!h.IsStopped();++t){e.PushCopySol(r),h.SetIndex(t);(yield*i.DebugRetrigger(s,a))||h.Stop(),e.PopSol(r)}else for(let e=0;!h.IsStopped();++e){h.SetIndex(e);(yield*i.DebugRetrigger(s,a))||h.Stop()}return t.Pop(),o.Pop(),!1}_For(e,t,s){const i=this._runtime.GetEventSheetManager(),r=i.GetEventStack(),n=r.GetCurrentStackFrame(),a=n.GetCurrentEvent(),o=a.GetSolModifiers(),h=n.IsSolModifierAfterCnds(),l=r.Push(a),c=i.GetLoopStack(),u=c.Push();if(u.SetName(e),u.SetEnd(s),s<t)if(h)for(let e=t;e>=s&&!u.IsStopped();--e)i.PushCopySol(o),u.SetIndex(e),a.Retrigger(n,l),i.PopSol(o);else for(let e=t;e>=s&&!u.IsStopped();--e)u.SetIndex(e),a.Retrigger(n,l);else if(h)for(let e=t;e<=s&&!u.IsStopped();++e)i.PushCopySol(o),u.SetIndex(e),a.Retrigger(n,l),i.PopSol(o);else for(let e=t;e<=s&&!u.IsStopped();++e)u.SetIndex(e),a.Retrigger(n,l);return r.Pop(),c.Pop(),!1}*_DebugFor(e,t,s){const i=this._runtime.GetEventSheetManager(),r=i.GetEventStack(),n=r.GetCurrentStackFrame(),a=n.GetCurrentEvent(),o=a.GetSolModifiers(),h=n.IsSolModifierAfterCnds(),l=r.Push(a),c=i.GetLoopStack(),u=c.Push();if(u.SetName(e),u.SetEnd(s),s<t)if(h)for(let e=t;e>=s&&!u.IsStopped();--e)i.PushCopySol(o),u.SetIndex(e),yield*a.DebugRetrigger(n,l),i.PopSol(o);else for(let e=t;e>=s&&!u.IsStopped();--e)u.SetIndex(e),yield*a.DebugRetrigger(n,l);else if(h)for(let e=t;e<=s&&!u.IsStopped();++e)i.PushCopySol(o),u.SetIndex(e),yield*a.DebugRetrigger(n,l),i.PopSol(o);else for(let e=t;e<=s&&!u.IsStopped();++e)u.SetIndex(e),yield*a.DebugRetrigger(n,l);return r.Pop(),c.Pop(),!1}_ForEach(t){const s=this._runtime.GetEventSheetManager(),i=s.GetEventStack(),r=i.GetCurrentStackFrame(),n=r.GetCurrentEvent(),a=n.GetSolModifiers(),o=r.IsSolModifierAfterCnds(),l=i.Push(n),c=s.GetLoopStack(),u=c.Push(),_=t.IsInContainer(),d=t.GetCurrentSol(),p=h.Push();if(e.shallowAssignArray(p,d.GetInstances()),u.SetEnd(p.length),o)for(let e=0,i=p.length;e<i&&!u.IsStopped();++e){s.PushCopySol(a);const i=p[e];t.GetCurrentSol().SetSinglePicked(i),_&&i.SetSiblingsSinglePicked(),u.SetIndex(e),n.Retrigger(r,l),s.PopSol(a)}else{d._SetSelectAll(!1);const t=d._GetOwnInstances();e.clearArray(t),t.push(null);for(let e=0,s=p.length;e<s&&!u.IsStopped();++e){const s=p[e];t[0]=s,_&&s.SetSiblingsSinglePicked(),u.SetIndex(e),n.Retrigger(r,l)}}return i.Pop(),c.Pop(),e.clearArray(p),h.Pop(),!1}*_DebugForEach(t){const s=this._runtime.GetEventSheetManager(),i=s.GetEventStack(),r=i.GetCurrentStackFrame(),n=r.GetCurrentEvent(),a=n.GetSolModifiers(),o=r.IsSolModifierAfterCnds(),l=i.Push(n),c=s.GetLoopStack(),u=c.Push(),_=t.IsInContainer(),d=t.GetCurrentSol(),p=h.Push();if(e.shallowAssignArray(p,d.GetInstances()),u.SetEnd(p.length),o)for(let e=0,i=p.length;e<i&&!u.IsStopped();++e){s.PushCopySol(a);const i=p[e];t.GetCurrentSol().SetSinglePicked(i),_&&i.SetSiblingsSinglePicked(),u.SetIndex(e),yield*n.DebugRetrigger(r,l),s.PopSol(a)}else{d._SetSelectAll(!1);const t=d._GetOwnInstances();e.clearArray(t),t.push(null);for(let e=0,s=p.length;e<s&&!u.IsStopped();++e){const s=p[e];t[0]=s,_&&s.SetSiblingsSinglePicked(),u.SetIndex(e),yield*n.DebugRetrigger(r,l)}}return i.Pop(),c.Pop(),e.clearArray(p),h.Pop(),!1}_ForEachOrdered(t,s){const i=this._runtime.GetEventSheetManager(),r=i.GetEventStack(),n=i.GetCurrentCondition(),a=r.GetCurrentStackFrame(),o=a.GetCurrentEvent(),l=o.GetSolModifiers(),c=a.IsSolModifierAfterCnds(),u=r.Push(o),_=i.GetLoopStack(),d=_.Push(),p=t.IsInContainer(),f=t.GetCurrentSol(),m=h.Push();e.clearArray(m);const g=f.GetInstances();d.SetEnd(g.length);for(let e=0,t=g.length;e<t;++e)m.push([g[e],n.ReevaluateParameter(1,e)]);if(m.sort(ForEachOrdered_SortInstances),1===s&&m.reverse(),c)for(let e=0,s=m.length;e<s&&!d.IsStopped();++e){i.PushCopySol(l);const s=m[e][0];t.GetCurrentSol().SetSinglePicked(s),p&&s.SetSiblingsSinglePicked(),d.SetIndex(e),o.Retrigger(a,u),i.PopSol(l)}else{f._SetSelectAll(!1);const t=f._GetOwnInstances();e.clearArray(t),t.push(null);for(let e=0,s=m.length;e<s&&!d.IsStopped();++e){const s=m[e][0];t[0]=s,p&&s.SetSiblingsSinglePicked(),d.SetIndex(e),o.Retrigger(a,u)}}return r.Pop(),_.Pop(),e.clearArray(m),h.Pop(),!1}*_DebugForEachOrdered(t,s){const i=this._runtime.GetEventSheetManager(),r=i.GetEventStack(),n=i.GetCurrentCondition(),a=r.GetCurrentStackFrame(),o=a.GetCurrentEvent(),l=o.GetSolModifiers(),c=a.IsSolModifierAfterCnds(),u=r.Push(o),_=i.GetLoopStack(),d=_.Push(),p=t.IsInContainer(),f=t.GetCurrentSol(),m=h.Push();e.clearArray(m);const g=f.GetInstances();d.SetEnd(g.length);for(let e=0,t=g.length;e<t;++e)m.push([g[e],n.ReevaluateParameter(1,e)]);if(m.sort(ForEachOrdered_SortInstances),1===s&&m.reverse(),c)for(let e=0,s=m.length;e<s&&!d.IsStopped();++e){i.PushCopySol(l);const s=m[e][0];t.GetCurrentSol().SetSinglePicked(s),p&&s.SetSiblingsSinglePicked(),d.SetIndex(e),yield*o.DebugRetrigger(a,u),i.PopSol(l)}else{f._SetSelectAll(!1);const t=f._GetOwnInstances();e.clearArray(t),t.push(null);for(let e=0,s=m.length;e<s&&!d.IsStopped();++e){const s=m[e][0];t[0]=s,p&&s.SetSiblingsSinglePicked(),d.SetIndex(e),yield*o.DebugRetrigger(a,u)}}return r.Pop(),_.Pop(),e.clearArray(m),h.Pop(),!1}_GetFunctionMap(e,t){let s=this._functionMaps.get(e);return s||(t?(s={defaultFunc:null,strMap:new Map},this._functionMaps.set(e,s),s):null)}_DoCallMappedFunction(e,t,s,i,r){t.GetEventBlock().RunAsMappedFunctionCall(s,t.IsCopyPicked()),i&&e.PopSol(r)}*_DebugDoCallMappedFunction(e,t,s,i,r){yield*t.GetEventBlock().DebugRunAsMappedFunctionCall(s,t.IsCopyPicked()),i&&e.PopSol(r)}}}{const e=self.C3;e.Plugins.System.Type=class extends e.DefendedBase{constructor(e){super(),this._objectClass=e,this._runtime=e.GetRuntime(),this._plugin=e.GetPlugin()}OnCreate(){}Release(){this._objectClass=null,this._runtime=null,this._plugin=null}}}{const e=self.C3;e.Plugins.System.Instance=class extends e.DefendedBase{constructor(e,t){super(),this._inst=e,this._objectClass=this._inst.GetObjectClass(),this._sdkType=this._objectClass.GetSdkType(),this._runtime=this._inst.GetRuntime()}Release(){this._inst=null,this._objectClass=null,this._sdkType=null,this._runtime=null}}}{const e=self.C3,t=[];e.Plugins.System.Cnds={EveryTick:()=>!0,OnLayoutStart:()=>!0,OnLayoutEnd:()=>!0,OnSuspend:()=>!0,OnResume:()=>!0,IsSuspended(){return this._runtime.IsSuspended()},Else(){const e=this._runtime.GetCurrentEventStackFrame();return!e.GetElseBranchRan()&&!e.GetLastEventTrue()},TriggerOnce(){const e=this._runtime.GetCurrentCondition().GetSavedDataMap();let t=e.get("TriggerOnce_lastTick");void 0===t&&(t=-1,e.set("TriggerOnce_lastTick",-1));const s=this._runtime.GetTickCount();return e.set("TriggerOnce_lastTick",s),this._runtime.IsLayoutFirstTick()||t!==s-1},Every(e){const t=this._runtime.GetCurrentCondition().GetSavedDataMap(),s=t.get("Every_lastTime")||0,i=this._runtime.GetGameTime();t.has("Every_seconds")||t.set("Every_seconds",e);const r=t.get("Every_seconds");return i>=s+r?(t.set("Every_lastTime",s+r),i>=t.get("Every_lastTime")+.04&&t.set("Every_lastTime",i),t.set("Every_seconds",e),!0):(i<s-.1&&t.set("Every_lastTime",i),!1)},IsGroupActive(e){const t=this._runtime.GetEventSheetManager().GetEventGroupByName(e);return t&&t.IsGroupActive()},IsPreview(){return this._runtime.IsPreview()},IsMobile:()=>e.Platform.IsMobile,OnLoadFinished:()=>!0,OnCanvasSnapshot:()=>!0,EffectsSupported:()=>!0,OnSaveComplete:()=>!0,OnSaveFailed:()=>!0,OnLoadComplete:()=>!0,OnLoadFailed:()=>!0,ObjectUIDExists(e){return!!this._runtime.GetInstanceByUID(e)},IsOnPlatform(t){switch(t){case 0:return"browser"===e.Platform.Context;case 1:return"iOS"===e.Platform.OS;case 2:return"Android"===e.Platform.OS;case 8:return"cordova"===e.Platform.Context;case 9:return"scirra-arcade"===this._runtime.GetExportType();case 10:return"nwjs"===e.Platform.Context;case 13:return"windows-uwp"===this._runtime.GetExportType();default:return!1}},RegexTest(e,t,s){return this.GetRegex(t,s).test(e)},Compare:(t,s,i)=>e.compare(t,s,i),CompareBetween:(e,t,s)=>e>=t&&e<=s,CompareVar:(t,s,i)=>e.compare(t.GetValue(),s,i),CompareBoolVar:e=>!!e.GetValue(),CompareTime(t,s){const i=this._runtime.GetGameTime();if(0===t){const e=this._runtime.GetCurrentCondition().GetSavedDataMap();return!e.get("CompareTime_executed")&&i>=s&&(e.set("CompareTime_executed",!0),!0)}return e.compare(i,t,s)},IsNaN:e=>isNaN(e),AngleWithin:(t,s,i)=>e.angleDiff(e.toRadians(t),e.toRadians(i))<=e.toRadians(s),IsClockwiseFrom:(t,s)=>e.angleClockwise(e.toRadians(t),e.toRadians(s)),IsBetweenAngles(t,s,i){let r=e.toRadians(t),n=e.toRadians(s),a=e.toRadians(i);return!e.angleClockwise(a,n)?!(!e.angleClockwise(r,n)&&e.angleClockwise(r,a)):e.angleClockwise(r,n)&&!e.angleClockwise(r,a)},IsValueType:(e,t)=>"number"==typeof e?0===t:1===t,EvaluateExpression:e=>!!e,OnSignal(e){return e.toLowerCase()===this._signalTags.at(-1)},PickByComparison(t,s,i,r){if(!t)return!1;const n=this._GetForEachStack(),a=n.Push(),o=t.GetCurrentSol();e.shallowAssignArray(a,o.GetInstances()),o.IsSelectAll()&&e.clearArray(o._GetOwnElseInstances());const h=this._runtime.GetCurrentCondition();let l=0;for(let t=0,n=a.length;t<n;++t){const n=a[t];a[l]=n,s=h.ReevaluateParameter(1,t),r=h.ReevaluateParameter(3,t),e.compare(s,i,r)?++l:o._PushElseInstance(n)}e.truncateArray(a,l),o.SetArrayPicked(a);const c=!!a.length;return e.clearArray(a),n.Pop(),t.ApplySolToContainer(),c},PickByEvaluate(t,s){if(!t)return!1;const i=this._GetForEachStack(),r=i.Push(),n=t.GetCurrentSol();e.shallowAssignArray(r,n.GetInstances()),n.IsSelectAll()&&e.clearArray(n._GetOwnElseInstances());const a=this._runtime.GetCurrentCondition();let o=0;for(let e=0,t=r.length;e<t;++e){const t=r[e];r[o]=t,a.ReevaluateParameter(1,e)?++o:n._PushElseInstance(t)}e.truncateArray(r,o),n.SetArrayPicked(r);const h=!!r.length;return e.clearArray(r),i.Pop(),t.ApplySolToContainer(),h},PickNth(e,t){if(!e)return!1;const s=e.GetCurrentSol(),i=s.GetInstances();if((t=Math.floor(t))>=i.length)return!1;const r=i[t];return s.PickOne(r),e.ApplySolToContainer(),!0},PickRandom(e){if(!e)return!1;const t=e.GetCurrentSol(),s=t.GetInstances(),i=Math.floor(this._runtime.Random()*s.length);if(i>=s.length)return!1;const r=s[i];return t.PickOne(r),e.ApplySolToContainer(),!0},PickAll(e){if(!e)return!1;if(!e.GetInstanceCount())return!1;return e.GetCurrentSol()._SetSelectAll(!0),e.ApplySolToContainer(),!0},PickOverlappingPoint(s,i,r){if(!s)return!1;const n=s.GetCurrentSol(),a=n.GetInstances(),o=this._runtime.GetCurrentEvent().IsOrBlock(),h=this._runtime.GetCurrentCondition().IsInverted();n.IsSelectAll()?(e.shallowAssignArray(t,a),n.ClearArrays(),n._SetSelectAll(!1)):o?(e.shallowAssignArray(t,n._GetOwnElseInstances()),e.clearArray(n._GetOwnElseInstances())):(e.shallowAssignArray(t,n._GetOwnInstances()),e.clearArray(n._GetOwnInstances()));for(let s=0,a=t.length;s<a;++s){const a=t[s];e.xor(a.GetWorldInfo().ContainsPoint(i,r),h)?n._PushInstance(a):n._PushElseInstance(a)}return s.ApplySolToContainer(),e.xor(!!n._GetOwnInstances().length,h)},PickLastCreated(e){if(!e)return!1;const t=e.IsFamily();let s=null;const i=this._runtime._GetInstancesPendingCreate();for(let r=i.length-1;r>=0;--r){const n=i[r];if(t){if(n.GetObjectClass().BelongsToFamily(e)){s=n;break}}else if(n.GetObjectClass()===e){s=n;break}}if(!s){const t=e.GetInstances();t.length&&(s=t.at(-1))}if(!s)return!1;return e.GetCurrentSol().PickOne(s),e.ApplySolToContainer(),!0},Repeat(e){return this._runtime.IsDebugging()?this._DebugRepeat(e):this._Repeat(e)},While(){return this._runtime.IsDebugging()?this._DebugWhile():this._While()},For(e,t,s){return this._runtime.IsDebugging()?this._DebugFor(e,t,s):this._For(e,t,s)},ForEach(e){return this._runtime.IsDebugging()?this._DebugForEach(e):this._ForEach(e)},ForEachOrdered(e,t,s){return this._runtime.IsDebugging()?this._DebugForEachOrdered(e,s):this._ForEachOrdered(e,s)},LayerVisible:e=>!!e&&e.IsVisible(),LayerInteractive:e=>!!e&&e.IsSelfAndParentsInteractive(),LayerEmpty:e=>!!e&&!e.GetInstanceCount(),LayerCmpOpacity:(t,s,i)=>!!t&&e.compare(100*t.GetOpacity(),s,i),OnImageLoadingComplete:()=>!0,IsLoadingImages(){return this._imagesLoadingTotal>0},TemplateExists(e,t){const s=this._runtime.GetTemplateManager();return!!s&&(!!t&&!!s.GetTemplateData(e,t))}}}{const e=self.C3;function SortZOrderList(e,t){const s=e[0]-t[0];if(0!==s)return s;return e[1]-t[1]}function SortInstancesByValue(e,t){return e[1]-t[1]}const t=[],s=[],i=e.New(e.Rect),r=e.New(e.Color);e.Plugins.System.Acts={SetVar(e,t){e.SetValue(t)},AddVar(e,t){e.IsNumber()&&"number"!=typeof t&&(t=parseFloat(t)),e.SetValue(e.GetValue()+t)},SubVar(e,t){e.IsNumber()&&e.SetValue(e.GetValue()-t)},SetBoolVar(e,t){e.SetValue(!!t)},ToggleBoolVar(e){e.SetValue(!e.GetValue())},ResetGlobals(){this._runtime.GetEventSheetManager().ResetAllGlobalsToInitialValue()},CreateObject(e,t,s,i,r,n){if(!e||!t)return;const a=this._runtime.CreateInstance(e,t,s,i,r,n);if(!a)return;r&&t.SortAndAddInstancesByZIndex(a);const o=this._runtime.GetEventSheetManager();o.BlockFlushingInstances(!0),a._TriggerOnCreatedOnSelfAndRelated(),o.BlockFlushingInstances(!1);const h=new Map;a.CollectInstancesToPick(h,e,r);for(const[e,t]of h)e.GetCurrentSol().SetSetPicked(t)},CreateObjectByName(t,s,i,r,n,a){if(!t||!s)return;const o=this._runtime.GetObjectClassByName(t);o&&e.Plugins.System.Acts.CreateObject.call(this,o,s,i,r,n,a)},RecreateInitialObjects(e,t,s,r,n,a,o,h,l,c){if(!e)return;let u=this._runtime.GetCurrentLayout();if(a){const e=this._runtime.GetLayoutManager().GetLayoutByName(a);if(!e)return;u=e}let _=null;if(("number"!=typeof o||o>=0)&&(_=u.GetLayer(o),!_))return;i.set(t,s,r,n);const d=u.RecreateInitialObjects(e,i,_,h,l,c);e.GetCurrentSol().SetArrayPicked(d),e.ApplySolToContainer()},StopLoop(){const e=this._loopStack;e.IsInLoop()&&e.GetCurrent().Stop()},SetGroupActive(e,t){const s=this._runtime.GetEventSheetManager().GetEventGroupByName(e);s&&(0===t?s.SetGroupActive(!1):1===t?s.SetGroupActive(!0):s.SetGroupActive(!s.IsGroupActive()))},SetTimescale(e){this._runtime.SetTimeScale(e)},SetObjectTimescale(e,t){if(t<0&&(t=0),!e)return;const s=e.GetCurrentSol().GetInstances();for(const e of s)e.SetTimeScale(t)},RestoreObjectTimescale(e){if(!e)return;const t=e.GetCurrentSol().GetInstances();for(const e of t)e.RestoreTimeScale()},Wait(e){if(!(e<0))return this._runtime.GetEventSheetManager().AddScheduledWait().InitTimer(e),!0},WaitForSignal(e){return this._runtime.GetEventSheetManager().AddScheduledWait().InitSignal(e),!0},WaitForPreviousActions(){const e=this._runtime.GetEventSheetManager();return e.AddScheduledWait().InitPromise(e.GetPromiseForAllAsyncActions()),!0},Signal(t){const s=t.toLowerCase();this._signalTags.push(s),this._runtime.Trigger(e.Plugins.System.Cnds.OnSignal,null),this._signalTags.pop();for(const e of this._runtime.GetEventSheetManager().scheduledWaits())e.IsSignal()&&e.GetSignalTag()===s&&e.SetSignalled()},async SnapshotCanvas(t,s,i,r,n,a){const o=this._runtime.GetCanvasManager();o&&(this.UpdateRender(),await o.SnapshotCanvas(0===t?"image/png":"image/jpeg",s/100,i,r,n,a),await this._runtime.TriggerAsync(e.Plugins.System.Cnds.OnCanvasSnapshot,null))},SetCanvasSize(e,t){if(e<=0||t<=0)return;this._runtime.SetViewportSize(e,t),this._runtime.GetCurrentLayout().BoundScrolling();const s=this._runtime.GetCanvasManager();s&&("off"===s.GetCurrentFullscreenMode()||this._runtime.SetOriginalViewportSize(e,t),s.SetSize(s.GetLastWidth(),s.GetLastHeight(),!0),this._runtime.UpdateRender())},SetFullscreenQuality(e){const t=this._runtime.GetCanvasManager();t&&"off"!==t.GetCurrentFullscreenMode()&&(t.SetFullscreenScalingQuality(0!==e?"high":"low"),t.SetSize(t.GetLastWidth(),t.GetLastHeight(),!0))},SaveState(e){this._runtime.SaveToSlot(e)},LoadState(e){this._runtime.LoadFromSlot(e)},LoadStateJSON(e){this._runtime.LoadFromJsonString(e)},SetHalfFramerateMode(e){},ResetPersisted(){for(const e of this._runtime.GetLayoutManager().GetAllLayouts())e.ResetPersistData()},SetPixelRounding(e){this._runtime.SetPixelRoundingEnabled(0!==e)},SetMinimumFramerate(e){this._runtime.SetMinimumFramerate(e)},SortZOrderByInstVar(i,r){if(!i)return;const n=i.GetCurrentSol().GetInstances(),a=t,o=s,h=this._runtime.GetCurrentLayout(),l=i.IsFamily(),c=i.GetFamilyIndex();for(let e=0,t=n.length;e<t;++e){const t=n[e],s=t.GetWorldInfo();if(!s)continue;let i;i=l?t.GetInstanceVariableValue(r+t.GetObjectClass().GetFamilyInstanceVariableOffset(c)):t.GetInstanceVariableValue(r),a.push([s.GetLayer().GetIndex(),s.GetZIndex()]),o.push([t,i])}if(!a.length)return;a.sort(SortZOrderList),o.sort(SortInstancesByValue);let u=!1;for(let e=0,t=a.length;e<t;++e){const t=o[e][0],s=h.GetLayerByIndex(a[e][0]),i=a[e][1],r=s._GetInstances();r[i]!==t&&(r[i]=t,t.GetWorldInfo()._SetLayer(s,!0),s.SetZIndicesChanged(),u=!0)}u&&this._runtime.UpdateRender(),e.clearArray(t),e.clearArray(s)},GoToLayout(e){if(this._runtime.IsLoading())return;const t=this._runtime.GetLayoutManager();t.IsPendingChangeMainLayout()||t.ChangeMainLayout(e)},GoToLayoutByName(e){if(this._runtime.IsLoading())return;const t=this._runtime.GetLayoutManager();if(t.IsPendingChangeMainLayout())return;const s=t.GetLayoutByName(e);s&&t.ChangeMainLayout(s)},NextPrevLayout(e){if(this._runtime.IsLoading())return;const t=this._runtime.GetLayoutManager();if(t.IsPendingChangeMainLayout())return;const s=t.GetAllLayouts(),i=s.indexOf(t.GetMainRunningLayout());if(e&&0===i)return;if(!e&&i===s.length-1)return;const r=s[i+(e?-1:1)];t.ChangeMainLayout(r)},RestartLayout(){if(this._runtime.IsLoading())return;const e=this._runtime.GetLayoutManager();e.IsPendingChangeMainLayout()||(e.ChangeMainLayout(e.GetMainRunningLayout()),this._runtime.GetEventSheetManager().ResetAllGroupsInitialActivation())},SetLayerVisible(e,t){e&&e.SetVisible(t)},SetLayerInteractive(e,t){e&&e.SetInteractive(t)},SetLayerOpacity(e,t){e&&e.SetOpacity(t/100)},SetLayerScale(e,t){e&&e.SetOwnScale(t)},SetLayerScaleRate(e,t){e&&e.SetScaleRate(t)},SetLayerAngle(t,s){t&&t.SetAngle(e.toRadians(+s))},SetLayerScroll(e,t,s){e&&(e.SetOwnScrollPositionEnabled(!0),e.SetScrollX(t),e.SetScrollY(s))},RestoreLayerScroll(e){e&&e.SetOwnScrollPositionEnabled(!1)},SetLayerParallax(e,t,s){e&&e.SetParallax(t/100,s/100)},SetLayerZElevation(e,t){e&&e.SetZElevation(+t)},SetLayerBackground(e,t){if(!e)return;r.setFromRgbValue(t),r.clamp();const s=e.GetBackgroundColor();s.equalsIgnoringAlpha(r)||(s.copyRgb(r),this.UpdateRender())},SetLayerTransparent(e,t){e&&e.SetTransparent(t)},SetLayerBlendMode(e,t){e&&e.SetBlendMode(t)},SetLayerEffectEnabled(e,t,s){if(!e)return;const i=e.GetEffectList().GetEffectTypeByName(s);if(!i)return;const r=1===t;i.IsActive()!==r&&(i.SetActive(r),e.UpdateActiveEffects(),this._runtime.UpdateRender())},SetLayerEffectParam(e,t,s,i){if(!e)return;const n=e.GetEffectList(),a=n.GetEffectTypeByName(t);if(!a)return;s=Math.floor(s);const o=a.GetShaderProgram().GetParameterType(s);if(!o)return;"color"===o?(r.setFromRgbValue(i),i=r):"percent"===o&&(i/=100);n.SetEffectParameter(a.GetIndex(),s,i)&&a.IsActive()&&this._runtime.UpdateRender()},SetLayerForceOwnTexture(e,t){e&&e.SetForceOwnTexture(t)},SetLayoutScale(e){this._runtime.GetCurrentLayout().SetScale(+e)},SetLayoutAngle(t){this._runtime.GetCurrentLayout().SetAngle(e.toRadians(+t))},SetLayoutEffectEnabled(e,t){const s=this._runtime.GetCurrentLayout(),i=s.GetEffectList().GetEffectTypeByName(t);if(!i)return;const r=1===e;i.IsActive()!==r&&(i.SetActive(r),s.UpdateActiveEffects(),this._runtime.UpdateRender())},SetLayoutEffectParam(e,t,s){const i=this._runtime.GetCurrentLayout().GetEffectList(),n=i.GetEffectTypeByName(e);if(!n)return;t=Math.floor(t);const a=n.GetShaderProgram().GetParameterType(t);if(!a)return;"color"===a?(r.setFromRgbValue(s),s=r):"percent"===a&&(s/=100);i.SetEffectParameter(n.GetIndex(),t,s)&&n.IsActive()&&this._runtime.UpdateRender()},SetLayoutVanishingPoint(e,t){this._runtime.GetCurrentLayout().SetVanishingPointXY(e/100,t/100)},SetLayoutProjection(e){const t=this._runtime.GetCurrentLayout();0===e?t.SetPerspectiveProjection():t.SetOrthographicProjection()},ScrollX(e){this._runtime.GetCurrentLayout().SetScrollX(e)},ScrollY(e){this._runtime.GetCurrentLayout().SetScrollY(e)},Scroll(e,t){const s=this._runtime.GetCurrentLayout();s.SetScrollX(e),s.SetScrollY(t)},ScrollToObject(e){if(!e)return;const t=e.GetFirstPicked();if(!t)return;const s=t.GetWorldInfo();if(!s)return;const i=this._runtime.GetCurrentLayout();i.SetScrollX(s.GetX()),i.SetScrollY(s.GetY())},async LoadObjectTextures(e){const t=this._runtime.GetMainRunningLayout();if(!t||!e||this._runtime.IsLoading())return;const s=e.IsFamily()?e.GetFamilyMembers():[e];await this._LoadTexturesForObjectClasses(t,s)},async LoadObjectTexturesByName(t){await e.Plugins.System.Acts.LoadObjectTextures.call(this,this._runtime.GetObjectClassByName(t))},UnloadObjectTextures(e){const t=this._runtime.GetMainRunningLayout();if(!t||!e)return;const s=e.IsFamily()?e.GetFamilyMembers():[e];this._UnloadTexturesForObjectClasses(t,s)},UnloadObjectTexturesByName(t){e.Plugins.System.Acts.UnloadObjectTextures.call(this,this._runtime.GetObjectClassByName(t))},UnloadUnusedTextures(){const e=this._runtime.GetMainRunningLayout();if(!e)return;const t=e._GetTextureLoadedObjectTypes();this._UnloadTexturesForObjectClasses(e,t)},async LoadLayoutTextures(e){const t=this._runtime.GetMainRunningLayout();e&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,e._GetInitialObjectClasses())},async LoadLayoutTexturesByName(e){const t=this._runtime.GetMainRunningLayout(),s=this._runtime.GetLayoutManager().GetLayoutByName(e);s&&t&&!this._runtime.IsLoading()&&await this._LoadTexturesForObjectClasses(t,s._GetInitialObjectClasses())},SetFunctionReturnValue(e){const t=this._eventStack.GetCurrentExpFuncStackFrame();if(t)switch(t.GetFunctionReturnType()){case 1:"number"==typeof e&&t.SetFunctionReturnValue(e);break;case 2:"string"==typeof e&&t.SetFunctionReturnValue(e);break;case 3:t.SetFunctionReturnValue(e);break}},MapFunction(t,s,i){const r=this._GetFunctionMap(t.toLowerCase(),!0),n=r.strMap,a=s.toLowerCase();n.has(a);const o=e.first(n.values())||r.defaultFunc;if(o){if(0!==o.GetReturnType()!==(0!==i.GetReturnType()))return}n.set(a,i)},MapFunctionDefault(t,s){const i=this._GetFunctionMap(t.toLowerCase(),!0);i.defaultFunc;const r=e.first(i.strMap.values())||i.defaultFunc;if(r){if(0!==r.GetReturnType()!==(0!==s.GetReturnType()))return}i.defaultFunc=s},CallMappedFunction(e,t,s){s=Math.floor(s);const i=this._GetFunctionMap(e.toLowerCase(),!1);if(!i)return;let r=i.strMap.get(t.toLowerCase());if(!r){if(!i.defaultFunc)return;r=i.defaultFunc,s=0}if(!r.IsEnabled())return;if(0!==r.GetReturnType())return;const n=this._runtime,a=n.GetEventSheetManager(),o=a.GetCurrentEvent(),h=o.GetSolModifiersIncludingParents(),l=h.length>0;l&&(r.IsCopyPicked()?a.PushCopySol(h):a.PushCleanSol(h));const c=[],u=a.FindFirstFunctionBlockParent(o);if(u){const e=u.GetFunctionParameters();for(let t=s,i=e.length;t<i;++t)c.push(e[t].GetValue())}const _=r.GetFunctionParameters();for(let e=c.length,t=_.length;e<t;++e)c.push(_[e].GetInitialValue());return n.IsDebugging()?this._DebugDoCallMappedFunction(a,r,c,l,h):this._DoCallMappedFunction(a,r,c,l,h)}}}{const e=self.C3;e.Plugins.System.Exps={int:function(e){return"string"==typeof e&&(e=parseInt(e,10),isNaN(e)&&(e=0)),Math.floor(e)},float:function(e){return"string"==typeof e&&(e=parseFloat(e),isNaN(e)&&(e=0)),e},str:e=>e.toString(),len:e=>"string"==typeof e?e.length:0,random(e,t){return void 0===t?this._runtime.Random()*e:this._runtime.Random()*(t-e)+e},choose(...e){return e[Math.floor(this._runtime.Random()*e.length)]},chooseindex:(t,...s)=>("number"!=typeof t&&(t=0),s[t=e.clamp(Math.floor(t),0,s.length-1)]),pi:()=>Math.PI,infinity:()=>1/0,sqrt:e=>Math.sqrt(e),abs:e=>Math.abs(e),round:e=>Math.round(e),roundtodp(e,t){t=Math.max(Math.floor(t),0);const s=Math.pow(10,t);return Math.round((e+Number.EPSILON)*s)/s},floor:e=>Math.floor(e),ceil:e=>Math.ceil(e),sign:e=>Math.sign(e),sin:t=>Math.sin(e.toRadians(t)),cos:t=>Math.cos(e.toRadians(t)),tan:t=>Math.tan(e.toRadians(t)),asin:t=>e.toDegrees(Math.asin(t)),acos:t=>e.toDegrees(Math.acos(t)),atan:t=>e.toDegrees(Math.atan(t)),exp:e=>Math.exp(e),ln:e=>Math.log(e),log10:e=>Math.log(e)/Math.LN10,max(...e){let t=e[0];"number"!=typeof t&&(t=0);for(let s=1,i=e.length;s<i;++s){let i=e[s];"number"==typeof i&&(t<i&&(t=i))}return t},min(...e){let t=e[0];"number"!=typeof t&&(t=0);for(let s=1,i=e.length;s<i;++s){let i=e[s];"number"==typeof i&&(t>i&&(t=i))}return t},clamp:(t,s,i)=>e.clamp(t,s,i),distance:(t,s,i,r)=>e.distanceTo(t,s,i,r),angle:(t,s,i,r)=>e.toDegrees(e.angleTo(t,s,i,r)),lerp:(t,s,i)=>e.lerp(t,s,i),unlerp:(t,s,i)=>e.unlerp(t,s,i),qarp:(t,s,i,r)=>e.qarp(t,s,i,r),cubic:(t,s,i,r,n)=>e.cubic(t,s,i,r,n),cosp:(t,s,i)=>e.cosp(t,s,i),anglediff:(t,s)=>e.toDegrees(e.angleDiff(e.toRadians(t),e.toRadians(s))),anglelerp:(t,s,i)=>e.toDegrees(e.angleLerp(e.toRadians(t),e.toRadians(s),i)),anglerotate:(t,s,i)=>e.toDegrees(e.angleRotate(e.toRadians(t),e.toRadians(s),e.toRadians(i))),setbit:(e,t,s)=>(e|=0)&~(1<<(t|=0))|(s=0!==s?1:0)<<t,togglebit:(e,t)=>(e|=0)^1<<(t|=0),getbit:(e,t)=>(e|=0)&1<<(t|=0)?1:0,newline:()=>"\n",uppercase:e=>"string"==typeof e?e.toUpperCase():"",lowercase:e=>"string"==typeof e?e.toLowerCase():"",left:(e,t)=>"string"==typeof e?e.substr(0,t):"",mid:(e,t,s)=>"string"!=typeof e?"":s<0?e.substr(t):e.substr(t,s),right:(e,t)=>"string"==typeof e?e.substr(Math.max(e.length-t,0)):"",trim:e=>"string"==typeof e?e.trim():"",tokenat(e,t,s){if("string"!=typeof e||"string"!=typeof s)return"";let i=e.split(s);return(t=Math.floor(t))<0||t>=i.length?"":i[t]},tokencount:(e,t)=>"string"==typeof e&&"string"==typeof t&&e.length?e.split(t).length:0,find:(t,s)=>"string"==typeof t&&"string"==typeof s?t.search(new RegExp(e.EscapeRegex(s),"i")):-1,findcase:(t,s)=>"string"==typeof t&&"string"==typeof s?t.search(new RegExp(e.EscapeRegex(s),"")):-1,replace:(t,s,i)=>"string"==typeof t&&"string"==typeof s&&"string"==typeof i?t.replace(new RegExp(e.EscapeRegex(s),"gi"),i):"string"==typeof t?t:"",regexsearch(e,t,s){const i=this.GetRegex(t,s);return e?e.search(i):-1},regexreplace(e,t,s,i){const r=this.GetRegex(t,s);return e?e.replace(r,i):""},regexmatchcount(e,t,s){const i=this.GetRegexMatches(e.toString(),t,s);return i?i.length:0},regexmatchat(e,t,s,i){i=Math.floor(i);const r=this.GetRegexMatches(e.toString(),t,s);return!r||i<0||i>=r.length?"":r[i]},zeropad(e,t){let s=e<0?"-":"";e<0&&(e=-e);const i=t-e.toString().length;return s+="0".repeat(Math.max(i,0)),s+e.toString()},urlencode:e=>encodeURIComponent(e),urldecode:e=>decodeURIComponent(e),dt(){return this._runtime._GetDtFast()},timescale(){return this._runtime.GetTimeScale()},wallclocktime(){return(Date.now()-this._runtime.GetStartTime())/1e3},unixtime:()=>Date.now(),time(){return this._runtime.GetGameTime()},tickcount(){return this._runtime.GetTickCount()},objectcount(){return this._runtime.GetObjectCount()},fps(){return this._runtime.GetFPS()},cpuutilisation(){return this._runtime.GetMainThreadTime()},gpuutilisation(){return this._runtime.GetGPUUtilisation()},windowwidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},windowheight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},originalwindowwidth(){return this._runtime.GetOriginalViewportWidth()},originalwindowheight(){return this._runtime.GetOriginalViewportHeight()},originalviewportwidth(){return this._runtime.GetOriginalViewportWidth()},originalviewportheight(){return this._runtime.GetOriginalViewportHeight()},scrollx(){return this._runtime.GetCurrentLayout().GetScrollX()},scrolly(){return this._runtime.GetCurrentLayout().GetScrollY()},layoutname(){return this._runtime.GetCurrentLayout().GetName()},layoutscale(){return this._runtime.GetCurrentLayout().GetScale()},layoutangle(){return e.toDegrees(this._runtime.GetCurrentLayout().GetAngle())},layoutwidth(){return this._runtime.GetCurrentLayout().GetWidth()},layoutheight(){return this._runtime.GetCurrentLayout().GetHeight()},vanishingpointx(){return 100*this._runtime.GetCurrentLayout().GetVanishingPointX()},vanishingpointy(){return 100*this._runtime.GetCurrentLayout().GetVanishingPointY()},viewportleft(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().getLeft():0},viewporttop(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().getTop():0},viewportright(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().getRight():0},viewportbottom(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().getBottom():0},viewportwidth(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().width():0},viewportheight(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetViewport3D().height():0},viewportmidx(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);if(t){const e=t.GetViewport3D();return(e.getLeft()+e.getRight())/2}return 0},viewportmidy(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);if(t){const e=t.GetViewport3D();return(e.getTop()+e.getBottom())/2}return 0},canvastolayerx(e,t,s){const i=this._runtime.GetCurrentLayout().GetLayer(e);return i?i.CanvasCssToLayer(t,s)[0]:0},canvastolayery(e,t,s){const i=this._runtime.GetCurrentLayout().GetLayer(e);return i?i.CanvasCssToLayer(t,s)[1]:0},layertocanvasx(e,t,s){const i=this._runtime.GetCurrentLayout().GetLayer(e);return i?i.LayerToCanvasCss(t,s)[0]:0},layertocanvasy(e,t,s){const i=this._runtime.GetCurrentLayout().GetLayer(e);return i?i.LayerToCanvasCss(t,s)[1]:0},layerscale(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetOwnScale():0},layerangle(t){const s=this._runtime.GetCurrentLayout().GetLayer(t);return s?e.toDegrees(s.GetOwnAngle()):0},layeropacity(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?100*t.GetOpacity():0},layerscalerate(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetScaleRate():0},layerscrollx(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetScrollX():0},layerscrolly(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetScrollY():0},layerparallaxx(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?100*t.GetParallaxX():0},layerparallaxy(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?100*t.GetParallaxY():0},layerzelevation(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetZElevation():0},layerindex(e){const t=this._runtime.GetCurrentLayout().GetLayer(e);return t?t.GetIndex():-1},canvassnapshot(){const e=this._runtime.GetCanvasManager();return e?e.GetCanvasSnapshotUrl():""},loopindex(e){const t=this._loopStack;if(!t.IsInLoop())return 0;if(e){const s=t.FindByName(e);return s?s.GetIndex():0}return t.GetCurrent().GetIndex()},savestatejson(){return this._runtime.GetLastSaveJsonString()},callmapped(e,t,...s){const i=this._GetFunctionMap(e.toLowerCase(),!1);if(!i)return 0;let r=i.strMap.get(t.toLowerCase());if(!r){if(!i.defaultFunc)return 0;r=i.defaultFunc}const n=r.GetReturnType(),a=r.GetDefaultReturnValue();if(0===n)return 0;if(!r.IsEnabled())return a;const o=this._runtime.GetEventSheetManager(),h=o.GetCurrentEvent().GetSolModifiersIncludingParents(),l=h.length>0;l&&(r.IsCopyPicked()?o.PushCopySol(h):o.PushCleanSol(h));const c=r.GetFunctionParameters();for(let e=s.length,t=c.length;e<t;++e)s.push(c[e].GetInitialValue());const u=r.GetEventBlock(),_=u.RunAsExpressionFunctionCall(u.GetSolModifiersIncludingParents(),r.IsCopyPicked(),n,a,...s);return l&&o.PopSol(h),_},loadingprogress(){return this._runtime.GetAssetManager().GetLoadProgress()},imageloadingprogress(){return 0===this._imagesLoadingTotal?1:this._imagesLoadingComplete/this._imagesLoadingTotal},renderer(){return this._runtime.GetWebGPURenderer()?"webgpu":"webgl"},rendererdetail(){return this._runtime.GetWebGPURenderer()?"<unavailable>":this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},imagememoryusage(){let e=this._runtime.GetRenderer().GetEstimatedTextureMemoryUsage();return Math.round(100*e/1048576)/100},rgb:(t,s,i)=>e.PackRGB(t,s,i),rgbex:(t,s,i)=>e.PackRGBEx(t/100,s/100,i/100),rgba:(t,s,i,r)=>e.PackRGBAEx(t/100,s/100,i/100,r/100),rgbex255:(t,s,i)=>e.PackRGBEx(t/255,s/255,i/255),rgba255:(t,s,i,r)=>e.PackRGBAEx(t/255,s/255,i/255,r/255),projectname(){return this._runtime.GetProjectName()},projectversion(){return this._runtime.GetProjectVersion()},currenteventsheetname(){return this._runtime.GetCurrentEvent().GetEventSheet().GetName()},currenteventnumber(){return this._runtime.GetCurrentEvent().GetDisplayNumber()}}}{const e=self.C3;e.Plugins.Sprite=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3,t=[];e.Plugins.Sprite.Type=class extends e.SDKTypeBase{constructor(e){super(e),this._animations=e.GetAnimations()}Release(){e.clearArray(this._animations),super.Release()}OnCreate(){for(const e of this._animations)e.LoadAllAssets(this._runtime)}LoadTextures(e){const t={sampling:this._runtime.GetSampling()};return Promise.all(this._animations.map((s=>s.LoadAllTextures(e,t))))}ReleaseTextures(){for(const e of this._animations)e.ReleaseAllTextures()}OnDynamicTextureLoadComplete(){this._UpdateAllCurrentTexture()}_UpdateAllCurrentTexture(){for(const e of this._objectClass.instancesIncludingPendingCreate())e.GetSdkInstance()._UpdateCurrentTexture()}FinishCondition(t){e.Plugins.Sprite.FinishCollisionCondition(this,t)}BeforeRunAction(e){t.push({objectClass:null,createHierarchy:!1,instances:[]})}_SpawnPickInstance(e,s,i){const r=t.at(-1);r.objectClass=e,r.createHierarchy=i,r.instances.push(s)}AfterRunAction(e){const s=t.pop(),i=s.objectClass,r=s.createHierarchy;if(!i)return;const n=new Map;for(const e of s.instances)e.CollectInstancesToPick(n,i,r);for(const[e,t]of n)e.GetCurrentSol().SetSetPicked(t)}}}{const e=self.C3,t=self.C3X,s=0,i=1,r=2,n=3,a=e.New(e.Rect),o=e.New(e.Quad),h=e.New(e.Vector2),l=1,c=2,u=4;e.Plugins.Sprite.Instance=class extends e.SDKWorldInstanceBase{constructor(t,a){super(t);let o=!0,h="",u=0,_=!0;a&&(o=!!a[s],h=a[i],u=a[r],_=a[n]),this._currentAnimation=this._objectClass.GetAnimationByName(h)||this._objectClass.GetAnimations()[0],this._currentFrameIndex=e.clamp(u,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);const d=this._currentAnimationFrame.GetImageInfo();this._currentTexture=d.GetTexture(),this._currentRcTex=d.GetTexRect(),this._currentQuadTex=d.GetTexQuad(),this.HandleRendererContextLoss(),t.SetFlag(c,!0),t.SetFlag(l,this._currentAnimation.GetSpeed()>=0),this._currentAnimationSpeed=Math.abs(this._currentAnimation.GetSpeed()),this._currentAnimationRepeatTo=this._currentAnimation.GetRepeatTo(),this._animationTimer=e.New(e.KahanSum),this._frameStartTime=0,this._animationRepeats=0,this._animTriggerName="",this._changeAnimFrameIndex=-1,this._changeAnimationName="",this._changeAnimationFrom=0;const p=this.GetWorldInfo();this._bquadRef=p.GetBoundingQuad(),p.SetVisible(o),p.SetCollisionEnabled(_),p.SetOriginX(this._currentAnimationFrame.GetOriginX()),p.SetOriginY(this._currentAnimationFrame.GetOriginY()),p.SetSourceCollisionPoly(this._currentAnimationFrame.GetCollisionPoly()),p.SetBboxChanged(),1===this._objectClass.GetAnimationCount()&&1===this._objectClass.GetAnimations()[0].GetFrameCount()||0===this._currentAnimationSpeed||this._StartTicking()}Release(){this._currentAnimation=null,this._currentAnimationFrame=null,this._currentTexture=null,this._animationTimer=null,super.Release()}GetCurrentImageInfo(){return this._currentAnimationFrame.GetImageInfo()}IsOriginalSizeKnown(){return!0}OnRendererContextLost(){this._currentTexture=null}OnRendererContextRestored(){this._UpdateCurrentTexture()}Draw(e){const t=this._currentTexture;if(null===t)return;e.SetTexture(t);const s=this.GetWorldInfo();s.HasMesh()?this._DrawMesh(s,e):this._DrawStandard(s,e)}_DrawStandard(e,t){let s=this._bquadRef;this._runtime.IsPixelRoundingEnabled()&&(s=e.PixelRoundQuad(s)),t.Quad4(s,this._currentQuadTex)}_DrawMesh(e,t){const s=e.GetTransformedMesh();if(e.IsMeshChanged()){e.CalculateBbox(a,o,!1);let t=o;this._runtime.IsPixelRoundingEnabled()&&(t=e.PixelRoundQuad(t)),s.CalculateTransformedMesh(e.GetSourceMesh(),t,this._currentQuadTex),e.SetMeshChanged(!1)}s.Draw(t)}GetAnimationTime(){return this._animationTimer.Get()}IsAnimationPlaying(){return this._inst.GetFlag(c)}SetAnimationPlaying(e){this._inst.SetFlag(c,e)}IsPlayingForwards(){return this._inst.GetFlag(l)}SetPlayingForwards(e){this._inst.SetFlag(l,e)}IsInAnimationTrigger(){return this._inst.GetFlag(u)}SetInAnimationTrigger(e){this._inst.SetFlag(u,e)}Tick(){this._changeAnimationName&&this._DoChangeAnimation(),this._changeAnimFrameIndex>=0&&this._DoChangeAnimFrame();const t=this._currentAnimationSpeed;if(!this.IsAnimationPlaying()||0===t)return void this._StopTicking();const s=this._runtime.GetDt(this._inst);this._animationTimer.Add(s);const i=this.GetAnimationTime(),r=this._currentAnimationFrame,n=r.GetDuration()/t;if(i<this._frameStartTime+n)return;const a=this._currentAnimation,o=this._currentAnimationRepeatTo,h=a.GetFrameCount(),l=a.GetRepeatCount(),c=a.IsLooping(),u=a.IsPingPong();this.IsPlayingForwards()?this._currentFrameIndex++:this._currentFrameIndex--,this._frameStartTime+=n,this._currentFrameIndex>=h&&(u?(this.SetPlayingForwards(!1),this._currentFrameIndex=h-2):c?this._currentFrameIndex=o:(this._animationRepeats++,this._animationRepeats>=l?this._FinishAnimation(!1):this._currentFrameIndex=o)),this._currentFrameIndex<0&&(u?(this._currentFrameIndex=1,this.SetPlayingForwards(!0),c||(this._animationRepeats++,this._animationRepeats>=l&&this._FinishAnimation(!0))):c?this._currentFrameIndex=o:(this._animationRepeats++,this._animationRepeats>=l?this._FinishAnimation(!0):this._currentFrameIndex=o)),this._currentFrameIndex=e.clamp(this._currentFrameIndex,0,h-1);const _=a.GetFrameAt(this._currentFrameIndex);i>this._frameStartTime+_.GetDuration()/t&&(this._frameStartTime=i),this._OnFrameChanged(r,_)}_FinishAnimation(t){this._currentFrameIndex=t?0:this._currentAnimation.GetFrameCount()-1,this.SetAnimationPlaying(!1),this._animTriggerName=this._currentAnimation.GetName(),this.SetInAnimationTrigger(!0),this.DispatchScriptEvent("animationend",!1,{animationName:this._animTriggerName}),this.Trigger(e.Plugins.Sprite.Cnds.OnAnyAnimFinished),this.Trigger(e.Plugins.Sprite.Cnds.OnAnimFinished),this.SetInAnimationTrigger(!1),this._animationRepeats=0}_OnFrameChanged(t,s){if(t===s)return;const i=this.GetWorldInfo(),r=t.GetImageInfo(),n=s.GetImageInfo(),a=r.GetWidth(),o=r.GetHeight(),h=n.GetWidth(),l=n.GetHeight();a!==h&&i.SetWidth(i.GetWidth()*(h/a)),o!==l&&i.SetHeight(i.GetHeight()*(l/o)),i.SetOriginX(s.GetOriginX()),i.SetOriginY(s.GetOriginY()),i.SetSourceCollisionPoly(s.GetCollisionPoly()),i.SetBboxChanged(),this._currentAnimationFrame=s,this._currentTexture=n.GetTexture(),this._currentRcTex=n.GetTexRect(),this._currentQuadTex=n.GetTexQuad();const c=this.GetInstance().GetBehaviorInstances();for(let e=0,i=c.length;e<i;++e)c[e].OnSpriteFrameChanged(t,s);this.DispatchScriptEvent("framechange",!1,{animationName:this._currentAnimation.GetName(),animationFrame:this._currentFrameIndex}),this.Trigger(e.Plugins.Sprite.Cnds.OnFrameChanged),this._runtime.UpdateRender()}_StartAnim(e){this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime(),1===e&&0!==this._currentFrameIndex&&(this._changeAnimFrameIndex=0,this.IsInAnimationTrigger()||this._DoChangeAnimFrame()),this._StartTicking()}_SetAnim(e,t){this._changeAnimationName=e,this._changeAnimationFrom=t,this._StartTicking(),this.IsInAnimationTrigger()||this._DoChangeAnimation()}_GetCurrentAnimation(){return this._currentAnimation}_GetCurrentAnimationName(){return this._changeAnimationName?this._changeAnimationName:this._currentAnimation.GetName()}_SetAnimFrame(e){isFinite(e)&&(this._changeAnimFrameIndex=e,this.IsInAnimationTrigger()||this._DoChangeAnimFrame())}_GetAnimFrame(){return this._currentFrameIndex}_SetAnimSpeed(e){this._currentAnimationSpeed=Math.abs(e),this.SetPlayingForwards(e>=0),this._currentAnimationSpeed>0&&this._StartTicking()}_GetAnimSpeed(){return this.IsPlayingForwards()?this._currentAnimationSpeed:-this._currentAnimationSpeed}_SetAnimRepeatToFrame(t){t=e.clamp(Math.floor(t),0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationRepeatTo=t}_GetAnimRepeatToFrame(){return this._currentAnimationRepeatTo}_DoChangeAnimation(){const t=this._currentAnimationFrame,s=this._objectClass.GetAnimationByName(this._changeAnimationName);if(this._changeAnimationName="",!s)return;if(s===this._currentAnimation&&this.IsAnimationPlaying())return;this._currentAnimation=s,this.SetPlayingForwards(s.GetSpeed()>=0),this._currentAnimationSpeed=Math.abs(s.GetSpeed()),this._currentAnimationRepeatTo=s.GetRepeatTo(),this._currentFrameIndex=e.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1),1===this._changeAnimationFrom&&(this._currentFrameIndex=0),this.SetAnimationPlaying(!0),this._frameStartTime=this.GetAnimationTime();const i=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._OnFrameChanged(t,i)}_DoChangeAnimFrame(){const t=this._currentAnimationFrame,s=this._currentFrameIndex;if(this._currentFrameIndex=e.clamp(Math.floor(this._changeAnimFrameIndex),0,this._currentAnimation.GetFrameCount()-1),this._changeAnimFrameIndex=-1,s===this._currentFrameIndex)return;const i=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._OnFrameChanged(t,i),this._frameStartTime=this.GetAnimationTime()}_UpdateCurrentTexture(){const e=this._currentAnimationFrame.GetImageInfo();this._currentTexture=e.GetTexture(),this._currentRcTex=e.GetTexRect(),this._currentQuadTex=e.GetTexQuad(),this.GetWorldInfo().SetMeshChanged(!0)}GetTexture(){return this._currentTexture}GetTexRect(){return this._currentRcTex}GetTexQuad(){return this._currentQuadTex}GetImagePointCount(){return this._currentAnimationFrame.GetImagePointCount()}GetImagePoint(e){const t=this._currentAnimationFrame,s=this.GetWorldInfo();let i=null;if("string"==typeof e)i=t.GetImagePointByName(e);else{if("number"!=typeof e)throw new TypeError("expected string or number");i=t.GetImagePointByIndex(e-1)}if(!i)return[s.GetX(),s.GetY()];if(h.copy(i.GetVec2()),s.HasMesh()){const[e,t]=s.GetSourceMesh().TransformPoint(h.getX(),h.getY());h.set(e,t)}return h.offset(-t.GetOriginX(),-t.GetOriginY()),h.scale(s.GetWidth(),s.GetHeight()),h.rotate(s.GetAngle()),h.offset(s.GetX(),s.GetY()),[h.getX(),h.getY()]}GetCollisionPolyPointCount(){return this.GetWorldInfo().GetTransformedCollisionPoly().pointCount()}GetCollisionPolyPoint(e){e=Math.floor(e);const t=this.GetWorldInfo(),s=t.GetTransformedCollisionPoly(),i=s.pointCount();if(e===i&&(e=0),e<0||e>=i)return[0,0];const r=s.pointsArr();return[r[2*e+0]+t.GetX(),r[2*e+1]+t.GetY()]}GetDebuggerProperties(){const t=e.Plugins.Sprite.Acts,s="plugins.sprite.debugger.animation-properties";return[{title:s+".title",properties:[{name:s+".current-animation",value:this._currentAnimation.GetName(),onedit:e=>this.CallAction(t.SetAnim,e,0)},{name:s+".current-frame",value:this._currentFrameIndex,onedit:e=>this.CallAction(t.SetAnimFrame,e)},{name:s+".is-playing",value:this.IsAnimationPlaying(),onedit:e=>e?this.CallAction(t.StartAnim,0):this.CallAction(t.StopAnim)},{name:s+".speed",value:this._currentAnimationSpeed,onedit:e=>this.CallAction(t.SetAnimSpeed,e)},{name:s+".repeats",value:this._animationRepeats,onedit:e=>this._animationRepeats=e}]}]}SaveToJson(){const e={a:this._currentAnimation.GetSID()};0!==this._frameStartTime&&(e.fs=this._frameStartTime);const t=this.GetAnimationTime();0!==t&&(e.at=t),0!==this._currentFrameIndex&&(e.f=this._currentFrameIndex),0!==this._currentAnimationSpeed&&(e.cas=this._currentAnimationSpeed),1!==this._animationRepeats&&(e.ar=this._animationRepeats),0!==this._currentAnimationRepeatTo&&(e.rt=this._currentAnimationRepeatTo),this.IsAnimationPlaying()||(e.ap=this.IsAnimationPlaying()),this.IsPlayingForwards()||(e.af=this.IsPlayingForwards());const s=this.GetWorldInfo();return s.IsCollisionEnabled()&&(e.ce=s.IsCollisionEnabled()),e}LoadFromJson(t){const s=this.GetObjectClass().GetAnimationBySID(t.a);s&&(this._currentAnimation=s),this._frameStartTime=t.hasOwnProperty("fs")?t.fs:0,this._animationTimer.Set(t.hasOwnProperty("at")?t.at:0);const i=t.hasOwnProperty("f")?t.f:0;this._currentFrameIndex=e.clamp(i,0,this._currentAnimation.GetFrameCount()-1),this._currentAnimationSpeed=t.hasOwnProperty("cas")?t.cas:0,this._animationRepeats=t.hasOwnProperty("ar")?t.ar:1;const r=t.hasOwnProperty("rt")?t.rt:0;this._currentAnimationRepeatTo=e.clamp(r,0,this._currentAnimation.GetFrameCount()-1),this.SetAnimationPlaying(!t.hasOwnProperty("ap")||!!t.ap),this.SetPlayingForwards(!t.hasOwnProperty("af")||!!t.af);const n=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._currentAnimationFrame=n,this._UpdateCurrentTexture();const a=this.GetWorldInfo();a.SetOriginX(n.GetOriginX()),a.SetOriginY(n.GetOriginY()),a.SetSourceCollisionPoly(n.GetCollisionPoly()),a.SetCollisionEnabled(!!t.ce),this.IsAnimationPlaying()&&this._StartTicking()}GetPropertyValueByIndex(t){const s=this.GetWorldInfo();switch(t){case n:return s.IsCollisionEnabled();case r:return e.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1);case i:return this._currentAnimation.GetName()}}SetPropertyValueByIndex(t,s){const a=this.GetWorldInfo();switch(t){case n:a.SetCollisionEnabled(!!s);break;case r:this.SetAnimationPlaying(!1);const t=this._currentAnimation.GetFrameCount()-1,o=s=e.clamp(s,0,t),h=this._currentAnimation.GetFrameAt(this._currentFrameIndex),l=this._currentAnimation.GetFrameAt(o);this._OnFrameChanged(h,l),this._currentFrameIndex=e.clamp(o,0,t);break;case i:this._changeAnimationName=s,this._DoChangeAnimation();break}}GetScriptInterfaceClass(){return self.ISpriteInstance}};const _=new WeakMap,d=new Map([["current-frame",0],["beginning",1]]);self.ISpriteInstance=class extends self.IWorldInstance{constructor(){super(),_.set(this,self.IInstance._GetInitInst().GetSdkInstance())}getImagePointCount(){return _.get(this).GetImagePointCount()}getImagePointX(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return _.get(this).GetImagePoint(e)[0]}getImagePointY(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return _.get(this).GetImagePoint(e)[1]}getImagePoint(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("expected string or number");return _.get(this).GetImagePoint(e)}getPolyPointCount(){return _.get(this).GetCollisionPolyPointCount()}getPolyPointX(e){return t.RequireFiniteNumber(e),_.get(this).GetCollisionPolyPoint(e)[0]}getPolyPointY(e){return t.RequireFiniteNumber(e),_.get(this).GetCollisionPolyPoint(e)[1]}getPolyPoint(e){return t.RequireFiniteNumber(e),_.get(this).GetCollisionPolyPoint(e)}stopAnimation(){_.get(this).SetAnimationPlaying(!1)}startAnimation(e="current-frame"){t.RequireString(e);const s=d.get(e);if(void 0===s)throw new Error("invalid mode");_.get(this)._StartAnim(s)}setAnimation(e,s="beginning"){t.RequireString(e),t.RequireString(s);const i=d.get(s);if(void 0===i)throw new Error("invalid mode");const r=_.get(this);if(!r.GetObjectClass().GetAnimationByName(e))throw new Error(`animation name "${e}" does not exist`);r._SetAnim(e,i)}getAnimation(e){t.RequireString(e);const s=_.get(this).GetObjectClass().GetAnimationByName(e);return s?s.GetIAnimation():null}get animation(){return _.get(this)._GetCurrentAnimation().GetIAnimation()}get animationName(){return _.get(this)._GetCurrentAnimationName()}set animationFrame(e){t.RequireFiniteNumber(e),_.get(this)._SetAnimFrame(e)}get animationFrame(){return _.get(this)._GetAnimFrame()}set animationSpeed(e){t.RequireFiniteNumber(e),_.get(this)._SetAnimSpeed(e)}get animationSpeed(){return _.get(this)._GetAnimSpeed()}set animationRepeatToFrame(e){t.RequireFiniteNumber(e),_.get(this)._SetAnimRepeatToFrame(e)}get animationRepeatToFrame(){return _.get(this)._GetAnimRepeatToFrame()}get imageWidth(){return _.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return _.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const e=_.get(this).GetCurrentImageInfo();return[e.GetWidth(),e.GetHeight()]}setSolidCollisionFilter(e,s){t.RequireString(s),_.get(this).GetWorldInfo().SetSolidCollisionFilter(!!e,s)}}}{const e=self.C3;e.Plugins.Sprite.Cnds={IsAnimPlaying(t){return e.equalsNoCase(this._GetCurrentAnimationName(),t)},CompareFrame(t,s){return e.compare(this._currentFrameIndex,t,s)},CompareAnimSpeed(t,s){return e.compare(this._GetAnimSpeed(),t,s)},OnAnimFinished(t){return e.equalsNoCase(this._animTriggerName,t)},OnAnyAnimFinished:()=>!0,OnFrameChanged:()=>!0,IsMirrored(){return this.GetWorldInfo().GetWidth()<0},IsFlipped(){return this.GetWorldInfo().GetHeight()<0},OnURLLoaded:()=>!0,OnURLFailed:()=>!0,IsCollisionEnabled(){return this.GetWorldInfo().IsCollisionEnabled()}}}{const e=self.C3;e.Plugins.Sprite.Acts={Spawn(e,t,s,i){if(!e||!t)return;const[r,n]=this.GetImagePoint(s),a=this._runtime.CreateInstance(e,t,r,n,i);if(!a)return;if(i&&t.SortAndAddInstancesByZIndex(a),e.GetPlugin().IsRotatable()){const e=a.GetWorldInfo();e.SetAngle(this.GetWorldInfo().GetAngle()),e.SetBboxChanged()}const o=this._runtime.GetEventSheetManager();o.BlockFlushingInstances(!0),a._TriggerOnCreatedOnSelfAndRelated(),o.BlockFlushingInstances(!1),e!==this.GetObjectClass()&&this._sdkType._SpawnPickInstance(e,a,i)},StopAnim(){this.SetAnimationPlaying(!1)},StartAnim(e){this._StartAnim(e)},SetAnim(e,t){this._SetAnim(e,t)},SetAnimFrame(e){this._SetAnimFrame(e)},SetAnimSpeed(e){this._SetAnimSpeed(e)},SetAnimRepeatToFrame(e){this._SetAnimRepeatToFrame(e)},SetMirrored(e){const t=this.GetWorldInfo(),s=t.GetWidth(),i=Math.abs(s)*(0===e?-1:1);s!==i&&(t.SetWidth(i),t.SetBboxChanged())},SetFlipped(e){const t=this.GetWorldInfo(),s=t.GetHeight(),i=Math.abs(s)*(0===e?-1:1);s!==i&&(t.SetHeight(i),t.SetBboxChanged())},SetScale(e){const t=this._currentAnimationFrame.GetImageInfo(),s=this.GetWorldInfo(),i=s.GetWidth()<0?-1:1,r=s.GetHeight()<0?-1:1,n=t.GetWidth()*e*i,a=t.GetHeight()*e*r;s.GetWidth()===n&&s.GetHeight()===a||(s.SetSize(n,a),s.SetBboxChanged())},async LoadURL(t,s,i){const r=this._currentAnimationFrame.GetImageInfo(),n=this.GetWorldInfo(),a=this._runtime,o=this._sdkType;if(r.GetURL()===t)return 0===s&&(n.SetSize(r.GetWidth(),r.GetHeight()),n.SetBboxChanged()),void this.Trigger(e.Plugins.Sprite.Cnds.OnURLLoaded);const h=e.New(e.ImageInfo);try{if(await h.LoadDynamicAsset(a,t),!h.IsLoaded())throw new Error("image failed to load");if(this.WasReleased())return void h.Release();await h.LoadStaticTexture(a.GetRenderer(),{sampling:a.GetSampling()})}catch(t){return void(this.WasReleased()||this.Trigger(e.Plugins.Sprite.Cnds.OnURLFailed))}this.WasReleased()?h.Release():(r.ReplaceWith(h),o._UpdateAllCurrentTexture(),a.UpdateRender(),0===s&&(n.SetSize(r.GetWidth(),r.GetHeight()),n.SetBboxChanged()),await this.TriggerAsync(e.Plugins.Sprite.Cnds.OnURLLoaded))},SetCollisions(e){this.GetWorldInfo().SetCollisionEnabled(e)},SetSolidCollisionFilter(e,t){this.GetWorldInfo().SetSolidCollisionFilter(0===e,t)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}}}{const e=self.C3;e.Plugins.Sprite.Exps={AnimationFrame(){return this._currentFrameIndex},AnimationFrameCount(){return this._currentAnimation.GetFrameCount()},AnimationName(){return this._currentAnimation.GetName()},AnimationSpeed(){return this._GetAnimSpeed()},OriginalAnimationSpeed(){return this._currentAnimation.GetSpeed()},ImagePointX(e){return this.GetImagePoint(e)[0]},ImagePointY(e){return this.GetImagePoint(e)[1]},ImagePointCount(){return this.GetImagePointCount()},ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},PolyPointXAt(e){return this.GetCollisionPolyPoint(e)[0]},PolyPointYAt(e){return this.GetCollisionPolyPoint(e)[1]},PolyPointCount(){return this.GetCollisionPolyPointCount()}}}{const e=self.C3;e.Plugins.TiledBg=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;function WrapModeToStr(e){switch(e){case 0:return"clamp-to-edge";case 1:return"repeat";case 2:return"mirror-repeat"}return"repeat"}e.Plugins.TiledBg.Type=class extends e.SDKTypeBase{constructor(e,t){super(e),this._wrapX="repeat",this._wrapY="repeat",t&&(this._wrapX=WrapModeToStr(t[0]),this._wrapY=WrapModeToStr(t[1]))}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling(),wrapX:this._wrapX,wrapY:this._wrapY})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}}}{const e=self.C3,t=self.C3X,s=0,i=1,r=4,n=5,a=6,o=7,h=8,l=9,c=10,u=11,_=12,d=13,p=14,f=e.New(e.Rect),m=e.New(e.Quad),g=e.New(e.Rect),S=e.New(e.Quad);e.Plugins.TiledBg.Instance=class extends e.SDKWorldInstanceBase{constructor(t,i){super(t),this._imageOffsetX=0,this._imageOffsetY=0,this._imageScaleX=1,this._imageScaleY=1,this._imageAngle=0,this._enableTileRandomization=!1,this._tileXRandom=0,this._tileYRandom=0,this._tileAngleRandom=0,this._tileBlendMarginX=0,this._tileBlendMarginY=0,this._ownImageInfo=null,i&&(this.GetWorldInfo().SetVisible(!!i[s]),this._imageOffsetX=i[r],this._imageOffsetY=i[n],this._imageScaleX=i[a],this._imageScaleY=i[o],this._imageAngle=e.toRadians(i[h]),this._enableTileRandomization=!!i[l],this._tileXRandom=i[c],this._tileYRandom=i[u],this._tileAngleRandom=i[_],this._tileBlendMarginX=i[d],this._tileBlendMarginY=i[p])}Release(){this._ReleaseOwnImage(),super.Release()}_ReleaseOwnImage(){this._ownImageInfo&&(this._ownImageInfo.Release(),this._ownImageInfo=null)}CalculateTextureCoordsFor3DFace(e,t,s){const i=this.GetCurrentImageInfo(),r=i.GetWidth(),n=i.GetHeight(),a=this._imageOffsetX/r,o=this._imageOffsetY/n,h=this._imageAngle;g.set(0,0,e/(r*this._imageScaleX),t/(n*this._imageScaleY)),g.offset(-a,-o),0===h?s.setFromRect(g):s.setFromRotatedRect(g,-h)}SetTilingShaderProgram(e){if(this._enableTileRandomization){const t=this.GetCurrentImageInfo();e.SetTileRandomizationMode(),e.SetTileRandomizationInfo(t.GetWidth()*this._imageScaleX,t.GetHeight()*this._imageScaleY,this._tileXRandom,this._tileYRandom,this._tileAngleRandom,this._tileBlendMarginX,this._tileBlendMarginY)}else e.SetTextureFillMode()}Draw(e){const t=this.GetCurrentImageInfo(),s=t.GetTexture();if(null===s)return;this.SetTilingShaderProgram(e),e.SetTexture(s);const i=t.GetWidth(),r=t.GetHeight(),n=this._imageOffsetX/i,a=this._imageOffsetY/r,o=this.GetWorldInfo();g.set(0,0,o.GetWidth()/(i*this._imageScaleX),o.GetHeight()/(r*this._imageScaleY)),g.offset(-n,-a),o.HasMesh()?this._DrawMesh(o,e):this._DrawStandard(o,e)}_DrawStandard(e,t){let s=e.GetBoundingQuad();this._runtime.IsPixelRoundingEnabled()&&(s=e.PixelRoundQuad(s)),0===this._imageAngle?t.Quad3(s,g):(S.setFromRotatedRect(g,-this._imageAngle),t.Quad4(s,S))}_DrawMesh(e,t){const s=e.GetTransformedMesh();if(e.IsMeshChanged()){e.CalculateBbox(f,m,!1);let t=m;this._runtime.IsPixelRoundingEnabled()&&(t=e.PixelRoundQuad(t));let i=g;0!==this._imageAngle&&(S.setFromRotatedRect(g,-this._imageAngle),i=S),s.CalculateTransformedMesh(e.GetSourceMesh(),t,i),e.SetMeshChanged(!1)}s.Draw(t)}GetCurrentImageInfo(){return this._ownImageInfo||this._objectClass.GetImageInfo()}IsOriginalSizeKnown(){return!0}GetTexture(){return this.GetCurrentImageInfo().GetTexture()}_SetMeshChanged(){this.GetWorldInfo().SetMeshChanged(!0)}_SetImageOffsetX(e){this._imageOffsetX!==e&&(this._imageOffsetX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetX(){return this._imageOffsetX}_SetImageOffsetY(e){this._imageOffsetY!==e&&(this._imageOffsetY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageOffsetY(){return this._imageOffsetY}_SetImageScaleX(e){this._imageScaleX!==e&&(this._imageScaleX=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleX(){return this._imageScaleX}_SetImageScaleY(e){this._imageScaleY!==e&&(this._imageScaleY=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageScaleY(){return this._imageScaleY}_SetImageAngle(e){this._imageAngle!==e&&(this._imageAngle=e,this._runtime.UpdateRender(),this._SetMeshChanged())}_GetImageAngle(){return this._imageAngle}_SetTileRandomizationEnabled(e){e=!!e,this._enableTileRandomization!==e&&(this._enableTileRandomization=e,this._runtime.UpdateRender())}_IsTileRandomizationEnabled(){return this._enableTileRandomization}_SetTileXRandom(e){this._tileXRandom!==e&&(this._tileXRandom=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileXRandom(){return this._tileXRandom}_SetTileYRandom(e){this._tileYRandom!==e&&(this._tileYRandom=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileYRandom(){return this._tileYRandom}_SetTileAngleRandom(e){this._tileAngleRandom!==e&&(this._tileAngleRandom=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileAngleRandom(){return this._tileAngleRandom}_SetTileBlendMarginX(e){this._tileBlendMarginX!==e&&(this._tileBlendMarginX=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileBlendMarginX(){return this._tileBlendMarginX}_SetTileBlendMarginY(e){this._tileBlendMarginY!==e&&(this._tileBlendMarginY=e,this._IsTileRandomizationEnabled()&&this._runtime.UpdateRender())}_GetTileBlendMarginY(){return this._tileBlendMarginY}GetDebuggerProperties(){const t="plugins.tiledbg.properties";return[{title:t+".image-transform.name",properties:[{name:t+".image-offset-x.name",value:this._GetImageOffsetX(),onedit:e=>this._SetImageOffsetX(e)},{name:t+".image-offset-y.name",value:this._GetImageOffsetY(),onedit:e=>this._SetImageOffsetY(e)},{name:t+".image-scale-x.name",value:100*this._GetImageScaleX(),onedit:e=>this._SetImageScaleX(e/100)},{name:t+".image-scale-y.name",value:100*this._GetImageScaleY(),onedit:e=>this._SetImageScaleY(e/100)},{name:t+".image-angle.name",value:e.toDegrees(this._GetImageAngle()),onedit:t=>this._SetImageAngle(e.toRadians(t))}]},{title:t+".tile-randomization.name",properties:[{name:t+".enable-tile-randomization.name",value:this._IsTileRandomizationEnabled(),onedit:e=>this._SetTileRandomizationEnabled(e)},{name:t+".x-random.name",value:100*this._GetTileXRandom(),onedit:e=>this._SetTileXRandom(e/100)},{name:t+".y-random.name",value:100*this._GetTileYRandom(),onedit:e=>this._SetTileYRandom(e/100)},{name:t+".angle-random.name",value:100*this._GetTileAngleRandom(),onedit:e=>this._SetTileAngleRandom(e/100)},{name:t+".blend-margin-x.name",value:100*this._GetTileBlendMarginX(),onedit:e=>this._SetTileBlendMarginX(e/100)},{name:t+".blend-margin-y.name",value:100*this._GetTileBlendMarginY(),onedit:e=>this._SetTileBlendMarginY(e/100)}]}]}GetPropertyValueByIndex(e){switch(e){case r:return this._GetImageOffsetX();case n:return this._GetImageOffsetY();case a:return this._GetImageScaleX();case o:return this._GetImageScaleY();case h:return this._GetImageAngle();case l:return this._IsTileRandomizationEnabled();case c:return this._GetTileXRandom();case u:return this._GetTileYRandom();case _:return this._GetTileAngleRandom();case d:return this._GetTileBlendMarginX();case p:return this._GetTileBlendMarginY()}}SetPropertyValueByIndex(e,t){switch(e){case r:this._SetImageOffsetX(t);break;case n:this._SetImageOffsetY(t);break;case a:this._SetImageScaleX(t);break;case o:this._SetImageScaleY(t);break;case h:this._SetImageAngle(t);break;case l:this._SetTileRandomizationEnabled(!!t);break;case c:this._SetTileXRandom(t);break;case u:this._SetTileYRandom(t);break;case _:this._SetTileAngleRandom(t);break;case d:this._SetTileBlendMarginX(t);break;case p:this._SetTileBlendMarginY(t);break}}GetScriptInterfaceClass(){return self.ITiledBackgroundInstance}};const y=new WeakMap;self.ITiledBackgroundInstance=class extends self.IWorldInstance{constructor(){super(),y.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set imageOffsetX(e){t.RequireFiniteNumber(e),y.get(this)._SetImageOffsetX(e)}get imageOffsetX(){return y.get(this)._GetImageOffsetX()}set imageOffsetY(e){t.RequireFiniteNumber(e),y.get(this)._SetImageOffsetY(e)}get imageOffsetY(){return y.get(this)._GetImageOffsetY()}setImageOffset(e,s){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s);const i=y.get(this);i._SetImageOffsetX(e),i._SetImageOffsetY(s)}getImageOffset(){const e=y.get(this);return[e._GetImageOffsetX(),e._GetImageOffsetY()]}set imageScaleX(e){t.RequireFiniteNumber(e),y.get(this)._SetImageScaleX(e)}get imageScaleX(){return y.get(this)._GetImageScaleX()}set imageScaleY(e){t.RequireFiniteNumber(e),y.get(this)._SetImageScaleY(e)}get imageScaleY(){return y.get(this)._GetImageScaleY()}setImageScale(e,s){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s);const i=y.get(this);i._SetImageScaleX(e),i._SetImageScaleY(s)}getImageScale(){const e=y.get(this);return[e._GetImageScaleX(),e._GetImageScaleY()]}set imageAngle(e){t.RequireFiniteNumber(e),y.get(this)._SetImageAngle(e)}get imageAngle(){return y.get(this)._GetImageAngle()}set imageAngleDegrees(s){t.RequireFiniteNumber(s),y.get(this)._SetImageAngle(e.toRadians(s))}get imageAngleDegrees(){return e.toDegrees(y.get(this)._GetImageAngle())}get imageWidth(){return y.get(this).GetCurrentImageInfo().GetWidth()}get imageHeight(){return y.get(this).GetCurrentImageInfo().GetHeight()}getImageSize(){const e=y.get(this).GetCurrentImageInfo();return[e.GetWidth(),e.GetHeight()]}set enableTileRandomization(e){y.get(this)._SetTileRandomizationEnabled(!!e)}get enableTileRandomization(){return y.get(this)._IsTileRandomizationEnabled()}set tileXRandom(e){t.RequireFiniteNumber(e),y.get(this)._SetTileXRandom(e)}get tileXRandom(){return y.get(this)._GetTileXRandom()}set tileYRandom(e){t.RequireFiniteNumber(e),y.get(this)._SetTileYRandom(e)}get tileYRandom(){return y.get(this)._GetTileYRandom()}setTileRandom(e,s){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s);const i=y.get(this);i._SetTileXRandom(e),i._SetTileYRandom(s)}getTileRandom(){const e=y.get(this);return[e._GetTileXRandom(),e._GetTileYRandom()]}set tileAngleRandom(e){t.RequireFiniteNumber(e),y.get(this)._SetTileAngleRandom(e)}get tileAngleRandom(){return y.get(this)._GetTileAngleRandom()}set tileBlendMarginX(e){t.RequireFiniteNumber(e),y.get(this)._SetTileBlendMarginX(e)}get tileBlendMarginX(){return y.get(this)._GetTileBlendMarginX()}set tileBlendMarginY(e){t.RequireFiniteNumber(e),y.get(this)._SetTileBlendMarginY(e)}get tileBlendMarginY(){return y.get(this)._GetTileBlendMarginY()}setTileBlendMargin(e,s){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s);const i=y.get(this);i._SetTileBlendMarginX(e),i._SetTileBlendMarginY(s)}getTileBlendMargin(){const e=y.get(this);return[e._GetTileBlendMarginX(),e._GetTileBlendMarginY()]}}}{const e=self.C3;e.Plugins.TiledBg.Cnds={OnURLLoaded:()=>!0,OnURLFailed:()=>!0,IsTileRandomizationEnabled(){return this._IsTileRandomizationEnabled()}}}{const e=self.C3;e.Plugins.TiledBg.Acts={SetImageOffsetX(e){this._SetImageOffsetX(e)},SetImageOffsetY(e){this._SetImageOffsetY(e)},SetImageScaleX(e){this._SetImageScaleX(e/100)},SetImageScaleY(e){this._SetImageScaleY(e/100)},SetImageAngle(t){this._SetImageAngle(e.toRadians(t))},SetTileRandomizationEnabled(e){this._SetTileRandomizationEnabled(e)},SetTilePosRandom(e,t){this._SetTileXRandom(e/100),this._SetTileYRandom(t/100)},SetTileAngleRandom(e){this._SetTileAngleRandom(e/100)},SetTileBlendMargin(e,t){this._SetTileBlendMarginX(e/100),this._SetTileBlendMarginY(t/100)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},async LoadURL(t,s){if(this._ownImageInfo&&this._ownImageInfo.GetURL()===t)return;const i=this._runtime,r=e.New(e.ImageInfo);try{if(await r.LoadDynamicAsset(i,t),!r.IsLoaded())throw new Error("image failed to load");if(this.WasReleased())return r.Release(),null;if(!await r.LoadStaticTexture(i.GetRenderer(),{sampling:i.GetSampling(),wrapX:"repeat",wrapY:"repeat"}))return}catch(t){return void(this.WasReleased()||this.Trigger(e.Plugins.TiledBg.Cnds.OnURLFailed))}this.WasReleased()?r.Release():(this._ReleaseOwnImage(),this._ownImageInfo=r,i.UpdateRender(),await this.TriggerAsync(e.Plugins.TiledBg.Cnds.OnURLLoaded))}}}{const e=self.C3;e.Plugins.TiledBg.Exps={ImageWidth(){return this.GetCurrentImageInfo().GetWidth()},ImageHeight(){return this.GetCurrentImageInfo().GetHeight()},ImageOffsetX(){return this._imageOffsetX},ImageOffsetY(){return this._imageOffsetY},ImageScaleX(){return 100*this._imageScaleX},ImageScaleY(){return 100*this._imageScaleY},ImageAngle(){return e.toDegrees(this._imageAngle)},TileXRandom(){return 100*this._GetTileXRandom()},TileYRandom(){return 100*this._GetTileYRandom()},TileAngleRandom(){return 100*this._GetTileAngleRandom()},TileBlendMarginX(){return 100*this._GetTileBlendMarginX()},TileBlendMarginY(){return 100*this._GetTileBlendMarginY()}}}{const e=self.C3;e.Plugins.Browser=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Browser.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t="browser";e.Plugins.Browser.Instance=class extends e.SDKInstanceBase{constructor(s,i){super(s,t),this._initLocationStr="",this._isOnline=!1,this._referrer="",this._docTitle="",this._isCookieEnabled=!1,this._screenWidth=0,this._screenHeight=0,this._windowOuterWidth=0,this._windowOuterHeight=0,this._isConstructArcade=!1,this._cssStyleMap=new Map,this.AddDOMMessageHandlers([["online-state",e=>this._OnOnlineStateChanged(e)],["backbutton",()=>this._OnBackButton()],["sw-message",e=>this._OnSWMessage(e)],["hashchange",e=>this._OnHashChange(e)]]);const r=this.GetRuntime().Dispatcher();this._disposables=new e.CompositeDisposable(e.Disposable.From(r,"afterfirstlayoutstart",(()=>this._OnAfterFirstLayoutStart())),e.Disposable.From(r,"window-resize",(()=>this._OnWindowResize())),e.Disposable.From(r,"suspend",(()=>this._OnSuspend())),e.Disposable.From(r,"resume",(()=>this._OnResume()))),this._runtime.AddLoadPromise(this.PostToDOMAsync("get-initial-state",{exportType:this._runtime.GetExportType()}).then((e=>{this._initLocationStr=e.location,this._isOnline=e.isOnline,this._referrer=e.referrer,this._docTitle=e.title,this._isCookieEnabled=e.isCookieEnabled,this._screenWidth=e.screenWidth,this._screenHeight=e.screenHeight,this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._isConstructArcade=e.isConstructArcade})))}Release(){super.Release()}_OnAfterFirstLayoutStart(){this.PostToDOM("ready-for-sw-messages")}async _OnOnlineStateChanged(t){const s=!!t.isOnline;this._isOnline!==s&&(this._isOnline=s,this._isOnline?await this.TriggerAsync(e.Plugins.Browser.Cnds.OnOnline):await this.TriggerAsync(e.Plugins.Browser.Cnds.OnOffline))}async _OnWindowResize(){await this.TriggerAsync(e.Plugins.Browser.Cnds.OnResize)}_OnSuspend(){this.Trigger(e.Plugins.Browser.Cnds.OnPageHidden)}_OnResume(){this.Trigger(e.Plugins.Browser.Cnds.OnPageVisible)}async _OnBackButton(){await this.TriggerAsync(e.Plugins.Browser.Cnds.OnBackButton)}_OnSWMessage(t){const s=t.type;"downloading-update"===s?this.Trigger(e.Plugins.Browser.Cnds.OnUpdateFound):"update-ready"===s||"update-pending"===s?this.Trigger(e.Plugins.Browser.Cnds.OnUpdateReady):"offline-ready"===s&&this.Trigger(e.Plugins.Browser.Cnds.OnOfflineReady)}_OnHashChange(t){this._initLocationStr=t.location,this.Trigger(e.Plugins.Browser.Cnds.OnHashChange)}GetDebuggerProperties(){const e="plugins.browser.debugger";return[{title:"plugins.browser.name",properties:[{name:e+".user-agent",value:navigator.userAgent},{name:e+".is-online",value:this._isOnline},{name:e+".is-fullscreen",value:this._runtime.GetCanvasManager().IsDocumentFullscreen()}]}]}}}{const e=self.C3;e.Plugins.Browser.Cnds={IsOnline(){return this._isOnline},OnOnline:()=>!0,OnOffline:()=>!0,OnResize:()=>!0,CookiesEnabled(){return this._isCookieEnabled},IsFullscreen(){return this._runtime.GetCanvasManager().IsDocumentFullscreen()},OnBackButton:()=>!0,IsPortraitLandscape(e){return(this._runtime.GetCanvasManager().GetLastWidth()<=this._runtime.GetCanvasManager().GetLastHeight()?0:1)===e},OnUpdateFound:()=>!0,OnUpdateReady:()=>!0,OnOfflineReady:()=>!0,OnHashChange:()=>!0,PageVisible(){return!this._runtime.IsSuspended()},OnPageHidden:()=>!0,OnPageVisible:()=>!0,HasJava:()=>!1,IsDownloadingUpdate:()=>!1,OnMenuButton:()=>!1,OnSearchButton:()=>!1,IsMetered:()=>!1,IsCharging:()=>!0,SupportsFullscreen:()=>!0}}{const C3=self.C3,ORIENTATIONS=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];C3.Plugins.Browser.Acts={Alert(e){this.PostToDOM("alert",{message:e.toString()})},Close(){this._isConstructArcade||(this._runtime.IsDebug()?self.C3Debugger.CloseWindow():this.PostToDOM("close"))},Focus(){this.PostToDOM("set-focus",{isFocus:!0})},Blur(){this.PostToDOM("set-focus",{isFocus:!1})},GoBack(){this._isConstructArcade||this.PostToDOM("navigate",{type:"back"})},GoForward(){this._isConstructArcade||this.PostToDOM("navigate",{type:"forward"})},GoHome(){},Reload(){this._isConstructArcade||(this._runtime.IsDebug()?this._runtime.PostToDebugger({type:"reload"}):this.PostToDOM("navigate",{type:"reload"}))},GoToURL(e,t){this._PostToDOMMaybeSync("navigate",{type:"url",url:e,target:t,exportType:this._runtime.GetExportType()})},GoToURLWindow(e,t){this._PostToDOMMaybeSync("navigate",{type:"new-window",url:e,tag:t,exportType:this._runtime.GetExportType()})},RequestFullScreen(e,t){e>=2&&(e+=1),6===e&&(e=2),1===e&&(e=0);const s=C3.CanvasManager._FullscreenModeNumberToString(e);this._runtime.GetCanvasManager().SetDocumentFullscreenMode(s),this._PostToDOMMaybeSync("request-fullscreen",{navUI:t})},CancelFullScreen(){this._PostToDOMMaybeSync("exit-fullscreen")},Vibrate(e){const t=e.split(",");for(let e=0,s=t.length;e<s;++e)t[e]=parseInt(t[e],10);this._PostToDOMMaybeSync("vibrate",{pattern:t})},async InvokeDownload(e,t){if(!e||!t)return;const s=await this._runtime.GetAssetManager().GetProjectFileUrl(e);this._runtime.InvokeDownload(s,t)},InvokeDownloadString(e,t,s){if(!s)return;const i=`data:${t},${encodeURIComponent(e)}`;this._runtime.InvokeDownload(i,s)},ConsoleLog(e,t){t=t.toString()},ConsoleGroup(e){},ConsoleGroupEnd(){},ExecJs(jsStr){try{eval(jsStr)}catch(e){}},LockOrientation(e){if((e=Math.floor(e))<0||e>=ORIENTATIONS.length)return;const t=ORIENTATIONS[e];this._PostToDOMMaybeSync("lock-orientation",{orientation:t})},UnlockOrientation(){this._PostToDOMMaybeSync("unlock-orientation")},LoadStyleSheet(e){this._runtime.GetAssetManager().LoadStyleSheet(e)},async SetDocumentCSSStyle(e,t,s,i){await this.PostToDOMAsync("set-document-css-style",{prop:C3.CSSToCamelCase(e),value:t,selector:s,"is-all":0!==i})},async GetDocumentCSSStyle(e,t,s){const i=await this.PostToDOMAsync("get-document-css-style",{prop:e,selector:t});i.isOk&&this._cssStyleMap.set(s.toLowerCase(),i.result.trim())},SetHash(e){this.PostToDOM("set-hash",{hash:e})}}}{const C3=self.C3;C3.Plugins.Browser.Exps={URL(){return this._runtime.IsInWorker()?this._initLocationStr:location.toString()},Protocol(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).protocol:location.protocol},Domain(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).hostname:location.hostname},Port(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).port:location.port},PathName(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).pathname:location.pathname},Hash(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).hash:location.hash},QueryString(){return this._runtime.IsInWorker()?new URL(this._initLocationStr).search:location.search},QueryParam(e){const t=this._runtime.IsInWorker()?new URL(this._initLocationStr).search:location.search,s=RegExp("[?&]"+e+"=([^&]*)").exec(t);return s?decodeURIComponent(s[1].replace(/\+/g," ")):""},Referrer(){return this._referrer},Title(){return this._docTitle},Language:()=>navigator.language,Platform:()=>navigator.platform,UserAgent:()=>navigator.userAgent,ExecJS(jsStr){let result=0;try{result=eval(jsStr)}catch(e){}return"number"==typeof result||"string"==typeof result?result:"boolean"==typeof result&&result?1:0},CSSStyleValue(e){return this._cssStyleMap.get(e)||""},Name:()=>navigator.appName,Version:()=>navigator.appVersion,Product:()=>navigator.product,Vendor:()=>navigator.vendor,BatteryLevel:()=>1,BatteryTimeLeft:()=>1/0,Bandwidth(){const e=navigator.connection;return e&&(e.downlink||e.downlinkMax||e.bandwidth)||1/0},ConnectionType(){const e=navigator.connection;return e&&e.type||"unknown"},DevicePixelRatio:()=>self.devicePixelRatio,ScreenWidth(){return this._screenWidth},ScreenHeight(){return this._screenHeight},WindowInnerWidth(){return this._runtime.GetCanvasManager().GetLastWidth()},WindowInnerHeight(){return this._runtime.GetCanvasManager().GetLastHeight()},WindowOuterWidth(){return this._windowOuterWidth},WindowOuterHeight(){return this._windowOuterWidth}}}{const e=self.C3;e.Plugins.Keyboard=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3,t=self.C3X;e.Plugins.Keyboard.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IKeyboardObjectType}};let s=null;function GetKeyboardSdkInstance(){return s.GetSingleGlobalInstance().GetSdkInstance()}self.IKeyboardObjectType=class extends self.IObjectClass{constructor(e){super(e),s=e,e.GetRuntime()._GetCommonScriptInterfaces().keyboard=this}isKeyDown(e){const t=GetKeyboardSdkInstance();if("string"==typeof e)return t.IsKeyDown(e);if("number"==typeof e)return t.IsKeyCodeDown(e);throw new TypeError("expected string or number")}}}{const e=self.C3;e.Plugins.Keyboard.Instance=class extends e.SDKInstanceBase{constructor(t,s){super(t),this._keysDownByString=new Set,this._keysDownByWhich=new Set,this._triggerWhich=0,this._triggerString="",this._triggerTypedKey="";const i=this.GetRuntime().Dispatcher();this._disposables=new e.CompositeDisposable(e.Disposable.From(i,"keydown",(e=>this._OnKeyDown(e.data))),e.Disposable.From(i,"keyup",(e=>this._OnKeyUp(e.data))),e.Disposable.From(i,"window-blur",(()=>this._OnWindowOrKeyboardBlur())),e.Disposable.From(i,"keyboard-blur",(()=>this._OnWindowOrKeyboardBlur())))}Release(){super.Release()}_OnKeyDown(t){const s=t.which,i=t.code||s.toString(),r=t.key;this._keysDownByString.has(i)||(this._keysDownByString.add(i),this._keysDownByWhich.add(s),this._triggerString=i,this._triggerWhich=s,this._triggerTypedKey=r,this.Trigger(e.Plugins.Keyboard.Cnds.OnAnyKey),this.Trigger(e.Plugins.Keyboard.Cnds.OnKey),this.Trigger(e.Plugins.Keyboard.Cnds.OnLeftRightKeyPressed),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyCode))}_OnKeyUp(t){const s=t.which,i=t.code||s.toString(),r=t.key;this._keysDownByString.delete(i),this._keysDownByWhich.delete(s),this._triggerString=i,this._triggerWhich=s,this._triggerTypedKey=r,this.Trigger(e.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnLeftRightKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyCodeReleased)}_OnWindowOrKeyboardBlur(){for(const t of this._keysDownByWhich)this._keysDownByWhich.delete(t),this._triggerWhich=t,this.Trigger(e.Plugins.Keyboard.Cnds.OnAnyKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyReleased),this.Trigger(e.Plugins.Keyboard.Cnds.OnKeyCodeReleased);this._keysDownByString.clear()}IsKeyDown(e){return this._keysDownByString.has(e)}IsKeyCodeDown(e){return this._keysDownByWhich.has(e)}SaveToJson(){return{tk:this._triggerWhich,tkk:this._triggerTypedKey}}LoadFromJson(e){this._triggerWhich=e.tk,e.hasOwnProperty("tkk")&&(this._triggerTypedKey=e.tkk)}GetDebuggerProperties(){const t="plugins.keyboard";return[{title:t+".name",properties:[{name:t+".debugger.last-key-code",value:this._triggerWhich},{name:t+".debugger.last-key-string",value:e.Plugins.Keyboard.Exps.StringFromKeyCode(this._triggerWhich)},{name:t+".debugger.last-typed-key",value:this._triggerTypedKey}]}]}}}{const e=self.C3,t=["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight"];e.Plugins.Keyboard.Cnds={IsKeyDown(e){return this._keysDownByWhich.has(e)},OnKey(e){return this._triggerWhich===e},OnAnyKey:()=>!0,OnAnyKeyReleased:()=>!0,OnKeyReleased(e){return this._triggerWhich===e},IsKeyCodeDown(e){return e=Math.floor(e),this._keysDownByWhich.has(e)},OnKeyCode(e){return this._triggerWhich===e},OnKeyCodeReleased(e){return this._triggerWhich===e},OnLeftRightKeyPressed(e){const s=t[e];return this._triggerString===s},OnLeftRightKeyReleased(e){const s=t[e];return this._triggerString===s},IsLeftRightKeyDown(e){const s=t[e];return this._keysDownByString.has(s)}}}{const e=self.C3;e.Plugins.Keyboard.Acts={}}{const e=self.C3;function StringFromCharCode(e){switch(e=Math.floor(e)){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"";case 38:return"";case 39:return"";case 40:return"";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(e)}}e.Plugins.Keyboard.Exps={LastKeyCode(){return this._triggerWhich},StringFromKeyCode:e=>StringFromCharCode(e),TypedKey(){return this._triggerTypedKey}}}{const e=self.C3;e.Plugins.Touch=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3,t=self.C3X;e.Plugins.Touch.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.ITouchObjectType}};let s=null;function GetTouchSdkInstance(){return s.GetSingleGlobalInstance().GetSdkInstance()}self.ITouchObjectType=class extends self.IObjectClass{constructor(e){super(e),s=e,e.GetRuntime()._GetCommonScriptInterfaces().touch=this}requestPermission(e){t.RequireString(e);const s=GetTouchSdkInstance();if("orientation"===e)return s._RequestPermission(0);if("motion"===e)return s._RequestPermission(1);throw new Error("invalid type")}}}{const e=self.C3,t="touch";e.Plugins.Touch.Instance=class extends e.SDKInstanceBase{constructor(s,i){super(s,t),this._touches=new Map,this._useMouseInput=!1,this._isMouseDown=!1,this._orientCompassHeading=0,this._orientAlpha=0,this._orientBeta=0,this._orientGamma=0,this._accX=0,this._accY=0,this._accZ=0,this._accWithGX=0,this._accWithGY=0,this._accWithGZ=0,this._triggerIndex=0,this._triggerId=0,this._triggerPermission=0,this._curTouchX=0,this._curTouchY=0,this._getTouchIndex=0,this._permissionPromises=[],i&&(this._useMouseInput=i[0]),this.AddDOMMessageHandler("permission-result",(e=>this._OnPermissionResult(e)));const r=this.GetRuntime().Dispatcher();this._disposables=new e.CompositeDisposable(e.Disposable.From(r,"pointerdown",(e=>this._OnPointerDown(e.data))),e.Disposable.From(r,"pointermove",(e=>this._OnPointerMove(e.data))),e.Disposable.From(r,"pointerup",(e=>this._OnPointerUp(e.data,!1))),e.Disposable.From(r,"pointercancel",(e=>this._OnPointerUp(e.data,!0))),e.Disposable.From(r,"deviceorientation",(e=>this._OnDeviceOrientation(e.data))),e.Disposable.From(r,"deviceorientationabsolute",(e=>this._OnDeviceOrientationAbsolute(e.data))),e.Disposable.From(r,"devicemotion",(e=>this._OnDeviceMotion(e.data))),e.Disposable.From(r,"tick2",(e=>this._OnTick2())))}Release(){this._touches.clear(),super.Release()}_OnPointerDown(t){if("mouse"===t.pointerType){if(!this._useMouseInput)return;this._isMouseDown=!0}const s=t.pointerId;if(this._touches.has(s))return;const i=t.pageX-this._runtime.GetCanvasClientX(),r=t.pageY-this._runtime.GetCanvasClientY(),n=performance.now(),a=this._touches.size;this._triggerIndex=a,this._triggerId=s;const o=e.New(e.Plugins.Touch.TouchInfo);o.Init(n,i,r,s,a),this._touches.set(s,o),this.Trigger(e.Plugins.Touch.Cnds.OnNthTouchStart),this.Trigger(e.Plugins.Touch.Cnds.OnTouchStart),this._curTouchX=i,this._curTouchY=r,this.Trigger(e.Plugins.Touch.Cnds.OnTouchObject)}_OnPointerMove(e){if("mouse"===e.pointerType&&!this._isMouseDown)return;const t=this._touches.get(e.pointerId);if(!t)return;const s=performance.now();if(s-t.GetTime()<2)return;const i=e.pageX-this._runtime.GetCanvasClientX(),r=e.pageY-this._runtime.GetCanvasClientY();t.Update(s,i,r,e.width,e.height,e.pressure)}_OnPointerUp(t,s){if("mouse"===t.pointerType){if(!this._isMouseDown)return;this._isMouseDown=!1}const i=performance.now(),r=t.pointerId,n=this._touches.get(r);if(n){if(this._triggerIndex=n.GetStartIndex(),this._triggerId=n.GetId(),this.Trigger(e.Plugins.Touch.Cnds.OnNthTouchEnd),this.Trigger(e.Plugins.Touch.Cnds.OnTouchEnd),!s){const t=n.ShouldTriggerTap(i);"single-tap"===t?(this.Trigger(e.Plugins.Touch.Cnds.OnTapGesture),this._curTouchX=n.GetX(),this._curTouchY=n.GetY(),this.Trigger(e.Plugins.Touch.Cnds.OnTapGestureObject)):"double-tap"===t&&(this.Trigger(e.Plugins.Touch.Cnds.OnDoubleTapGesture),this._curTouchX=n.GetX(),this._curTouchY=n.GetY(),this.Trigger(e.Plugins.Touch.Cnds.OnDoubleTapGestureObject))}n.Release(),this._touches.delete(r)}}_RequestPermission(e){return this._PostToDOMMaybeSync("request-permission",{type:e}),new Promise(((t,s)=>{this._permissionPromises.push({type:e,resolve:t,reject:s})}))}_OnPermissionResult(t){const s=t.result,i=t.type;this._triggerPermission=i;const r=this._permissionPromises.filter((e=>e.type===i));for(const e of r)e.resolve(s?"granted":"denied");this._permissionPromises=this._permissionPromises.filter((e=>e.type!==i)),s?(this.Trigger(e.Plugins.Touch.Cnds.OnPermissionGranted),0===i?this._runtime.RequestDeviceOrientationEvent():this._runtime.RequestDeviceMotionEvent()):this.Trigger(e.Plugins.Touch.Cnds.OnPermissionDenied)}_OnDeviceOrientation(e){"number"==typeof e.webkitCompassHeading?this._orientCompassHeading=e.webkitCompassHeading:e.absolute&&(this._orientCompassHeading=e.alpha),this._orientAlpha=e.alpha,this._orientBeta=e.beta,this._orientGamma=e.gamma}_OnDeviceOrientationAbsolute(e){this._orientCompassHeading=e.alpha}_OnDeviceMotion(e){const t=e.acceleration;t&&(this._accX=t.x,this._accY=t.y,this._accZ=t.z);const s=e.accelerationIncludingGravity;s&&(this._accWithGX=s.x,this._accWithGY=s.y,this._accWithGZ=s.z)}_OnTick2(){const t=performance.now();let s=0;for(const i of this._touches.values())i.GetTime()<=t-50&&i._SetLastTime(t),i.ShouldTriggerHold(t)&&(this._triggerIndex=i.GetStartIndex(),this._triggerId=i.GetId(),this._getTouchIndex=s,this.Trigger(e.Plugins.Touch.Cnds.OnHoldGesture),this._curTouchX=i.GetX(),this._curTouchY=i.GetY(),this.Trigger(e.Plugins.Touch.Cnds.OnHoldGestureObject),this._getTouchIndex=0),++s}_GetTouchByIndex(e){e=Math.floor(e);for(const t of this._touches.values()){if(0===e)return t;--e}return null}_IsClientPosOnCanvas(e,t){return e>=0&&t>=0&&e<this._runtime.GetCanvasCssWidth()&&t<this._runtime.GetCanvasCssHeight()}GetDebuggerProperties(){return[{title:"plugins.touch.debugger.touches",properties:[...this._touches.values()].map((e=>({name:"$"+e.GetId(),value:e.GetX()+", "+e.GetY()})))}]}}}{const e=self.C3,t=[];e.Plugins.Touch.Cnds={OnTouchStart:()=>!0,OnTouchEnd:()=>!0,IsInTouch(){return this._touches.size>0},OnTouchObject(e){return!!e&&(!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1))},IsTouchingObject(s){if(!s)return!1;const i=new Map,r=e=>{let t=i.get(e);return void 0===t&&(t=e.IsSelfAndParentsInteractive(),i.set(e,t)),t},n=s.GetCurrentSol(),a=n.GetInstances();for(const e of a){const s=e.GetWorldInfo(),i=s.GetLayer();if(r(i)&&s.IsInViewport2())for(const r of this._touches.values()){if(!this._IsClientPosOnCanvas(r.GetX(),r.GetY()))continue;const[n,a]=i.CanvasCssToLayer(r.GetX(),r.GetY(),s.GetTotalZElevation());if(s.ContainsPoint(n,a)){t.push(e);break}}}return i.clear(),!!t.length&&(n.SetArrayPicked(t),s.ApplySolToContainer(),e.clearArray(t),!0)},CompareTouchSpeed(t,s,i){const r=this._GetTouchByIndex(t);return!!r&&e.compare(r.GetSpeed(),s,i)},OrientationSupported:()=>!0,MotionSupported:()=>!0,CompareOrientation(t,s,i){this._runtime.RequestDeviceOrientationEvent();let r=0;return r=0===t?this._orientAlpha:1===t?this._orientBeta:this._orientGamma,e.compare(r,s,i)},CompareAcceleration(t,s,i){this._runtime.RequestDeviceMotionEvent();let r=0;return r=0===t?this._accWithGX:1===t?this._accWithGY:2===t?this._accWithGZ:3===t?this._accX:4===t?this._accY:this._accZ,e.compare(r,s,i)},OnNthTouchStart(e){return(e=Math.floor(e))===this._triggerIndex},OnNthTouchEnd(e){return(e=Math.floor(e))===this._triggerIndex},HasNthTouch(e){return e=Math.floor(e),this._touches.size>=e+1},OnHoldGesture:()=>!0,OnTapGesture:()=>!0,OnDoubleTapGesture:()=>!0,OnHoldGestureObject(e){return!!e&&(!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1))},OnTapGestureObject(e){return!!e&&(!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1))},OnDoubleTapGestureObject(e){return!!e&&(!!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY)&&this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(e,this._curTouchX,this._curTouchY,!1))},OnPermissionGranted(e){return this._triggerPermission===e},OnPermissionDenied(e){return this._triggerPermission===e}}}{const e=self.C3;e.Plugins.Touch.Acts={RequestPermission(e){this._RequestPermission(e)}}}{const e=self.C3;e.Plugins.Touch.Exps={TouchCount(){return this._touches.size},X(e){const t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!0):0},Y(e){const t=this._GetTouchByIndex(this._getTouchIndex);return t?t.GetPositionForLayer(this._runtime.GetCurrentLayout(),e,!1):0},XAt(e,t){const s=this._GetTouchByIndex(e);return s?s.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YAt(e,t){const s=this._GetTouchByIndex(e);return s?s.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},XForID(e,t){const s=this._touches.get(e);return s?s.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!0):0},YForID(e,t){const s=this._touches.get(e);return s?s.GetPositionForLayer(this._runtime.GetCurrentLayout(),t,!1):0},AbsoluteX(){const e=this._GetTouchByIndex(0);return e?e.GetX():0},AbsoluteY(){const e=this._GetTouchByIndex(0);return e?e.GetY():0},AbsoluteXAt(e){const t=this._GetTouchByIndex(e);return t?t.GetX():0},AbsoluteYAt(e){const t=this._GetTouchByIndex(e);return t?t.GetY():0},AbsoluteXForID(e){const t=this._touches.get(e);return t?t.GetX():0},AbsoluteYForID(e){const t=this._touches.get(e);return t?t.GetY():0},SpeedAt(e){const t=this._GetTouchByIndex(e);return t?t.GetSpeed():0},SpeedForID(e){const t=this._touches.get(e);return t?t.GetSpeed():0},AngleAt(t){const s=this._GetTouchByIndex(t);return s?e.toDegrees(s.GetAngle()):0},AngleForID(t){const s=this._touches.get(t);return s?e.toDegrees(s.GetAngle()):0},CompassHeading(){return this._runtime.RequestDeviceOrientationEvent(),this._orientCompassHeading},Alpha(){return this._runtime.RequestDeviceOrientationEvent(),this._orientAlpha},Beta(){return this._runtime.RequestDeviceOrientationEvent(),this._orientBeta},Gamma(){return this._runtime.RequestDeviceOrientationEvent(),this._orientGamma},AccelerationXWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGX},AccelerationYWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGY},AccelerationZWithG(){return this._runtime.RequestDeviceMotionEvent(),this._accWithGZ},AccelerationX(){return this._runtime.RequestDeviceMotionEvent(),this._accX},AccelerationY(){return this._runtime.RequestDeviceMotionEvent(),this._accY},AccelerationZ(){return this._runtime.RequestDeviceMotionEvent(),this._accZ},TouchIndex(){return this._triggerIndex},TouchID(){return this._triggerId},WidthForID(e){const t=this._touches.get(e);return t?t.GetWidth():0},HeightForID(e){const t=this._touches.get(e);return t?t.GetHeight():0},PressureForID(e){const t=this._touches.get(e);return t?t.GetPressure():0}}}{const e=self.C3,t=15,s=500,i=333,r=25;let n=-1e3,a=-1e3,o=-1e4;e.Plugins.Touch.TouchInfo=class extends e.DefendedBase{constructor(){super(),this._pointerId=0,this._startIndex=0,this._startTime=0,this._time=0,this._lastTime=0,this._startX=0,this._startY=0,this._x=0,this._y=0,this._lastX=0,this._lastY=0,this._width=0,this._height=0,this._pressure=0,this._hasTriggeredHold=!1,this._isTooFarForHold=!1}Release(){}Init(e,t,s,i,r){this._pointerId=i,this._startIndex=r,this._time=e,this._lastTime=e,this._startTime=e,this._startX=t,this._startY=s,this._x=t,this._y=s,this._lastX=t,this._lastY=s}Update(s,i,r,n,a,o){this._lastTime=this._time,this._time=s,this._lastX=this._x,this._lastY=this._y,this._x=i,this._y=r,this._width=n,this._height=a,this._pressure=o,!this._isTooFarForHold&&e.distanceTo(this._startX,this._startY,this._x,this._y)>=t&&(this._isTooFarForHold=!0)}GetId(){return this._pointerId}GetStartIndex(){return this._startIndex}GetTime(){return this._time}_SetLastTime(e){this._lastTime=e}GetX(){return this._x}GetY(){return this._y}GetSpeed(){const t=e.distanceTo(this._x,this._y,this._lastX,this._lastY),s=(this._time-this._lastTime)/1e3;return s>0?t/s:0}GetAngle(){return e.angleTo(this._lastX,this._lastY,this._x,this._y)}GetWidth(){return this._width}GetHeight(){return this._height}GetPressure(){return this._pressure}ShouldTriggerHold(i){return!this._hasTriggeredHold&&(i-this._startTime>=s&&!this._isTooFarForHold&&e.distanceTo(this._startX,this._startY,this._x,this._y)<t&&(this._hasTriggeredHold=!0,!0))}ShouldTriggerTap(s){return this._hasTriggeredHold?"":s-this._startTime<=i&&!this._isTooFarForHold&&e.distanceTo(this._startX,this._startY,this._x,this._y)<t?s-o<=2*i&&e.distanceTo(n,a,this._x,this._y)<r?(n=-1e3,a=-1e3,o=-1e4,"double-tap"):(n=this._x,a=this._y,o=s,"single-tap"):""}GetPositionForLayer(e,t,s){if(void 0===t){return e.GetLayerByIndex(0).CanvasCssToLayer_DefaultTransform(this._x,this._y)[s?0:1]}{const i=e.GetLayer(t);return i?i.CanvasCssToLayer(this._x,this._y)[s?0:1]:0}}}}{const e=self.C3;e.Plugins.PlatformInfo=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.PlatformInfo.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t="platform-info";e.Plugins.PlatformInfo.Instance=class extends e.SDKInstanceBase{constructor(e,s){super(e,t),this._screenWidth=0,this._screenHeight=0,this._windowOuterWidth=0,this._windowOuterHeight=0,this._safeAreaInset=[0,0,0,0],this._supportsWakeLock=!1,this._isWakeLockActive=!1,this._isNwjs=!1,this.AddDOMMessageHandlers([["window-resize",e=>this._OnWindowResize(e)],["wake-lock-acquired",e=>this._OnWakeLockAcquired(e)],["wake-lock-error",e=>this._OnWakeLockError(e)],["wake-lock-released",e=>this._OnWakeLockReleased(e)]]),navigator.connection&&navigator.connection.addEventListener("change",(()=>this._OnNetworkChange())),this._runtime.AddLoadPromise(this.PostToDOMAsync("get-initial-state").then((e=>{this._screenWidth=e.screenWidth,this._screenHeight=e.screenHeight,this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._safeAreaInset=e.safeAreaInset,this._supportsWakeLock=e.supportsWakeLock,this._isNwjs=e.isNwjs})))}Release(){super.Release()}_OnWindowResize(e){this._windowOuterWidth=e.windowOuterWidth,this._windowOuterHeight=e.windowOuterHeight,this._safeAreaInset=e.safeAreaInset}async _OnNetworkChange(){await this.TriggerAsync(e.Plugins.PlatformInfo.Cnds.OnNetworkChange)}async _OnWakeLockAcquired(){this._isWakeLockActive=!0,await this.TriggerAsync(e.Plugins.PlatformInfo.Cnds.OnWakeLockAcquired)}async _OnWakeLockError(){this._isWakeLockActive=!1,await this.TriggerAsync(e.Plugins.PlatformInfo.Cnds.OnWakeLockError)}async _OnWakeLockReleased(){this._isWakeLockActive=!1,await this.TriggerAsync(e.Plugins.PlatformInfo.Cnds.OnWakeLockReleased)}}}{const e=self.C3;e.Plugins.PlatformInfo.Cnds={IsOnMobile:()=>e.Platform.IsMobile,IsOnWindows:()=>"Windows"===e.Platform.OS,IsOnMacOS:()=>"macOS"===e.Platform.OS,IsOnLinux:()=>"Linux"===e.Platform.OS,IsOnChromeOS:()=>"Chrome OS"===e.Platform.OS,IsOnAndroid:()=>"Android"===e.Platform.OS,IsOniOS:()=>"iOS"===e.Platform.OS,IsWebExport(){const e=this._runtime.GetExportType();return"html5"===e||"scirra-arcade"===e||"preview"===e||"instant-games"===e},IsCordovaExport(){return this._runtime.IsCordova()},IsNWjsExport(){return"nwjs"===this._runtime.GetExportType()||this._isNwjs},IsWindowsUWPExport(){return"windows-uwp"===this._runtime.GetExportType()},IsWindowsWebView2Export(){return"windows-webview2"===this._runtime.GetExportType()},IsMacOSWKWebView2Export(){return"macos-wkwebview"===this._runtime.GetExportType()},OnNetworkChange:()=>!0,OnWakeLockAcquired:()=>!0,OnWakeLockError:()=>!0,OnWakeLockReleased:()=>!0,IsWakeLockActive(){return this._isWakeLockActive},IsWakeLockSupported(){return this._supportsWakeLock}}}{const e=self.C3;e.Plugins.PlatformInfo.Acts={RequestWakeLock(){this._supportsWakeLock&&this._PostToDOMMaybeSync("request-wake-lock")},ReleaseWakeLock(){this._supportsWakeLock&&(this._isWakeLockActive=!1,this.PostToDOM("release-wake-lock"))}}}{const e=self.C3;e.Plugins.PlatformInfo.Exps={Renderer(){let e="";return e=this._runtime.GetWebGPURenderer()?"webgpu":"webgl"+this._runtime.GetWebGLRenderer().GetWebGLVersionNumber(),this._runtime.GetRenderer().HasMajorPerformanceCaveat()&&(e+="-software"),e},RendererDetail(){return this._runtime.GetWebGLRenderer().GetUnmaskedRenderer()},DevicePixelRatio:()=>self.devicePixelRatio,ScreenWidth(){return this._screenWidth},ScreenHeight(){return this._screenHeight},WindowInnerWidth(){return this._runtime.GetCanvasManager().GetLastWidth()},WindowInnerHeight(){return this._runtime.GetCanvasManager().GetLastHeight()},WindowOuterWidth(){return this._windowOuterWidth},WindowOuterHeight(){return this._windowOuterHeight},CanvasCssWidth(){return this._runtime.GetCanvasManager().GetCssWidth()},CanvasCssHeight(){return this._runtime.GetCanvasManager().GetCssHeight()},CanvasDeviceWidth(){return this._runtime.GetCanvasManager().GetDeviceWidth()},CanvasDeviceHeight(){return this._runtime.GetCanvasManager().GetDeviceHeight()},Downlink:()=>navigator.connection&&navigator.connection.downlink||0,DownlinkMax:()=>navigator.connection&&navigator.connection.downlinkMax||0,ConnectionType:()=>navigator.connection&&navigator.connection.type||"unknown",ConnectionEffectiveType:()=>navigator.connection&&navigator.connection.effectiveType||"unknown",ConnectionRTT:()=>navigator.connection&&navigator.connection.rtt||0,HardwareConcurrency:()=>navigator.hardwareConcurrency||0,DeviceMemory:()=>navigator.deviceMemory||0,SafeAreaInsetTop(){return this._safeAreaInset[0]},SafeAreaInsetRight(){return this._safeAreaInset[1]},SafeAreaInsetBottom(){return this._safeAreaInset[2]},SafeAreaInsetLeft(){return this._safeAreaInset[3]}}}{const e=self.C3;e.Plugins.Particles=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Particles.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling()})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}}}{const e=self.C3,t=self.C3X,s=0,i=1,r=2,n=3,a=4,o=5,h=6,l=7,c=8,u=9,_=10,d=11,p=12,f=13,m=14,g=15,S=16,y=17,G=18,I=19,T=20,b=0,C=1,P=e.New(e.Rect);e.Plugins.Particles.Instance=class extends e.SDKWorldInstanceBase{constructor(t,b){super(t),this._isFirstTick=!0;const C=e.New(self.ParticleEngine);this._particleEngine=C,C.ononeshotfinish=()=>this._OnOneShotFinish(),this._spawnObjectClass=null,this._particleUpdateCallback=(e,t,s,i,r,n)=>this._OnParticleUpdate(e,t,s,i,r,n),this._particleDestroyCallback=e=>this._OnParticleDestroy(e),this._hasAnyDefaultParticle=!0;let P=!0;b&&(C.SetRate(b[s]),C.SetSprayCone(e.toRadians(b[i])),C.SetSprayType(b[r]?"one-shot":"continuous-spray"),this._SetParticleObjectClass(this._runtime.GetObjectClassBySID(b[n])),P=b[a],C.SetInitSpeed(b[o]),C.SetInitSize(b[h]),C.SetInitOpacity(b[l]/100),C.SetGrowRate(b[c]),C.SetInitXRandom(b[u]),C.SetInitYRandom(b[_]),C.SetInitSpeedRandom(b[d]),C.SetInitSizeRandom(b[p]),C.SetGrowRandom(b[f]),C.SetAcceleration(b[m]),C.SetGravity(b[g]),C.SetLifeAngleRandom(b[S]),C.SetLifeSpeedRandom(b[y]),C.SetLifeOpacityRandom(b[G]),C.SetDestroyModeIndex(b[I]),C.SetTimeout(b[T])),this._UpdateEngineParameters(),this._spawnObjectClass&&(this._hasAnyDefaultParticle=!1),"one-shot"===C.GetSprayType()?C.CreateOneShotSpray():C.SetSpraying(!0);const v=this.GetWorldInfo();v.SetVisible(P),v.SetBboxChangeEventEnabled(!0),this._inst.Dispatcher().addEventListener("bboxchange",(()=>{v.OverwriteBoundingBox(this._particleEngine.GetBoundingBox())})),this.GetRuntime().GetRenderer().IsWebGPU()&&v.SetUsePointsShaderProgram(),this._afterLoad=e=>this._OnAfterLoad(e),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad),this._StartTicking()}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._particleEngine.Release(),this._particleEngine=null,this._particleUpdateCallback=null,this._particleDestroyCallback=null,super.Release()}GetParticleEngine(){return this._particleEngine}_SetRate(e){this._particleEngine.SetRate(e),"one-shot"===this._particleEngine.GetSprayType()&&this._isFirstTick&&this._particleEngine.SetParticleCount(e)}_SetParticleObjectClass(e){e===this.GetObjectClass()&&(e=null),e!==this._spawnObjectClass&&(this._spawnObjectClass=e,this._particleEngine.onparticlecreate=e?e=>this._OnParticleCreate(e):null,this._spawnObjectClass||(this._hasAnyDefaultParticle=!0))}_UpdateEngineParameters(){const e=this._particleEngine,t=this.GetWorldInfo();e.SetMasterOpacity(t.GetOpacity()),e.SetPixelRounding(this._runtime.IsPixelRoundingEnabled()),e.SetSpawnX(t.GetX()),e.SetSpawnY(t.GetY()),e.SetSpawnAngle(t.GetAngle()),e.SetInitSizeScale(Math.abs(t.GetSceneGraphScale()))}_OnOneShotFinish(){this._runtime.DestroyInstance(this._inst)}Draw(e){if(!this._hasAnyDefaultParticle)return;const t=this._objectClass.GetImageInfo(),s=t.GetTexture();if(!s)return;const i=this.GetWorldInfo(),r=i.GetLayer(),n=P;this._runtime.GetCanvasManager().IsPastingToDrawingCanvas()?n.set(-1/0,-1/0,1/0,1/0):r.Has3DCamera()?r.CalculateViewport3D(i.GetTotalZElevation(),n):r.GetViewportForZ(i.GetTotalZElevation(),n),e.SetTexture(s);const a=r.Get2DScaleFactorToZ(i.GetTotalZElevation());this._particleEngine.SetParticleScale(r.GetRenderScale()*a),this._particleEngine.Draw(e,t.GetTexRect(),n,r.Has3DCamera())}SaveToJson(){const e=this._particleEngine;return{r:e.GetRate(),sc:e.GetSprayCone(),st:e.GetSprayType(),isp:e.GetInitSpeed(),isz:e.GetInitSize(),io:e.GetInitOpacity(),gr:e.GetGrowRate(),xr:e.GetInitXRandom(),yr:e.GetInitYRandom(),spr:e.GetInitSpeedRandom(),szr:e.GetInitSizeRandom(),grnd:e.GetGrowRandom(),acc:e.GetAcceleration(),g:e.GetGravity(),lar:e.GetLifeAngleRandom(),lsr:e.GetLifeSpeedRandom(),lor:e.GetLifeOpacityRandom(),dm:e.GetDestroyModeIndex(),to:e.GetTimeout(),s:e.IsSpraying(),pcc:e._GetCreateCounter(),ft:this._isFirstTick,soc:this._spawnObjectClass?this._spawnObjectClass.GetSID():null,p:e.GetParticles().map((e=>e.toJSON()))}}LoadFromJson(e,t){const s=this._particleEngine;if(s.SetRate(e.r),s.SetSprayCone(e.sc),s.SetSprayType(e.st),s.SetInitSpeed(e.isp),s.SetInitSize(e.isz),s.SetInitOpacity(e.io),s.SetGrowRate(e.gr),s.SetInitXRandom(e.xr),s.SetInitYRandom(e.yr),s.SetInitSpeedRandom(e.spr),s.SetInitSizeRandom(e.szr),s.SetGrowRandom(e.grnd),s.SetAcceleration(e.acc),s.SetGravity(e.g),s.SetLifeAngleRandom(e.lar),s.SetLifeSpeedRandom(e.lsr),s.SetLifeOpacityRandom(e.lor),s.SetDestroyModeIndex(e.dm),s.SetTimeout(e.to),s.SetSpraying(e.s),s._SetCreateCounter(e.pcc),this._isFirstTick=e.ft,e.hasOwnProperty("soc")){const t=this.GetRuntime().GetObjectClassBySID(e.soc);t&&this._SetParticleObjectClass(t)}const i=e.p;s.SetParticleCount(i.length);const r=s.GetParticles();for(let e=0,t=r.length;e<t;++e)r[e].setFromJSON(i[e]);"state"===t&&this._spawnObjectClass&&(s.UpdateAllParticlesUserData(),s.ApplyParticleDataToUserData(this))}_OnAfterLoad(){const e=this._particleEngine;if(e.UpdateAllParticlesUserData(),e.ApplyParticleDataToUserData(this),"one-shot"!==e.GetSprayType())return;const t=e.GetParticles();for(let e=0,s=t.length;e<s;++e){const s=t[e],i=s.GetUserData();if(!i)continue;const r=i.GetWorldInfo();if(!r)continue;const n=r.GetInstance();if(!n)continue;const a=s.GetUserDataUID(),o=n.GetUID();if("number"==typeof a&&"number"==typeof o&&a===o)continue;const h=this.GetRuntime(),l=h.GetInstanceByUID(a);l&&h.DestroyInstance(l)}}Tick(){const e=this._runtime.GetDt(this._inst);this._UpdateEngineParameters(),this._isFirstTick&&"one-shot"===this._particleEngine.GetSprayType()&&this._particleEngine.ReInitAllParticles(),this._particleEngine.Tick(e),this._particleEngine.IsSpraying()&&this._runtime.UpdateRender(),this.GetWorldInfo().SetBboxChanged(),this._isFirstTick=!1}_FastForward(e){const t=1/60;for(this._isFirstTick&&"one-shot"===this._particleEngine.GetSprayType()&&this._particleEngine.ReInitAllParticles();e>0;)this._particleEngine.Tick(t),e-=t;this._particleEngine.IsSpraying()&&this._runtime.UpdateRender(),this.GetWorldInfo().SetBboxChanged(),this._isFirstTick=!1}_OnParticleCreate(e){const t=this._runtime.CreateInstance(this._spawnObjectClass,this.GetWorldInfo().GetLayer(),e.GetX(),e.GetY()),s=t.GetWorldInfo();return s.SetSize(e.GetSize(),e.GetSize()),s.SetAngle(e.GetAngle()),s.SetOpacity(e.GetOpacity()),s.SetUnpremultipliedColor(this.GetWorldInfo().GetUnpremultipliedColor()),s.SetBboxChanged(),s.ZOrderMoveAdjacentToInstance(this.GetInstance(),!0),t._TriggerOnCreated(),e.SetUpdateCallback(this._particleUpdateCallback),e.SetDestroyCallback(this._particleDestroyCallback),t}_OnParticleUpdate(e,t,s,i,r,n){if(e.IsDestroyed())return;const a=e.GetWorldInfo();a.OffsetXY(t,s),a.SetSize(a.GetWidth()+i,a.GetHeight()+i),a.SetAngle(a.GetAngle()+r),a.SetOpacity(a.GetOpacity()+n),a.SetBboxChanged()}_OnParticleDestroy(e){e.IsDestroyed()||this._runtime.DestroyInstance(e)}GetPropertyValueByIndex(t){const n=this._particleEngine;switch(t){case s:return n.GetRate();case i:return e.toDegrees(n.GetSprayCone());case r:return"one-shot"===n.GetSprayType()?C:b;case o:return n.GetInitSpeed();case h:return n.GetInitSize();case l:return 100*n.GetInitOpacity();case c:return n.GetGrowRate();case u:return n.GetInitXRandom();case _:return n.GetInitYRandom();case d:return n.GetInitSpeedRandom();case p:return n.GetInitSizeRandom();case f:return n.GetGrowRandom();case m:return n.GetAcceleration();case g:return n.GetGravity();case S:return n.GetLifeAngleRandom();case y:return n.GetLifeSpeedRandom();case G:return n.GetLifeOpacityRandom();case I:return n.GetDestroyModeIndex();case T:return n.GetTimeout()}}SetPropertyValueByIndex(t,n){const a=this._particleEngine;switch(t){case s:a.SetRate(n);break;case i:a.SetSprayCone(e.toRadians(n));break;case r:a.SetSprayType(n?"one-shot":"continuous-spray");break;case o:a.SetInitSpeed(n);break;case h:a.SetInitSize(n);break;case l:a.SetInitOpacity(n/100);break;case c:a.SetGrowRate(n);break;case u:a.SetInitXRandom(n);break;case _:a.SetInitYRandom(n);break;case d:a.SetInitSpeedRandom(n);break;case p:a.SetInitSizeRandom(n);break;case f:a.SetGrowRandom(n);break;case m:a.SetAcceleration(n);break;case g:a.SetGravity(n);break;case S:a.SetLifeAngleRandom(n);break;case y:a.SetLifeSpeedRandom(n);break;case G:a.SetLifeOpacityRandom(n);break;case I:a.SetDestroyModeIndex(n);break;case T:a.SetTimeout(n);break}}GetDebuggerProperties(){const t="plugins.particles",s=t+".properties",i=t+".debugger",r=this._particleEngine;return[{title:t+".name",properties:[{name:i+".particle-count",value:r.GetParticleCount()},{name:s+".type.name",value:[s+".type.items."+r.GetSprayType()]},{name:i+".is-spraying",value:r.IsSpraying(),onedit:e=>r.SetSpraying(e)},{name:s+".rate.name",value:r.GetRate(),onedit:e=>r.SetRate(e)},{name:s+".spray-cone.name",value:e.toDegrees(r.GetSprayCone()),onedit:t=>r.SetSprayCone(e.toRadians(t))},{name:s+".speed.name",value:r.GetInitSpeed(),onedit:e=>r.SetInitSpeed(e)},{name:s+".size.name",value:r.GetInitSize(),onedit:e=>r.SetInitSize(e)},{name:s+".opacity.name",value:r.GetInitOpacity(),onedit:e=>r.SetInitOpacity(e)},{name:s+".grow-rate.name",value:r.GetGrowRate(),onedit:e=>r.SetGrowRate(e)},{name:s+".x-randomiser.name",value:r.GetInitXRandom(),onedit:e=>r.SetInitXRandom(e)},{name:s+".y-randomiser.name",value:r.GetInitYRandom(),onedit:e=>r.SetInitYRandom(e)},{name:s+".initial-speed-randomiser.name",value:r.GetInitSpeedRandom(),onedit:e=>r.SetInitSpeedRandom(e)},{name:s+".size-randomiser.name",value:r.GetInitSizeRandom(),onedit:e=>r.SetInitSizeRandom(e)},{name:s+".grow-rate-randomiser.name",value:r.GetGrowRandom(),onedit:e=>r.SetGrowRandom(e)},{name:s+".acceleration.name",value:r.GetAcceleration(),onedit:e=>r.SetAcceleration(e)},{name:s+".gravity.name",value:r.GetGravity(),onedit:e=>r.SetGravity(e)},{name:s+".angle-randomiser.name",value:r.GetLifeAngleRandom(),onedit:e=>r.SetLifeAngleRandom(e)},{name:s+".life-speed-randomiser.name",value:r.GetLifeSpeedRandom(),onedit:e=>r.SetLifeSpeedRandom(e)},{name:s+".opacity-randomiser.name",value:r.GetLifeOpacityRandom(),onedit:e=>r.SetLifeOpacityRandom(e)},{name:s+".timeout.name",value:r.GetTimeout(),onedit:e=>r.SetTimeout(e)}]}]}GetScriptInterfaceClass(){return self.IParticlesInstance}};const v=new WeakMap;function GetParticleEngine(e){return v.get(e).GetParticleEngine()}self.IParticlesInstance=class extends self.IWorldInstance{constructor(){super(),v.set(this,self.IInstance._GetInitInst().GetSdkInstance())}set isSpraying(e){GetParticleEngine(this).SetSpraying(!!e)}get isSpraying(){return GetParticleEngine(this).IsSpraying()}set rate(e){t.RequireFiniteNumber(e),v.get(this)._SetRate(e)}get rate(){return GetParticleEngine(this).GetRate()}set sprayCone(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetSprayCone(e)}get sprayCone(){return GetParticleEngine(this).GetSprayCone()}set initSpeed(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetInitSpeed(e)}get initSpeed(){return GetParticleEngine(this).GetInitSpeed()}set initSize(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetInitSize(e)}get initSize(){return GetParticleEngine(this).GetInitSize()}set initOpacity(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetInitOpacity(e)}get initOpacity(){return GetParticleEngine(this).GetInitOpacity()}set initXRandom(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetInitXRandom(e)}get initXRandom(){return GetParticleEngine(this).GetInitXRandom()}set initYRandom(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetInitYRandom(e)}get initYRandom(){return GetParticleEngine(this).GetInitYRandom()}set initSpeedRandom(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetInitSpeedRandom(e)}get initSpeedRandom(){return GetParticleEngine(this).GetInitSpeedRandom()}set initSizeRandom(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetInitSizeRandom(e)}get initSizeRandom(){return GetParticleEngine(this).GetInitSizeRandom()}set initGrowRate(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetGrowRate(e)}get initGrowRate(){return GetParticleEngine(this).GetGrowRate()}set initGrowRandom(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetGrowRandom(e)}get initGrowRandom(){return GetParticleEngine(this).GetGrowRandom()}set acceleration(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetAcceleration(e)}get acceleration(){return GetParticleEngine(this).GetAcceleration()}set gravity(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetGravity(e)}get gravity(){return GetParticleEngine(this).GetGravity()}set lifeAngleRandom(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetLifeAngleRandom(e)}get lifeAngleRandom(){return GetParticleEngine(this).GetLifeAngleRandom()}set lifeSpeedRandom(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetLifeSpeedRandom(e)}get lifeSpeedRandom(){return GetParticleEngine(this).GetLifeSpeedRandom()}set lifeOpacityRandom(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetLifeOpacityRandom(e)}get lifeOpacityRandom(){return GetParticleEngine(this).GetLifeOpacityRandom()}set timeout(e){t.RequireFiniteNumber(e),GetParticleEngine(this).SetTimeout(e)}get timeout(){return GetParticleEngine(this).GetTimeout()}fastForward(e){t.RequireFiniteNumber(e),v.get(this)._FastForward(e)}setParticleObjectClass(e){const t=v.get(this);e?t._SetParticleObjectClass(t.GetRuntime()._UnwrapIObjectClass(e)):t._SetParticleObjectClass(null)}}}{const e=self.C3;e.Plugins.Particles.Cnds={IsSpraying(){return this._particleEngine.IsSpraying()}}}{const e=self.C3;e.Plugins.Particles.Acts={SetSpraying(e){this._particleEngine.SetSpraying(0!==e)},SetRate(e){this._SetRate(e)},SetParticleObject(e){this._SetParticleObjectClass(e)},UnsetParticleObject(){this._SetParticleObjectClass(null)},SetSprayCone(t){this._particleEngine.SetSprayCone(e.toRadians(t))},SetInitSpeed(e){this._particleEngine.SetInitSpeed(e)},SetInitSize(e){this._particleEngine.SetInitSize(e)},SetInitOpacity(e){this._particleEngine.SetInitOpacity(e/100)},SetGrowRate(e){this._particleEngine.SetGrowRate(e)},SetXRandomiser(e){this._particleEngine.SetInitXRandom(e)},SetYRandomiser(e){this._particleEngine.SetInitYRandom(e)},SetSpeedRandomiser(e){this._particleEngine.SetInitSpeedRandom(e)},SetSizeRandomiser(e){this._particleEngine.SetInitSizeRandom(e)},SetGrowRateRandomiser(e){this._particleEngine.SetGrowRandom(e)},SetParticleAcc(e){this._particleEngine.SetAcceleration(e)},SetGravity(e){this._particleEngine.SetGravity(e)},SetAngleRandomiser(e){this._particleEngine.SetLifeAngleRandom(e)},SetLifeSpeedRandomiser(e){this._particleEngine.SetLifeSpeedRandom(e)},SetOpacityRandomiser(e){this._particleEngine.SetLifeOpacityRandom(e)},SetTimeout(e){this._particleEngine.SetTimeout(e)},FastForward(e){this._FastForward(e)},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()}}}{const e=self.C3;e.Plugins.Particles.Exps={ParticleCount(){return this._particleEngine.GetParticleCount()},Rate(){return this._particleEngine.GetRate()},SprayCone(){return e.toDegrees(this._particleEngine.GetSprayCone())},InitSpeed(){return this._particleEngine.GetInitSpeed()},InitSize(){return this._particleEngine.GetInitSize()},InitOpacity(){return 100*this._particleEngine.GetInitOpacity()},InitGrowRate(){return this._particleEngine.GetGrowRate()},XRandom(){return this._particleEngine.GetInitXRandom()},YRandom(){return this._particleEngine.GetInitYRandom()},InitSizeRandom(){return this._particleEngine.GetInitSizeRandom()},InitSpeedRandom(){return this._particleEngine.GetInitSpeedRandom()},InitGrowRandom(){return this._particleEngine.GetGrowRandom()},ParticleAcceleration(){return this._particleEngine.GetAcceleration()},Gravity(){return this._particleEngine.GetGravity()},ParticleAngleRandom(){return this._particleEngine.GetLifeAngleRandom()},ParticleSpeedRandom(){return this._particleEngine.GetLifeSpeedRandom()},ParticleOpacityRandom(){return this._particleEngine.GetLifeOpacityRandom()},Timeout(){return this._particleEngine.GetTimeout()}}}{const e=self.C3,t=[],s=1e3,i=new Set(["continuous-spray","one-shot"]),r=["fade-to-invisible","timeout-expired","particle-stopped"];self.ParticleEngine=class{constructor(){this._rate=0,this._sprayCone=0,this._sprayType="continuous-spray",this._isSpraying=!1,this._masterOpacity=0,this._isPixelRounding=!1,this._spawnX=0,this._spawnY=0,this._spawnAngle=0,this._initSpeed=0,this._initSize=0,this._initSizeScale=1,this._initOpacity=0,this._growRate=0,this._xRandom=0,this._yRandom=0,this._initSpeedRandom=0,this._initSizeRandom=0,this._growRandom=0,this._acceleration=0,this._gravity=0,this._lifeAngleRandom=0,this._lifeSpeedRandom=0,this._lifeOpacityRandom=0,this._destroyMode=0,this._timeout=0,this._createCounter=0,this._particleScale=1,this.ononeshotfinish=null,this.onparticlecreate=null,this._particles=[],this._boundingBox=new e.Rect,this._color=new e.Color}Release(){this.Cancel(),e.clearArray(this._particles),this._particles=null,this.ononeshotfinish=null,this.onparticlecreate=null,this._boundingBox=null,this._color=null}Cancel(){const i=this._particles;for(let e=0,t=i.length;e<t;++e)i[e].Destroy();e.appendArray(t,i),e.clearArray(i),t.length>s&&e.truncateArray(t,s),this._isSpraying=!1}CreateOneShotSpray(){for(let e=0,t=this._rate;e<t;++e)this._CreateParticle();this._particles.length&&(this._isSpraying=!0)}_CreateParticle(){let s=null;return t.length?(s=t.pop(),s.SetEngine(this)):s=e.New(self.Particle,this),this._particles.push(s),s.Init(this.onparticlecreate),s}ReInitAllParticles(){const e=this._particles,t=this.onparticlecreate;for(let s=0,i=e.length;s<i;++s)e[s].Init(t)}UpdateAllParticlesUserData(){const e=this._particles,t=this.onparticlecreate;for(let s=0,i=e.length;s<i;++s)e[s].UpdateUserData(t)}ApplyParticleDataToUserData(e){const t=this._particles;for(let s=0,i=t.length;s<i;++s){const i=t[s],r=i.GetUserData();if(r){const t=r.GetWorldInfo();t.SetX(i.GetX()),t.SetY(i.GetY()),t.SetSize(i.GetSize(),i.GetSize()),t.SetOpacity(i.GetOpacity()),t.SetAngle(i.GetAngle()),t.SetUnpremultipliedColor(e.GetWorldInfo().GetUnpremultipliedColor()),t.SetBboxChanged()}}}SetParticleCount(i){const r=this._particles;if(i<r.length){const n=r.length-i;for(let e=0;e<n;++e){const e=r.pop();e.Destroy(),t.push(e)}t.length>s&&e.truncateArray(t,s)}else if(i>r.length){const e=i-r.length;for(let t=0;t<e;++t)this._CreateParticle()}}GetParticles(){return this._particles}GetParticleCount(){return this._particles.length}Tick(e){this._SpawnContinuous(e),this._TickParticles(e),this._MaybeFinishOneShot()}_SpawnContinuous(e){if("continuous-spray"===this._sprayType&&this._isSpraying){this._createCounter+=e*this._rate;const t=Math.floor(this._createCounter);this._createCounter-=t;for(let e=0;e<t;++e)this._CreateParticle()}}_SetCreateCounter(e){this._createCounter=e}_GetCreateCounter(){return this._createCounter}_TickParticles(i){const r=this._boundingBox;r.set(this._spawnX,this._spawnY,this._spawnX,this._spawnY);const n=this._particles;let a=0;for(let e=0,s=n.length;e<s;++e){const s=n[e];n[a]=s,s.Tick(i),s.IsActive()?(++a,r.expandToContain(s.GetBoundingBox())):(s.Destroy(),t.push(s))}e.truncateArray(n,a),t.length>s&&e.truncateArray(t,s)}_MaybeFinishOneShot(){"one-shot"===this._sprayType&&0===this._particles.length&&this._isSpraying&&(this.ononeshotfinish&&this.ononeshotfinish(),this._isSpraying=!1)}Draw(e,t,s,i){e.StartRenderingPoints(t),this._color.copy(e.GetColor());const r=this._particles;for(let n=0,a=r.length;n<a;++n){const a=r[n];s.intersectsRect(a.GetBoundingBox())&&a.Draw(e,t,i)}e.FinishRenderingPoints()}GetColor(){return this._color}SetRate(e){this._rate=+e}GetRate(){return this._rate}SetSprayCone(e){this._sprayCone=+e}GetSprayCone(){return this._sprayCone}SetSprayType(e){if(!i.has(e))throw new Error("invalid spray type");this._sprayType=e}GetSprayType(){return this._sprayType}SetSpraying(e){this._isSpraying=!!e}IsSpraying(){return this._isSpraying}SetMasterOpacity(e){this._masterOpacity=+e}GetMasterOpacity(){return this._masterOpacity}SetPixelRounding(e){this._isPixelRounding=!!e}IsPixelRounding(){return this._isPixelRounding}SetSpawnX(e){this._spawnX=+e}GetSpawnX(){return this._spawnX}SetSpawnY(e){this._spawnY=+e}GetSpawnY(){return this._spawnY}SetSpawnAngle(e){this._spawnAngle=+e}GetInitAngle(){return this._spawnAngle}SetInitSpeed(e){this._initSpeed=+e}GetInitSpeed(){return this._initSpeed}SetInitSize(e){this._initSize=+e}GetInitSize(){return this._initSize}SetInitSizeScale(e){this._initSizeScale=+e}GetInitSizeScale(){return this._initSizeScale}SetInitOpacity(e){this._initOpacity=+e}GetInitOpacity(){return this._initOpacity}SetGrowRate(e){this._growRate=+e}GetGrowRate(){return this._growRate}SetInitXRandom(e){this._xRandom=+e}GetInitXRandom(){return this._xRandom}SetInitYRandom(e){this._yRandom=+e}GetInitYRandom(){return this._yRandom}SetInitSpeedRandom(e){this._initSpeedRandom=+e}GetInitSpeedRandom(){return this._initSpeedRandom}SetInitSizeRandom(e){this._initSizeRandom=+e}GetInitSizeRandom(){return this._initSizeRandom}SetGrowRandom(e){this._growRandom=+e}GetGrowRandom(){return this._growRandom}SetAcceleration(e){this._acceleration=+e}GetAcceleration(){return this._acceleration}SetGravity(e){this._gravity=+e}GetGravity(){return this._gravity}SetLifeAngleRandom(e){this._lifeAngleRandom=+e}GetLifeAngleRandom(){return this._lifeAngleRandom}SetLifeSpeedRandom(e){this._lifeSpeedRandom=+e}GetLifeSpeedRandom(){return this._lifeSpeedRandom}SetLifeOpacityRandom(e){this._lifeOpacityRandom=+e}GetLifeOpacityRandom(){return this._lifeOpacityRandom}SetDestroyMode(e){let t=r.indexOf(e);if(-1===t)throw new Error("invalid destroy mode");this._destroyMode=t}SetDestroyModeIndex(e){this.SetDestroyMode(r[e])}GetDestroyMode(){return r[this._destroyMode]}GetDestroyModeIndex(){return this._destroyMode}SetTimeout(e){this._timeout=+e}GetTimeout(){return this._timeout}SetParticleScale(e){this._particleScale=+e}GetParticleScale(){return this._particleScale}GetBoundingBox(){return this._boundingBox}}}{const e=self.C3,t=self.ParticleEngine;function randomOffset(e){return Math.random()*e-e/2}const s=new e.Quad,i=new e.Color,r=self.devicePixelRatio||1;let n=!1;self.Particle=class{constructor(t){this._engine=t,this._isActive=!1,this._x=0,this._y=0,this._speed=0,this._angle=0,this._opacity=1,this._lastOpacity=0,this._grow=0,this._size=0,this._halfSize=0,this._gs=0,this._age=0,this._bbox=new e.Rect,this._userData=null,this._userDataUid=NaN,this._updateCallback=null,this._destroyCallback=null}SetEngine(e){this._engine=e}Init(e){const t=this._engine;this._isActive=!0,this._x=t.GetSpawnX()+randomOffset(t.GetInitXRandom()),this._y=t.GetSpawnY()+randomOffset(t.GetInitYRandom()),this._speed=t.GetInitSpeed()+randomOffset(t.GetInitSpeedRandom()),this._angle=t.GetInitAngle()+randomOffset(t.GetSprayCone()),this._opacity=t.GetInitOpacity(),this._lastOpacity=this._opacity,this._size=(t.GetInitSize()+randomOffset(t.GetInitSizeRandom()))*t.GetInitSizeScale(),this._halfSize=this._size/2,this._grow=t.GetGrowRate()+randomOffset(t.GetGrowRandom()),this._gs=0,this._age=0,this._UpdateBoundingBox(),e?this._userData||(this._userData=e(this)):(this._userData=null,this._updateCallback=null,this._destroyCallback=null)}UpdateUserData(e){e?this._userData&&!this._userData.IsDestroyed()||(this._userData=e(this)):(this._userData=null,this._updateCallback=null,this._destroyCallback=null)}SetUpdateCallback(e){this._updateCallback=e}SetDestroyCallback(e){this._destroyCallback=e}Destroy(){const e=this._destroyCallback;e&&e(this._userData),this._userData=null,this._updateCallback=null,this._destroyCallback=null}toJSON(){let e;return this._userData&&(e=this._userData.GetWorldInfo().GetInstance().GetUID()),[this._x,this._y,this._speed,this._angle,this._opacity,this._grow,this._size,this._gs,this._age,e]}setFromJSON(e){this._x=e[0],this._y=e[1],this._speed=e[2],this._angle=e[3],this._opacity=e[4],this._grow=e[5],this._size=e[6],this._gs=e[7],this._age=e[8],this._userDataUid=e[9],this._halfSize=this._size/2,this._UpdateBoundingBox()}Tick(t){const s=this._engine,i=this._speed*t,r=this._angle,n=Math.cos(r)*i,a=Math.sin(r)*i+this._gs*t;this._x+=n,this._y+=a;const o=this._grow*t;this._size+=o,this._halfSize=this._size/2,this._speed+=s.GetAcceleration()*t,this._gs+=s.GetGravity()*t,this._age+=t,this._UpdateBoundingBox();const h=s.GetLifeAngleRandom(),l=s.GetLifeSpeedRandom(),c=s.GetLifeOpacityRandom();let u=0;0!==h&&(u=randomOffset(h*t),this._angle+=u),0!==l&&(this._speed+=randomOffset(l*t)),0!==c&&(this._opacity=e.clamp(this._opacity+randomOffset(c*t),0,1));const _=this._size>=1&&(2===s.GetDestroyModeIndex()?this._speed>0:this._age<s.GetTimeout()),d=this._updateCallback;if(d&&_){let e=s.GetMasterOpacity()*this._opacity;0===s.GetDestroyModeIndex()&&(e*=1-this._age/s.GetTimeout());const t=e-this._lastOpacity;this._lastOpacity=e,d(this._userData,n,a,o,u,t)}this._isActive=_}IsActive(){return this._isActive}GetBoundingBox(){return this._bbox}_UpdateBoundingBox(){const e=this._x,t=this._y,s=this._halfSize;this._bbox.set(e-s,t-s,e+s,t+s)}Draw(e,t,a){if(this._userData)return;const o=this._engine;let h=o.GetMasterOpacity()*this._opacity;if(0===o.GetDestroyModeIndex()&&(h*=1-this._age/o.GetTimeout()),h<=0)return;const l=this._size,c=l*o.GetParticleScale()*r;if(c<1)return;let u=this._x,_=this._y;o.IsPixelRounding()&&(u=u+.5|0,_=_+.5|0),e.IsWebGPU()?e.Point(u,_,l,h):a||c>e.GetMaxPointSize()||c<e.GetMinPointSize()?(i.copy(o.GetColor()),i.multiplyAlpha(h),e.SetColor(i),n=!0,s.setFromRect(this._bbox),e.Quad3(s,t)):(n&&(e.SetColor(o.GetColor()),n=!1),e.Point(u,_,c,h))}GetUserData(){return this._userData}GetUserDataUID(){return this._userDataUid}GetX(){return this._x}GetY(){return this._y}GetSize(){return this._size}GetAngle(){return this._angle}GetOpacity(){return this._opacity}}}{const e=self.C3;e.Plugins.Mouse=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3,t=self.C3X;e.Plugins.Mouse.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IMouseObjectType}};let s=null;function GetMouseSdkInstance(){return s.GetSingleGlobalInstance().GetSdkInstance()}self.IMouseObjectType=class extends self.IObjectClass{constructor(e){super(e),s=e,e.GetRuntime()._GetCommonScriptInterfaces().mouse=this}getMouseX(e){return GetMouseSdkInstance().GetMousePositionForLayer(e)[0]}getMouseY(e){return GetMouseSdkInstance().GetMousePositionForLayer(e)[1]}getMousePosition(e){return GetMouseSdkInstance().GetMousePositionForLayer(e)}isMouseButtonDown(e){return GetMouseSdkInstance().IsMouseButtonDown(e)}setCursorStyle(e){t.RequireString(e),GetMouseSdkInstance().SetCursorStyle(e)}setCursorObjectClass(e){const t=GetMouseSdkInstance(),s=t.GetRuntime()._UnwrapIObjectClass(e);t.SetCursorObjectClass(s)}}}{const e=self.C3,t="mouse";let s=null;e.Plugins.Mouse.Instance=class extends e.SDKInstanceBase{constructor(s,i){super(s,t),this._buttonMap=[!1,!1,!1],this._mouseXcanvas=0,this._mouseYcanvas=0,this._triggerButton=0,this._triggerType=0,this._triggerDir=0,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._hasPointerLock=!1,this._movementX=0,this._movementY=0,this.AddDOMMessageHandlers([["pointer-lock-change",e=>this._OnPointerLockChange(e)],["pointer-lock-error",e=>this._OnPointerLockError(e)]]);const r=this.GetRuntime().Dispatcher();this._disposables=new e.CompositeDisposable(e.Disposable.From(r,"pointermove",(e=>this._OnPointerMove(e.data))),e.Disposable.From(r,"pointerdown",(e=>this._OnPointerDown(e.data))),e.Disposable.From(r,"pointerup",(e=>this._OnPointerUp(e.data))),e.Disposable.From(r,"dblclick",(e=>this._OnDoubleClick(e.data))),e.Disposable.From(r,"wheel",(e=>this._OnMouseWheel(e.data))),e.Disposable.From(r,"window-blur",(()=>this._OnWindowBlur())))}Release(){super.Release()}_OnPointerDown(e){"mouse"===e.pointerType&&(this._mouseXcanvas=e.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=e.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(e.lastButtons,e.buttons))}_OnPointerMove(t){this._movementX=t.movementX,this._movementY=t.movementY,this.Trigger(e.Plugins.Mouse.Cnds.OnMovement),this._movementX=0,this._movementY=0,"mouse"===t.pointerType&&(this._mouseXcanvas=t.pageX-this._runtime.GetCanvasClientX(),this._mouseYcanvas=t.pageY-this._runtime.GetCanvasClientY(),this._CheckButtonChanges(t.lastButtons,t.buttons))}_OnPointerUp(e){"mouse"===e.pointerType&&this._CheckButtonChanges(e.lastButtons,e.buttons)}_CheckButtonChanges(e,t){this._CheckButtonChange(e,t,1,0),this._CheckButtonChange(e,t,4,1),this._CheckButtonChange(e,t,2,2)}_CheckButtonChange(e,t,s,i){!(e&s)&&t&s?this._OnMouseDown(i):e&s&&!(t&s)&&this._OnMouseUp(i)}_OnMouseDown(t){this._buttonMap[t]=!0,this.Trigger(e.Plugins.Mouse.Cnds.OnAnyClick),this._triggerButton=t,this._triggerType=0,this.Trigger(e.Plugins.Mouse.Cnds.OnClick),this.Trigger(e.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseUp(t){this._buttonMap[t]&&(this._buttonMap[t]=!1,this._triggerButton=t,this.Trigger(e.Plugins.Mouse.Cnds.OnRelease))}_OnDoubleClick(t){this._triggerButton=t.button,this._triggerType=1,this.Trigger(e.Plugins.Mouse.Cnds.OnClick),this.Trigger(e.Plugins.Mouse.Cnds.OnObjectClicked)}_OnMouseWheel(t){this._triggerDir=t.deltaY<0?1:0,this._wheelDeltaX=t.deltaX,this._wheelDeltaY=t.deltaY,this._wheelDeltaZ=t.deltaZ,this.Trigger(e.Plugins.Mouse.Cnds.OnWheel)}_OnWindowBlur(){for(let t=0,s=this._buttonMap.length;t<s;++t){if(!this._buttonMap[t])return;this._buttonMap[t]=!1,this._triggerButton=t,this.Trigger(e.Plugins.Mouse.Cnds.OnRelease)}}GetMousePositionForLayer(e){const t=this._runtime.GetMainRunningLayout(),s=this._mouseXcanvas,i=this._mouseYcanvas;if(void 0===e){return t.GetLayerByIndex(0).CanvasCssToLayer_DefaultTransform(s,i)}{const r=t.GetLayer(e);return r?r.CanvasCssToLayer(s,i):[0,0]}}IsMouseButtonDown(e){return e=Math.floor(e),!!this._buttonMap[e]}_IsMouseOverCanvas(){return this._mouseXcanvas>=0&&this._mouseYcanvas>=0&&this._mouseXcanvas<this._runtime.GetCanvasCssWidth()&&this._mouseYcanvas<this._runtime.GetCanvasCssHeight()}SetCursorStyle(e){s!==e&&(s=e,this.PostToDOM("cursor",e))}async SetCursorObjectClass(t){if(e.Platform.IsMobile||!t)return;const i=t.GetFirstPicked();if(!i)return;const r=i.GetWorldInfo(),n=i.GetCurrentImageInfo();if(!r||!n)return;if(s===n)return;s=n;const a=`url(${await n.ExtractImageToBlobURL()}) ${Math.round(r.GetOriginX()*n.GetWidth())} ${Math.round(r.GetOriginY()*n.GetHeight())}, auto`;this.PostToDOM("cursor",a)}_OnPointerLockChange(e){this._UpdatePointerLockState(e["has-pointer-lock"])}_OnPointerLockError(t){this._UpdatePointerLockState(t["has-pointer-lock"]),this.Trigger(e.Plugins.Mouse.Cnds.OnPointerLockError)}_UpdatePointerLockState(t){this._hasPointerLock!==t&&(this._hasPointerLock=t,this._hasPointerLock?this.Trigger(e.Plugins.Mouse.Cnds.OnPointerLocked):this.Trigger(e.Plugins.Mouse.Cnds.OnPointerUnlocked))}GetDebuggerProperties(){const e="plugins.mouse";return[{title:e+".name",properties:[{name:e+".debugger.absolute-position",value:this._mouseXcanvas+","+this._mouseYcanvas},{name:e+".debugger.left-button",value:this._buttonMap[0]},{name:e+".debugger.middle-button",value:this._buttonMap[1]},{name:e+".debugger.right-button",value:this._buttonMap[2]}]},{title:e+".debugger.position-on-each-layer",properties:this._runtime.GetMainRunningLayout().GetLayers().map((e=>({name:"$"+e.GetName(),value:e.CanvasCssToLayer(this._mouseXcanvas,this._mouseYcanvas).join(", ")})))}]}}}{const e=self.C3;e.Plugins.Mouse.Cnds={OnClick(e,t){return this._triggerButton===e&&this._triggerType===t},OnAnyClick:()=>!0,IsButtonDown(e){return this._buttonMap[e]},OnRelease(e){return this._triggerButton===e},IsOverObject(t){if(!this._IsMouseOverCanvas())return!1;const s=this._runtime.GetCurrentCondition().IsInverted(),i=this._mouseXcanvas,r=this._mouseYcanvas;return e.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(t,i,r,s),s)},OnObjectClicked(e,t,s){if(e!==this._triggerButton||t!==this._triggerType)return!1;if(!this._IsMouseOverCanvas())return!1;const i=this._mouseXcanvas,r=this._mouseYcanvas;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(s,i,r,!1)},OnWheel(e){return 2===e||this._triggerDir===e},OnPointerLocked:()=>!0,OnPointerUnlocked:()=>!0,OnPointerLockError:()=>!0,HasPointerLock(){return this._hasPointerLock},OnMovement:()=>!0}}{const e=self.C3,t=["auto","pointer","text","crosshair","move","help","wait","none"];e.Plugins.Mouse.Acts={SetCursor(e){this.SetCursorStyle(t[e])},SetCursorSprite(e){this.SetCursorObjectClass(e)},RequestPointerLock(){this._PostToDOMMaybeSync("request-pointer-lock")},ReleasePointerLock(){this.PostToDOM("release-pointer-lock")}}}{const e=self.C3;e.Plugins.Mouse.Exps={X(e){return this.GetMousePositionForLayer(e)[0]},Y(e){return this.GetMousePositionForLayer(e)[1]},AbsoluteX(){return this._mouseXcanvas},AbsoluteY(){return this._mouseYcanvas},MovementX(){return this._movementX},MovementY(){return this._movementY},WheelDeltaX(){return this._wheelDeltaX},WheelDeltaY(){return this._wheelDeltaY},WheelDeltaZ(){return this._wheelDeltaZ}}}{const e=self.C3;e.Plugins.Spritefont2=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Spritefont2.Type=class extends e.SDKTypeBase{constructor(t){super(t),this._spriteFont=e.New(self.SpriteFont)}Release(){super.Release()}OnCreate(){this.GetImageInfo().LoadAsset(this._runtime)}LoadTextures(e){return this.GetImageInfo().LoadStaticTexture(e,{sampling:this._runtime.GetSampling()})}ReleaseTextures(){this.GetImageInfo().ReleaseTexture()}GetSpriteFont(){return this._spriteFont}UpdateSettings(e,t,s,i){const r=this.GetImageInfo(),n=this._spriteFont;n.SetWidth(r.GetWidth()),n.SetHeight(r.GetHeight()),n.SetCharacterWidth(e),n.SetCharacterHeight(t),n.SetCharacterSet(s),n.SetSpacingData(i),n.UpdateCharacterMap()}}}{const e=self.C3,t=self.C3X,s=0,i=1,r=2,n=3,a=4,o=5,h=6,l=7,c=8,u=9,_=10,d=11,p=12,f=13,m=14,g=["left","center","right"],S=["top","center","bottom"],y=0,G=1;e.Plugins.Spritefont2.Instance=class extends e.SDKWorldInstanceBase{constructor(t,s){super(t),this._text="",this._enableBBcode=!0,this._characterWidth=16,this._characterHeight=16,this._characterSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789.,;:?!-_~#\"'&()[]|`\\/@+=*$<>";let i="";if(this._characterScale=1,this._characterSpacing=0,this._lineHeight=0,this._horizontalAlign=0,this._verticalAlign=0,this._wrapByWord=!0,this._readAloud=!1,this._screenReaderText=null,this._spriteFontText=null,this._typewriterStartTime=-1,this._typewriterEndTime=-1,this._typewriterLength=0,s){this._text=s[0],this._enableBBcode=s[1],this._characterWidth=s[2],this._characterHeight=s[3],this._characterSet=s[4],i=s[5],this._characterScale=s[6],this._characterSpacing=s[7],this._lineHeight=s[8],this._horizontalAlign=s[9],this._verticalAlign=s[10],this._wrapByWord=0===s[11];this.GetWorldInfo().SetVisible(s[12]),this._readAloud=!!s[m]}this._sdkType.UpdateSettings(this._characterWidth,this._characterHeight,this._characterSet,i),this._spriteFontText=e.New(self.SpriteFontText,this._sdkType.GetSpriteFont());const r=this.GetWorldInfo();this._spriteFontText.SetSize(r.GetWidth(),r.GetHeight()),this._UpdateSettings(),this._UpdateScreenReaderText(),this._inst.SetMustMitigateZFighting()}Release(){this._CancelTypewriter(),this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null),this._spriteFontText.Release(),this._spriteFontText=null,super.Release()}_UpdateSettings(){const e=this._spriteFontText;e&&(e.SetBBCodeEnabled(this._enableBBcode),e.SetText(this._text),e.SetWordWrapMode(this._wrapByWord?"word":"character"),e.SetHorizontalAlign(g[this._horizontalAlign]),e.SetVerticalAlign(S[this._verticalAlign]),e.SetSpacing(this._characterSpacing),e.SetLineHeight(this._lineHeight))}_UpdateScreenReaderText(){if(this._readAloud){let t=this._text;this._enableBBcode&&(t=e.BBString.StripAnyTags(t)),this._screenReaderText?this._screenReaderText.SetText(t):this._screenReaderText=e.New(e.ScreenReaderText,this._runtime,t)}else this._screenReaderText&&(this._screenReaderText.Release(),this._screenReaderText=null)}Draw(e){const t=this._objectClass.GetImageInfo(),s=t.GetTexture();if(!s)return;e.SetTexture(s);const i=this.GetWorldInfo();let r=i.GetBoundingQuad();const n=this._spriteFontText;n.SetScale(this._characterScale),n.SetSceneGraphScale(i.GetSceneGraphScale()),this._runtime.IsPixelRoundingEnabled()&&(r=i.PixelRoundQuad(r)),n.SetSize(i.GetWidth(),i.GetHeight()),n.GetSpriteFont().SetTexRect(t.GetTexRect()),n.SetColor(i.GetUnpremultipliedColor()),n.Draw(e,r.getTlx(),r.getTly(),i.GetAngle())}SaveToJson(){const e={t:this._text,ebbc:this._enableBBcode,csc:this._characterScale,csp:this._characterSpacing,lh:this._lineHeight,ha:this._horizontalAlign,va:this._verticalAlign,w:this._wrapByWord,cw:this._sdkType.GetSpriteFont().GetCharacterWidth(),ch:this._sdkType.GetSpriteFont().GetCharacterHeight(),cs:this._sdkType.GetSpriteFont().GetCharacterSet(),sd:this._sdkType.GetSpriteFont().GetSpacingData()};return-1!==this._typewriterEndTime&&(e.tw={st:this._typewriterStartTime,en:this._typewriterEndTime,l:this._typewriterLength}),e}LoadFromJson(e){if(this._CancelTypewriter(),this._text=e.t,this._enableBBcode=e.ebbc,this._characterScale=e.csc,this._characterSpacing=e.csp,this._lineHeight=e.lh,this._horizontalAlign=e.ha,this._verticalAlign=e.va,this._wrapByWord=e.w,e.hasOwnProperty("tw")){const t=e.tw;this._typewriterStartTime=t.st,this._typewriterEndTime=t.en,this._typewriterLength=e.l}const t=this._sdkType.GetSpriteFont();t.SetCharacterWidth(e.cw),t.SetCharacterHeight(e.ch),t.SetCharacterSet(e.cs),t.SetSpacingData(e.sd),this._UpdateSettings(),this._UpdateScreenReaderText(),-1!==this._typewriterEndTime&&this._StartTicking()}GetPropertyValueByIndex(e){switch(e){case s:return this.GetText();case i:return this._enableBBcode;case r:return this._sdkType.GetSpriteFont().GetCharacterWidth();case n:return this._sdkType.GetSpriteFont().GetCharacterHeight();case a:return this._sdkType.GetSpriteFont().GetCharacterSet();case o:return this._sdkType.GetSpriteFont().GetSpacingData();case h:return this._GetScale();case l:return this._GetCharacterSpacing();case c:return this._GetLineHeight();case u:return this._GetHAlign();case _:return this._GetVAlign();case d:return this._IsWrapByWord()?G:y}}SetPropertyValueByIndex(e,t){switch(e){case s:this._SetText(t);break;case i:if(this._enableBBcode===!!t)return;this._enableBBcode=!!t,this._UpdateSettings();break;case r:this._sdkType.GetSpriteFont().SetCharacterWidth(t);break;case n:this._sdkType.GetSpriteFont().SetCharacterHeight(t);break;case a:this._sdkType.GetSpriteFont().SetCharacterSet(t);break;case o:this._sdkType.GetSpriteFont().SetSpacingData(t);break;case h:this._SetScale(t);break;case l:this._SetCharacterSpacing(t);break;case c:this._SetLineHeight(t);break;case u:this._SetHAlign(t);break;case _:this._SetVAlign(t);break;case d:this._SetWrapByWord(t===y);break}}_SetText(e){this._text!==e&&(this._text=e,this._spriteFontText.SetText(e),this._UpdateScreenReaderText(),this._runtime.UpdateRender())}GetText(){return this._text}_StartTypewriter(t,s){this._SetText(t),this._typewriterStartTime=this._runtime.GetWallTime(),this._typewriterEndTime=this._typewriterStartTime+s/this.GetInstance().GetActiveTimeScale(),this._typewriterLength=e.CountGraphemes(e.BBString.StripAnyTags(t)),this._spriteFontText.SetDrawMaxCharacterCount(0),this._StartTicking()}_CancelTypewriter(){this._typewriterStartTime=-1,this._typewriterEndTime=-1,this._typewriterLength=0,this._spriteFontText.SetDrawMaxCharacterCount(-1),this._StopTicking()}_FinishTypewriter(){-1!==this._typewriterEndTime&&(this._CancelTypewriter(),this.Trigger(e.Plugins.Spritefont2.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender())}_SetScale(e){this._characterScale!==e&&(this._characterScale=e,this._spriteFontText.SetScale(this._characterScale),this._runtime.UpdateRender())}_GetScale(){return this._characterScale}_SetCharacterSpacing(e){this._characterSpacing!==e&&(this._characterSpacing=e,this._spriteFontText.SetSpacing(this._characterSpacing),this._runtime.UpdateRender())}_GetCharacterSpacing(){return this._characterSpacing}_SetLineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this._spriteFontText.SetLineHeight(this._lineHeight),this._runtime.UpdateRender())}_GetLineHeight(){return this._lineHeight}_SetHAlign(e){this._horizontalAlign!==e&&(this._horizontalAlign=e,this._UpdateSettings(),this._runtime.UpdateRender())}_GetHAlign(){return this._horizontalAlign}_SetVAlign(e){this._verticalAlign!==e&&(this._verticalAlign=e,this._UpdateSettings(),this._runtime.UpdateRender())}_GetVAlign(){return this._verticalAlign}_SetWrapByWord(e){e=!!e,this._wrapByWord!==e&&(this._wrapByWord=e,this._UpdateSettings(),this._runtime.UpdateRender())}_IsWrapByWord(){return this._wrapByWord}_SetReadAloud(e){this._readAloud=!!e,this._UpdateScreenReaderText()}_IsReadAloud(){return this._readAloud}_GetTextWidth(){const e=this.GetWorldInfo();return this._spriteFontText.SetSize(e.GetWidth(),e.GetHeight()),this._spriteFontText.SetScale(this._characterScale),this._spriteFontText.GetTextWidth()}_GetTextHeight(){const e=this.GetWorldInfo();return this._spriteFontText.SetSize(e.GetWidth(),e.GetHeight()),this._spriteFontText.SetScale(this._characterScale),this._spriteFontText.GetTextHeight()}Tick(){const t=this._runtime.GetWallTime();if(t>=this._typewriterEndTime)this._CancelTypewriter(),this.Trigger(e.Plugins.Spritefont2.Cnds.OnTypewriterTextFinished),this._runtime.UpdateRender();else{let s=e.relerp(this._typewriterStartTime,this._typewriterEndTime,t,0,this._typewriterLength);s=Math.floor(s),s!==this._spriteFontText.GetDrawMaxCharacterCount()&&(this._spriteFontText.SetDrawMaxCharacterCount(s),this._runtime.UpdateRender())}}GetDebuggerProperties(){const e="plugins.spritefont2";return[{title:e+".name",properties:[{name:e+".properties.text.name",value:this.GetText(),onedit:e=>this._SetText(e)},{name:e+".properties.scale.name",value:this._GetScale(),onedit:e=>this._SetScale(e)},{name:e+".properties.character-spacing.name",value:this._GetCharacterSpacing(),onedit:e=>this._SetCharacterSpacing(e)},{name:e+".properties.line-height.name",value:this._GetLineHeight(),onedit:e=>this._SetLineHeight(e)}]}]}GetScriptInterfaceClass(){return self.ISpriteFontInstance}};const I=new WeakMap,T=new Map([["left",0],["center",1],["right",2]]),b=new Map([["top",0],["center",1],["bottom",2]]),C=new Map([["word",!0],["character",!1]]);self.ISpriteFontInstance=class extends self.IWorldInstance{constructor(){super(),I.set(this,self.IInstance._GetInitInst().GetSdkInstance())}get text(){return I.get(this).GetText()}set text(e){t.RequireString(e);const s=I.get(this);s._CancelTypewriter(),s._SetText(e)}typewriterText(e,s){t.RequireString(e),t.RequireFiniteNumber(s);const i=I.get(this);i._CancelTypewriter(),i._StartTypewriter(e,s)}typewriterFinish(){I.get(this)._FinishTypewriter()}set characterScale(e){t.RequireFiniteNumber(e),I.get(this)._SetScale(e)}get characterScale(){return I.get(this)._GetScale()}set characterSpacing(e){t.RequireFiniteNumber(e),I.get(this)._SetCharacterSpacing(e)}get characterSpacing(){return I.get(this)._GetCharacterSpacing()}set lineHeight(e){t.RequireFiniteNumber(e),I.get(this)._SetLineHeight(e)}get lineHeight(){return I.get(this)._GetLineHeight()}set horizontalAlign(e){t.RequireString(e);const s=T.get(e);if(void 0===s)throw new Error("invalid mode");I.get(this)._SetHAlign(s)}get horizontalAlign(){return g[I.get(this)._GetHAlign()]}set verticalAlign(e){t.RequireString(e);const s=b.get(e);if(void 0===s)throw new Error("invalid mode");I.get(this)._SetVAlign(s)}get verticalAlign(){return S[I.get(this)._GetVAlign()]}set wordWrapMode(e){t.RequireString(e);const s=C.get(e);if(void 0===s)throw new Error("invalid mode");I.get(this)._SetWrapByWord(s)}get wordWrapMode(){return I.get(this)._IsWrapByWord()?"word":"character"}set readAloud(e){I.get(this)._SetReadAloud(!!e)}get readAloud(){return I.get(this)._IsReadAloud()}get textWidth(){return I.get(this)._GetTextWidth()}get textHeight(){return I.get(this)._GetTextHeight()}getTextSize(){const e=I.get(this);return[e._GetTextWidth(),e._GetTextHeight()]}}}{const e=self.C3;e.Plugins.Spritefont2.Cnds={CompareText(t,s){return s?this._text===t:e.equalsNoCase(this._text,t)},IsRunningTypewriterText(){return-1!==this._typewriterEndTime},OnTypewriterTextFinished:()=>!0}}{const e=self.C3;e.Plugins.Spritefont2.Acts={SetText(e){this._CancelTypewriter(),"number"==typeof e&&e<1e9&&(e=Math.round(1e10*e)/1e10),this._SetText(e.toString())},AppendText(e){this._CancelTypewriter(),"number"==typeof e&&e<1e9&&(e=Math.round(1e10*e)/1e10),(e=e.toString())&&this._SetText(this._text+e)},TypewriterText(e,t){this._CancelTypewriter(),"number"==typeof e&&e<1e9&&(e=Math.round(1e10*e)/1e10),this._StartTypewriter(e.toString(),t)},TypewriterFinish(){this._FinishTypewriter()},SetScale(e){this._SetScale(e)},SetCharacterSpacing(e){this._SetCharacterSpacing(e)},SetLineHeight(e){this._SetLineHeight(e)},SetCharacterWidth(e,t){let s=!1;const i=this._sdkType.GetSpriteFont();for(const r of e)if(" "===r)i.SetSpaceWidth(t),s=!0;else{const e=i.GetCharacter(r);e&&(e.SetDisplayWidth(t),s=!0)}s&&i.SetCharacterWidthsChanged(),this._runtime.UpdateRender()},SetEffect(e){this.GetWorldInfo().SetBlendMode(e),this._runtime.UpdateRender()},SetHAlign(e){this._SetHAlign(e)},SetVAlign(e){this._SetVAlign(e)},SetWrapping(e){this._SetWrapByWord(0===e)},SetReadAloud(e){this._SetReadAloud(e)}}}{const e=self.C3;e.Plugins.Spritefont2.Exps={CharacterWidth(e){const t=this._sdkType.GetSpriteFont().GetCharacter(e);return t?t.GetDisplayWidth():this._sdkType.GetSpriteFont().GetCharacterWidth()},CharacterHeight(){return this._characterHeight},CharacterScale(){return this._characterScale},CharacterSpacing(){return this._characterSpacing},LineHeight(){return this._lineHeight},Text(){return this._text},PlainText(){return this._enableBBcode?e.BBString.StripAnyTags(this._text):this._text},TextWidth(){return this._GetTextWidth()},TextHeight(){return this._GetTextHeight()}}}{const e=self.C3;self.SpriteFontCharacter=class{constructor(t,s,i,r){let n=t.GetCharacterWidth(),a=t.GetCharacterHeight();this._spriteFont=t,this._char=s,this._pxRect=new e.Rect(i,r,i+n,r+a),this._texRect=new e.Rect,this._displayWidth=-1,this._UpdateTexRect()}Release(){this._spriteFont=null,this._pxRect=null,this._texRect=null}_UpdateTexRect(){let e=this._spriteFont.GetWidth(),t=this._spriteFont.GetHeight();this._texRect.copy(this._pxRect),this._texRect.divide(e,t),this._texRect.lerpInto(this._spriteFont.GetTexRect())}GetSpriteFont(){return this._spriteFont}GetChar(){return this._char}GetTexRect(){return this._texRect}SetDisplayWidth(e){this._displayWidth=e}GetDisplayWidth(){return this._displayWidth<0?this._spriteFont.GetCharacterWidth():this._displayWidth}}}{const e=self.C3,t=new e.Rect,s=new e.Quad,i=new e.Color,r=new Set(["left","center","right"]),n=new Set(["top","center","bottom"]),a=new Set(["word","character"]);self.SpriteFontText=class{constructor(t){this._spriteFont=t,this._cssWidth=0,this._cssHeight=0,this._text="",this._isBBcodeEnabled=!1,this._bbString=null,this._wrappedText=e.New(e.WordWrap),this._wrapMode="word",this._wrapChanged=!1,this._horizontalAlign="left",this._verticalAlign="top",this._scale=1,this._sceneGraphScale=1,this._spacing=0,this._lineHeight=0,this._color=e.New(e.Color),this._drawMaxCharCount=-1,this._drawCharCount=0,this._measureTextCallback=(e,t)=>this._MeasureText(e,t),this._spriteFont._AddSpriteFontText(this)}Release(){this._spriteFont._RemoveSpriteFontText(this),this._color=null,this._measureTextCallback=null,this._wrappedText.Clear(),this._wrappedText=null,this._spriteFont=null,this._bbString=null}_MeasureText(e,t){const s=this._GetStyleTag(t,"scale"),i=(s?parseFloat(s.param):this._scale)*this._sceneGraphScale,r=this._GetStyleTag(t,"scalex"),n=(r?parseFloat(r.param):1)*i,a=this._GetStyleTag(t,"scaley"),o=(a?parseFloat(a.param):1)*i,h=this._spriteFont.GetCharacterHeight()*o+this._lineHeight,l=this.GetSpriteFont(),c=l.GetCharacterWidth()*n,u=this.GetSpacing();if(l.HasAnyCustomWidths()){let t=0,s=0;for(const i of e){let e=c;const r=l.GetCharacter(i);r?e=r.GetDisplayWidth()*n:" "===i&&(e=l.GetSpaceWidth()*n),s+=e,++t}return{width:s+t*u,height:h}}{const t=e.length;return{width:c*t+Math.max(t,0)*u,height:h}}}_SetWrapChanged(){this._wrapChanged=!0,this._wrappedText.Clear()}SetSize(e,t){e<=0||t<=0||this._cssWidth===e&&this._cssHeight===t||(this._cssWidth!==e&&this._SetWrapChanged(),this._cssWidth=e,this._cssHeight=t)}SetDrawMaxCharacterCount(e){this._drawMaxCharCount=Math.floor(e)}GetDrawMaxCharacterCount(){return this._drawMaxCharCount}_GetStyleTag(e,t){for(let s=e.length-1;s>=0;--s){const i=e[s];if(i.tag===t)return i}return null}_HasStyleTag(e,t){return!!this._GetStyleTag(e,t)}_MaybeWrapText(){if(!this._wrapChanged)return;!this._isBBcodeEnabled||this._bbString&&this._bbString.toString()===this._text||(this._bbString=new e.BBString(this._text,{noEscape:!0}));const t=-this.GetSpacing();this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,this._measureTextCallback,this._cssWidth,this._wrapMode,t),this._wrapChanged=!1}Draw(t,s,i,r){this._MaybeWrapText(),this._drawCharCount=0;let n=0;const a=this._lineHeight,o=e.cloneArray(this._wrappedText.GetLines()),h=Math.sin(r),l=Math.cos(r),c=o.reduce(((e,t)=>e+t.height),0)-a;"center"===this._verticalAlign?n=Math.max(Math.floor(this._cssHeight/2-c/2),0):"bottom"===this._verticalAlign&&(n=Math.floor(this._cssHeight-c));for(let e=0,r=o.length;e<r;++e){const r=o[e],c=r.height;if(e>0&&n>this._cssHeight-(c-a))break;n>=0&&this._DrawLine(t,r,s,i,n,h,l),n+=c}}_DrawLine(e,t,s,i,r,n,a){const o=t.height;let h=0;"center"===this._horizontalAlign?h=Math.max(Math.floor((this._cssWidth-t.width)/2),0):"right"===this._horizontalAlign&&(h=Math.max(Math.floor(this._cssWidth-t.width),0));for(const l of t.fragments)this._DrawFragment(e,l,s,i,h,r,n,a,o),h+=l.width}_DrawFragment(r,n,a,o,h,l,c,u,_){let d=n.chArr,p=n.width;const f=n.styles;if(-1!==this._drawMaxCharCount){if(this._drawCharCount>=this._drawMaxCharCount)return;this._drawCharCount+d.length>this._drawMaxCharCount&&(d=d.slice(0,this._drawMaxCharCount-this._drawCharCount),p=this._MeasureText(d,f).width),this._drawCharCount+=d.length}const m=this._GetStyleTag(f,"background");if(e.IsCharArrayAllWhitespace(d)&&!m||this._HasStyleTag(f,"hide"))return;const g=this._GetStyleTag(f,"scale"),S=(g?parseFloat(g.param):this._scale)*this._sceneGraphScale,y=this._GetStyleTag(f,"scalex"),G=(y?parseFloat(y.param):1)*S,I=this._GetStyleTag(f,"scaley"),T=(I?parseFloat(I.param):1)*S,b=this._spriteFont.GetCharacterHeight()*T;l+=_-this._lineHeight-b;const C=this._GetStyleTag(f,"offsetx");h+=C?parseFloat(C.param):0;const P=this._GetStyleTag(f,"offsety");l+=P?parseFloat(P.param):0,m&&(r.SetColorFillMode(),i.parseString(m.param),i.setA(1),r.SetColor(i),t.set(h,l,h+p,l+b),t.getRight()>this._cssWidth&&t.setRight(this._cssWidth),s.setFromRotatedRectPrecalc(t,c,u),s.offset(a,o),r.Quad(s),r.SetTextureFillMode());const v=this._GetStyleTag(f,"color");v?(i.parseString(v.param),i.setA(this._color.getA())):i.copy(this._color);const x=this._GetStyleTag(f,"opacity");x&&i.setA(i.getA()*parseFloat(x.param)/100),i.premultiply(),r.SetColor(i);const R=this._spriteFont.GetCharacterWidth()*G,w=Math.abs(this.GetSpacing());for(const e of d){const i=this._spriteFont.GetCharacter(e);if(i){const e=i.GetDisplayWidth()*G;if(h+e>this._cssWidth+w+1e-5)return;t.set(h,l,h+R,l+b),s.setFromRotatedRectPrecalc(t,c,u),s.offset(a,o),r.Quad3(s,i.GetTexRect()),h+=e+this._spacing}else h+=this._spriteFont.GetSpaceWidth()*G+this._spacing}}GetSpriteFont(){return this._spriteFont}SetBBCodeEnabled(e){e=!!e,this._isBBcodeEnabled!==e&&(this._isBBcodeEnabled=e,this._SetWrapChanged())}IsBBCodeEnabled(){return this._isBBcodeEnabled}SetText(e){this._text!==e&&(this._text=e,this._SetWrapChanged())}SetWordWrapMode(e){if(!a.has(e))throw new Error("invalid word wrap mode");this._wrapMode!==e&&(this._wrapMode=e,this._SetWrapChanged())}SetHorizontalAlign(e){if(!r.has(e))throw new Error("invalid alignment");this._horizontalAlign=e}SetVerticalAlign(e){if(!n.has(e))throw new Error("invalid alignment");this._verticalAlign=e}SetScale(e){this._scale!==e&&(this._scale=e,this._SetWrapChanged())}GetScale(){return this._scale}SetSceneGraphScale(e){this._sceneGraphScale!==e&&(this._sceneGraphScale=e,this._SetWrapChanged())}GetSceneGraphScale(){return this._sceneGraphScale}SetSpacing(e){this._spacing!==e&&(this._spacing=e,this._SetWrapChanged())}GetSpacing(){return this._spacing}SetLineHeight(e){this._lineHeight=e,this._SetWrapChanged()}GetLineHeight(){return this._lineHeight}SetOpacity(t){t=e.clamp(t,0,1),this._color.a=t}SetColor(e){this._color.equals(e)||this._color.copy(e)}GetColor(){return this._color}GetTextWidth(){return this._MaybeWrapText(),this._wrappedText.GetMaxLineWidth()}GetTextHeight(){this._MaybeWrapText();const e=this._spriteFont.GetCharacterHeight()*this._scale,t=this._lineHeight,s=e+t;return this._wrappedText.GetLineCount()*s-t}}}{const e=self.C3,t=self.SpriteFontText,s={width:256,height:256,characterWidth:16,characterHeight:16,characterSet:""};self.SpriteFont=class{constructor(t){if((t=Object.assign({},s,t)).width<=0||t.height<=0||t.characterWidth<=0||t.characterHeight<=0)throw new Error("invalid size");this._width=t.width,this._height=t.height,this._characterWidth=t.characterWidth,this._characterHeight=t.characterHeight,this._characterSet=t.characterSet,this._spacingData="",this._spacingParsed=null,this._hasAnyCustomWidths=!1,this._spaceWidth=-1,this._texRect=new e.Rect(0,0,1,1),this._characterMap=new Map,this._mapChanged=!0,this._allTexts=new Set}Release(){this._texRect=null,this._ReleaseCharacters(),this._characterMap=null,this._allTexts&&this._allTexts.clear(),this._allTexts=null}_ReleaseCharacters(){for(let e of this._characterMap.values())e.Release();this._characterMap.clear()}_AddSpriteFontText(e){this._allTexts.add(e)}_RemoveSpriteFontText(e){this._allTexts.delete(e)}UpdateCharacterMap(){if(!this._mapChanged)return;this._ReleaseCharacters();let t=e.SplitGraphemes(this._characterSet),s=Math.floor(this._width/this._characterWidth),i=s*Math.floor(this._height/this._characterHeight);for(let r=0,n=t.length;r<n&&!(r>=i);++r){let i=t[r];if(this._characterMap.has(i))continue;let n=r%s,a=Math.floor(r/s);this._characterMap.set(i,e.New(self.SpriteFontCharacter,this,i,n*this._characterWidth,a*this._characterHeight))}if(this._hasAnyCustomWidths=!1,this._spaceWidth=-1,Array.isArray(this._spacingParsed))for(let e of this._spacingParsed){if(!Array.isArray(e))continue;if(2!==e.length)continue;let t=e[0],s=e[1];if("number"==typeof t&&isFinite(t)&&"string"==typeof s&&t!==this._characterWidth)for(let e of s){let s=this._characterMap.get(e);s?(s.SetDisplayWidth(t),this._hasAnyCustomWidths=!0):" "===e&&(this._spaceWidth=t,this._hasAnyCustomWidths=!0)}}this._mapChanged=!1;for(let e of this._allTexts)e._SetWrapChanged()}SetCharacterWidthsChanged(){this._hasAnyCustomWidths=!0;for(const e of this._allTexts)e._SetWrapChanged()}GetCharacter(e){return this.UpdateCharacterMap(),this._characterMap.get(e)||null}HasAnyCustomWidths(){return this._hasAnyCustomWidths}SetWidth(e){if((e=Math.floor(e))<=0)throw new Error("invalid size");this._width!==e&&(this._width=e,this._mapChanged=!0)}GetWidth(){return this._width}SetHeight(e){if((e=Math.floor(e))<=0)throw new Error("invalid size");this._height!==e&&(this._height=e,this._mapChanged=!0)}GetHeight(){return this._height}SetTexRect(e){if(!this._texRect.equals(e)){this._texRect.copy(e);for(const e of this._characterMap.values())e._UpdateTexRect()}}GetTexRect(){return this._texRect}SetCharacterWidth(e){if((e=Math.floor(e))<=0)throw new Error("invalid size");this._characterWidth!==e&&(this._characterWidth=e,this._mapChanged=!0)}GetCharacterWidth(){return this._characterWidth}SetCharacterHeight(e){if((e=Math.floor(e))<=0)throw new Error("invalid size");this._characterHeight!==e&&(this._characterHeight=e,this._mapChanged=!0)}GetCharacterHeight(){return this._characterHeight}SetCharacterSet(e){this._characterSet!==e&&(this._characterSet=e,this._mapChanged=!0)}GetCharacterSet(){return this._characterSet}SetSpacingData(e){if(this._spacingData!==e&&(this._spacingData=e,this._mapChanged=!0,this._spacingParsed=null,this._spacingData.length))try{this._spacingParsed=JSON.parse(this._spacingData)}catch(e){this._spacingParsed=null}}GetSpacingData(){return this._spacingData}SetSpaceWidth(e){e<0&&(e=-1),this._spaceWidth!==e&&(this._spaceWidth=e,this._spaceWidth>=0&&(this._hasAnyCustomWidths=!0))}GetSpaceWidth(){return this._spaceWidth<0?this._characterWidth:this._spaceWidth}}}{const e=self.C3;e.Plugins.Arr=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Arr.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IInstance;function ResizeArray(t,s,i){if(s<t.length)e.truncateArray(t,s);else if(s>t.length)if("function"==typeof i)for(let e=t.length;e<s;++e)t.push(i());else for(let e=t.length;e<s;++e)t.push(i)}e.Plugins.Arr.Instance=class extends e.SDKInstanceBase{constructor(t,s){super(t),this._cx=10,this._cy=1,this._cz=1,this._arr=null,this._forX=[],this._forY=[],this._forZ=[],this._forDepth=-1,s&&(this._cx=s[0],this._cy=s[1],this._cz=s[2]),this._arr=e.MakeFilledArray(this._cx,(()=>e.MakeFilledArray(this._cy,(()=>e.MakeFilledArray(this._cz,0)))))}Release(){this._arr=null,super.Release()}At(e,t,s){return e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),e>=0&&e<this._cx&&t>=0&&t<this._cy&&s>=0&&s<this._cz?this._arr[e][t][s]:0}Set(e,t,s,i){e=Math.floor(e),t=Math.floor(t),s=Math.floor(s),e>=0&&e<this._cx&&t>=0&&t<this._cy&&s>=0&&s<this._cz&&(this._arr[e][t][s]=i)}SetSize(t,s,i){if(t=Math.floor(t),s=Math.floor(s),i=Math.floor(i),t<0&&(t=0),s<0&&(s=0),i<0&&(i=0),this._cx===t&&this._cy===s&&this._cz===i)return;this._cx=t,this._cy=s,this._cz=i;const r=this._arr;ResizeArray(r,t,(()=>e.MakeFilledArray(s,(()=>e.MakeFilledArray(i,0)))));for(let n=0;n<t;++n){ResizeArray(r[n],s,(()=>e.MakeFilledArray(i,0)));for(let e=0;e<s;++e)ResizeArray(r[n][e],i,0)}}GetWidth(){return this._cx}GetHeight(){return this._cy}GetDepth(){return this._cz}GetDebuggerProperties(){const e="plugins.arr.debugger",t="plugins.arr.properties",s=[{title:e+".array-properties.title",properties:[{name:t+".width.name",value:this._cx,onedit:e=>this.SetSize(e,this._cy,this._cz)},{name:t+".height.name",value:this._cy,onedit:e=>this.SetSize(this._cx,e,this._cz)},{name:t+".depth.name",value:this._cz,onedit:e=>this.SetSize(this._cx,this._cy,e)},{name:t+".elements.name",value:this._cx*this._cy*this._cz}]}],i=[];if(1===this._cy&&1===this._cz)for(let e=0;e<this._cx;++e)i.push({name:"$"+e,value:this._arr[e][0][0],onedit:t=>this._arr[e][0][0]=t});else for(let e=0;e<this._cx;++e)i.push({name:"$"+e,value:this._arr[e].toString()});return i.length&&s.push({title:e+".array-data.title",properties:i}),s}GetAsJsonString(){return JSON.stringify({c2array:!0,size:[this._cx,this._cy,this._cz],data:this._arr})}SaveToJson(){return{size:[this._cx,this._cy,this._cz],data:this._arr}}LoadFromJson(e){const t=e.size;this._cx=t[0],this._cy=t[1],this._cz=t[2],this._arr=e.data}_GetForX(){return this._forDepth>=0&&this._forDepth<this._forX.length?this._forX[this._forDepth]:0}_GetForY(){return this._forDepth>=0&&this._forDepth<this._forY.length?this._forY[this._forDepth]:0}_GetForZ(){return this._forDepth>=0&&this._forDepth<this._forZ.length?this._forZ[this._forDepth]:0}GetScriptInterfaceClass(){return self.IArrayInstance}};const i=new WeakMap;self.IArrayInstance=class extends s{constructor(){super(),i.set(this,s._GetInitInst().GetSdkInstance())}get width(){return i.get(this).GetWidth()}get height(){return i.get(this).GetHeight()}get depth(){return i.get(this).GetDepth()}setSize(e,s=1,r=1){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireFiniteNumber(r),i.get(this).SetSize(e,s,r)}getAt(e,s=0,r=0){return t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),t.RequireFiniteNumber(r),i.get(this).At(e,s,r)}setAt(e,s,r=0,n=0){if(t.RequireFiniteNumber(s),t.RequireFiniteNumber(r),t.RequireFiniteNumber(n),"number"!=typeof e&&"string"!=typeof e)throw new TypeError("invalid type");i.get(this).Set(s,r,n,e)}}}{const e=self.C3;function DoForEachTrigger(e,t,s,i,r){e.PushCopySol(s),t.Retrigger(i,r),e.PopSol(s)}e.Plugins.Arr.Cnds={CompareX(t,s,i){return e.compare(this.At(t,0,0),s,i)},CompareXY(t,s,i,r){return e.compare(this.At(t,s,0),i,r)},CompareXYZ(t,s,i,r,n){return e.compare(this.At(t,s,i),r,n)},ArrForEach(e){const t=this._runtime,s=t.GetEventSheetManager(),i=t.GetCurrentEvent(),r=i.GetSolModifiers(),n=t.GetEventStack(),a=n.GetCurrentStackFrame(),o=n.Push(i),h=++this._forDepth,l=this._forX,c=this._forY,u=this._forZ,_=this._cx,d=this._cy,p=this._cz;if(h===this._forX.length?(l.push(0),c.push(0),u.push(0)):(l[h]=0,c[h]=0,u[h]=0),t.SetDebuggingEnabled(!1),0===e)for(let e=0;e<_;++e)for(let t=0;t<d;++t)for(let n=0;n<p;++n)l[h]=e,c[h]=t,u[h]=n,DoForEachTrigger(s,i,r,a,o);else if(1===e)for(let e=0;e<_;++e)for(let t=0;t<d;++t)l[h]=e,c[h]=t,DoForEachTrigger(s,i,r,a,o);else for(let e=0;e<_;++e)l[h]=e,DoForEachTrigger(s,i,r,a,o);return t.SetDebuggingEnabled(!0),this._forDepth--,n.Pop(),!1},CompareCurrent(t,s){return e.compare(this.At(this._GetForX(),this._GetForY(),this._GetForZ()),t,s)},Contains(e){const t=this._cx,s=this._cy,i=this._cz,r=this._arr;for(let n=0;n<t;++n)for(let t=0;t<s;++t)for(let s=0;s<i;++s)if(r[n][t][s]===e)return!0;return!1},IsEmpty(){return 0===this._cx||0===this._cy||0===this._cz},CompareSize(t,s,i){let r=0;switch(t){case 0:r=this._cx;break;case 1:r=this._cy;break;case 2:r=this._cz;break}return e.compare(r,s,i)}}}{const e=self.C3;function CompareValues(e,t){if("number"==typeof e&&"number"==typeof t)return e-t;{const s=e.toString(),i=t.toString();return s<i?-1:s>i?1:0}}e.Plugins.Arr.Acts={Clear(e){const t=this._cx,s=this._cy,i=this._cz,r=this._arr;for(let n=0;n<t;++n)for(let t=0;t<s;++t)for(let s=0;s<i;++s)r[n][t][s]=e},SetSize(e,t,s){this.SetSize(e,t,s)},SetX(e,t){this.Set(e,0,0,t)},SetXY(e,t,s){this.Set(e,t,0,s)},SetXYZ(e,t,s,i){this.Set(e,t,s,i)},Push(t,s,i){const r=this._cx,n=this._cy,a=this._cz,o=this._arr;if(0===i){const i=e.MakeFilledArray(n,(()=>e.MakeFilledArray(a,s)));0===t?o.push(i):o.unshift(i),this._cx++}else if(1===i){for(let i=0;i<r;++i){const r=e.MakeFilledArray(a,s);0===t?o[i].push(r):o[i].unshift(r)}this._cy++}else{for(let e=0;e<r;++e)for(let i=0;i<n;++i)0===t?o[e][i].push(s):o[e][i].unshift(s);this._cz++}},Pop(e,t){const s=this._cx,i=this._cy,r=this._cz,n=this._arr;if(0===t){if(0===s)return;0===e?n.pop():n.shift(),this._cx--}else if(1===t){if(0===i)return;for(let t=0;t<s;++t)0===e?n[t].pop():n[t].shift();this._cy--}else{if(0===r)return;for(let t=0;t<s;++t)for(let s=0;s<i;++s)0===e?n[t][s].pop():n[t][s].shift();this._cz--}},Reverse(e){const t=this._cx,s=this._cy,i=this._cz,r=this._arr;if(0!==t&&0!==s&&0!==i)if(0===e)r.reverse();else if(1===e)for(let e=0;e<t;++e)r[e].reverse();else for(let e=0;e<t;++e)for(let t=0;t<s;++t)r[e][t].reverse()},Sort(e){const t=this._cx,s=this._cy,i=this._cz,r=this._arr;if(0!==t&&0!==s&&0!==i)if(0===e)r.sort(((e,t)=>CompareValues(e[0][0],t[0][0])));else if(1===e)for(let e=0;e<t;++e)r[e].sort(((e,t)=>CompareValues(e[0],t[0])));else for(let e=0;e<t;++e)for(let t=0;t<s;++t)r[e][t].sort(CompareValues)},Delete(e,t){if((e=Math.floor(e))<0)return;const s=this._cx,i=this._cy,r=this._cz,n=this._arr;if(0===t){if(e>=s)return;n.splice(e,1),this._cx--}else if(1===t){if(e>=i)return;for(let t=0;t<s;++t)n[t].splice(e,1);this._cy--}else{if(e>=r)return;for(let t=0;t<s;++t)for(let s=0;s<i;++s)n[t][s].splice(e,1);this._cz--}},Insert(t,s,i){if((s=Math.floor(s))<0)return;const r=this._cx,n=this._cy,a=this._cz,o=this._arr;if(0===i){if(s>r)return;o.splice(s,0,e.MakeFilledArray(n,(()=>e.MakeFilledArray(a,t)))),this._cx++}else if(1===i){if(s>n)return;for(let i=0;i<r;++i)o[i].splice(s,0,e.MakeFilledArray(a,t));this._cy++}else{if(s>a)return;for(let e=0;e<r;++e)for(let i=0;i<n;++i)o[e][i].splice(s,0,t);this._cz++}},SplitString(e,t,s){const i=e.split(t);this.SetSize(i.length,1,1);for(let e=0,t=i.length;e<t;++e){let t=i[e];0===s?String(Number(t))===t&&(t=Number(t)):2===s&&(t=Number(t)),this.Set(e,0,0,t)}},JSONLoad(e){let t=null;try{t=JSON.parse(e)}catch(e){return}if(!t.c2array)return;const s=t.size;this._cx=s[0],this._cy=s[1],this._cz=s[2],this._arr=t.data},JSONDownload(e){const t=URL.createObjectURL(new Blob([this.GetAsJsonString()],{type:"application/json"}));this._runtime.InvokeDownload(t,e)}}}{const e=self.C3;e.Plugins.Arr.Exps={At(e,t,s){return this.At(e,t||0,s||0)},Width(){return this._cx},Height(){return this._cy},Depth(){return this._cz},CurX(){return this._GetForX()},CurY(){return this._GetForY()},CurZ(){return this._GetForZ()},CurValue(){return this.At(this._GetForX(),this._GetForY(),this._GetForZ())},Front(){return this.At(0,0,0)},Back(){return this.At(this._cx-1,0,0)},IndexOf(e){const t=this._arr;for(let s=0,i=this._cx;s<i;++s)if(t[s][0][0]===e)return s;return-1},LastIndexOf(e){const t=this._arr;for(let s=this._cx-1;s>=0;--s)if(t[s][0][0]===e)return s;return-1},JoinString(e){let t=[];for(let e=0;e<this._cx;++e)t.push(this.At(e,0,0));return t.join(e)},AsJSON(){return this.GetAsJsonString()}}}{const e=self.C3,t=[];e.Plugins.Audio=class extends e.SDKPluginBase{constructor(e){super(e)}_AddActionPromise(e){t.push(e)}static async WaitForAllActionPromises(){await Promise.all(t),e.clearArray(t)}Release(){super.Release()}}}{const e=self.C3,t=self.C3X;function GetAudioDOMInterface(){if(self.C3Audio_DOMInterface)return self.C3Audio_DOMInterface;throw new Error("audio scripting API cannot be used here - make sure the project is using DOM mode, not worker mode")}e.Plugins.Audio.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}GetScriptInterfaceClass(){return self.IAudioObjectType}},self.IAudioObjectType=class extends self.IObjectClass{constructor(e){super(e)}get audioContext(){return GetAudioDOMInterface().GetAudioContext()}get destinationNode(){return GetAudioDOMInterface().GetDestinationNode()}}}{const e=self.C3,t="audio",s=["interactive","balanced","playback"];e.Plugins.Audio.Instance=class extends e.SDKInstanceBase{constructor(i,r){super(i,t),this._nextPlayTime=0,this._triggerTags=[],this._enableMultiTags=!0,this._timeScaleMode=0,this._saveLoadMode=0,this._playInBackground=!1,this._panningModel=1,this._distanceModel=1,this._listenerPos=[this._runtime.GetViewportWidth()/2,this._runtime.GetViewportHeight()/2,600],this._listenerForwardVec=[0,0,-1],this._listenerUpVec=[0,1,0],this._referenceDistance=600,this._maxDistance=1e4,this._rolloffFactor=1,this._listenerInst=null,this._loadListenerUid=-1,this._masterVolume=1,this._isSilent=!1,this._sampleRate=0,this._audioContextState="suspended",this._outputLatency=0,this._effectCount=new Map,this._preloadTotal=0,this._preloadCount=0,this._bufferMetadata=new Map,this._remoteUrls=new Map;let n="interactive";r&&(this._timeScaleMode=r[0],this._saveLoadMode=r[1],this._playInBackground=r[2],n=s[r[3]],this._enableMultiTags=r[4],this._panningModel=r[5],this._distanceModel=r[6],this._listenerPos[2]=r[7],this._referenceDistance=r[8],this._maxDistance=r[9],this._rolloffFactor=r[10]),this._lastAIState=[],this._lastFxState=[],this._lastAnalysersData=[],this.AddDOMMessageHandlers([["state",e=>this._OnUpdateState(e)],["audiocontext-state",e=>this._OnAudioContextStateChanged(e)],["fxstate",e=>this._OnUpdateFxState(e)],["trigger",e=>this._OnTrigger(e)],["buffer-metadata",e=>this._OnBufferMetadata(e)]]);const a=this.GetRuntime().Dispatcher();this._disposables=new e.CompositeDisposable(e.Disposable.From(a,"instancedestroy",(e=>this._OnInstanceDestroyed(e.instance))),e.Disposable.From(a,"afterload",(()=>this._OnAfterLoad())),e.Disposable.From(a,"suspend",(()=>this._OnSuspend())),e.Disposable.From(a,"resume",(()=>this._OnResume()))),this._runtime.AddLoadPromise(this.PostToDOMAsync("create-audio-context",{preloadList:this._runtime.GetAssetManager().GetAudioToPreload().map((e=>({originalUrl:e.originalUrl,url:e.url,type:e.type,fileSize:e.fileSize}))),isiOSCordova:this._runtime.IsiOSCordova(),isSafari:"Safari"===e.Platform.Browser,timeScaleMode:this._timeScaleMode,latencyHint:n,panningModel:this._panningModel,distanceModel:this._distanceModel,refDistance:this._referenceDistance,maxDistance:this._maxDistance,rolloffFactor:this._rolloffFactor,listenerPos:this._listenerPos}).then((e=>{this._sampleRate=e.sampleRate,this._audioContextState=e.audioContextState,this._outputLatency=e.outputLatency}))),this._StartTicking()}Release(){this._listenerInst=null,super.Release()}_SplitTags(e){return this._enableMultiTags?e.split(" ").filter((e=>!!e)):e?[e]:[]}_MatchTagLists(t,s){for(const i of s){let s=!1;for(const r of t)if(e.equalsNoCase(r,i)){s=!0;break}if(!s)return!1}return!0}_MatchTagListToStr(e,t){return this._MatchTagLists(e,this._SplitTags(t))}_AddActionPromise(e){this.GetPlugin()._AddActionPromise(e)}_OnInstanceDestroyed(e){this._listenerInst===e&&(this._listenerInst=null)}DbToLinearNoCap(e){return Math.pow(10,e/20)}DbToLinear(e){const t=this.DbToLinearNoCap(e);return isFinite(t)?Math.max(Math.min(t,1),0):0}LinearToDbNoCap(e){return Math.log(e)/Math.log(10)*20}LinearToDb(e){return this.LinearToDbNoCap(Math.max(Math.min(e,1),0))}_OnSuspend(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!0})}_OnResume(){this._playInBackground||this.PostToDOM("set-suspended",{isSuspended:!1})}_OnUpdateState(t){const s=t.tickCount;this._outputLatency=t.outputLatency;const i=this._lastAIState.filter((e=>e.hasOwnProperty("placeholder")&&(e.placeholder>s||-1===e.placeholder)));this._lastAIState=t.audioInstances,this._lastAnalysersData=t.analysers,i.length>0&&e.appendArray(this._lastAIState,i)}_OnBufferMetadata(e){this._bufferMetadata.set(e.originalUrl,{duration:e.duration})}_OnAudioContextStateChanged(e){this._audioContextState=e.audioContextState}GetAudioContextState(){return this._runtime.IsExportToVideo()?"running":this._audioContextState}_OnUpdateFxState(e){this._lastFxState=e.fxstate}_GetFirstAudioStateByTags(e){const t=this._SplitTags(e);for(const e of this._lastAIState)if(this._MatchTagLists(e.tags,t))return e;return null}_IsTagPlaying(e){const t=this._SplitTags(e);return this._lastAIState.some((e=>this._MatchTagLists(e.tags,t)&&e.isPlaying))}_MaybeMarkAsPlaying(e,t,s,i,r){if(this._IsTagPlaying(t))return null;const n=this._bufferMetadata.get(e),a={tags:this._SplitTags(t),duration:n?n.duration:0,volume:r,isPlaying:!0,playbackTime:0,playbackRate:1,uid:-1,bufferOriginalUrl:e,bufferUrl:"",bufferType:"",isMusic:s,isLooping:i,isMuted:!1,resumePosition:0,pan:null,placeholder:-1};return this._lastAIState.push(a),a}async _OnTrigger(t){const s=t.type;this._triggerTags=t.tags;const i=t.aiid;if("ended"===s){for(const e of this._lastAIState)if(e.aiid===i){e.isPlaying=!1;break}await this.TriggerAsync(e.Plugins.Audio.Cnds.OnEnded)}else"fade-ended"===s&&await this.TriggerAsync(e.Plugins.Audio.Cnds.OnFadeEnded)}_MatchTriggerTag(e){return this._MatchTagListToStr(this._triggerTags,e)}Tick(){const e={timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),instPans:this.GetInstancePans(),tickCount:this._runtime.GetTickCountNoSave()};if(this._listenerInst){const t=this._listenerInst.GetWorldInfo();this._listenerPos[0]=t.GetX(),this._listenerPos[1]=t.GetY(),e.listenerPos=this._listenerPos,e.listenerOrientation=[...this._listenerForwardVec,...this._listenerUpVec]}this.PostToDOM("tick",e)}rotatePtAround(e,t,s,i,r){if(0===s)return[e,t];const n=Math.sin(s),a=Math.cos(s),o=(e-=i)*n;return e=e*a-(t-=r)*n,t=t*a+o,[e+=i,t+=r]}GetInstancePans(){return this._lastAIState.filter((e=>-1!==e.uid)).map((e=>this._runtime.GetInstanceByUID(e.uid))).filter((e=>e)).map((e=>{const t=e.GetWorldInfo(),s=t.GetLayer().GetAngle(),[i,r]=this.rotatePtAround(t.GetX(),t.GetY(),-s,this._listenerPos[0],this._listenerPos[1]);return{uid:e.GetUID(),x:i,y:r,z:t.GetTotalZElevation(),angle:t.GetAngle()-s}}))}GetAnalyserData(t,s){for(const i of this._lastAnalysersData)if(i.index===s&&e.equalsNoCase(i.tag,t))return i;return null}_IncrementEffectCount(e){for(const t of this._SplitTags(e)){const e=t.toLowerCase();this._effectCount.set(e,(this._effectCount.get(e)||0)+1)}}_ShouldSave(e){return!e.hasOwnProperty("placeholder")&&(3!==this._saveLoadMode&&((!e.isMusic||1!==this._saveLoadMode)&&!(!e.isMusic&&2===this._saveLoadMode)))}SaveToJson(){return{isSilent:this._isSilent,masterVolume:this._masterVolume,listenerZ:this._listenerPos[2],listenerForwardVec:this._listenerForwardVec,listenerUpVec:this._listenerUpVec,listenerUid:this._listenerInst?this._listenerInst.GetUID():-1,remoteUrls:[...this._remoteUrls.entries()],playing:this._lastAIState.filter((e=>this._ShouldSave(e))),effects:this._lastFxState,analysers:this._lastAnalysersData}}LoadFromJson(e){if(this._isSilent=e.isSilent,this._masterVolume=e.masterVolume,this._listenerPos[2]=e.listenerZ,this._listenerInst=null,this._loadListenerUid=e.listenerUid,e.hasOwnProperty("listenerForwardVec")?this._listenerForwardVec=e.listenerForwardVec:this._listenerForwardVec=[0,0,-1],e.hasOwnProperty("listenerUpVec")?this._listenerUpVec=e.listenerUpVec:this._listenerUpVec=[0,1,0],this._remoteUrls.clear(),e.remoteUrls)for(const[t,s]of e.remoteUrls)this._remoteUrls.set(t,s);this._lastAIState=e.playing;for(const e of this._lastAIState)e.hasOwnProperty("tag")&&!e.hasOwnProperty("tags")&&(e.tags=[e.tag].filter((e=>!!e)));this._lastFxState=e.effects,this._lastAnalysersData=e.analysers}_OnAfterLoad(){if(-1!==this._loadListenerUid&&(this._listenerInst=this._runtime.GetInstanceByUID(this._loadListenerUid),this._loadListenerUid=-1,this._listenerInst)){const e=this._listenerInst.GetWorldInfo();this._listenerPos[0]=e.GetX(),this._listenerPos[1]=e.GetY()}for(const e of this._lastAIState){const t=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e.bufferOriginalUrl);t?(e.bufferUrl=t.url,e.bufferType=t.type):e.bufferUrl=null}for(const e of Object.values(this._lastFxState))for(const t of e)if(t.hasOwnProperty("bufferOriginalUrl")){const e=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t.bufferOriginalUrl);e&&(t.bufferUrl=e.url,t.bufferType=e.type)}this.PostToDOM("load-state",{saveLoadMode:this._saveLoadMode,timeScale:this._runtime.GetTimeScale(),gameTime:this._runtime.GetGameTimeRaw(),listenerPos:this._listenerPos,listenerOrientation:[...this._listenerForwardVec,...this._listenerUpVec],isSilent:this._isSilent,masterVolume:this._masterVolume,playing:this._lastAIState.filter((e=>null!==e.bufferUrl)),effects:this._lastFxState})}GetDebuggerProperties(){const e=[];for(const[t,s]of Object.entries(this._lastFxState))e.push({name:"$"+t,value:s.map((e=>e.type)).join(", ")});const t="plugins.audio.debugger";return[{title:t+".tag-effects",properties:e},{title:t+".currently-playing",properties:[{name:t+".currently-playing-count",value:this._lastAIState.length},...this._lastAIState.map(((e,t)=>({name:"$#"+t,value:`${e.bufferOriginalUrl} ("${e.tags}") ${Math.round(10*e.playbackTime)/10} / ${Math.round(10*e.duration)/10}`})))]}]}}}{const e=self.C3;e.Plugins.Audio.Cnds={OnEnded(e){return this._MatchTriggerTag(e)},OnFadeEnded(e){return this._MatchTriggerTag(e)},PreloadsComplete(){return this._preloadCount===this._preloadTotal},AdvancedAudioSupported:()=>!0,IsSilent(){return this._isSilent},IsAnyPlaying(){for(const e of this._lastAIState)if(e.isPlaying)return!0;return!1},IsTagPlaying(e){return this._IsTagPlaying(e)}}}{const e=self.C3,t=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];e.Plugins.Audio.Acts={Play(t,s,i,r,n){const a=e.Plugins.Audio.Acts._DoPlay.call(this,t,s,i,r,n);return this._AddActionPromise(a),a},PlayFromTimeline(t,s,i,r){e.Plugins.Audio.Acts._DoPlay.call(this,t,0,s,0,i,r)},async _DoPlay(t,s,i,r,n,a){if(this._isSilent)return;const o=t[1],h=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t[0]);if(!h)return;const l=this._nextPlayTime;this._nextPlayTime=0;const c=this._MaybeMarkAsPlaying(t[0],n,o,0!==s,this.DbToLinear(i));try{await this.PostToDOMAsync("play",{originalUrl:t[0],url:h.url,type:h.type,isMusic:o,tags:this._SplitTags(n),isLooping:0!==s,vol:this.DbToLinear(i),stereoPan:e.clamp(r/100,-1,1),pos:a||0,off:l,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{c&&(c.placeholder=this._runtime.GetTickCountNoSave())}},async PlayAtPosition(t,s,i,r,n,a,o,h,l,c,u){if(this._isSilent)return;const _=t[1],d=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t[0]);if(!d)return;const p=this._nextPlayTime;this._nextPlayTime=0;const f=this._MaybeMarkAsPlaying(t[0],u,_,0!==s,this.DbToLinear(i));try{await this.PostToDOMAsync("play",{originalUrl:t[0],url:d.url,type:d.type,isMusic:_,tags:this._SplitTags(u),isLooping:0!==s,vol:this.DbToLinear(i),pos:0,off:p,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:r,y:n,z:a,angle:e.toRadians(o),innerAngle:e.toRadians(h),outerAngle:e.toRadians(l),outerGain:this.DbToLinear(c)}})}finally{f&&(f.placeholder=this._runtime.GetTickCountNoSave())}},async PlayAtObject(t,s,i,r,n,a,o,h){if(this._isSilent)return;if(!r)return;const l=r.GetFirstPicked();if(!l||!l.GetWorldInfo())return;const c=l.GetWorldInfo(),u=c.GetLayer().GetAngle(),[_,d]=this.rotatePtAround(c.GetX(),c.GetY(),-u,this._listenerPos[0],this._listenerPos[1]),p=t[1],f=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t[0]);if(!f)return;const m=this._nextPlayTime;this._nextPlayTime=0;const g=this._MaybeMarkAsPlaying(t[0],h,p,0!==s,this.DbToLinear(i));try{await this.PostToDOMAsync("play",{originalUrl:t[0],url:f.url,type:f.type,isMusic:p,tags:this._SplitTags(h),isLooping:0!==s,vol:this.DbToLinear(i),pos:0,off:m,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:_,y:d,z:c.GetTotalZElevation(),angle:c.GetAngle()-u,innerAngle:e.toRadians(n),outerAngle:e.toRadians(a),outerGain:this.DbToLinear(o),uid:l.GetUID()}})}finally{g&&(g.placeholder=this._runtime.GetTickCountNoSave())}},async PlayByName(t,s,i,r,n,a){if(this._isSilent)return;const o=1===t,h=this._runtime.GetAssetManager().GetProjectAudioFileUrl(s)||this._remoteUrls.get(s.toLowerCase());if(!h)return;const l=this._nextPlayTime;this._nextPlayTime=0;const c=this._MaybeMarkAsPlaying(s,a,o,0!==i,this.DbToLinear(r));try{await this.PostToDOMAsync("play",{originalUrl:s,url:h.url,type:h.type,isMusic:o,tags:this._SplitTags(a),isLooping:0!==i,vol:this.DbToLinear(r),stereoPan:e.clamp(n/100,-1,1),pos:0,off:l,trueClock:!!self.C3_GetAudioContextCurrentTime})}finally{c&&(c.placeholder=this._runtime.GetTickCountNoSave())}},async PlayAtPositionByName(t,s,i,r,n,a,o,h,l,c,u,_){if(this._isSilent)return;const d=1===t,p=this._runtime.GetAssetManager().GetProjectAudioFileUrl(s)||this._remoteUrls.get(s.toLowerCase());if(!p)return;const f=this._nextPlayTime;this._nextPlayTime=0;const m=this._MaybeMarkAsPlaying(s,_,d,0!==i,this.DbToLinear(r));try{await this.PostToDOMAsync("play",{originalUrl:s,url:p.url,type:p.type,isMusic:d,tags:this._SplitTags(_),isLooping:0!==i,vol:this.DbToLinear(r),pos:0,off:f,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:n,y:a,z:o,angle:e.toRadians(h),innerAngle:e.toRadians(l),outerAngle:e.toRadians(c),outerGain:this.DbToLinear(u)}})}finally{m&&(m.placeholder=this._runtime.GetTickCountNoSave())}},async PlayAtObjectByName(t,s,i,r,n,a,o,h,l){if(this._isSilent)return;if(this._isSilent)return;if(!n)return;const c=n.GetFirstPicked();if(!c||!c.GetWorldInfo())return;const u=c.GetWorldInfo(),_=u.GetLayer().GetAngle(),[d,p]=this.rotatePtAround(u.GetX(),u.GetY(),-_,this._listenerPos[0],this._listenerPos[1]),f=1===t,m=this._runtime.GetAssetManager().GetProjectAudioFileUrl(s)||this._remoteUrls.get(s.toLowerCase());if(!m)return;const g=this._nextPlayTime;this._nextPlayTime=0;const S=this._MaybeMarkAsPlaying(s,l,f,0!==i,this.DbToLinear(r));try{await this.PostToDOMAsync("play",{originalUrl:s,url:m.url,type:m.type,isMusic:f,tags:this._SplitTags(l),isLooping:0!==i,vol:this.DbToLinear(r),pos:0,off:g,trueClock:!!self.C3_GetAudioContextCurrentTime,panning:{x:d,y:p,z:u.GetTotalZElevation(),angle:u.GetAngle()-_,innerAngle:e.toRadians(a),outerAngle:e.toRadians(o),outerGain:this.DbToLinear(h),uid:c.GetUID()}})}finally{S&&(S.placeholder=this._runtime.GetTickCountNoSave())}},SetLooping(e,t){this.PostToDOM("set-looping",{tags:this._SplitTags(e),isLooping:0===t})},SetMuted(e,t){this.PostToDOM("set-muted",{tags:this._SplitTags(e),isMuted:0===t})},SetVolume(e,t){this.PostToDOM("set-volume",{tags:this._SplitTags(e),vol:this.DbToLinear(t)})},FadeVolume(e,t,s,i){this.PostToDOM("fade-volume",{tags:this._SplitTags(e),vol:this.DbToLinear(t),duration:s,stopOnEnd:0===i})},SetStereoPan(t,s){this.PostToDOM("set-stereo-pan",{tags:this._SplitTags(t),p:e.clamp(s/100,-1,1)})},async Preload(e){const t=e[1],s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);s&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:e[0],url:s.url,type:s.type,isMusic:t}),this._preloadCount++)},async PreloadByName(e,t){const s=1===e,i=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());i&&(this._preloadTotal++,await this.PostToDOMAsync("preload",{originalUrl:t,url:i.url,type:i.type,isMusic:s}),this._preloadCount++)},SetPlaybackRate(e,t){this.PostToDOM("set-playback-rate",{tags:this._SplitTags(e),rate:Math.max(t,0)})},Stop(e){this.PostToDOM("stop",{tags:this._SplitTags(e)})},StopAll(){this.PostToDOM("stop-all")},SetPaused(e,t){this.PostToDOM("set-paused",{tags:this._SplitTags(e),paused:0===t})},Seek(e,t){this.PostToDOM("seek",{tags:this._SplitTags(e),pos:t})},SetSilent(e){2===e&&(e=this._isSilent?1:0),e=0===e,this._isSilent!==e&&(this._isSilent=e,this.PostToDOM("set-silent",{isSilent:e}))},SetMasterVolume(e){const t=this.DbToLinear(e);this._masterVolume!==t&&(this._masterVolume=t,this.PostToDOM("set-master-volume",{vol:t}))},AddFilterEffect(s,i,r,n,a,o,h){const l=t[i];this._IncrementEffectCount(s),this.PostToDOM("add-effect",{type:"filter",tags:this._SplitTags(s),params:[l,r,n,a,o,e.clamp(h/100,0,1)]})},AddDelayEffect(t,s,i,r){this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"delay",tags:this._SplitTags(t),params:[s,this.DbToLinear(i),e.clamp(r/100,0,1)]})},AddFlangerEffect(t,s,i,r,n,a){this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"flanger",tags:this._SplitTags(t),params:[s/1e3,i/1e3,r,n/100,e.clamp(a/100,0,1)]})},AddPhaserEffect(t,s,i,r,n,a,o){this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"phaser",tags:this._SplitTags(t),params:[s,i,r,n,a,e.clamp(o/100,0,1)]})},AddConvolutionEffect(t,s,i,r){const n=this._runtime.GetAssetManager().GetProjectAudioFileUrl(s[0]);n&&(this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"convolution",tags:this._SplitTags(t),bufferOriginalUrl:s[0],bufferUrl:n.url,bufferType:n.type,params:[0===i,e.clamp(r/100,0,1)]}))},AddGainEffect(e,t){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tags:this._SplitTags(e),params:[this.DbToLinear(t)]})},AddStereoPanEffect(t,s){this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"stereopan",tags:this._SplitTags(t),params:[e.clamp(s/100,-1,1)]})},AddMuteEffect(e){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"gain",tags:this._SplitTags(e),params:[0]})},AddTremoloEffect(t,s,i){this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"tremolo",tags:this._SplitTags(t),params:[s,e.clamp(i/100,0,1)]})},AddRingModEffect(t,s,i){this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"ringmod",tags:this._SplitTags(t),params:[s,e.clamp(i/100,0,1)]})},AddDistortionEffect(t,s,i,r,n,a){this._IncrementEffectCount(t),this.PostToDOM("add-effect",{type:"distortion",tags:this._SplitTags(t),params:[this.DbToLinearNoCap(s),this.DbToLinearNoCap(i),r,this.DbToLinearNoCap(n),e.clamp(a/100,0,1)]})},AddCompressorEffect(e,t,s,i,r,n){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"compressor",tags:this._SplitTags(e),params:[t,s,i,r/1e3,n/1e3]})},AddAnalyserEffect(e,t,s){this._IncrementEffectCount(e),this.PostToDOM("add-effect",{type:"analyser",tags:this._SplitTags(e),params:[t,s]})},RemoveEffects(e){const t=this._SplitTags(e);for(const e of t)this._effectCount.set(e.toLowerCase(),0);this.PostToDOM("remove-effects",{tags:t}),this._lastFxState={}},SetEffectParameter(e,t,s,i,r,n){this.PostToDOM("set-effect-param",{tags:this._SplitTags(e),index:Math.floor(t),param:s,value:i,ramp:r,time:n})},SetListenerObject(e){if(!e)return;const t=e.GetFirstPicked();t&&t.GetWorldInfo()&&(this._listenerInst=t)},SetListenerZ(e){this._listenerPos[2]=e},SetListenerOrientation(e,t,s,i,r,n){this._listenerForwardVec[0]=e,this._listenerForwardVec[1]=t,this._listenerForwardVec[2]=-s,this._listenerUpVec[0]=i,this._listenerUpVec[1]=r,this._listenerUpVec[2]=-n},ScheduleNextPlay(e){this._nextPlayTime=Math.max(e,0)},UnloadAudio(e){const t=e[1],s=this._runtime.GetAssetManager().GetProjectAudioFileUrl(e[0]);s&&this.PostToDOM("unload",{url:s.url,type:s.type,isMusic:t})},UnloadAudioByName(e,t){const s=1===e,i=this._runtime.GetAssetManager().GetProjectAudioFileUrl(t)||this._remoteUrls.get(t.toLowerCase());i&&this.PostToDOM("unload",{url:i.url,type:i.type,isMusic:s})},UnloadAll(){this.PostToDOM("unload-all")},AddRemoteURL(e,t,s){this._remoteUrls.set(s.toLowerCase(),{url:e,type:t})}}}{const e=self.C3;e.Plugins.Audio.Exps={Duration(e){const t=this._GetFirstAudioStateByTags(e);return t?t.duration:0},PlaybackTime(e){const t=this._GetFirstAudioStateByTags(e);return t?t.playbackTime:0},PlaybackRate(e){const t=this._GetFirstAudioStateByTags(e);return t?t.playbackRate:0},Volume(e){const t=this._GetFirstAudioStateByTags(e);return t?this.LinearToDb(t.volume):0},MasterVolume(){return this.LinearToDb(this._masterVolume)},EffectCount(e){return this._effectCount.get(e.toLowerCase())||0},AnalyserFreqBinCount(e,t){const s=this.GetAnalyserData(e,Math.floor(t));return s?s.binCount:0},AnalyserFreqBinAt(e,t,s){const i=this.GetAnalyserData(e,Math.floor(t));return i?(s=Math.floor(s))<0||s>=i.binCount?0:i.freqBins[s]:0},AnalyserPeakLevel(e,t){const s=this.GetAnalyserData(e,Math.floor(t));return s?s.peak:0},AnalyserRMSLevel(e,t){const s=this.GetAnalyserData(e,Math.floor(t));return s?s.rms:0},SampleRate(){return this._sampleRate},CurrentTime:()=>self.C3_GetAudioContextCurrentTime?self.C3_GetAudioContextCurrentTime():performance.now()/1e3,OutputLatency(){return this._outputLatency}}}{const e=self.C3;e.Plugins.Avix_PokiSDK_ForC3=class extends e.SDKPluginBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Plugins.Avix_PokiSDK_ForC3.Type=class extends e.SDKTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t="avix-pokisdk-forc3";e.Plugins.Avix_PokiSDK_ForC3.Instance=class extends e.SDKInstanceBase{constructor(e,s){if(super(e,t),this._pokiSDKLoaded=!1,this._adBlockDetected=!1,this._lastError="",this._lastAdRewardedSuccess=!1,this._debugModeActive=!1,this._lastTriggeredTag="",this._pokiEnabled=!0,this._debugOnPreview=!1,this._loadingNotification=0,this._automaticSuspend=!0,this._preventScroll=!0,this._adblockSim=!1,s&&([this._pokiEnabled,this._debugOnPreview,this._loadingNotification,this._automaticSuspend,this._preventScroll,this._adblockSim]=s),this.AddDOMMessageHandlers([["SuspendRuntime",this.SuspendRuntime.bind(this)],["ResumeRuntime",this.ResumeRuntime.bind(this)],["SetCommercialBreakConstraint",this.SetCommercialBreakConstraint.bind(this)]]),0===this._loadingNotification)runOnStartup((async e=>{e.addEventListener("beforeprojectstart",(()=>{this.PostToDOMAsync("GameLoadingFinished")}))}));else if(1===this._loadingNotification){let e=!0;runOnStartup((async t=>{const s=()=>{e?e=!1:(this.PostToDOMAsync("GameLoadingFinished"),t.getAllLayouts().forEach((e=>{e.removeEventListener("beforelayoutstart",s)})))};t.getAllLayouts().forEach((e=>e.addEventListener("beforelayoutstart",s)))}))}this._pokiEnabled&&(this._debugModeActive=this._debugOnPreview&&this._runtime.IsPreview(),this._runtime.AddLoadPromise(this.PostToDOMAsync("InitPoki",{debugMode:this._debugModeActive,preventScroll:this._preventScroll}).then((({loaded:e,adBlock:t})=>{this._adBlockDetected=t,this._pokiSDKLoaded=e,this._adblockSim&&this._runtime.IsPreview()&&(this._adBlockDetected=!0),this._pokiSDKLoaded?this._adBlockDetected&&(this._lastError="User is likely to have an AdBlock active"):this._lastError="Poki SDK did not load"})).catch(console.error)))}SuspendRuntime(){this._automaticSuspend&&this._runtime.SetSuspended(!0)}ResumeRuntime(){this._automaticSuspend&&this._runtime._suspendCount>0&&this._runtime.SetSuspended(!1)}SetCommercialBreakConstraint({constrained:e}){}Release(){super.Release()}}}self.C3.Plugins.Avix_PokiSDK_ForC3.Cnds={OnCommercialBreakComplete(e){return""===e||e===this._lastTriggeredTag},OnRewardedBreakComplete(e){return""===e||e===this._lastTriggeredTag},OnCommercialBreakPossible(){return!this._adBlockDetected},CommercialBreakPossible(){return!(!this._pokiSDKLoaded||!this._pokiEnabled)&&!this._adBlockDetected},LastAdRewardSuccess(){return this._lastAdRewardedSuccess},PokiSDKLoaded(){return this._pokiSDKLoaded},PokiPluginEnabled(){return this._pokiEnabled},AdBlockDetected(){return this._adBlockDetected},PokiDebugMode(){return this._debugModeActive}},self.C3.Plugins.Avix_PokiSDK_ForC3.Acts={NotifyLoadingFinished(){this._loadingNotification,this.PostToDOMAsync("GameLoadingFinished")},NotifyGameplayStart(){this.PostToDOMAsync("NotifyGameplayStart")},NotifyGameplayStop(){this.PostToDOMAsync("NotifyGameplayStop")},SetDebugMode(e){this._debugModeActive=e,this.PostToDOMAsync("SetDebugMode",{enable:e})},HappyTime(e){this.PostToDOMAsync("HappyTime",{intensity:e})},async RequestCommercialBreak(e){if(this._adblockSim&&this._runtime.IsPreview())return await Promise.resolve(),this._lastTriggeredTag=e,void this.Trigger(self.C3.Plugins.Avix_PokiSDK_ForC3.Cnds.OnCommercialBreakComplete);const{result:t,err:s}=await this.PostToDOMAsync("RequestCommercialBreak");s&&(this._lastError=s),this._lastTriggeredTag=e,this.Trigger(self.C3.Plugins.Avix_PokiSDK_ForC3.Cnds.OnCommercialBreakComplete)},async RequestRewardedBreak(e){if(this._adblockSim&&this._runtime.IsPreview())return await Promise.resolve(),this._lastTriggeredTag=e,this._lastAdRewardedSuccess=!1,void this.Trigger(self.C3.Plugins.Avix_PokiSDK_ForC3.Cnds.OnRewardedBreakComplete);const{result:t,err:s}=await this.PostToDOMAsync("RequestRewardedBreak");s&&(this._lastError=s),this._lastTriggeredTag=e,this._lastAdRewardedSuccess=t,this.Trigger(self.C3.Plugins.Avix_PokiSDK_ForC3.Cnds.OnRewardedBreakComplete)}},self.C3.Plugins.Avix_PokiSDK_ForC3.Exps={LastAdRewardSuccess(){return this._lastAdRewardedSuccess},CommercialBreakPossible(){return!(!this._pokiSDKLoaded||!this._pokiEnabled)&&!this._adBlockDetected},AdBlockDetected(){return this._adBlockDetected},LastError(){return this._lastError},PokiSDKLoaded(){return this._pokiSDKLoaded},PokiPluginEnabled(){return this._pokiEnabled},PokiDebugMode(){return this._debugModeActive}};{const e=self.C3;e.Behaviors.Sin=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Sin.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=0,r=1,n=2,a=3,o=4,h=5,l=6,c=7,u=8,_=0,d=1,p=2,f=3,m=4,g=5,S=6,y=7,G=8,I=9,T=0,b=1,C=2,P=3,v=4,x=2*Math.PI,R=Math.PI/2,w=3*Math.PI/2,A=[0,1,8,3,4,2,5,6,9,7];e.Behaviors.Sin.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._i=0,this._movement=0,this._wave=0,this._period=0,this._mag=0,this._isEnabled=!0,this._basePeriod=0,this._basePeriodOffset=0,this._baseMag=0,this._periodRandom=0,this._periodOffsetRandom=0,this._magnitudeRandom=0,this._initialValue=0,this._initialValue2=0,this._lastKnownValue=0,this._lastKnownValue2=0,this._ratio=0,s&&(this._movement=A[s[i]],this._wave=s[r],this._periodRandom=this._runtime.Random()*s[a],this._basePeriod=s[n],this._period=s[n],this._period+=this._periodRandom,this._basePeriodOffset=s[o],0!==this._period&&(this._periodOffsetRandom=this._runtime.Random()*s[h],this._i=s[o]/this._period*x,this._i+=this._periodOffsetRandom/this._period*x),this._magnitudeRandom=this._runtime.Random()*s[c],this._baseMag=s[l],this._mag=s[l],this._mag+=this._magnitudeRandom,this._isEnabled=!!s[u]),this._movement===g&&(this._mag=e.toRadians(this._mag)),this.Init(),this._isEnabled&&this._StartTicking()}Release(){super.Release()}SaveToJson(){return{i:this._i,e:this._isEnabled,mv:this._movement,w:this._wave,p:this._period,mag:this._mag,iv:this._initialValue,iv2:this._initialValue2,r:this._ratio,lkv:this._lastKnownValue,lkv2:this._lastKnownValue2}}LoadFromJson(e){this._i=e.i,this._SetEnabled(e.e),this._movement=e.mv,this._wave=e.w,this._period=e.p,this._mag=e.mag,this._initialValue=e.iv,this._initialValue2=e.iv2,this._ratio=e.r,this._lastKnownValue=e.lkv,this._lastKnownValue2=e.lkv2}Init(){const e=this._inst.GetWorldInfo();switch(this._movement){case _:this._initialValue=e.GetX();break;case d:this._initialValue=e.GetY();break;case p:this._initialValue=e.GetWidth(),this._ratio=e.GetHeight()/e.GetWidth();break;case f:this._initialValue=e.GetWidth();break;case m:this._initialValue=e.GetHeight();break;case g:this._initialValue=e.GetAngle();break;case S:this._initialValue=e.GetOpacity();break;case y:this._initialValue=0;break;case G:this._initialValue=e.GetX(),this._initialValue2=e.GetY();break;case I:this._initialValue=e.GetZElevation();break;default:}this._lastKnownValue=this._initialValue,this._lastKnownValue2=this._initialValue2}WaveFunc(e){switch(e%=x,this._wave){case T:return Math.sin(e);case b:return e<=R?e/R:e<=w?1-2*(e-R)/Math.PI:(e-w)/R-1;case C:return 2*e/x-1;case P:return-2*e/x+1;case v:return e<Math.PI?-1:1}return 0}Tick(){const e=this._runtime.GetDt(this._inst);this._isEnabled&&0!==e&&(0===this._period?this._i=0:this._i=(this._i+e/this._period*x)%x,this._UpdateFromPhase())}_UpdateFromPhase(){const t=this._inst.GetWorldInfo();switch(this._movement){case _:t.GetX()!==this._lastKnownValue&&(this._initialValue+=t.GetX()-this._lastKnownValue),t.SetX(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=t.GetX();break;case d:t.GetY()!==this._lastKnownValue&&(this._initialValue+=t.GetY()-this._lastKnownValue),t.SetY(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=t.GetY();break;case p:t.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag),t.SetHeight(t.GetWidth()*this._ratio);break;case f:t.SetWidth(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case m:t.SetHeight(this._initialValue+this.WaveFunc(this._i)*this._mag);break;case g:t.GetAngle()!==this._lastKnownValue&&(this._initialValue=e.clampAngle(this._initialValue+(t.GetAngle()-this._lastKnownValue))),t.SetAngle(this._initialValue+this.WaveFunc(this._i)*this._mag),this._lastKnownValue=t.GetAngle();break;case S:t.SetOpacity(this._initialValue+this.WaveFunc(this._i)*this._mag/100);break;case G:t.GetX()!==this._lastKnownValue&&(this._initialValue+=t.GetX()-this._lastKnownValue),t.GetY()!==this._lastKnownValue2&&(this._initialValue2+=t.GetY()-this._lastKnownValue2),t.SetX(this._initialValue+Math.cos(t.GetAngle())*this.WaveFunc(this._i)*this._mag),t.SetY(this._initialValue2+Math.sin(t.GetAngle())*this.WaveFunc(this._i)*this._mag),this._lastKnownValue=t.GetX(),this._lastKnownValue2=t.GetY();break;case I:t.SetZElevation(this._initialValue+this.WaveFunc(this._i)*this._mag);break}t.SetBboxChanged()}_OnSpriteFrameChanged(e,t){}_SetPeriod(e){this._period=e}_GetPeriod(){return this._period}_SetMagnitude(e){this._mag=e}_SetMagnitude_ConvertAngle(t){5===this._movement&&(t=e.toRadians(t)),this._SetMagnitude(t)}_GetMagnitude(){return this._mag}_GetMagnitude_ConvertAngle(){let t=this._GetMagnitude();return 5===this._movement&&(t=e.toDegrees(t)),t}_SetMovement(t){5===this._movement&&5!==t&&(this._mag=e.toDegrees(this._mag)),this._movement=t,this.Init()}_GetMovement(){return this._movement}_SetWave(e){this._wave=e}_GetWave(){return this._wave}_SetPhase(t){this._i=e.clamp(t,0,2*Math.PI),this._UpdateFromPhase()}_GetPhase(){return this._i}_SetEnabled(e){this._isEnabled=!!e,this._isEnabled?this._StartTicking():this._StopTicking()}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(e){switch(e){case i:return this._movement;case r:return this._wave;case n:return this._basePeriod;case l:return this._baseMag;case u:return this._isEnabled}}SetPropertyValueByIndex(t,s){switch(t){case i:this._movement=A[s],this.Init();break;case r:this._wave=s;break;case n:this._basePeriod=s,this._period=this._basePeriod+this._periodRandom,this._isEnabled||(0!==this._period?(this._i=this._basePeriodOffset/this._period*x,this._i+=this._periodOffsetRandom/this._period*x):this._i=0);break;case l:this._baseMag=s,this._mag=this._baseMag+this._magnitudeRandom,this._movement===g&&(this._mag=e.toRadians(this._mag));break;case u:this._isEnabled=!!s;break}}GetDebuggerProperties(){const e="behaviors.sin";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)},{name:e+".properties.period.name",value:this._GetPeriod(),onedit:e=>this._SetPeriod(e)},{name:e+".properties.magnitude.name",value:this._GetMagnitude_ConvertAngle(),onedit:e=>this._SetMagnitude_ConvertAngle(e)},{name:e+".debugger.value",value:this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}]}]}GetScriptInterfaceClass(){return self.ISineBehaviorInstance}};const M=new WeakMap,D=["horizontal","vertical","size","width","height","angle","opacity","value-only","forwards-backwards","z-elevation"],E=["sine","triangle","sawtooth","reverse-sawtooth","square"];self.ISineBehaviorInstance=class extends s{constructor(){super(),M.set(this,s._GetInitInst().GetSdkInstance())}set period(e){t.RequireFiniteNumber(e),M.get(this)._SetPeriod(e)}get period(){return M.get(this)._GetPeriod()}set magnitude(e){t.RequireFiniteNumber(e),M.get(this)._SetMagnitude(e)}get magnitude(){return M.get(this)._GetMagnitude()}set phase(e){M.get(this)._SetPhase(e)}get phase(){return M.get(this)._GetPhase()}set movement(e){t.RequireString(e);const s=D.indexOf(e);if(-1===s)throw new Error("invalid movement");M.get(this)._SetMovement(s)}get movement(){return D[M.get(this)._GetMovement()]}set wave(e){t.RequireString(e);const s=E.indexOf(e);if(-1===s)throw new Error("invalid wave");M.get(this)._SetWave(s)}get wave(){return E[M.get(this)._GetWave()]}get value(){const e=M.get(this);return e.WaveFunc(e._GetPhase())*e._GetMagnitude()}updateInitialState(){M.get(this).Init()}set isEnabled(e){M.get(this)._SetEnabled(!!e)}get isEnabled(){return M.get(this)._IsEnabled()}}}{const e=self.C3;e.Behaviors.Sin.Cnds={IsEnabled(){return this._IsEnabled()},CompareMovement(e){return this._GetMovement()===e},ComparePeriod(t,s){return e.compare(this._GetPeriod(),t,s)},CompareMagnitude(t,s){return e.compare(this._GetMagnitude_ConvertAngle(),t,s)},CompareWave(e){return this._GetWave()===e}}}{const e=self.C3;e.Behaviors.Sin.Acts={SetEnabled(e){this._SetEnabled(0!==e)},SetPeriod(e){this._SetPeriod(e)},SetMagnitude(e){this._SetMagnitude_ConvertAngle(e)},SetMovement(e){this._SetMovement(e)},SetWave(e){this._wave=e},SetPhase(e){const t=2*Math.PI;this._SetPhase(e*t%t)},UpdateInitialState(){this.Init()}}}{const e=self.C3;e.Behaviors.Sin.Exps={CyclePosition(){return this._GetPhase()/(2*Math.PI)},Period(){return this._GetPeriod()},Magnitude(){return this._GetMagnitude_ConvertAngle()},Value(){return this.WaveFunc(this._GetPhase())*this._GetMagnitude_ConvertAngle()}}}{const e=self.C3;e.Behaviors.solid=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.solid.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=0,r=1,n=new Set;e.Behaviors.solid.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this.SetEnabled(!0),t&&(this.SetEnabled(t[i]),this.SetTags(t[r]))}Release(){super.Release()}SetEnabled(e){this._inst._SetSolidEnabled(!!e)}IsEnabled(){return this._inst._IsSolidEnabled()}SetTags(e){const t=this._inst.GetSavedDataMap();if(!e.trim())return void t.delete("solidTags");let s=t.get("solidTags");s||(s=new Set,t.set("solidTags",s)),s.clear();for(const t of e.split(" "))t&&s.add(t.toLowerCase())}GetTags(){return this._inst.GetSavedDataMap().get("solidTags")||n}_GetTagsString(){return[...this.GetTags()].join(" ")}SaveToJson(){return{e:this.IsEnabled()}}LoadFromJson(e){this.SetEnabled(e.e)}GetPropertyValueByIndex(e){switch(e){case i:return this.IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case i:this.SetEnabled(t);break}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.solid.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this.SetEnabled(e)},{name:"behaviors.solid.properties.tags.name",value:this._GetTagsString(),onedit:e=>this.SetTags(e)}]}]}GetScriptInterfaceClass(){return self.ISolidBehaviorInstance}};const a=new WeakMap;self.ISolidBehaviorInstance=class extends s{constructor(){super(),a.set(this,s._GetInitInst().GetSdkInstance())}set isEnabled(e){a.get(this).SetEnabled(!!e)}get isEnabled(){return a.get(this).IsEnabled()}set tags(e){t.RequireString(e),a.get(this).SetTags(e)}get tags(){return a.get(this)._GetTagsString()}}}{const e=self.C3;e.Behaviors.solid.Cnds={IsEnabled(){return this.IsEnabled()}}}{const e=self.C3;e.Behaviors.solid.Acts={SetEnabled(e){this.SetEnabled(e)},SetTags(e){this.SetTags(e)}}}{const e=self.C3;e.Behaviors.solid.Exps={}}{const e=self.C3;e.Behaviors.Platform=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Platform.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=0,r=1,n=2,a=3,o=4,h=5,l=6,c=7,u=8,_=9,d=.05;function accelerate(t,s,i,r,n){const a=s*n,o=i*n;return e.clamp(t*n+.5*r*n*n,a,o)}e.Behaviors.Platform.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._keyboardDisposables=null,this._leftKey=!1,this._rightKey=!1,this._jumpKey=!1,this._jumped=!1,this._doubleJumped=!1,this._canDoubleJump=!1,this._ignoreInput=!1,this._simLeft=!1,this._simRight=!1,this._simJump=!1,this._lastFloorObject=null,this._loadFloorUid=-1,this._lastFloorX=0,this._lastFloorY=0,this._floorIsJumpthru=!1,this._wasOnFloor=!1,this._wasOverJumpthru=this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst),this._loadJumpthruUid=-1,this._animMode="stopped",this._fallThroughTime=-1,this._isFirstTick=!0,this._dx=0,this._dy=0,this._downX=0,this._downY=0,this._rightX=0,this._rightY=0,this._g=1500,this._g1=1500,this._ga=e.toRadians(90),this._maxSpeed=330,this._acc=1500,this._dec=1500,this._jumpStrength=650,this._maxFall=1e3,this._enableDoubleJump=!1,this._jumpSustain=0,this._sustainTime=0,this._defaultControls=!0,this._ceilingCollisionMode=0,this._isEnabled=!0,s&&(this._maxSpeed=s[i],this._acc=s[r],this._dec=s[n],this._jumpStrength=s[a],this._g=s[o],this._maxFall=s[h],this._enableDoubleJump=!!s[l],this._jumpSustain=s[c]/1e3,this._defaultControls=!!s[u],this._isEnabled=!!s[_]);const d=this._runtime.Dispatcher();this._disposables=new e.CompositeDisposable(e.Disposable.From(d,"instancedestroy",(e=>this._OnInstanceDestroyed(e.instance))),e.Disposable.From(d,"afterload",(e=>this._OnAfterLoad()))),this._defaultControls&&this._BindEvents(),this._isEnabled&&this._StartPostTicking(),this._UpdateGravity(),this._inst.GetUnsavedDataMap().set("isPlatformBehavior",!0)}Release(){this._keyboardDisposables&&(this._keyboardDisposables.Release(),this._keyboardDisposables=null),this._lastFloorObject=null,this._wasOverJumpthru=null,super.Release()}_BindEvents(){if(this._keyboardDisposables)return;const t=this._runtime.Dispatcher();this._keyboardDisposables=new e.CompositeDisposable(e.Disposable.From(t,"keydown",(e=>this._OnKeyDown(e.data))),e.Disposable.From(t,"keyup",(e=>this._OnKeyUp(e.data))),e.Disposable.From(t,"window-blur",(()=>this._OnWindowOrKeyboardBlur())),e.Disposable.From(t,"keyboard-blur",(()=>this._OnWindowOrKeyboardBlur())))}_UnBindEvents(){this._keyboardDisposables&&(this._keyboardDisposables.Release(),this._keyboardDisposables=null)}_OnInstanceDestroyed(e){this._lastFloorObject===e&&(this._lastFloorObject=null),this._wasOverJumpthru===e&&(this._wasOverJumpthru=null)}_OnKeyDown(e){switch(e.key){case"ArrowLeft":this._leftKey=!0;break;case"ArrowRight":this._rightKey=!0;break;case"ArrowUp":this._jumpKey=!0;break}}_OnKeyUp(e){switch(e.key){case"ArrowLeft":this._leftKey=!1;break;case"ArrowRight":this._rightKey=!1;break;case"ArrowUp":this._jumpKey=!1,this._jumped=!1;break}}_OnWindowOrKeyboardBlur(){this._leftKey=!1,this._rightKey=!1,this._jumpKey=!1,this._jumped=!1}SaveToJson(){return{ii:this._ignoreInput,lfx:this._lastFloorX,lfy:this._lastFloorY,lfo:this._lastFloorObject?this._lastFloorObject.GetUID():-1,am:this._animMode,en:this._isEnabled,fallt:this._fallThroughTime,ft:this._isFirstTick,dx:this._dx,dy:this._dy,ms:this._maxSpeed,acc:this._acc,dec:this._dec,js:this._jumpStrength,g:this._g,g1:this._g1,mf:this._maxFall,wof:this._wasOnFloor,woj:this._wasOverJumpthru?this._wasOverJumpthru.GetUID():-1,ga:this._ga,edj:this._enableDoubleJump,cdj:this._canDoubleJump,dj:this._doubleJumped,sus:this._jumpSustain,dc:this._defaultControls,cc:this._ceilingCollisionMode}}LoadFromJson(e){this._ignoreInput=e.ii,this._lastFloorX=e.lfx,this._lastFloorY=e.lfy,this._loadFloorUid=e.lfo,this._animMode=e.am;const t=e.en;this._fallThroughTime=e.fallt||-1,this._isFirstTick=e.ft,this._dx=e.dx,this._dy=e.dy,this._maxSpeed=e.ms,this._acc=e.acc,this._dec=e.dec,this._jumpStrength=e.js,this._g=e.g,this._g1=e.g1,this._maxFall=e.mf,this._wasOnFloor=e.wof,this._loadJumpthruUid=e.woj,this._ga=e.ga,this._enableDoubleJump=e.edj,this._canDoubleJump=e.cdj,this._doubleJumped=e.dj,this._jumpSustain=e.sus,this._defaultControls=e.dc,this._ceilingCollisionMode=e.cc||0,this._leftKey=!1,this._rightKey=!1,this._jumpKey=!1,this._jumped=!1,this._simLeft=!1,this._simRight=!1,this._simJump=!1,this._sustainTime=0,this._defaultControls?this._BindEvents():this._UnBindEvents(),this._SetEnabled(t),this._UpdateGravity()}_OnAfterLoad(){-1===this._loadFloorUid?this._lastFloorObject=null:this._lastFloorObject=this._runtime.GetInstanceByUID(this._loadFloorUid),-1===this._loadJumpthruUid?this._wasOverJumpthru=null:this._wasOverJumpthru=this._runtime.GetInstanceByUID(this._loadJumpthruUid)}_IsFallThroughEnabled(){return this._runtime.GetGameTime()>this._fallThroughTime+d}_UpdateGravity(){this._downX=Math.cos(this._ga),this._downY=Math.sin(this._ga),this._rightX=Math.cos(this._ga-Math.PI/2),this._rightY=Math.sin(this._ga-Math.PI/2),this._downX=e.round6dp(this._downX),this._downY=e.round6dp(this._downY),this._rightX=e.round6dp(this._rightX),this._rightY=e.round6dp(this._rightY),this._g1=this._g,this._g<0&&(this._downX*=-1,this._downY*=-1,this._g=Math.abs(this._g))}_GetGDir(){return this._g<0?-1:1}_IsOnFloor(){const e=this._inst.GetWorldInfo(),t=this._runtime.GetCollisionEngine(),s=this._inst,i=this._lastFloorObject,r=e.GetX(),n=e.GetY();if(e.OffsetXY(this._downX,this._downY),e.SetBboxChanged(),!i||!t.TestOverlap(s,i)||i.GetObjectClass().HasSolidBehavior()&&!t.IsSolidCollisionAllowed(i,s)||i.GetObjectClass().HasJumpthruBehavior()&&!i._IsJumpthruEnabled()){let i=t.TestOverlapSolid(s),a=null;if(!i&&this._IsFallThroughEnabled()&&(a=t.TestOverlapJumpthru(s,!0)),e.SetXY(r,n),e.SetBboxChanged(),i)return t.TestOverlap(s,i)?null:(this._floorIsJumpthru=!1,i);if(a&&a.length){let e=0;for(let i=0,r=a.length;i<r;++i)a[e]=a[i],t.TestOverlap(s,a[i])||++e;if(e>=1)return this._floorIsJumpthru=!0,a[0]}return null}return e.SetXY(r,n),e.SetBboxChanged(),i}PostTick(){if(!this._isEnabled)return;const e=this._runtime.GetDt(this._inst);this._jumpKey||this._simJump||(this._jumped=!1);let t=this._leftKey||this._simLeft,s=this._rightKey||this._simRight,i=this._jumpKey||this._simJump,r=i&&!this._jumped;this._simLeft=!1,this._simRight=!1,this._simJump=!1,this._ignoreInput&&(t=!1,s=!1,i=!1,r=!1),i||(this._sustainTime=0),this._HandleFirstTick();const[n,a,o]=this._TrackMovingPlatform();let h=this._IsOnFloor();const l=h&&!this._wasOnFloor;let c=!1;if([c,h]=this._MaybePushOutSolid(h),c)return;this._TrackFloor(h,o,n,i),r=this._HandleJump(h,r,i),h||this._ApplyJumpGravity(r,i,e),this._wasOnFloor=!!h;const u=this._ApplyHorizontalAcceleration(t,s,e);let _=!1,d=0;if(0!==this._dx&&(_=this._HandleHorizontalMovement(e,u,h,r)),0!==this._dy){const[t,s]=this._HandleVerticalMovement(e,h);_=_||t,d=s}!_&&l&&this._dy<0&&d>0&&(this._dy=0,_=!0),this._HandleAnimationTriggers(h,_,r),this._wasOverJumpthru=this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst)}_HandleFirstTick(){if(!this._isFirstTick)return;const e=this._inst,t=this._runtime.GetCollisionEngine();(t.TestOverlapSolid(e)||t.TestOverlapJumpthru(e))&&t.PushOutSolid(e,-this._downX,-this._downY,4,!0),this._isFirstTick=!1}_TrackMovingPlatform(){const e=this._lastFloorObject,t=e?e.GetWorldInfo():null;let s=0,i=0,r=!1;if(e&&0===this._dy&&(t.GetY()!==this._lastFloorY||t.GetX()!==this._lastFloorX)){const e=this._inst,n=e.GetWorldInfo(),a=this._runtime.GetCollisionEngine(),o=t.GetX(),h=t.GetY();s=o-this._lastFloorX,i=h-this._lastFloorY,n.OffsetXY(s,i),n.SetBboxChanged(),this._lastFloorX=o,this._lastFloorY=h,r=!0;const l=a.TestOverlapSolid(e);l&&(a.RegisterCollision(e,l),a.PushOutSolid(e,-s,-i,2.5*Math.hypot(s,i)))}return[s,i,r]}_MaybePushOutSolid(e){let t=!1;const s=this._inst,i=s.GetWorldInfo(),r=this._runtime.GetCollisionEngine(),n=r.TestOverlapSolid(s);if(!n)return[!1,e];const a=Math.abs(i.GetWidth()),o=Math.abs(i.GetHeight());if(s.GetSavedDataMap().get("inputPredicted"))r.PushOutSolid(s,-this._downX,-this._downY,10,!1);else if(r.PushOutSolid(s,-this._downX,-this._downY,o/8)){r.RegisterCollision(s,n),e=n,this._lastFloorObject=n;const t=n.GetWorldInfo();this._lastFloorX=t.GetX(),this._lastFloorY=t.GetY(),this._floorIsJumpthru=!1}else r.PushOutSolidAxis(s,this._rightX,this._rightY,a/2)||r.PushOutSolidAxis(s,this._downX,this._downY,o/2)||r.PushOutSolidNearest(s,Math.max(a,o)/2)?r.RegisterCollision(s,n):t=!0;return[t,e]}_TrackFloor(e,t,s,i){const r=this._inst,n=this._runtime.GetCollisionEngine();if(e){const i=this._downX,a=this._downY,o=this._rightX,h=this._rightY;if(this._doubleJumped=!1,this._canDoubleJump=!1,this._dy>0&&(this._wasOnFloor||(n.PushInFractional(r,-i,-a,e,16),this._wasOnFloor=!0),this._dy=0),this._lastFloorObject!==e){this._lastFloorObject=e;const t=e.GetWorldInfo();this._lastFloorX=t.GetX(),this._lastFloorY=t.GetY(),n.RegisterCollision(r,e)}else if(t){const e=n.TestOverlapSolid(r);e&&(n.RegisterCollision(r,e),0!==s&&(s>0?n.PushOutSolid(r,-o,-h):n.PushOutSolid(r,o,h)),n.PushOutSolid(r,-i,-a))}}else i||(this._canDoubleJump=!0)}_HandleJump(t,s,i){if(t&&s||!t&&this._enableDoubleJump&&i&&this._canDoubleJump&&!this._doubleJumped){const i=this._inst,r=i.GetWorldInfo(),n=this._runtime.GetCollisionEngine(),a=r.GetX(),o=r.GetY();r.OffsetXY(-this._downX,-this._downY),r.SetBboxChanged(),n.TestOverlapSolid(i)?s=!1:(this._sustainTime=this._jumpSustain,this.Trigger(e.Behaviors.Platform.Cnds.OnJump),this._animMode="jumping",this._dy=-this._jumpStrength,s=!0,t?this._jumped=!0:this._doubleJumped=!0),r.SetXY(a,o),r.SetBboxChanged()}return s}_ApplyJumpGravity(e,t,s){t&&this._sustainTime>0?(this._dy=-this._jumpStrength,this._sustainTime-=s):(this._lastFloorObject=null,this._dy+=this._g*s,this._dy>this._maxFall&&(this._dy=this._maxFall)),e&&(this._jumped=!0)}_ApplyHorizontalAcceleration(t,s,i){const r=this._acc,n=this._dec;t===s&&(this._dx<0?(this._dx+=n*i,this._dx>0&&(this._dx=0)):this._dx>0&&(this._dx-=n*i,this._dx<0&&(this._dx=0)));let a=0;return t&&!s&&(a=this._dx>0?-(r+n):-r),s&&!t&&(a=this._dx<0?r+n:r),this._dx+=a*i,this._dx=e.clamp(this._dx,-this._maxSpeed,this._maxSpeed),a}_HandleHorizontalMovement(e,t,s,i){const r=this._inst,n=r.GetWorldInfo(),a=this._runtime.GetCollisionEngine(),o=this._downX,h=this._downY,l=this._rightX,c=this._rightY,u=this._maxSpeed;let _=!1,d=n.GetX(),p=n.GetY();const f=accelerate(this._dx,-u,u,t,e)*l,m=accelerate(this._dx,-u,u,t,e)*c;n.OffsetXY(l*(this._dx>1?1:-1)-o,c*(this._dx>1?1:-1)-h),n.SetBboxChanged();let g=!1;const S=a.TestOverlapSolid(r);n.SetXY(d+f,p+m),n.SetBboxChanged();let y=a.TestOverlapSolid(r);if(!y&&s&&(y=a.TestOverlapJumpthru(r),y&&(n.SetXY(d,p),n.SetBboxChanged(),a.TestOverlap(r,y)?(y=null,g=!1):g=!0,n.SetXY(d+f,p+m),n.SetBboxChanged())),y){let t=Math.abs(this._dx*e)+2;S||!a.PushOutSolid(r,-o,-h,t,g,y)?(a.RegisterCollision(r,y),t=Math.max(Math.abs(this._dx*e*2.5),Math.floor(n.GetWidth())),a.PushOutSolid(r,l*(this._dx<0?1:-1),c*(this._dx<0?1:-1),t,!1)?!s||g||this._floorIsJumpthru||(d=n.GetX(),p=n.GetY(),n.OffsetXY(o,h),a.TestOverlapSolid(r)&&a.PushOutSolid(r,-o,-h,3,!1)||(n.SetXY(d,p),n.SetBboxChanged())):(n.SetXY(d,p),n.SetBboxChanged()),g||(this._dx=0)):!S&&!i&&Math.abs(this._dy)<Math.abs(this._jumpStrength/4)&&(this._dy=0,s||(_=!0))}else{const t=this._IsOnFloor();if(s&&!t){const t=Math.ceil(Math.abs(this._dx*e))+2;d=n.GetX(),p=n.GetY(),n.OffsetXY(o*t,h*t),n.SetBboxChanged(),a.TestOverlapSolid(r)||a.TestOverlapJumpthru(r)?a.PushOutSolid(r,-o,-h,t+2,!0):(n.SetXY(d,p),n.SetBboxChanged())}else if(t){if(!s&&this._floorIsJumpthru){this._lastFloorObject=t;const e=t.GetWorldInfo();this._lastFloorX=e.GetX(),this._lastFloorY=e.GetY(),this._dy=0,_=!0}0===this._dy&&a.PushInFractional(r,-o,-h,t,16)}}return _}_HandleVerticalMovement(t,s){const i=this._inst,r=i.GetWorldInfo(),n=this._runtime.GetCollisionEngine(),a=this._downX,o=this._downY;let h=!1,l=r.GetX(),c=r.GetY();const u=accelerate(this._dy,-1/0,this._maxFall,this._g,t);r.OffsetXY(u*a,u*o);const _=r.GetX(),d=r.GetY();r.SetBboxChanged();let p=n.TestOverlapSolid(i),f=!1;if(!p&&this._dy>0&&!s){const t=this._IsFallThroughEnabled()?n.TestOverlapJumpthru(i,!0):null;if(t&&t.length){if(this._wasOverJumpthru){r.SetXY(l,c),r.SetBboxChanged();let s=0;for(let e=0,r=t.length;e<r;++e)t[s]=t[e],n.TestOverlap(i,t[e])||++s;e.truncateArray(t,s),r.SetXY(_,d),r.SetBboxChanged()}t.length>=1&&(p=t[0])}f=!!p}if(p){n.RegisterCollision(i,p),this._sustainTime=0;let e=1.1;f&&!this._wasOverJumpthru&&(e=2);const s=Math.max(Math.abs(this._dy*t*e),2);if(n.PushOutSolid(i,a*(this._dy<0?1:-1),o*(this._dy<0?1:-1),s,f,p)){this._lastFloorObject=p;const e=p.GetWorldInfo();this._lastFloorX=e.GetX(),this._lastFloorY=e.GetY(),this._floorIsJumpthru=f,f&&(h=!0),(this._dy>0||0===this._ceilingCollisionMode)&&(this._dy=0),this._dy<0&&1===this._ceilingCollisionMode&&n.PushInFractional(i,a,o,p,32)}else r.SetXY(l,c),r.SetBboxChanged(),this._wasOnFloor=!0,f||(this._dy=0)}return[h,u]}_HandleAnimationTriggers(t,s,i){"falling"!==this._animMode&&this._dy>0&&!t&&(this.Trigger(e.Behaviors.Platform.Cnds.OnFall),this._animMode="falling"),(t||s)&&this._dy>=0&&("falling"===this._animMode||s||i&&0===this._dy?(this.Trigger(e.Behaviors.Platform.Cnds.OnLand),0===this._dx&&0===this._dy?this._animMode="stopped":this._animMode="moving"):("stopped"!==this._animMode&&0===this._dx&&0===this._dy&&(this.Trigger(e.Behaviors.Platform.Cnds.OnStop),this._animMode="stopped"),"moving"===this._animMode||0===this._dx&&0===this._dy||i||(this.Trigger(e.Behaviors.Platform.Cnds.OnMove),this._animMode="moving")))}_IsMoving(){return 0!==this._GetVectorX()||0!==this._GetVectorY()}_CheckIfStandingOnFloor(){if(0!==this._dy)return!1;const e=this._inst,t=this.GetWorldInfo(),s=this._runtime.GetCollisionEngine(),i=t.GetX(),r=t.GetY();t.OffsetXY(this._downX,this._downY),t.SetBboxChanged();const n=s.TestOverlapSolid(e);let a=null;if(!n&&this._IsFallThroughEnabled()&&(a=s.TestOverlapJumpthru(e,!0)),t.SetXY(i,r),t.SetBboxChanged(),n)return!s.TestOverlap(e,n);if(a&&a.length){let t=0;for(let i=0,r=a.length;i<r;++i)a[t]=a[i],s.TestOverlap(e,a[i])||t++;if(t>=1)return!0}return!1}_IsByWall(e){const t=this._inst,s=this.GetWorldInfo(),i=this._runtime.GetCollisionEngine(),r=s.GetX(),n=s.GetY();if(0===e?s.OffsetXY(2*-this._rightX,2*-this._rightY):s.OffsetXY(2*this._rightX,2*this._rightY),s.SetBboxChanged(),!i.TestOverlapSolid(t))return s.SetXY(r,n),s.SetBboxChanged(),!1;s.OffsetXY(3*-this._downX,3*-this._downY),s.SetBboxChanged();const a=!!i.TestOverlapSolid(t);return s.SetXY(r,n),s.SetBboxChanged(),a}_FallThroughJumpThru(){const e=this.GetWorldInfo(),t=e.GetX(),s=e.GetY();e.OffsetXY(this._downX,this._downY),e.SetBboxChanged();const i=this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst,!1);e.SetXY(t,s),e.SetBboxChanged(),i&&(this._fallThroughTime=this._runtime.GetGameTime(),this._lastFloorObject=null)}_ResetDoubleJump(e){this._doubleJumped=!e}_GetSpeed(){return Math.hypot(this._dx,this._dy)}_GetMovingAngle(){return Math.atan2(this._dy,this._dx)}_IsJumping(){return this._dy<0}_IsFalling(){return this._dy>0}_SetMaxSpeed(e){this._maxSpeed=Math.max(e,0)}_GetMaxSpeed(){return this._maxSpeed}_SetAcceleration(e){this._acc=Math.max(e,0)}_GetAcceleration(){return this._acc}_SetDeceleration(e){this._dec=Math.max(e,0)}_GetDeceleration(){return this._dec}_SetJumpStrength(e){this._jumpStrength=Math.max(e,0)}_GetJumpStrength(){return this._jumpStrength}_SetMaxFallSpeed(e){this._maxFall=Math.max(e,0)}_GetMaxFallSpeed(){return this._maxFall}_SetGravity(e){if(this._g1===e)return;this._g=e,this._UpdateGravity();const t=this._runtime.GetCollisionEngine(),s=this.GetWorldInfo();t.TestOverlapSolid(this._inst)&&(t.PushOutSolid(this._inst,this._downX,this._downY,10),s.OffsetXY(2*this._downX,2*this._downY),s.SetBboxChanged()),this._lastFloorObject=null}_GetGravity(){return this._g}_SetGravityAngle(t){t=e.clampAngle(t),this._ga!==t&&(this._ga=t,this._UpdateGravity(),this._lastFloorObject=null)}_GetGravityAngle(){return this._ga}_SetDoubleJumpEnabled(e){this._enableDoubleJump=!!e}_IsDoubleJumpEnabled(){return this._enableDoubleJump}_SetJumpSustain(e){this._jumpSustain=e}_GetJumpSustain(){return this._jumpSustain}_SetCeilingCollisionMode(e){this._ceilingCollisionMode=e}_GetCeilingCollisionMode(){return this._ceilingCollisionMode}_SetVectorX(e){this._dx=e}_GetVectorX(){return this._dx}_SetVectorY(e){this._dy=e}_GetVectorY(){return this._dy}_SimulateControl(e){if(this._isEnabled)switch(e){case 0:this._simLeft=!0;break;case 1:this._simRight=!0;break;case 2:this._simJump=!0;break}}_SetDefaultControls(e){e=!!e,this._defaultControls!==e&&(this._defaultControls=e,this._defaultControls?this._BindEvents():(this._UnBindEvents(),this._OnWindowOrKeyboardBlur()))}_IsDefaultControls(){return this._defaultControls}_SetIgnoreInput(e){this._ignoreInput=!!e}_IsIgnoreInput(){return this._ignoreInput}_SetEnabled(e){e=!!e,this._isEnabled!==e&&(this._isEnabled=e,this._isEnabled?this._StartPostTicking():(this._StopPostTicking(),this._lastFloorObject=null,this._simLeft=!1,this._simRight=!1,this._simJump=!1))}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(e){switch(e){case i:return this._GetMaxSpeed();case r:return this._GetAcceleration();case n:return this._GetDeceleration();case a:return this._GetJumpStrength();case o:return this._GetGravity();case h:return this._GetMaxFallSpeed();case l:return this._IsDoubleJumpEnabled();case c:return 1e3*this._GetJumpSustain();case u:return this._IsDefaultControls();case _:return this._IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case i:this._SetMaxSpeed(t);break;case r:this._SetAcceleration(t);break;case n:this._SetDeceleration(t);break;case a:this._SetJumpStrength(t);break;case o:this._SetGravity(t);break;case h:this._SetMaxFallSpeed(t);break;case l:this._SetDoubleJumpEnabled(!!t);break;case c:this._SetJumpSustain(t/1e3);break;case u:this._SetDefaultControls(!!t);break;case _:this._SetEnabled(!!t);break}}GetDebuggerProperties(){const t="behaviors.platform";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:t+".debugger.vector-x",value:this._GetVectorX(),onedit:e=>this._SetVectorX(e)},{name:t+".debugger.vector-y",value:this._GetVectorY(),onedit:e=>this._SetVectorY(e)},{name:t+".properties.max-speed.name",value:this._GetMaxSpeed(),onedit:e=>this._SetMaxSpeed(e)},{name:t+".properties.acceleration.name",value:this._GetAcceleration(),onedit:e=>this._SetAcceleration(e)},{name:t+".properties.deceleration.name",value:this._GetDeceleration(),onedit:e=>this._SetDeceleration(e)},{name:t+".properties.jump-strength.name",value:this._GetJumpStrength(),onedit:e=>this._SetJumpStrength(e)},{name:t+".properties.gravity.name",value:this._GetGravity(),onedit:e=>this._SetGravity(e)},{name:t+".debugger.gravity-angle",value:e.toDegrees(this._GetGravityAngle()),onedit:t=>this._SetGravityAngle(e.toRadians(t))},{name:t+".properties.max-fall-speed.name",value:this._GetMaxFallSpeed(),onedit:e=>this._SetMaxFallSpeed(e)},{name:t+".properties.double-jump.name",value:this._IsDoubleJumpEnabled(),onedit:e=>this._SetDoubleJumpEnabled(e)},{name:t+".properties.jump-sustain.name",value:1e3*this._GetJumpSustain(),onedit:e=>this._SetJumpSustain(e/1e3)},{name:t+".debugger.animation-mode",value:[t+".debugger.anim-"+this._animMode]},{name:t+".properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IPlatformBehaviorInstance}};const p=new WeakMap,f=new Map([["left",0],["right",1],["jump",2]]);self.IPlatformBehaviorInstance=class extends s{constructor(){super(),p.set(this,s._GetInitInst().GetSdkInstance())}fallThrough(){p.get(this)._FallThroughJumpThru()}resetDoubleJump(e){p.get(this)._ResetDoubleJump(!!e)}simulateControl(e){t.RequireString(e);const s=f.get(e);if("number"!=typeof s)throw new Error("invalid control");p.get(this)._SimulateControl(s)}get speed(){return p.get(this)._GetSpeed()}get maxSpeed(){return p.get(this)._GetMaxSpeed()}set maxSpeed(e){t.RequireFiniteNumber(e),p.get(this)._SetMaxSpeed(e)}get acceleration(){return p.get(this)._GetAcceleration()}set acceleration(e){t.RequireFiniteNumber(e),p.get(this)._SetAcceleration(e)}get deceleration(){return p.get(this)._GetDeceleration()}set deceleration(e){t.RequireFiniteNumber(e),p.get(this)._SetDeceleration(e)}get jumpStrength(){return p.get(this)._GetJumpStrength()}set jumpStrength(e){t.RequireFiniteNumber(e),p.get(this)._SetJumpStrength(e)}get maxFallSpeed(){return p.get(this)._GetMaxFallSpeed()}set maxFallSpeed(e){t.RequireFiniteNumber(e),p.get(this)._SetMaxFallSpeed(e)}get gravity(){return p.get(this)._GetGravity()}set gravity(e){t.RequireFiniteNumber(e),p.get(this)._SetGravity(e)}get gravityAngle(){return p.get(this)._GetGravityAngle()}set gravityAngle(e){t.RequireFiniteNumber(e),p.get(this)._SetGravityAngle(e)}get isDoubleJumpEnabled(){return p.get(this)._IsDoubleJumpEnabled()}set isDoubleJumpEnabled(e){p.get(this)._SetDoubleJumpEnabled(!!e)}get jumpSustain(){return p.get(this)._GetJumpSustain()}set jumpSustain(e){t.RequireFiniteNumber(e),p.get(this)._SetJumpSustain(e)}get ceilingCollisionMode(){return 0===p.get(this)._GetCeilingCollisionMode()?"stop":"preserve-momentum"}set ceilingCollisionMode(e){t.RequireString(e);const s=p.get(this);if("stop"===e)s._SetCeilingCollisionMode(0);else{if("preserve-momentum"!==e)throw new Error("invalid mode");s._SetCeilingCollisionMode(1)}}get isOnFloor(){return p.get(this)._CheckIfStandingOnFloor()}isByWall(e){t.RequireString(e);const s=p.get(this);if("left"===e)return s._IsByWall(0);if("right"===e)return s._IsByWall(1);throw new Error("invalid side")}get isMoving(){return p.get(this)._IsMoving()}get isJumping(){return p.get(this)._IsJumping()}get isFalling(){return p.get(this)._IsFalling()}get vectorX(){return p.get(this)._GetVectorX()}set vectorX(e){t.RequireFiniteNumber(e),p.get(this)._SetVectorX(e)}get vectorY(){return p.get(this)._GetVectorY()}set vectorY(e){t.RequireFiniteNumber(e),p.get(this)._SetVectorY(e)}setVector(e,s){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s);const i=p.get(this);i._SetVectorX(e),i._SetVectorY(s)}getVector(){const e=p.get(this);return[e._GetVectorX(),e._GetVectorY()]}get isDefaultControls(){return p.get(this)._IsDefaultControls()}set isDefaultControls(e){p.get(this)._SetDefaultControls(!!e)}get isIgnoringInput(){return p.get(this)._IsIgnoreInput()}set isIgnoringInput(e){p.get(this)._SetIgnoreInput(!!e)}get isEnabled(){return p.get(this)._IsEnabled()}set isEnabled(e){p.get(this)._SetEnabled(!!e)}}}{const e=self.C3;e.Behaviors.Platform.Cnds={IsMoving(){return this._IsMoving()},CompareSpeed(t,s){return e.compare(this._GetSpeed(),t,s)},IsOnFloor(){return this._CheckIfStandingOnFloor()},IsByWall(e){return this._IsByWall(e)},IsJumping(){return this._IsJumping()},IsFalling(){return this._IsFalling()},IsDoubleJumpEnabled(){return this._IsDoubleJumpEnabled()},OnJump:()=>!0,OnFall:()=>!0,OnStop:()=>!0,OnMove:()=>!0,OnLand:()=>!0,IsEnabled(){return this._IsEnabled()}}}{const e=self.C3;e.Behaviors.Platform.Acts={SetMaxSpeed(e){this._SetMaxSpeed(e)},SetAcceleration(e){this._SetAcceleration(e)},SetDeceleration(e){this._SetDeceleration(e)},SetJumpStrength(e){this._SetJumpStrength(e)},SetMaxFallSpeed(e){this._SetMaxFallSpeed(e)},SetGravity(e){this._SetGravity(e)},SimulateControl(e){this._SimulateControl(e)},SetIgnoreInput(e){this._SetIgnoreInput(!!e)},SetVectorX(e){this._SetVectorX(e)},SetVectorY(e){this._SetVectorY(e)},SetGravityAngle(t){this._SetGravityAngle(e.toRadians(t))},SetEnabled(e){this._SetEnabled(0!==e)},FallThrough(){this._FallThroughJumpThru()},SetDoubleJumpEnabled(e){this._SetDoubleJumpEnabled(0!==e)},SetJumpSustain(e){this._SetJumpSustain(e/1e3)},SetCeilingCollision(e){this._SetCeilingCollisionMode(e)},SetDefaultControls(e){this._SetDefaultControls(e)},ResetDoubleJump(e){this._ResetDoubleJump(e)}}}{const e=self.C3;e.Behaviors.Platform.Exps={Speed(){return this._GetSpeed()},MaxSpeed(){return this._GetMaxSpeed()},Acceleration(){return this._GetAcceleration()},Deceleration(){return this._GetDeceleration()},JumpStrength(){return this._GetJumpStrength()},Gravity(){return this._GetGravity()},GravityAngle(){return e.toDegrees(this._GetGravityAngle())},MaxFallSpeed(){return this._GetMaxFallSpeed()},MovingAngle(){return e.toDegrees(this._GetMovingAngle())},VectorX(){return this._GetVectorX()},VectorY(){return this._GetVectorY()},JumpSustain(){return 1e3*this._GetJumpSustain()}}}{const e=self.C3;e.Behaviors.MoveTo=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.MoveTo.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=0,r=1,n=2,a=3,o=4,h=5,l=6;e.Behaviors.MoveTo.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._maxSpeed=200,this._acc=600,this._dec=600,this._rotateSpeed=0,this._setAngle=!0,this._stopOnSolids=!1,this._isEnabled=!0,this._speed=0,this._movingAngle=this.GetWorldInfo().GetAngle(),this._waypoints=[],s&&(this._maxSpeed=s[i],this._acc=s[r],this._dec=s[n],this._rotateSpeed=e.toRadians(s[a]),this._setAngle=s[o],this._stopOnSolids=s[h],this._isEnabled=s[l]),this._timelineInfo=null,this._lastBezierPosition=NaN,this._lastBezierSegment=NaN}Release(){this._timelineInfo&&(this._timelineInfo.Release(),this._timelineInfo=null),this._lastBezierPosition=NaN,this._lastBezierSegment=NaN,super.Release()}SaveToJson(){return{ms:this._maxSpeed,acc:this._acc,dec:this._dec,rs:this._rotateSpeed,sa:this._setAngle,sos:this._stopOnSolids,s:this._speed,ma:this._movingAngle,wp:this._waypoints.map((e=>({x:e.x,y:e.y}))),e:this._isEnabled}}LoadFromJson(e){this._maxSpeed=e.ms,this._acc=e.acc,this._dec=e.dec,this._rotateSpeed=e.rs,this._setAngle=e.sa,this._stopOnSolids=e.sos,this._speed=e.s,this._movingAngle=e.ma,this._waypoints=e.wp.map((e=>({x:e.x,y:e.y}))),this._SetEnabled(e.e),this._isEnabled&&this._waypoints.length>0&&this._StartTicking()}_AddWaypoint(t,s,i,r){i&&e.clearArray(this._waypoints),this._waypoints.push({x:t,y:s,opts:r}),this._isEnabled&&this._StartTicking()}_GetWaypointCount(){return this._waypoints.length}_GetWaypointXAt(e){return(e=Math.floor(e))<0||e>=this._waypoints.length?0:this._waypoints[e].x}_GetWaypointYAt(e){return(e=Math.floor(e))<0||e>=this._waypoints.length?0:this._waypoints[e].y}_IsMoving(){return this._waypoints.length>0}_Stop(){e.clearArray(this._waypoints),this._speed=0,this._StopTicking()}_GetTargetX(){return this._waypoints.length>0?this._waypoints[0].x:0}_GetTargetY(){return this._waypoints.length>0?this._waypoints[0].y:0}_GetTargetIsBezier(){if(this._waypoints.length>0){const e=this._waypoints[0];if(e.opts)return e.opts.isBezier}return!1}_GetTargetIsBezierFirst(){if(this._waypoints.length>0){const e=this._waypoints[0];if(e.opts)return e.opts.isBezier&&e.opts.isFirst}return!1}_GetTargetBezierPosition(){if(this._waypoints.length>0){const e=this._waypoints[0];if(e.opts)return e.opts.bezierPosition}return!1}_GetTargetBezierSegment(){if(this._waypoints.length>0){const e=this._waypoints[0];if(e.opts)return e.opts.bezierSegment}return!1}_SetSpeed(e){this._IsMoving()&&(this._speed=Math.min(e,this._maxSpeed))}_GetSpeed(){return this._speed}_SetMaxSpeed(e){this._maxSpeed=Math.max(e,0),this._SetSpeed(this._speed)}_GetMaxSpeed(){return this._maxSpeed}_IsRotationEnabled(){return this._isEnabled&&this._IsMoving()&&this._GetTargetIsBezier()?!!this._GetTargetIsBezierFirst():0!==this._rotateSpeed}Tick(){if(!this._isEnabled||!this._IsMoving())return;const t=this._runtime.GetDt(this._inst),s=this._inst.GetWorldInfo(),i=s.GetX(),r=s.GetY(),n=s.GetAngle();let a=this._speed,o=this._maxSpeed;const h=this._acc,l=this._dec,c=this._GetTargetX(),u=this._GetTargetY(),_=e.angleTo(i,r,c,u);let d=!1;if(l>0&&1===this._waypoints.length){const t=.5*a*a/l*1.0001;if(d=e.distanceSquared(i,r,c,u)<=t*t,d){const t=e.distanceTo(i,r,c,u);a=Math.sqrt(2*l*t),o=a,this._speed=a}}if(this._IsRotationEnabled()){const t=e.angleDiff(this._movingAngle,_);if(t>Number.EPSILON){const i=t/this._rotateSpeed,r=e.distanceTo(s.GetX(),s.GetY(),c,u)/(2*Math.sin(t))*t;o=Math.min(o,e.clamp(r/i,0,this._maxSpeed))}}let p=d?-l:h;const f=Math.min(a*t+.5*p*t*t,o*t);if(d){if(l>0&&(this._speed=Math.max(this._speed-l*t,0),0===this._speed))return void this._OnArrived(s,c,u)}else this._speed=0===h?o:Math.min(this._speed+h*t,o);if(e.distanceSquared(s.GetX(),s.GetY(),c,u)<=f*f)this._OnArrived(s,c,u);else{if(this._IsRotationEnabled()?this._movingAngle=e.angleRotate(this._movingAngle,_,this._rotateSpeed*t):this._movingAngle=_,s.OffsetXY(Math.cos(this._movingAngle)*f,Math.sin(this._movingAngle)*f),this._setAngle){const e=this._GetTargetIsBezier(),t=this._GetTargetIsBezierFirst();if(e&&!t){const e=this._GetTargetBezierSegment(),t=this._GetTargetBezierPosition(),i=s.GetX(),r=s.GetY();let n;self.isNaN(this._lastBezierSegment)&&(this._lastBezierSegment=0),n=this._lastBezierSegment===e?this._timelineInfo.Project(i,r,{tRange:[this._lastBezierPosition,t]}):this._timelineInfo.Project(i,r);const a=this._timelineInfo.TangentAngle(i,r,n[2],n[4]);s.SetAngle(a)}else s.SetAngle(this._movingAngle),this._lastBezierPosition=NaN,this._lastBezierSegment=NaN}s.SetBboxChanged(),this._CheckSolidCollision(i,r,n)}}_OnArrived(t,s,i){t.SetXY(s,i),t.SetBboxChanged();const r=this._waypoints[0];r.opts&&r.opts.isBezier?(this._lastBezierPosition=r.opts.bezierPosition,this._lastBezierSegment=r.opts.bezierSegment):(this._lastBezierPosition=NaN,this._lastBezierSegment=NaN),this._waypoints.shift(),0===this._waypoints.length&&(this._timelineInfo&&(this._timelineInfo.Release(),this._timelineInfo=null,this._lastBezierPosition=NaN,this._lastBezierSegment=NaN),this._speed=0,this._StopTicking()),this.DispatchScriptEvent("arrived"),this.Trigger(e.Behaviors.MoveTo.Cnds.OnArrived)}_CheckSolidCollision(t,s,i){const r=this._runtime.GetCollisionEngine();if(this._stopOnSolids&&r.TestOverlapSolid(this._inst)){this._Stop();const n=this._inst.GetWorldInfo(),a=n.GetX(),o=n.GetY(),h=e.angleTo(a,o,t,s),l=e.distanceTo(a,o,t,s);r.PushOutSolid(this._inst,Math.cos(h),Math.sin(h),Math.max(l,1))||(n.SetXY(t,s),n.SetAngle(i),n.SetBboxChanged()),this.DispatchScriptEvent("hitsolid"),this.Trigger(e.Behaviors.MoveTo.Cnds.OnHitSolid)}}_IsSetAngle(){return this._setAngle}_SetSetAngle(e){this._setAngle=!!e}_SetAngleOfMotion(e){if(this._movingAngle=e,this._isEnabled&&this._setAngle&&!this._IsMoving()){const e=this.GetWorldInfo();e.SetAngle(this._movingAngle),e.SetBboxChanged()}}_GetAngleOfMotion(){return this._movingAngle}_SetAcceleration(e){this._acc=Math.max(e,0)}_GetAcceleration(){return this._acc}_SetDeceleration(e){this._dec=Math.max(e,0)}_GetDeceleration(){return this._dec}_SetRotateSpeed(e){this._rotateSpeed=Math.max(e,0)}_GetRotateSpeed(){return this._rotateSpeed}_SetStopOnSolids(e){this._stopOnSolids=!!e}_IsStopOnSolids(){return this._stopOnSolids}_SetEnabled(e){e=!!e,this._isEnabled!==e&&(this._isEnabled=e,this._isEnabled&&this._IsMoving()?this._StartTicking():this._StopTicking())}_IsEnabled(){return this._isEnabled}GetPropertyValueByIndex(t){switch(t){case i:return this._GetMaxSpeed();case r:return this._GetAcceleration();case n:return this._GetDeceleration();case a:return e.toDegrees(this._GetRotateSpeed());case o:return this._IsSetAngle();case h:return this._IsStopOnSolids();case l:return this._IsEnabled()}}SetPropertyValueByIndex(t,s){switch(t){case i:this._SetMaxSpeed(s);break;case r:this._SetAcceleration(s);break;case n:this._SetDeceleration(s);break;case a:this._SetRotateSpeed(e.toRadians(s));break;case o:this._SetSetAngle(s);break;case h:this._SetStopOnSolids(s);break;case l:this._SetEnabled(s);break}}GetDebuggerProperties(){const t="behaviors.moveto";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:t+".debugger.speed",value:this._GetSpeed(),onedit:e=>this._SetSpeed(e)},{name:t+".debugger.angle-of-motion",value:e.toDegrees(this._GetAngleOfMotion()),onedit:t=>this._movingAngle=e.toRadians(t)},{name:t+".debugger.target-x",value:this._GetTargetX()},{name:t+".debugger.target-y",value:this._GetTargetY()},{name:t+".debugger.waypoint-count",value:this._GetWaypointCount()},{name:t+".properties.max-speed.name",value:this._GetMaxSpeed(),onedit:e=>this._SetMaxSpeed(e)},{name:t+".properties.acceleration.name",value:this._GetAcceleration(),onedit:e=>this._SetAcceleration(e)},{name:t+".properties.deceleration.name",value:this._GetDeceleration(),onedit:e=>this._SetDeceleration(e)},{name:t+".properties.rotate-speed.name",value:e.toDegrees(this._GetRotateSpeed()),onedit:t=>this._SetRotateSpeed(e.toRadians(t))},{name:t+".properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IMoveToBehaviorInstance}};const c=new WeakMap;self.IMoveToBehaviorInstance=class extends s{constructor(){super(),c.set(this,s._GetInitInst().GetSdkInstance())}moveToPosition(e,s,i=!0){t.RequireFiniteNumber(e),t.RequireFiniteNumber(s),c.get(this)._AddWaypoint(e,s,!!i)}getTargetX(){return c.get(this)._GetTargetX()}getTargetY(){return c.get(this)._GetTargetY()}getTargetPosition(){const e=c.get(this);return[e._GetTargetX(),e._GetTargetY()]}getWaypointCount(){return c.get(this)._GetWaypointCount()}getWaypointX(e){return t.RequireFiniteNumber(e),c.get(this)._GetWaypointXAt(e)}getWaypointY(e){return t.RequireFiniteNumber(e),c.get(this)._GetWaypointYAt(e)}getWaypoint(e){t.RequireFiniteNumber(e);const s=c.get(this);return[s._GetWaypointXAt(e),s._GetWaypointYAt(e)]}stop(){c.get(this)._Stop()}get isMoving(){return c.get(this)._IsMoving()}get speed(){return c.get(this)._GetSpeed()}set speed(e){t.RequireFiniteNumber(e),c.get(this)._SetSpeed(e)}get maxSpeed(){return c.get(this)._GetMaxSpeed()}set maxSpeed(e){t.RequireFiniteNumber(e),c.get(this)._SetMaxSpeed(e)}get acceleration(){return c.get(this)._GetAcceleration()}set acceleration(e){t.RequireFiniteNumber(e),c.get(this)._SetAcceleration(e)}get deceleration(){return c.get(this)._GetDeceleration()}set deceleration(e){t.RequireFiniteNumber(e),c.get(this)._SetDeceleration(e)}get angleOfMotion(){return c.get(this)._GetAngleOfMotion()}set angleOfMotion(e){t.RequireFiniteNumber(e),c.get(this)._SetAngleOfMotion(e)}get rotateSpeed(){return c.get(this)._GetRotateSpeed()}set rotateSpeed(e){t.RequireFiniteNumber(e),c.get(this)._SetRotateSpeed(e)}get isStopOnSolids(){return c.get(this)._IsStopOnSolids()}set isStopOnSolids(e){c.get(this)._SetStopOnSolids(e)}get isEnabled(){return c.get(this)._IsEnabled()}set isEnabled(e){c.get(this)._SetEnabled(e)}}}{const e=self.C3;e.Behaviors.MoveTo.Cnds={IsMoving(){return this._IsMoving()},CompareSpeed(t,s){return e.compare(this._GetSpeed(),t,s)},IsEnabled(){return this._IsEnabled()},OnArrived:()=>!0,OnHitSolid:()=>!0}}{const e=self.C3;e.Behaviors.MoveTo.Acts={MoveToPosition(e,t,s){this._AddWaypoint(e,t,0===s)},MoveToObject(e,t,s){if(!e)return;const i=e.GetPairedInstance(this._inst);if(!i||!i.GetWorldInfo())return;const[r,n]=i.GetImagePoint(t);this._AddWaypoint(r,n,0===s)},MoveAlongPathfindingPath(t){const s=this._inst.GetBehaviorSdkInstanceFromCtor(e.Behaviors.Pathfinding);if(!s)return;const i=s._GetPath();if(0!==i.length)for(let e=0,s=i.length;e<s;++e){const s=i[e];this._AddWaypoint(s.x,s.y,0===e&&0===t)}},MoveAlongTimeline(t,s,i){const r=e.New(e.TimelineInfo,t,s);if(!r.WasInitialized())return void r.Release();r.SetOrigin(this._inst.GetWorldInfo());let n=!0;for(const e of r.segments())switch(e.GetType()){case"line":{const t=e.GetX(),s=e.GetY();this._AddWaypoint(t,s,n&&0===i),n=!1;break}case"cubic-bezier":for(let t=0;t<=e.GetStepCount();t++){const s=t*e.GetStepIncrement(),r=e.Map(s),a=r[0],o=r[1];this._AddWaypoint(a,o,n&&0===i,{isBezier:!0,isFirst:n,bezierPosition:e._Map(s),bezierSegment:e.GetIndex()}),n=!1}break}this._timelineInfo=r},MoveAlongTimelineByName(t,s,i){const r=this._runtime.GetTimelineManager().GetTimelineByName(t);r&&e.Behaviors.MoveTo.Acts.MoveAlongTimeline.call(this,r,s,i)},Stop(){this._Stop()},SetMovingAngle(t){this._SetAngleOfMotion(e.toRadians(t))},SetSpeed(e){this._SetSpeed(e)},SetMaxSpeed(e){this._SetMaxSpeed(e)},SetAcceleration(e){this._SetAcceleration(e)},SetDeceleration(e){this._SetDeceleration(e)},SetRotateSpeed(t){this._SetRotateSpeed(e.toRadians(t))},SetStopOnSolids(e){this._SetStopOnSolids(e)},SetEnabled(e){this._SetEnabled(e)}}}{const e=self.C3;e.Behaviors.MoveTo.Exps={Speed(){return this._GetSpeed()},MaxSpeed(){return this._GetMaxSpeed()},Acceleration(){return this._GetAcceleration()},Deceleration(){return this._GetDeceleration()},MovingAngle(){return e.toDegrees(this._GetAngleOfMotion())},RotateSpeed(){return e.toDegrees(this._GetRotateSpeed())},TargetX(){return this._GetTargetX()},TargetY(){return this._GetTargetY()},WaypointCount(){return this._GetWaypointCount()},WaypointXAt(e){return this._GetWaypointXAt(e)},WaypointYAt(e){return this._GetWaypointYAt(e)}}}{const e=self.C3;e.Behaviors.scrollto=class extends e.SDKBehaviorBase{constructor(e){super(e),this._shakeMag=0,this._shakeStart=0,this._shakeEnd=0,this._shakeMode=0}Release(){super.Release()}SetShakeMagnitude(e){this._shakeMag=e}GetShakeMagnitude(){return this._shakeMag}SetShakeStart(e){this._shakeStart=e}GetShakeStart(){return this._shakeStart}SetShakeEnd(e){this._shakeEnd=e}GetShakeEnd(){return this._shakeEnd}SetShakeMode(e){this._shakeMode=e}GetShakeMode(){return this._shakeMode}}}{const e=self.C3;e.Behaviors.scrollto.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=0;e.Behaviors.scrollto.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,s){super(e),this._isEnabled=!0,s&&(this._isEnabled=s[t]),this._isEnabled&&this._StartTicking2()}Release(){super.Release()}SaveToJson(){const e=this.GetBehavior();return{e:this._isEnabled,smg:e.GetShakeMagnitude(),ss:e.GetShakeStart(),se:e.GetShakeEnd(),smd:e.GetShakeMode()}}LoadFromJson(e){const t=this.GetBehavior();t.SetShakeMagnitude(e.smg),t.SetShakeStart(e.ss),t.SetShakeEnd(e.se),t.SetShakeMode(e.smd),this._isEnabled=e.e,this._isEnabled?this._StartTicking2():this._StopTicking2()}_SetEnabled(e){this._isEnabled=!!e,this._isEnabled?this._StartTicking2():this._StopTicking2()}IsEnabled(){return this._isEnabled}Tick2(){if(!this.IsEnabled())return;this._runtime.GetDt(this._inst);const t=this.GetBehavior(),s=t.GetInstances();let i=0,r=0,n=0;for(const t of s){const s=t.GetBehaviorInstanceFromCtor(e.Behaviors.scrollto);if(!s||!s.GetSdkInstance().IsEnabled())continue;const a=t.GetWorldInfo();i+=a.GetX(),r+=a.GetY(),++n}const a=this._inst.GetWorldInfo().GetLayout(),o=this._runtime.GetGameTime();let h=0,l=0;if(o>=t.GetShakeStart()&&o<t.GetShakeEnd()){let e=t.GetShakeMagnitude()*Math.min(this._runtime.GetTimeScale(),1);0===t.GetShakeMode()&&(e*=1-(o-t.GetShakeStart())/(t.GetShakeEnd()-t.GetShakeStart()));const s=this._runtime.Random()*Math.PI*2,i=this._runtime.Random()*e;h=Math.cos(s)*i,l=Math.sin(s)*i}a.SetScrollX(i/n+h),a.SetScrollY(r/n+l)}GetPropertyValueByIndex(e){switch(e){case t:return this._isEnabled}}SetPropertyValueByIndex(e,s){switch(e){case t:this._isEnabled=!!s,this._isEnabled?this._StartTicking2():this._StopTicking2();break}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.scrollto.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}}}{const e=self.C3;e.Behaviors.scrollto.Cnds={IsEnabled(){return this.IsEnabled()}}}{const e=self.C3;e.Behaviors.scrollto.Acts={Shake(e,t,s){const i=this.GetBehavior();i.SetShakeMagnitude(e),i.SetShakeStart(this._runtime.GetGameTime()),i.SetShakeEnd(this._runtime.GetGameTime()+t),i.SetShakeMode(s)},SetEnabled(e){this._SetEnabled(0!==e)}}}{const e=self.C3;e.Behaviors.scrollto.Exps={}}{const e=self.C3;e.Behaviors.Pin=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Pin.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3;e.Behaviors.Pin.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._pinInst=null,this._pinUid=-1,this._mode="",this._propSet=new Set,this._pinDist=0,this._pinAngle=0,this._pinImagePoint=0,this._dx=0,this._dy=0,this._dWidth=0,this._dHeight=0,this._dAngle=0,this._dz=0,this._lastKnownAngle=0,this._destroy=!1,s&&(this._destroy=s[0]);const i=this._runtime.Dispatcher();this._disposables=new e.CompositeDisposable(e.Disposable.From(i,"instancedestroy",(e=>this._OnInstanceDestroyed(e.instance))),e.Disposable.From(i,"afterload",(e=>this._OnAfterLoad())))}Release(){this._pinInst=null,super.Release()}_SetPinInst(e){e?(this._pinInst=e,this._StartTicking2()):(this._pinInst=null,this._StopTicking2())}_Pin(t,s,i){if(!t)return;const r=t.GetFirstPicked(this._inst);if(!r)return;this._mode=s,this._SetPinInst(r);const n=this._inst.GetWorldInfo(),a=r.GetWorldInfo();if("properties"===this._mode){const t=this._propSet;t.clear();for(const e of i)t.add(e);this._dx=n.GetX()-a.GetX(),this._dy=n.GetY()-a.GetY(),this._dAngle=n.GetAngle()-a.GetAngle(),this._lastKnownAngle=n.GetAngle(),this._dz=n.GetZElevation()-a.GetZElevation(),t.has("x")&&t.has("y")&&(this._pinAngle=e.angleTo(a.GetX(),a.GetY(),n.GetX(),n.GetY())-a.GetAngle(),this._pinDist=e.distanceTo(a.GetX(),a.GetY(),n.GetX(),n.GetY())),t.has("width-abs")?this._dWidth=n.GetWidth()-a.GetWidth():t.has("width-scale")&&(this._dWidth=n.GetWidth()/a.GetWidth()),t.has("height-abs")?this._dHeight=n.GetHeight()-a.GetHeight():t.has("height-scale")&&(this._dHeight=n.GetHeight()/a.GetHeight())}else this._pinDist=e.distanceTo(a.GetX(),a.GetY(),n.GetX(),n.GetY())}SaveToJson(){const e=this._propSet,t=this._mode,s={uid:this._pinInst?this._pinInst.GetUID():-1,m:t,d:this._destroy};return"rope"===t||"bar"===t?s.pd=this._pinDist:"properties"===t&&(s.ps=[...this._propSet],e.has("imagepoint")?s.ip=this._pinImagePoint:e.has("x")&&e.has("y")?(s.pa=this._pinAngle,s.pd=this._pinDist):(e.has("x")&&(s.dx=this._dx),e.has("y")&&(s.dy=this._dy)),e.has("angle")&&(s.da=this._dAngle,s.lka=this._lastKnownAngle),(e.has("width-abs")||e.has("width-scale"))&&(s.dw=this._dWidth),(e.has("height-abs")||e.has("height-scale"))&&(s.dh=this._dHeight),e.has("z")&&(s.dz=this._dz)),s}LoadFromJson(e){const t=e.m,s=this._propSet;if(s.clear(),this._pinUid=e.uid,"number"!=typeof t){if(this._mode=t,e.hasOwnProperty("d")&&(this._destroy=!!e.d),"rope"===t||"bar"===t)this._pinDist=e.pd;else if("properties"===t){for(const t of e.ps)s.add(t);s.has("imagepoint")?this._pinImagePoint=e.ip:s.has("x")&&s.has("y")?(this._pinAngle=e.pa,this._pinDist=e.pd):(s.has("x")&&(this._dx=e.dx),s.has("y")&&(this._dy=e.dy)),s.has("angle")&&(this._dAngle=e.da,this._lastKnownAngle=e.lka||0),(s.has("width-abs")||s.has("width-scale"))&&(this._dWidth=e.dw),(s.has("height-abs")||s.has("height-scale"))&&(this._dHeight=e.dh),s.has("z")&&(this._dz=e.dz)}}else this._LoadFromJson_Legacy(e)}_LoadFromJson_Legacy(e){const t=this._propSet,s=e.msa,i=e.tsa,r=e.pa,n=e.pd;switch(e.m){case 0:this._mode="properties",t.add("x").add("y").add("angle"),this._pinAngle=r,this._pinDist=n,this._dAngle=s-i,this._lastKnownAngle=e.lka;break;case 1:this._mode="properties",t.add("x").add("y"),this._pinAngle=r,this._pinDist=n;break;case 2:this._mode="properties",t.add("angle"),this._dAngle=s-i,this._lastKnownAngle=e.lka;break;case 3:this._mode="rope",this._pinDist=e.pd;break;case 4:this._mode="bar",this._pinDist=e.pd;break}}_OnAfterLoad(){-1===this._pinUid?this._SetPinInst(null):(this._SetPinInst(this._runtime.GetInstanceByUID(this._pinUid)),this._pinUid=-1)}_OnInstanceDestroyed(e){this._pinInst===e&&(this._SetPinInst(null),this._destroy&&this._runtime.DestroyInstance(this._inst))}Tick2(){const t=this._pinInst;if(!t)return;const s=t.GetWorldInfo(),i=this._inst.GetWorldInfo(),r=this._mode;let n=!1;if("rope"===r||"bar"===r){const t=e.distanceTo(i.GetX(),i.GetY(),s.GetX(),s.GetY());if(t>this._pinDist||"bar"===r&&t<this._pinDist){const t=e.angleTo(s.GetX(),s.GetY(),i.GetX(),i.GetY());i.SetXY(s.GetX()+Math.cos(t)*this._pinDist,s.GetY()+Math.sin(t)*this._pinDist),n=!0}}else{const r=this._propSet;let a=0;if(r.has("imagepoint")){const[e,s]=t.GetImagePoint(this._pinImagePoint);i.EqualsXY(e,s)||(i.SetXY(e,s),n=!0)}else if(r.has("x")&&r.has("y")){const e=s.GetX()+Math.cos(s.GetAngle()+this._pinAngle)*this._pinDist,t=s.GetY()+Math.sin(s.GetAngle()+this._pinAngle)*this._pinDist;i.EqualsXY(e,t)||(i.SetXY(e,t),n=!0)}else a=s.GetX()+this._dx,r.has("x")&&a!==i.GetX()&&(i.SetX(a),n=!0),a=s.GetY()+this._dy,r.has("y")&&a!==i.GetY()&&(i.SetY(a),n=!0);r.has("angle")&&(this._lastKnownAngle!==i.GetAngle()&&(this._dAngle=e.clampAngle(this._dAngle+(i.GetAngle()-this._lastKnownAngle))),a=e.clampAngle(s.GetAngle()+this._dAngle),a!==i.GetAngle()&&(i.SetAngle(a),n=!0),this._lastKnownAngle=i.GetAngle()),r.has("width-abs")&&(a=s.GetWidth()+this._dWidth,a!==i.GetWidth()&&(i.SetWidth(a),n=!0)),r.has("width-scale")&&(a=s.GetWidth()*this._dWidth,a!==i.GetWidth()&&(i.SetWidth(a),n=!0)),r.has("height-abs")&&(a=s.GetHeight()+this._dHeight,a!==i.GetHeight()&&(i.SetHeight(a),n=!0)),r.has("height-scale")&&(a=s.GetHeight()*this._dHeight,a!==i.GetHeight()&&(i.SetHeight(a),n=!0)),r.has("z")&&(a=s.GetZElevation()+this._dz,a!==i.GetZElevation()&&(i.SetZElevation(a),this._runtime.UpdateRender()))}n&&i.SetBboxChanged()}GetDebuggerProperties(){const e="behaviors.pin.debugger";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".is-pinned",value:!!this._pinInst},{name:e+".pinned-uid",value:this._pinInst?this._pinInst.GetUID():0}]}]}}}{const e=self.C3;e.Behaviors.Pin.Cnds={IsPinned(){return!!this._pinInst},WillDestroy(){return this._destroy}}}{const e=self.C3;e.Behaviors.Pin.Acts={PinByDistance(e,t){this._Pin(e,0===t?"rope":"bar")},PinByProperties(e,t,s,i,r,n,a){const o=[];t&&o.push("x"),s&&o.push("y"),i&&o.push("angle"),a&&o.push("z"),1===r?o.push("width-abs"):2===r&&o.push("width-scale"),1===n?o.push("height-abs"):2===n&&o.push("height-scale"),0!==o.length&&this._Pin(e,"properties",o)},PinByImagePoint(e,t,s,i,r,n){const a=["imagepoint"];s&&a.push("angle"),n&&a.push("z"),1===i?a.push("width-abs"):2===i&&a.push("width-scale"),1===r?a.push("height-abs"):2===r&&a.push("height-scale"),this._pinImagePoint=t,this._Pin(e,"properties",a)},SetPinDistance(e){"rope"!==this._mode&&"bar"!==this._mode||(this._pinDist=Math.max(e,0))},SetDestroy(e){this._destroy=e},Unpin(){this._SetPinInst(null),this._mode="",this._propSet.clear(),this._pinImagePoint=""},Pin(e,t){switch(t){case 0:this._Pin(e,"properties",["x","y","angle"]);break;case 1:this._Pin(e,"properties",["x","y"]);break;case 2:this._Pin(e,"properties",["angle"]);break;case 3:this._Pin(e,"rope");break;case 4:this._Pin(e,"bar");break}}}}{const e=self.C3;e.Behaviors.Pin.Exps={PinnedUID(){return this._pinInst?this._pinInst.GetUID():-1}}}{const e=self.C3;e.Behaviors.Tween=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Tween.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=e.Behaviors.Tween,s=0;t.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this._allowMultiple=!1,this._enabled=!0,t&&(this._allowMultiple=!1,this._enabled=!!t[s]),this._activeTweens=new Map,this._disabledTweens=[],this._waitingForReleaseTweens=new Map,this._finishingTween=null,this._activeTweensJson=null,this._disabledTweensJson=null,this._waitingForReleaseTweensJson=null,this._finishingTweenName="",this._enabled&&this._StartTicking2(),this._afterLoad=e=>this._OnAfterLoad(e),this.GetRuntime().Dispatcher().addEventListener("afterload",this._afterLoad)}Release(){this.GetRuntime().Dispatcher().removeEventListener("afterload",this._afterLoad),this._afterLoad=null,this._finishingTween&&(this.ReleaseAndCompleteTween(this._finishingTween),this._finishingTween=null),this.ReleaseAndCompleteTweens(),this._tweens=null,this.ClearDisabledList(),this._disabledTweens=null,this._ReleaseWaitingTweens(),this._waitingForReleaseTweens=null,super.Release()}SetEnabled(e){this._enabled=!!e,e?this._StartTicking2():this._StopTicking2();for(const t of this.AllTweens())e?this.IsInDisabledList(t)&&t.Resume():((t.IsPlaying()||t.IsScheduled())&&this.AddToDisabledList(t),t.Stop());e&&this.ClearDisabledList()}IsEnabled(){return this._enabled}AddToDisabledList(e){this._disabledTweens.push(e)}IsInDisabledList(e){return this._disabledTweens.includes(e)}ClearDisabledList(){e.clearArray(this._disabledTweens)}GetFinishingTween(){return this._finishingTween}IsInstanceValid(){const e=this.GetObjectInstance();return!!e&&!e.IsDestroyed()}GetTween(e,t,s=!1){const i=t?this.PropertyTweens(t,s):this.AllTweens(s);if(i&&i.length)for(const t of i)if(t.HasTags(e))return t}GetTweenIncludingWaitingForRelease(e,t){return this.GetTween(e,t,!0)}*GetTweens(e,t,s=!1){const i=t?this.PropertyTweens(t,s):this.AllTweens(s);if(i&&i.length)for(const t of i)t.HasTags(e)&&(yield t)}*GetTweensIncludingWaitingForRelease(e,t){yield*this.GetTweens(e,t,!0)}PropertyTweens(e,t){if(t){let t=this._activeTweens.get(e),s=this._waitingForReleaseTweens.get(e);return t||(t=[]),s||(s=[]),t.concat(s).filter((e=>e)).filter((e=>!e.IsReleased()))}{let t=this._activeTweens.get(e);return t||(t=[]),t.filter((e=>e)).filter((e=>!e.IsReleased()))}}AllTweens(e){if(e){const e=[...this._activeTweens.values()].flat(),t=[...this._waitingForReleaseTweens.values()].flat();return e.concat(t).filter((e=>e)).filter((e=>!e.IsReleased()))}return[...this._activeTweens.values()].flat().filter((e=>e)).filter((e=>!e.IsReleased()))}AllTweensIncludingWaitingForRelease(){return this.AllTweens(!0)}SaveToJson(){return{s:!1,e:!!this._enabled,at:this._SaveActiveTweensToJson(),dt:this._SaveDisabledTweensToJson(),wt:this._SaveWaitingForReleaseTweensToJson(),ft:this._SaveFinishingTweenToJson()}}LoadFromJson(e){e&&(this._activeTweensJson=e.at,this._disabledTweensJson=e.dt,this._waitingForReleaseTweensJson=e.wt,this._finishingTweenName=e.ft,this._allowMultiple=!1,this._enabled=!!e.e)}_OnAfterLoad(t){const s=this.GetRuntime().GetTimelineManager();if(this._PopulateTweenMap(this._activeTweensJson,this._activeTweens,s),this._disabledTweensJson){e.clearArray(this._disabledTweens);for(const e of this._disabledTweensJson)this._PopulateTweenArray(this._disabledTweens,e,s)}this._PopulateTweenMap(this._waitingForReleaseTweensJson,this._waitingForReleaseTweens,s),this._finishingTween=this._GetTween(this._finishingTweenName,s),this._enabled?this._StartTicking2():this._StopTicking2()}_PopulateTweenMap(t,s,i){if(t)for(const r in t){let n=s.get(r);n?e.clearArray(n):n=[];const a=t[r];for(const t of a){if(this._PopulateTweenArray(n,t.name,i))this._LoadTweenFromJson(t.name,t,i);else{const s=e.TweenState.Build({runtime:this.GetRuntime(),json:t});s.AddCompletedCallback((e=>this._FinishTriggers(e))),i.AddScheduledTimeline(s),this._PopulateTweenArray(n,s,i)}}s.set(r,n)}}_GetTween(e,t){return t.GetScheduledOrPlayingTimelineByName(e)}_PopulateTweenArray(e,t,s){if("string"!=typeof t)return!!e.push(t);{const i=this._GetTween(t,s);if(i)return!!e.push(i)}return!1}_LoadTweenFromJson(e,t,s){if("string"==typeof e){const i=this._GetTween(e,s);i&&i._LoadFromJson(t)}else e._LoadFromJson(t)}_SaveActiveTweensToJson(){const e={};for(const[t,s]of this._activeTweens)e[t]=s.filter((e=>!e.IsReleased())).map((e=>e._SaveToJson()));return e}_SaveDisabledTweensToJson(){return this._disabledTweens.filter((e=>!e.IsReleased())).map((e=>e.GetName()))}_SaveWaitingForReleaseTweensToJson(){const e={};for(const[t,s]of this._waitingForReleaseTweens)e[t]=s.map((e=>e._SaveToJson()));return e}_SaveFinishingTweenToJson(){return this._finishingTween?this._finishingTween.GetName():""}Tick2(){this._ReleaseWaitingTweens()}CreateTween(s){const i=t.Config.GetPropertyTracksConfig(s.property,s.startValue,s.endValue,s.ease,s.resultMode,this.GetObjectInstance()),r=t.Maps.GetPropertyFromIndex(s.property);t.Maps.IsValueId(r)||this.ReleaseTweens(s.property);const n=e.TweenState.Build({runtime:this.GetRuntime(),id:r,tags:s.tags,time:s.time,instance:this.GetObjectInstance(),releaseOnComplete:!!s.releaseOnComplete,loop:!!s.loop,pingPong:!!s.pingPong,repeatCount:s.repeatCount,initialValueMode:s.initialValueMode,propertyTracksConfig:i});return n.AddCompletedCallback((e=>this._FinishTriggers(e))),this._AddTween(n,s.property),n}_MaybeRemoveFromActiveTweenMap(e){const t=e.GetId();if(this._activeTweens.has(t)){const s=this._activeTweens.get(t);if(s){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}}ReleaseTween(e,t=!1){this._MaybeRemoveFromActiveTweenMap(e),e.IsReleased()||this._IsInWaitingList(e)||(e.Stop(t),this._AddToWaitingList(e))}ReleaseTweens(s,i=!1){if(e.IsFiniteNumber(s)){const r=t.Maps.GetPropertyFromIndex(s);if(!this._activeTweens.has(r))return;const n=this._activeTweens.get(r),a=this.GetFinishingTween();for(const e of n)e!==a&&(e.IsReleased()||this._IsInWaitingList(e)||(e.Stop(i),e.Release()));e.clearArray(n)}else{const t=this.GetFinishingTween();for(const e of this.AllTweens())e!==t&&(e.IsReleased()||this._IsInWaitingList(e)||(e.Stop(i),e.Release()));for(const t of this._activeTweens.keys())e.clearArray(this._activeTweens.get(t)),this._activeTweens.delete(t);this._activeTweens.clear()}}ReleaseAndCompleteTween(e){this.ReleaseTween(e,!0)}ReleaseAndCompleteTweens(){this.ReleaseTweens(NaN,!0)}GetPropertyValueByIndex(e){switch(e){case s:return this._enabled}}SetPropertyValueByIndex(e,t){switch(e){case s:this._enabled=!!t;break}}_GetBehaviorType(e){const t=e.GetInstance().GetBehaviorInstances();for(const e of t){const t=e.GetBehaviorType();if(t.GetInstanceSdkCtor()===this.constructor)return t}}Trigger(e,t,s,i){return this._runtime?super.Trigger(e):t.Trigger(e,s,i)}_FinishTriggers(e){let s,i;if(this._finishingTween=e,t.Cnds.SetFinishingTween(e),this.GetRuntime())s=this._inst,i=this._runtime,this.Trigger(t.Cnds.OnTweensFinished),this.Trigger(t.Cnds.OnAnyTweensFinished),this.ReleaseTween(e);else{if(s=e.GetInstance(),!s)return;if(s&&s.IsDestroyed())return;i=s.GetRuntime();const r=this._GetBehaviorType(e);this.Trigger(t.Cnds.OnTweensFinished,i,s,r),this.Trigger(t.Cnds.OnAnyTweensFinished,i,s,r),e.Stop()}this._finishingTween=null,t.Cnds.SetFinishingTween(null),e.GetDestroyInstanceOnComplete()&&i.DestroyInstance(s)}_AddTween(e,s){const i=t.Maps.GetPropertyFromIndex(s);this._activeTweens.has(i)||this._activeTweens.set(i,[]);this._activeTweens.get(i).push(e)}_AddToWaitingList(e){const t=e.GetId();this._waitingForReleaseTweens.has(t)||this._waitingForReleaseTweens.set(t,[]),this._waitingForReleaseTweens.get(t).push(e)}_IsInWaitingList(e){const t=e.GetId();return!!this._waitingForReleaseTweens.has(t)&&this._waitingForReleaseTweens.get(t).includes(e)}_ReleaseWaitingTweens(){if(this._waitingForReleaseTweens.size){for(const t of this._waitingForReleaseTweens.values()){for(const e of t)e.IsReleased()||e.Release();e.clearArray(t)}this._waitingForReleaseTweens.clear()}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.tween.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this.SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.ITweenBehaviorInstance}}}{const e=self.C3;let t=null;e.Behaviors.Tween.Cnds={SetFinishingTween(e){t=e},OnTweensFinished:e=>t.HasTags(e),OnAnyTweensFinished:()=>!0,IsPlaying(t){const s=[...this.GetTweensIncludingWaitingForRelease(t)];return!!s&&(!!s.length&&s.some(e.TweenState.IsPlaying))},IsAnyPlaying(){const t=[...this.AllTweensIncludingWaitingForRelease()];return!!t&&(!!t.length&&t.some(e.TweenState.IsPlaying))},IsPaused(t){const s=[...this.GetTweensIncludingWaitingForRelease(t)];return!!s&&(!!s.length&&s.some(e.TweenState.IsPaused))},IsAnyPaused(){const t=[...this.AllTweensIncludingWaitingForRelease()];return!!t&&(!!t.length&&t.some(e.TweenState.IsPaused))}}}{const e=self.C3,t=self.Ease,s=e.Behaviors.Tween;s.Acts={SetEnabled(e){this.SetEnabled(!!e)},async TweenOneProperty(...e){if(!this.IsEnabled()||!this.IsInstanceValid())return;const t=this.CreateTween(s.TweenArguments.OneProperty(this,...e));t.Play()&&await t.GetPlayPromise()},async TweenTwoProperties(...e){if(!this.IsEnabled()||!this.IsInstanceValid())return;const t=this.CreateTween(s.TweenArguments.TwoProperties(this,...e));t.Play()&&await t.GetPlayPromise()},async TweenValue(...e){if(!this.IsEnabled()||!this.IsInstanceValid())return;const t=this.CreateTween(s.TweenArguments.ValueProperty(this,...e));t.Play()&&await t.GetPlayPromise()},PauseTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))t.Stop()},PauseAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())e.Stop()},ResumeTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))t.Resume()},ResumeAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())e.Resume()},StopTweens(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.GetTweens(e))this.ReleaseTween(t)},StopAllTweens(){if(this.IsEnabled()&&this.IsInstanceValid())for(const e of this.AllTweens())this.ReleaseTween(e)},SetOnePropertyTweensEndValue(t,s,i){if(!this.IsEnabled()||!this.IsInstanceValid())return;const r=e.Behaviors.Tween.Maps.GetSinglePropertyFromIndex(s);for(const e of this.GetTweens(t))e.BeforeSetEndValues([r]),e.SetEndValue(i,r)},SetTwoPropertiesTweensEndValue(t,s,i,r){if(!this.IsEnabled()||!this.IsInstanceValid())return;const n=e.Behaviors.Tween.Maps.GetRealProperties(s);for(const e of this.GetTweens(t))e.BeforeSetEndValues(n),e.SetEndValue(i,n[0]),e.SetEndValue(r,n[1])},SetValuePropertyTweensStartValue(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e,"value"))s.SetStartValue(t,"value")},SetValuePropertyTweensEndValue(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e,"value"))s.BeforeSetEndValues(["value"]),s.SetEndValue(t,"value")},SetTweensEase(e,s){if(!this.IsEnabled()||!this.IsInstanceValid())return;const i=t.GetEaseFromIndex(s);for(const t of this.GetTweens(e))t.SetEase(i)},SetAllTweensEase(e){if(!this.IsEnabled()||!this.IsInstanceValid())return;const s=t.GetEaseFromIndex(e);for(const e of this.AllTweens())e.SetEase(s)},SetTweensTime(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetTime(t)},SetAllTweensTime(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetTime(e)},SetTweensPlaybackRate(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetPlaybackRate(t)},SetAllTweensPlaybackRate(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetPlaybackRate(e)},SetTweensDestroyOnComplete(e,t){if(this.IsEnabled()&&this.IsInstanceValid())for(const s of this.GetTweens(e))s.SetDestroyInstanceOnComplete(!!t)},SetAllTweensDestroyOnComplete(e){if(this.IsEnabled()&&this.IsInstanceValid())for(const t of this.AllTweens())t.SetDestroyInstanceOnComplete(!!e)}}}{const e=self.C3;e.Behaviors.Tween.Exps={Time(e){const t=this.GetTweenIncludingWaitingForRelease(e);return t?t.GetTime():0},Progress(e){const t=this.GetTweenIncludingWaitingForRelease(e);return t?t.GetTime()/t.GetTotalTime():0},Value(e){const t=this.GetTweenIncludingWaitingForRelease(e,"value");return t?t.GetPropertyTrack("value").GetSourceAdapterValue():0},Tags(){return this.GetFinishingTween()?this.GetFinishingTween().GetStringTags():""}}}{const e=self.C3,t=self.Ease,s=["position","size","scale"],i=["offsetX","offsetY","offsetWidth","offsetHeight","offsetAngle","offsetOpacity","offsetColor","offsetZElevation","offsetScaleX","offsetScaleY"],r=["value"],n=[].concat(s).concat(i).concat(r),a={position:["offsetX","offsetY"],size:["offsetWidth","offsetHeight"],scale:["offsetScaleX","offsetScaleY"]},o=Object.assign({},n.reduce(((e,t)=>Object.assign({},e,{[t]:[t]})),{}),a);e.Behaviors.Tween.Maps=class{constructor(){}static GetEases(){return[...t.GetRuntimeEaseNames()]}static GetEaseFromIndex(e){return[...t.GetRuntimeEaseNames()][e]}static GetPropertyFromIndex(e){return n[e]}static GetPropertyIndexFromName(e){return n.indexOf(e)}static GetPairPropertyFromIndex(e){return s[e]}static GetSinglePropertyFromIndex(e){return i[e]}static GetValuePropertyFromIndex(e){return r[e]}static GetPairProperties(e){return a[e]}static GetRealProperties(t){return e.IsString(t)?o[t]:o[n[t]]}static IsPairId(e){return!!a[e]}static IsColorId(e){return"offsetColor"===e}static IsAngleId(e){return"offsetAngle"===e}static IsOpacityId(e){return"offsetOpacity"===e}static IsValueId(e){return"value"===e}}}{const e=self.C3,t=e.Behaviors.Tween,s=new Map;t.Config=class{constructor(){}static GetPropertyTracksConfig(i,r,n,a,o,h){0===s.size&&this._CreateConfigObjects();const l=t.PropertyTypes.Pick(i);let c=s.get(l);return e.IsFiniteNumber(i)&&(i=t.Maps.GetPropertyFromIndex(i)),this._GetConfig(c,i,r,n,a,o,h)}static TransformValue(t,s){return e.Behaviors.Tween.GetPropertyTracksConfig(t).valueGetter(s)}static _CreateConfigObjects(){const e=t.PropertyTypes,s=t.ValueGetters;this._AddConfigObject(e.PAIR,this._GetPairConfig,s._GetPropertyValue),this._AddConfigObject(e.COLOR,this._GetColorConfig,s._GetColorPropertyValue),this._AddConfigObject(e.ANGLE,this._GetAngleConfig,s._GetPropertyAngleValue),this._AddConfigObject(e.VALUE,this._GetValueConfig,s._GetPropertyValue),this._AddConfigObject(e.OTHER,this._GetCommonConfig,s._GetPropertyValue)}static _AddConfigObject(e,t,i){s.set(e,this._CreateConfigObject(e,t,i))}static _CreateConfigObject(e,t,s){return{name:e,configFunc:t,valueGetter:s}}static _GetConfig(e,t,s,i,r,n,a){return e.configFunc(t,e.valueGetter(s),e.valueGetter(i),r,n,a)}static _GetPairConfig(e,s,i,r,n,a){return t.Maps.GetPairProperties(e).map(((e,a)=>({sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:s[a],endValue:i[a],ease:t.Maps.GetEaseFromIndex(r),resultMode:n})))}static _GetColorConfig(s,i,r,n,a,o){return e.Plugins.Text&&o.GetPlugin()instanceof e.Plugins.Text?{sourceId:"plugin",sourceArgs:[7],property:"color",type:"color",valueType:"color",startValue:i,endValue:r,ease:t.Maps.GetEaseFromIndex(n),resultMode:a}:{sourceId:"world-instance",property:s,type:"color",valueType:"color",startValue:i,endValue:r,ease:t.Maps.GetEaseFromIndex(n),resultMode:a}}static _GetAngleConfig(e,s,i,r,n,a){return{sourceId:"world-instance",property:e,type:"angle",valueType:"angle",startValue:s,endValue:i,ease:t.Maps.GetEaseFromIndex(r),resultMode:n}}static _GetCommonConfig(e,s,i,r,n,a){return{sourceId:"world-instance",property:e,type:"float",valueType:"numeric",startValue:s,endValue:i,ease:t.Maps.GetEaseFromIndex(r),resultMode:n}}static _GetValueConfig(e,s,i,r,n,a){return{sourceId:"value",property:e,type:"float",valueType:"numeric",startValue:s,endValue:i,ease:t.Maps.GetEaseFromIndex(r),resultMode:n}}}}{const e=self.C3,t=e.Behaviors.Tween,s={resultMode:"absolute"},i=Object.assign({},s,{tags:"",property:"",time:0,ease:0,releaseOnComplete:0,loop:!1,pingPong:!1,repeatCount:1}),r=Object.assign({},i,{initialValueMode:"current-state",startValue:0,endValue:0}),n=Object.assign({},i,{initialValueMode:"current-state",startValue:[0,0],endValue:[0,0]}),a=Object.assign({},i,{initialValueMode:"current-state",startValue:[0,0,0],endValue:[0,0,0]}),o=Object.assign({},r,{initialValueMode:"start-value"}),h=0,l=1,c=0,u=1,_=2;t.TweenArguments=class{constructor(){}static _SetCommonProperties(e,t,s,i,r,n,a,o){e.tags=t,e.time=s,e.ease=i,e.releaseOnComplete=r,e.loop=n,e.pingPong=a,e.repeatCount=o}static OneProperty(s,i,n,o,h,l,d,p,f,m){const g="string"==typeof n?n:t.Maps.GetSinglePropertyFromIndex(n),S=t.Maps.IsColorId(g)?a:r;return this._SetCommonProperties(S,i,h,l,d,p,f,m),t.Maps.IsColorId(g)?(a.endValue[c]=e.GetRValue(o),a.endValue[u]=e.GetGValue(o),a.endValue[_]=e.GetBValue(o),a.property=t.Maps.GetPropertyIndexFromName(g)):t.Maps.IsOpacityId(g)?r.endValue=o/100:r.endValue=o,S.property=t.Maps.GetPropertyIndexFromName(g),S}static TwoProperties(e,s,i,r,a,o,c,u,_,d,p){this._SetCommonProperties(n,s,o,c,u,_,d,p);const f="string"==typeof i?i:t.Maps.GetPairPropertyFromIndex(i);return n.endValue[h]=r,n.endValue[l]=a,n.property=t.Maps.GetPropertyIndexFromName(f),n}static ValueProperty(e,s,i,r,n,a,h,l,c,u){return this._SetCommonProperties(o,s,n,a,h,l,c,u),o.startValue=i,o.endValue=r,o.property=t.Maps.GetPropertyIndexFromName("value"),o}}}{const e=self.C3,t=e.Behaviors.Tween,s=[];t.PropertyTypes=class{constructor(){}static Pick(i){if(0===s.length){const e=s;e.push({checkFunc:t.Maps.IsPairId,result:this.PAIR}),e.push({checkFunc:t.Maps.IsColorId,result:this.COLOR}),e.push({checkFunc:t.Maps.IsAngleId,result:this.ANGLE}),e.push({checkFunc:t.Maps.IsValueId,result:this.VALUE}),e.push({checkFunc:()=>!0,result:this.OTHER})}e.IsFiniteNumber(i)&&(i=e.Behaviors.Tween.Maps.GetPropertyFromIndex(i));for(const e of s)if(e.checkFunc(i))return e.result}static get PAIR(){return"pair"}static get COLOR(){return"color"}static get ANGLE(){return"angle"}static get VALUE(){return"value"}static get OTHER(){return"other"}}}{const e=self.C3,t=e.Behaviors.Tween;t.ValueGetters=class{constructor(){}static _GetPropertyAngleValue(t){const s=e.toRadians(parseFloat(t));return e.clampAngle(s)}static _GetColorPropertyValue(e){return e.slice(0)}static _GetPropertyValue(e){return e}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=self.Ease,r=e.Behaviors.Tween,n=new WeakMap,a=new Map([["x",{name:"offsetX",type:"one"}],["y",{name:"offsetY",type:"one"}],["width",{name:"offsetWidth",type:"one"}],["height",{name:"offsetHeight",type:"one"}],["angle",{name:"offsetAngle",type:"one"}],["opacity",{name:"offsetOpacity",type:"one"}],["color",{name:"offsetColor",type:"color"}],["z-elevation",{name:"offsetZElevation",type:"one"}],["x-scale",{name:"offsetScaleX",type:"one"}],["y-scale",{name:"offsetScaleY",type:"one"}],["position",{name:"position",type:"two"}],["size",{name:"size",type:"two"}],["scale",{name:"scale",type:"two"}],["value",{name:"value",type:"value"}]]);function getIndexForEase(e){t.RequireString(e);const s=i.ToInternal(e);let r;if(r=s?i.GetIndexForEase(s,null):i.GetIndexForEase(e,null),-1===r)throw new Error(`invalid ease name '${e}'`);return r}const o={tags:"",destroyOnComplete:!1,loop:!1,pingPong:!1,repeatCount:1,startValue:0},h={easeToIndexFunc:getIndexForEase};self.ITweenBehaviorInstance=class extends s{constructor(){super(),n.set(this,s._GetInitInst().GetSdkInstance())}startTween(s,i,l,c,u){const _=n.get(this);if(!_.IsEnabled()||!_.IsInstanceValid())return null;const d=a.get(s);if(!d)throw new Error("invalid tween property");"one"===d.type||"value"===d.type?t.RequireNumber(i):(t.RequireArray(i),"two"===d.type?(t.RequireNumber(i[0]),t.RequireNumber(i[1])):"color"===d.type&&(t.RequireNumber(i[0]),t.RequireNumber(i[1]),t.RequireNumber(i[2]))),"angle"===s?i=e.toDegrees(i):"opacity"===s?i*=100:"color"===s&&(i=e.PackRGBEx(i[0],i[1],i[2]));const p=getIndexForEase(c);let f;if(t.RequireFiniteNumber(l),u=Object.assign({},o,u),"value"===d.type&&t.RequireNumber(u.startValue),"one"===d.type||"color"===d.type?f=_.CreateTween(r.TweenArguments.OneProperty(_,u.tags,d.name,i,l,p,!!u.destroyOnComplete,!!u.loop,!!u.pingPong,u.repeatCount)):"two"===d.type?f=_.CreateTween(r.TweenArguments.TwoProperties(_,u.tags,d.name,i[0],i[1],l,p,!!u.destroyOnComplete,!!u.loop,!!u.pingPong,u.repeatCount)):"value"===d.type&&(f=_.CreateTween(r.TweenArguments.ValueProperty(_,u.tags,u.startValue,i,l,p,!!u.destroyOnComplete,!!u.loop,!!u.pingPong,u.repeatCount))),!f.Play())throw new Error("failed to start tween");return f.GetITweenState(_,h)}*allTweens(){const e=n.get(this);for(const t of e.AllTweens())yield t.GetITweenState(e,h)}*tweensByTags(e){t.RequireString(e);const s=n.get(this);for(const t of s.GetTweens(e))yield t.GetITweenState(s,h)}get isEnabled(){return n.get(this).IsEnabled()}set isEnabled(e){n.get(this).SetEnabled(e)}}}{const e=self.C3;e.Behaviors.Rotate=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Rotate.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=0,r=1,n=2;e.Behaviors.Rotate.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._speed=0,this._acceleration=0,this._isEnabled=!0,s&&(this._speed=e.toRadians(s[i]),this._acceleration=e.toRadians(s[r]),this._isEnabled=s[n]),this._isEnabled&&this._StartTicking()}Release(){super.Release()}_SetSpeed(e){this._speed=e}_GetSpeed(){return this._speed}_SetAcceleration(e){this._acceleration=e}_GetAcceleration(){return this._acceleration}SaveToJson(){return{s:this._speed,a:this._acceleration,e:this._isEnabled}}LoadFromJson(e){this._speed=e.s,this._acceleration=e.a,this._SetEnabled(e.e)}Tick(){if(!this._isEnabled)return;const e=this._runtime.GetDt(this._inst);if(0!==e&&(0!==this._acceleration&&(this._speed+=this._acceleration*e),0!==this._speed)){const t=this._inst.GetWorldInfo();t.SetAngle(t.GetAngle()+this._speed*e),t.SetBboxChanged()}}GetPropertyValueByIndex(t){switch(t){case i:return e.toDegrees(this._GetSpeed());case r:return e.toDegrees(this._GetAcceleration());case n:return this._IsEnabled()}}SetPropertyValueByIndex(t,s){switch(t){case i:this._SetSpeed(e.toRadians(s));break;case r:this._SetAcceleration(e.toRadians(s));break;case n:this._SetEnabled(s);break}}_SetEnabled(e){this._isEnabled=!!e,this._isEnabled?this._StartTicking():this._StopTicking()}_IsEnabled(){return this._isEnabled}GetDebuggerProperties(){const t="behaviors.rotate";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:t+".properties.speed.name",value:e.toDegrees(this._GetSpeed()),onedit:t=>this._SetSpeed(e.toRadians(t))},{name:t+".properties.acceleration.name",value:e.toDegrees(this._GetAcceleration()),onedit:t=>this._SetAcceleration(e.toRadians(t))},{name:t+".properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IRotateBehaviorInstance}};const a=new WeakMap;self.IRotateBehaviorInstance=class extends s{constructor(){super(),a.set(this,s._GetInitInst().GetSdkInstance())}set speed(e){t.RequireFiniteNumber(e),a.get(this)._SetSpeed(e)}get speed(){return a.get(this)._GetSpeed()}set acceleration(e){t.RequireFiniteNumber(e),a.get(this)._SetAcceleration(e)}get acceleration(){return a.get(this)._GetAcceleration()}get isEnabled(){return a.get(this)._IsEnabled()}set isEnabled(e){a.get(this)._SetEnabled(e)}}}{const e=self.C3;e.Behaviors.Rotate.Cnds={IsEnabled(){return this._IsEnabled()}}}{const e=self.C3;e.Behaviors.Rotate.Acts={SetSpeed(t){this._SetSpeed(e.toRadians(t))},SetAcceleration(t){this._SetAcceleration(e.toRadians(t))},SetEnabled(e){this._SetEnabled(e)}}}{const e=self.C3;e.Behaviors.Rotate.Exps={Speed(){return e.toDegrees(this._GetSpeed())},Acceleration(){return e.toDegrees(this._GetAcceleration())}}}{const e=self.C3;e.Behaviors.Anchor=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Anchor.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=0,r=1,n=2,a=3,o=4;e.Behaviors.Anchor.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._anchorLeft=2,this._anchorTop=2,this._anchorRight=0,this._anchorBottom=0,this._isEnabled=!0;const h=this._inst.GetWorldInfo().GetBoundingBox();this._xLeft=h.getLeft(),this._yTop=h.getTop(),this._xRight=this._runtime.GetOriginalViewportWidth()-h.getLeft(),this._yBottom=this._runtime.GetOriginalViewportHeight()-h.getTop(),this._rDiff=this._runtime.GetOriginalViewportWidth()-h.getRight(),this._bDiff=this._runtime.GetOriginalViewportHeight()-h.getBottom(),s&&(this._anchorLeft=s[i],this._anchorTop=s[r],this._anchorRight=s[n],this._anchorBottom=s[a],this._isEnabled=!!s[o]);const l=this._runtime.Dispatcher();this._disposables=new e.CompositeDisposable(e.Disposable.From(l,"layoutchange",(()=>this._OnLayoutChange()))),this._isEnabled&&this._StartTicking()}Release(){super.Release()}SaveToJson(){return{xl:this._xLeft,yt:this._yTop,xr:this._xRight,yb:this._yBottom,rd:this._rDiff,bd:this._bDiff,al:this._anchorLeft,at:this._anchorTop,ar:this._anchorRight,ab:this._anchorBottom,e:this._isEnabled}}LoadFromJson(e){this._xLeft=e.xl,this._yTop=e.yt,this._xRight=e.xr,this._yBottom=e.yb,this._rDiff=e.rd,this._bDiff=e.bd,this._anchorLeft=e.al,this._anchorTop=e.at,this._anchorRight=e.ar,this._anchorBottom=e.ab,this._isEnabled=e.e,this._isEnabled?this._StartTicking():this._StopTicking()}_SetEnabled(e){if(this._isEnabled&&!e)this._isEnabled=!1,this._StopTicking();else if(!this._isEnabled&&e){const e=this._inst.GetWorldInfo().GetBoundingBox();this._xLeft=e.getLeft(),this._yTop=e.getTop(),this._xRight=this._runtime.GetOriginalViewportWidth()-e.getLeft(),this._yBottom=this._runtime.GetOriginalViewportHeight()-e.getTop(),this._rDiff=this._runtime.GetOriginalViewportWidth()-e.getRight(),this._bDiff=this._runtime.GetOriginalViewportHeight()-e.getBottom(),this._isEnabled=!0,this._StartTicking()}}_IsEnabled(){return this._isEnabled}_UpdatePosition(){if(!this._isEnabled)return;const e=this._inst.GetWorldInfo(),t=e.GetLayer().GetViewport();if(0===this._anchorLeft){const s=t.getLeft()+this._xLeft-e.GetBoundingBox().getLeft();0!==s&&(e.OffsetX(s),e.SetBboxChanged())}else if(1===this._anchorLeft){const s=t.getRight()-this._xRight-e.GetBoundingBox().getLeft();0!==s&&(e.OffsetX(s),e.SetBboxChanged())}if(0===this._anchorTop){const s=t.getTop()+this._yTop-e.GetBoundingBox().getTop();0!==s&&(e.OffsetY(s),e.SetBboxChanged())}else if(1===this._anchorTop){const s=t.getBottom()-this._yBottom-e.GetBoundingBox().getTop();0!==s&&(e.OffsetY(s),e.SetBboxChanged())}if(1===this._anchorRight){const s=t.getRight()-this._rDiff-e.GetBoundingBox().getRight();0!==s&&(e.OffsetX(e.GetOriginX()*s),e.SetWidth(Math.max(e.GetWidth()+s),0),e.SetBboxChanged(),this._rDiff=t.getRight()-e.GetBoundingBox().getRight())}if(1===this._anchorBottom){const s=t.getBottom()-this._bDiff-e.GetBoundingBox().getBottom();0!==s&&(e.OffsetY(e.GetOriginY()*s),e.SetHeight(Math.max(e.GetHeight()+s,0)),e.SetBboxChanged(),this._bDiff=t.getBottom()-e.GetBoundingBox().getBottom())}}Tick(){this._UpdatePosition()}_OnLayoutChange(){this._UpdatePosition()}GetPropertyValueByIndex(e){switch(e){case i:return this._anchorLeft;case r:return this._anchorTop;case n:return this._anchorRight;case a:return this._anchorBottom;case o:return this._isEnabled}}SetPropertyValueByIndex(e,t){switch(e){case i:this._anchorLeft=t;break;case r:this._anchorTop=t;break;case n:this._anchorRight=t;break;case a:this._anchorBottom=t;break;case o:this._isEnabled=!!t,this._isEnabled?this._StartTicking():this._StopTicking();break}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.anchor.properties.enabled.name",value:this._IsEnabled(),onedit:e=>this._SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IAnchorBehaviorInstance}};const h=new WeakMap;self.IAnchorBehaviorInstance=class extends s{constructor(){super(),h.set(this,s._GetInitInst().GetSdkInstance())}get isEnabled(){return h.get(this)._IsEnabled()}set isEnabled(e){h.get(this)._SetEnabled(e)}}}{const e=self.C3;e.Behaviors.Anchor.Cnds={IsEnabled(){return this._IsEnabled()}}}{const e=self.C3;e.Behaviors.Anchor.Acts={SetEnabled(e){this._SetEnabled(0!==e)}}}{const e=self.C3;e.Behaviors.Anchor.Exps={}}{const e=self.C3;e.Behaviors.Fade=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.Fade.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.C3X,s=self.IBehaviorInstance,i=0,r=1,n=2,a=3,o=4;e.Behaviors.Fade.Instance=class extends e.SDKBehaviorInstanceBase{constructor(t,s){super(t),this._fadeInTime=0,this._waitTime=0,this._fadeOutTime=0,this._destroy=!0,this._activeAtStart=!0,this._setMaxOpacity=!1,this._stage=0,this._stageTime=e.New(e.KahanSum),this._maxOpacity=this._inst.GetWorldInfo().GetOpacity()||1,s&&(this._fadeInTime=s[i],this._waitTime=s[r],this._fadeOutTime=s[n],this._destroy=!!s[a],this._activeAtStart=!!s[o],this._stage=this._activeAtStart?0:3),this._activeAtStart&&(0===this._fadeInTime?(this._stage=1,0===this._waitTime&&(this._stage=2)):(this._inst.GetWorldInfo().SetOpacity(0),this._runtime.UpdateRender())),this._StartTicking()}Release(){super.Release()}SaveToJson(){return{fit:this._fadeInTime,wt:this._waitTime,fot:this._fadeOutTime,d:this._destroy,s:this._stage,st:this._stageTime.Get(),mo:this._maxOpacity}}LoadFromJson(e){this._fadeInTime=e.fit,this._waitTime=e.wt,this._fadeOutTime=e.fot,this._destroy=e.d,this._stage=e.s,this._stageTime.Set(e.st),this._maxOpacity=e.mo,3===this._stage?this._StopTicking():this._StartTicking()}Tick(){const t=this._runtime.GetDt(this._inst);this._stageTime.Add(t);const s=this._inst.GetWorldInfo();0===this._stage&&(s.SetOpacity(this._stageTime.Get()/this._fadeInTime*this._maxOpacity),this._runtime.UpdateRender(),s.GetOpacity()>=this._maxOpacity&&(s.SetOpacity(this._maxOpacity),this._stage=1,this._stageTime.Reset(),this.DispatchScriptEvent("fadeinend"),this.Trigger(e.Behaviors.Fade.Cnds.OnFadeInEnd))),1===this._stage&&this._stageTime.Get()>=this._waitTime&&(this._stage=2,this._stageTime.Reset(),this.DispatchScriptEvent("waitend"),this.Trigger(e.Behaviors.Fade.Cnds.OnWaitEnd)),2===this._stage&&(0!==this._fadeOutTime?(s.SetOpacity(this._maxOpacity-this._stageTime.Get()/this._fadeOutTime*this._maxOpacity),this._runtime.UpdateRender(),s.GetOpacity()<=0&&(this._stage=3,this._stageTime.Reset(),this.DispatchScriptEvent("fadeoutend"),this.Trigger(e.Behaviors.Fade.Cnds.OnFadeOutEnd),this._destroy&&this._runtime.DestroyInstance(this._inst))):(this._stage=3,this._stageTime.Reset())),3===this._stage&&this._StopTicking()}_StartFade(){this._activeAtStart||this._setMaxOpacity||(this._maxOpacity=this._inst.GetWorldInfo().GetOpacity()||1,this._setMaxOpacity=!0),3===this._stage&&this.Start()}_RestartFade(){this.Start()}Start(){this._stage=0,this._stageTime.Reset(),0===this._fadeInTime?(this._stage=1,0===this._waitTime&&(this._stage=2)):(this._inst.GetWorldInfo().SetOpacity(0),this._runtime.UpdateRender()),this._StartTicking()}_SetFadeInTime(e){this._fadeInTime=Math.max(e,0)}_GetFadeInTime(){return this._fadeInTime}_SetWaitTime(e){this._waitTime=Math.max(e,0)}_GetWaitTime(){return this._waitTime}_SetFadeOutTime(e){this._fadeOutTime=Math.max(e,0)}_GetFadeOutTime(){return this._fadeOutTime}GetPropertyValueByIndex(e){switch(e){case i:return this._GetFadeInTime();case r:return this._GetWaitTime();case n:return this._GetFadeOutTime();case a:return this._destroy}}SetPropertyValueByIndex(e,t){switch(e){case i:this._SetFadeInTime(t);break;case r:this._SetWaitTime(t);break;case n:this._SetFadeOutTime(t);break;case a:this._destroy=!!t;break}}GetDebuggerProperties(){const e="behaviors.fade";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:e+".properties.fade-in-time.name",value:this._GetFadeInTime(),onedit:e=>this._SetFadeInTime(e)},{name:e+".properties.wait-time.name",value:this._GetWaitTime(),onedit:e=>this._SetWaitTime(e)},{name:e+".properties.fade-out-time.name",value:this._GetFadeOutTime(),onedit:e=>this._SetFadeOutTime(e)},{name:e+".debugger.stage",value:[e+".debugger."+["fade-in","wait","fade-out","done"][this._stage]]}]}]}GetScriptInterfaceClass(){return self.IFadeBehaviorInstance}};const h=new WeakMap;self.IFadeBehaviorInstance=class extends s{constructor(){super(),h.set(this,s._GetInitInst().GetSdkInstance())}startFade(){h.get(this)._StartFade()}restartFade(){h.get(this)._RestartFade()}set fadeInTime(e){t.RequireFiniteNumber(e),h.get(this)._SetFadeInTime(e)}get fadeInTime(){return h.get(this)._GetFadeInTime()}set waitTime(e){t.RequireFiniteNumber(e),h.get(this)._SetWaitTime(e)}get waitTime(){return h.get(this)._GetWaitTime()}set fadeOutTime(e){t.RequireFiniteNumber(e),h.get(this)._SetFadeOutTime(e)}get fadeOutTime(){return h.get(this)._GetFadeOutTime()}}}{const e=self.C3;e.Behaviors.Fade.Cnds={OnFadeOutEnd:()=>!0,OnFadeInEnd:()=>!0,OnWaitEnd:()=>!0}}{const e=self.C3;e.Behaviors.Fade.Acts={StartFade(){this._StartFade()},RestartFade(){this._RestartFade()},SetFadeInTime(e){this._SetFadeInTime(e)},SetWaitTime(e){this._SetWaitTime(e)},SetFadeOutTime(e){this._SetFadeOutTime(e)}}}{const e=self.C3;e.Behaviors.Fade.Exps={FadeInTime(){return this._GetFadeInTime()},WaitTime(){return this._GetWaitTime()},FadeOutTime(){return this._GetFadeOutTime()}}}{const e=self.C3;e.Behaviors.jumpthru=class extends e.SDKBehaviorBase{constructor(e){super(e)}Release(){super.Release()}}}{const e=self.C3;e.Behaviors.jumpthru.Type=class extends e.SDKBehaviorTypeBase{constructor(e){super(e)}Release(){super.Release()}OnCreate(){}}}{const e=self.C3,t=self.IBehaviorInstance,s=0;e.Behaviors.jumpthru.Instance=class extends e.SDKBehaviorInstanceBase{constructor(e,t){super(e),this.SetEnabled(!0),t&&this.SetEnabled(t[s])}Release(){super.Release()}SetEnabled(e){this._inst._SetJumpthruEnabled(!!e)}IsEnabled(){return this._inst._IsJumpthruEnabled()}SaveToJson(){return{e:this.IsEnabled()}}LoadFromJson(e){this.SetEnabled(e.e)}GetPropertyValueByIndex(e){switch(e){case s:return this.IsEnabled()}}SetPropertyValueByIndex(e,t){switch(e){case s:this.SetEnabled(t);break}}GetDebuggerProperties(){return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.jumpthru.properties.enabled.name",value:this.IsEnabled(),onedit:e=>this.SetEnabled(e)}]}]}GetScriptInterfaceClass(){return self.IJumpthruBehaviorInstance}};const i=new WeakMap;self.IJumpthruBehaviorInstance=class extends t{constructor(){super(),i.set(this,t._GetInitInst().GetSdkInstance())}set isEnabled(e){i.get(this).SetEnabled(!!e)}get isEnabled(){return i.get(this).IsEnabled()}}}{const e=self.C3;e.Behaviors.jumpthru.Cnds={IsEnabled(){return this.IsEnabled()}}}{const e=self.C3;e.Behaviors.jumpthru.Acts={SetEnabled(e){this.SetEnabled(e)}}}{const e=self.C3;e.Behaviors.jumpthru.Exps={}}{const e=self.C3;self.C3_GetObjectRefTable=function(){return[e.Plugins.Sprite,e.Plugins.TiledBg,e.Behaviors.Sin,e.Plugins.Browser,e.Plugins.Keyboard,e.Plugins.Touch,e.Plugins.PlatformInfo,e.Behaviors.solid,e.Behaviors.Platform,e.Behaviors.MoveTo,e.Behaviors.scrollto,e.Behaviors.Pin,e.Behaviors.Tween,e.Plugins.Particles,e.Behaviors.Rotate,e.Behaviors.Anchor,e.Behaviors.Fade,e.Behaviors.jumpthru,e.Plugins.Mouse,e.Plugins.Spritefont2,e.Plugins.Arr,e.Plugins.Audio,e.Plugins.Avix_PokiSDK_ForC3,e.Plugins.Touch.Cnds.OnTapGestureObject,e.Plugins.System.Acts.RestartLayout,e.Plugins.System.Cnds.Every,e.Plugins.System.Cnds.CompareVar,e.Plugins.System.Acts.SubVar,e.Plugins.Spritefont2.Acts.SetText,e.Plugins.Spritefont2.Cnds.OnCreated,e.Plugins.Arr.Acts.JSONLoad,e.Plugins.Spritefont2.Acts.SetCharacterWidth,e.Plugins.System.Cnds.For,e.Plugins.Arr.Exps.Height,e.Plugins.Arr.Exps.At,e.Plugins.System.Exps.loopindex,e.Plugins.System.Cnds.IsGroupActive,e.Plugins.System.Cnds.OnLayoutStart,e.Plugins.System.Acts.SetVar,e.Plugins.System.Exps.viewportright,e.Plugins.System.Acts.SetLayerVisible,e.Plugins.Spritefont2.Acts.SetY,e.Plugins.System.Exps.viewporttop,e.Plugins.Spritefont2.Exps.Height,e.Plugins.Sprite.Acts.SetSize,e.Plugins.System.Exps.viewportwidth,e.Plugins.System.Exps.viewportheight,e.Plugins.Sprite.Acts.SetY,e.Plugins.System.Exps.viewportbottom,e.Plugins.Sprite.Exps.Height,e.Plugins.Sprite.Acts.SetScale,e.Plugins.Sprite.Acts.SetVisible,e.Plugins.Spritefont2.Acts.SetVisible,e.Plugins.Sprite.Acts.SetInstanceVar,e.Plugins.System.Exps.choose,e.Plugins.Avix_PokiSDK_ForC3.Acts.NotifyGameplayStart,e.Plugins.System.Cnds.TriggerOnce,e.Plugins.System.Acts.SetGroupActive,e.Plugins.System.Acts.CreateObject,e.Plugins.System.Exps.random,e.Plugins.Sprite.Exps.X,e.Plugins.Sprite.Exps.Y,e.Behaviors.Pin.Acts.PinByProperties,e.Plugins.Sprite.Acts.SetPos,e.Plugins.System.Exps.viewportleft,e.Plugins.Sprite.Cnds.OnAnimFinished,e.Plugins.Sprite.Acts.Destroy,e.Plugins.System.Cnds.EveryTick,e.Plugins.System.Acts.SetLayerScale,e.Plugins.Sprite.Cnds.PickInstVarHiLow,e.Plugins.System.Exps.int,e.Behaviors.Platform.Cnds.IsMoving,e.Behaviors.Platform.Cnds.IsOnFloor,e.Plugins.Particles.Acts.SetPos,e.Plugins.Sprite.Exps.ImagePointX,e.Plugins.Sprite.Exps.ImagePointY,e.Plugins.System.Cnds.Else,e.Plugins.Sprite.Cnds.IsOverlapping,e.Plugins.Sprite.Cnds.IsAnimPlaying,e.Plugins.Sprite.Acts.SetAngle,e.Plugins.Sprite.Exps.Angle,e.Plugins.Touch.Cnds.IsTouchingObject,e.Plugins.Sprite.Cnds.CompareOpacity,e.Behaviors.Tween.Acts.TweenValue,e.Behaviors.Tween.Cnds.IsPlaying,e.Plugins.Sprite.Acts.SetOpacity,e.Behaviors.Tween.Exps.Value,e.Plugins.System.Acts.Wait,e.Plugins.Sprite.Cnds.CompareInstanceVar,e.Plugins.System.Acts.WaitForPreviousActions,e.Plugins.Sprite.Acts.AddInstanceVar,e.Behaviors.Platform.Acts.SimulateControl,e.Plugins.Keyboard.Cnds.IsKeyDown,e.Plugins.Keyboard.Cnds.OnKeyReleased,e.Behaviors.Platform.Cnds.OnJump,e.Plugins.Sprite.Acts.SetAnim,e.Behaviors.Platform.Cnds.OnFall,e.Behaviors.Platform.Exps.VectorX,e.Plugins.Sprite.Acts.SetMirrored,e.Plugins.Sprite.Cnds.OnCollision,e.Plugins.Sprite.Acts.MoveToTop,e.Plugins.Audio.Acts.Play,e.Plugins.Mouse.Cnds.IsOverObject,e.Plugins.System.Cnds.LayerVisible,e.Plugins.Sprite.Acts.SetDefaultColor,e.Behaviors.MoveTo.Acts.MoveToObject,e.Behaviors.Platform.Acts.SetEnabled,e.Plugins.Sprite.Acts.MoveToLayer,e.Plugins.Keyboard.Cnds.OnKey,e.Plugins.Avix_PokiSDK_ForC3.Acts.NotifyGameplayStop,e.Plugins.System.Acts.SetTimescale,e.Plugins.System.Acts.GoToLayout,e.Plugins.Sprite.Cnds.CompareY,e.Plugins.Sprite.Acts.StartAnim,e.Behaviors.Platform.Acts.SetJumpStrength,e.Plugins.Sprite.Cnds.CompareFrame,e.Behaviors.Platform.Acts.SetMaxSpeed,e.Behaviors.Platform.Acts.SetGravity,e.Behaviors.Pin.Acts.Unpin,e.Plugins.Sprite.Cnds.CompareHeight,e.Plugins.System.Cnds.PickRandom,e.Plugins.Sprite.Acts.SetAnimFrame,e.Plugins.Sprite.Exps.Width,e.Plugins.Sprite.Acts.SetX,e.Behaviors.MoveTo.Acts.MoveToPosition,e.Plugins.Avix_PokiSDK_ForC3.Acts.RequestCommercialBreak,e.Plugins.Sprite.Cnds.IsMirrored,e.Behaviors.Fade.Acts.SetWaitTime,e.Plugins.Sprite.Acts.SetWidth,e.Plugins.Sprite.Cnds.CompareWidth,e.Plugins.Sprite.Acts.SetHeight,e.Plugins.PlatformInfo.Cnds.IsOnMobile,e.Plugins.PlatformInfo.Cnds.IsOnWindows,e.Plugins.PlatformInfo.Cnds.IsOnLinux,e.Plugins.PlatformInfo.Cnds.IsOnChromeOS,e.Plugins.PlatformInfo.Cnds.IsOnMacOS,e.Plugins.TiledBg.Exps.X,e.Plugins.System.Acts.SetLayoutEffectEnabled,e.Plugins.TiledBg.Acts.SetDefaultColor,e.Plugins.TiledBg.Acts.SetVisible,e.Plugins.Avix_PokiSDK_ForC3.Acts.RequestRewardedBreak,e.Plugins.Sprite.Cnds.PickByUID,e.Plugins.Sprite.Cnds.IsVisible,e.Plugins.Audio.Acts.SetMasterVolume,e.Plugins.Audio.Cnds.IsTagPlaying]},self.C3_JsPropNameTable=[{comp_logo:0},{down_meu:0},{menu_bg:0},{Sine:0},{Sprite8:0},{up_meu:0},{Browser:0},{Keyboard:0},{Touch:0},{PlatformInfo:0},{Solid:0},{platform_map1:0},{MOVE:0},{xx:0},{VecX:0},{jump:0},{shield:0},{str:0},{t:0},{Platform:0},{MoveTo:0},{p1:0},{ScrollTo:0},{camera:0},{VectX:0},{p2:0},{vectx:0},{p3:0},{yy:0},{Pin:0},{picker:0},{center:0},{Sprite2:0},{Sprite3:0},{batut:0},{naklon:0},{p4:0},{red_skin:0},{Tween:0},{red_movebutton:0},{blue_skin:0},{blue_movebutton:0},{step_part:0},{trumpline_partciles:0},{map1_bg:0},{platformup_map1:0},{tree:0},{Sprite7:0},{teleType:0},{pos:0},{Rotate:0},{teleport1:0},{teleport2:0},{star_part:0},{on:0},{home_btn:0},{star_part2:0},{dino:0},{black_bg:0},{step_part2:0},{pause_logo:0},{resume_btn:0},{exit_btn:0},{yellow_skin:0},{yellow_movebutton:0},{"2pl_btn":0},{"3pl_btn":0},{"4pl_btn":0},{green_movebutton:0},{green_skin:0},{Anchor:0},{TiledBackground4:0},{level_select_shtorka:0},{map_1:0},{map_2:0},{map_3:0},{step_part3:0},{step_part4:0},{TiledBackground5:0},{P1_control:0},{P2_control:0},{P3_control:0},{P4_control:0},{start_btn:0},{menu_bg_right:0},{menu_bg_left:0},{back_btn:0},{settings_btn:0},{Sprite6:0},{Fade:0},{imgtxt_menu:0},{ch:0},{arrow_ls:0},{use:0},{cou:0},{spawner_items:0},{item:0},{settings_window:0},{SETTINGS_button:0},{SETTINGS_button2:0},{set_timer:0},{set_timer2:0},{set_timer3:0},{close_btn:0},{Sprite9:0},{TiledBackground6:0},{win_character:0},{win_btn:0},{win_btn2:0},{win_lose_counter:0},{shield1:0},{shield2:0},{shield3:0},{shield4:0},{platform_map2:0},{platformup_map2:0},{map2_bg:0},{Sprite:0},{YY:0},{WIN_MENU_GO:0},{TiledBackground:0},{platform_map3:0},{platformup_map3:0},{map3_bg:0},{Jumpthru:0},{platform_map3_op:0},{setting_image_txt:0},{Sprite4:0},{Sprite5:0},{loading_txt:0},{pause_img:0},{Mouse:0},{SpriteFont:0},{Array:0},{teleport_part:0},{tag_part:0},{jump_part:0},{buff_part:0},{Audio:0},{audio_btn:0},{TiledBackground7:0},{PokiSDK:0},{Sprite10:0},{Sprite11:0},{Sprite12:0},{playersCount:0},{hiX:0},{loX:0},{hiY:0},{loY:0},{voda:0},{tou:0},{timer:0},{cd:0},{choo:0},{anim:0},{vp:0},{vp2:0},{pc_control:0},{buffs:0},{timeset:0},{map:0},{platform:0},{audio:0}]}{const e=self.C3;function unaryminus(e){return"number"==typeof e?-e:e}function bothNumbers(e,t){return"number"==typeof e&&"number"==typeof t}function add(e,t){return bothNumbers(e,t)?e+t:e}function subtract(e,t){return bothNumbers(e,t)?e-t:e}function multiply(e,t){return bothNumbers(e,t)?e*t:e}function divide(e,t){return bothNumbers(e,t)?e/t:e}function mod(e,t){return bothNumbers(e,t)?e%t:e}function pow(e,t){return bothNumbers(e,t)?Math.pow(e,t):e}function and(e,t){if("string"==typeof e||"string"==typeof t){let s,i;return s="number"==typeof e?(Math.round(1e10*e)/1e10).toString():e,i="number"==typeof t?(Math.round(1e10*t)/1e10).toString():t,s+i}return e&&t?1:0}function or(e,t){return bothNumbers(e,t)?e||t?1:0:e}self.C3_ExpressionFuncs=[()=>1,()=>10,e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()},()=>'{"c2array":true,"size":[2,38,1],"data":[[[10],[21],[25],[26],[27],[28],[29],[30],[31],[35],[36],[37],[41],[44],[45],[47],[49],[53],[54],[55],[56],[57],[58],[59],[60],[61],[62],[63],[64],[65],[67],[68],[69],[75],[77],[81],[82],[95]],[["|"],["\'"],["Ii"],[".:"],[",`"],["()"],[";"],["-"],["!"],["1<>"],["\\""],[""],["]"],["[*"],["Ll?"],["Jj"],["EFef+="],["7"],["Cc"],["Pp_"],["Hh"],["Vv"],["BDNTbdnt5"],["Rr3\\\\$"],["Kk4"],["SUsu69"],["OYoy"],["Zz2"],["AXax"],["~%"],["Qq8&"],["Gg"],["0"],["#"],["/"],["Ww"],["Mm"],["@"]]]}',()=>" ",()=>16,()=>"",()=>0,e=>{const t=e._GetNode(0);return()=>t.ExpObject()},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject(1,s())},e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject(0,s())},()=>"Start",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(0)},()=>"win",e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t("ui")+s.ExpObject()/2},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod();return()=>(t("ui")+s("ui"))/50},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t("ui")-s.ExpObject()/2},()=>1.5,e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t("pause")-s.ExpObject()/2},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1,2,3,4,5)},()=>2,()=>"player1_osn",()=>"player2_osn",()=>"player3_osn",()=>"player4_osn",()=>"game",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(2500,3400)},()=>1450,e=>{const t=e._GetNode(0);return()=>t.ExpObject()-8},()=>999,e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1).GetBoundMethod();return()=>(t("ui")+s("ui"))/15},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("ui")},()=>"player1_mobile",()=>"player2_mobile",()=>"player1_pc",()=>"player2_pc",()=>"player1_pc2",()=>"player2_pc2",()=>3,()=>"player3_mobile",()=>"player3_pc",()=>"player3_pc2",()=>4,()=>"player4_mobile",()=>"player4_pc",()=>"player4_pc2",()=>"buff_create",()=>"buff",()=>"1",()=>99,()=>"camera",t=>{const s=t._GetNode(0).GetVar(),i=t._GetNode(1).GetVar(),r=t._GetNode(2).GetVar(),n=t._GetNode(3).GetVar(),a=t._GetNode(4).GetVar();return()=>1-e.distanceTo(s.GetValue(),i.GetValue(),r.GetValue(),n.GetValue())/(3.5*a.GetValue())},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>(t.ExpObject()+s.ExpObject())/2},e=>{const t=e._GetNode(0).GetVar(),s=e._GetNode(1).GetVar();return()=>(t.GetValue()+s.GetValue())/2},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t(s.ExpInstVar())},()=>"skins angle",e=>{const t=e._GetNode(0);return()=>t.ExpObject(1)},()=>"star",t=>{const s=t._GetNode(0),i=t._GetNode(1);return()=>e.lerp(s.ExpObject(),i.ExpObject(),.1)},()=>"buttons_opacity",()=>100,()=>"rb1",()=>25,e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("rb1")},()=>"bb1",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior("bb1")},()=>1e-9,()=>.01,()=>.001,()=>"jump",e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()+s.ExpObject()/2},()=>"fall",()=>"run",()=>"idle",e=>{const t=e._GetNode(0);return()=>t.ExpBehavior()},()=>"osn",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1,2)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1,2,3)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1,2,3,4)},()=>"game2",()=>"pause",()=>13158600,()=>16777215,()=>"teleporter",()=>"teleport pos",()=>3331,()=>1848,()=>1286,()=>1148,()=>1490,()=>1709,()=>4068,()=>1097,()=>1669,()=>2141,()=>3337,()=>1086,()=>4243,()=>2349,()=>2173,()=>1936,()=>5,()=>4642,()=>1393,()=>1178,()=>2341,()=>4785.524456,()=>2363.483971,()=>2708.064864,()=>1062.446862,()=>2947,()=>2352,()=>4485,()=>949,()=>1888,()=>1732,()=>4665,()=>1938,()=>1688,()=>961,()=>3686,()=>1785,()=>1519,()=>1509,()=>4483,()=>951,()=>4821.389827,()=>2374.344054,()=>4825.104563,()=>1919.312621,()=>4427,()=>1922,()=>2290,()=>1394,()=>4055,()=>1542,()=>1991,()=>2084,()=>4580,()=>1441,()=>1160,()=>2359,()=>3597,()=>1325,()=>1174,()=>1752,e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject()+s(5,15)},()=>.1,()=>15,e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(2,3,4,5)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1,3,4,5)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(2,1,4,5)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(2,3,1,5)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(2,3,4,1)},()=>"move_platform",()=>"pause_menu",()=>1e-4,()=>"trampoline",e=>{const t=e._GetNode(0);return()=>t.ExpObject()+20},()=>1800,()=>.2,()=>1e3,()=>50,()=>"Speed - 1",()=>40,()=>1200,()=>7,()=>600,()=>"Jump- 2",()=>1500,()=>2e3,()=>"teleport - 3",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(2,3)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1,3)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(2,3,4)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1,3,4)},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1,2,4)},()=>"shield - 4",e=>{const t=e._GetNode(0);return()=>t.ExpObject()-5},()=>-150,()=>"super - 5",()=>"fly- 6",()=>200,()=>"trumpoline - 7",()=>6,()=>"small - 8",()=>20,()=>45,()=>33,()=>90,()=>65,()=>"big - 9",()=>8,()=>180,()=>130,e=>{const t=e._GetNode(0);return()=>t.ExpObject()-18},()=>80,()=>"opacity - 10",()=>9,e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(0,1,2,3,4,5,6,9)},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t("ui")+s.ExpObject()/2+40},e=>{const t=e._GetNode(0);return()=>t.ExpObject()/2+30},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t("ui")-s.ExpObject()/2-30},e=>{const t=e._GetNode(0).GetBoundMethod(),s=e._GetNode(1);return()=>t("win")-s.ExpObject()/2+10},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()+s.ExpObject()+300},e=>{const t=e._GetNode(0);return()=>t.ExpInstVar()},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()-s.ExpObject()/2-200},e=>{const t=e._GetNode(0),s=e._GetNode(1);return()=>t.ExpObject()-s.ExpObject()-200},()=>3e-5,()=>4146153,()=>16481024,()=>3005951,()=>4575502,()=>"2",()=>1051,()=>.4,()=>900,()=>"3",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1)-100},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t(1)+100},e=>{const t=e._GetNode(0);return()=>1.15*t.ExpObject()},e=>{const t=e._GetNode(0).GetVar();return()=>t.GetValue()+400},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("ui2")+50},()=>"RadialBlur",e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("ui2")+75},e=>{const t=e._GetNode(0).GetBoundMethod();return()=>t("ui2")-75},()=>2743807,()=>"settings",()=>1080,()=>3063,t=>{const s=t._GetNode(0);return()=>e.lerp(s.ExpObject(),0,.2)},t=>{const s=t._GetNode(0);return()=>e.lerp(s.ExpObject(),270,.2)},()=>1720,()=>1120,()=>2120,()=>1520,()=>1920,()=>2320,()=>1320,()=>2520,()=>"right",e=>{const t=e._GetNode(0);return()=>t.ExpObject()+200},()=>"left",e=>{const t=e._GetNode(0);return()=>t.ExpObject()-200},()=>60,()=>120,e=>{const t=e._GetNode(0),s=e._GetNode(1).GetBoundMethod();return()=>t.ExpObject()+s(0)/3},()=>-1e3,()=>"mm",()=>-25]}